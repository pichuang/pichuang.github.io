
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Open Knowledge, Open Source, Open Mind">
      
      
        <meta name="author" content="Phil Huang">
      
      
        <link rel="canonical" href="https://blog.pichuang.com.tw/category/openshift/">
      
      
        <link rel="prev" href="../openai/">
      
      
        <link rel="next" href="../personal/">
      
      
        
      
      
      <link rel="icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3+insiders-4.49.2">
    
    
      
        <title>openshift - Phil's Workspace</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.67c3bdf0.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7COverpass+Mono+SemiBold:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Overpass Mono SemiBold"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8MQRY98QB2"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8MQRY98QB2",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8MQRY98QB2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openshift" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
  <a href="https://www.youtube.com/@pichuang-tw" style="color:white;">
    For updates follow <strong>@pichuang-tw</strong> on
    <strong>YouTube Channel ğŸ¥ </strong>
  </a>

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Phil&#39;s Workspace" class="md-header__button md-logo" aria-label="Phil's Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.97 5.92a.967.967 0 0 0-1.18-.68l-3.4.91-4.44-4.12-1.23.33 2.66 4.59-3.19.85-1.26-.98-.93.25 1.66 2.88 10.62-2.84c.52-.15.82-.68.69-1.19M21 10l-1 2h-5l-1-2 1-1h2V7h1v2h2l1 1m1 10v2H2v-2h13v-7h5v7h2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Phil's Workspace
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              openshift
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pichuang/pichuang.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    blog.pichuang.com.tw
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../wiki/" class="md-tabs__link">
          
  
    
  
  Wiki

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../azure-subnets/" class="md-tabs__link">
          
  
    
  
  Azure Visual Subnet Calculator

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../about/" class="md-tabs__link">
          
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Phil&#39;s Workspace" class="md-nav__button md-logo" aria-label="Phil's Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.97 5.92a.967.967 0 0 0-1.18-.68l-3.4.91-4.44-4.12-1.23.33 2.66 4.59-3.19.85-1.26-.98-.93.25 1.66 2.88 10.62-2.84c.52-.15.82-.68.69-1.19M21 10l-1 2h-5l-1-2 1-1h2V7h1v2h2l1 1m1 10v2H2v-2h13v-7h5v7h2Z"/></svg>

    </a>
    Phil's Workspace
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pichuang/pichuang.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    blog.pichuang.com.tw
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    azure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    container
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../homecloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    homecloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    misc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../o11y/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    o11y
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../openai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    openai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    openshift
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    openshift
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-4-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹äºŒ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-4-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-pod-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-v4" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift v4 æ±è¥¿å—åŒ—å‘ç¶²è·¯æµ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-v311" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift v3.11 æ±è¥¿å—åŒ—å‘ç¶²è·¯æ¢è¨
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-services-pods" class="md-nav__link">
    <span class="md-ellipsis">
      
        å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../personal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    personal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../sla/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    sla
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../sustainability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    sustainability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Authors
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Authors
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../author/url/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Phil Huang
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../wiki/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Wiki
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Wiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Azure Visual Subnet Calculator
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Azure Visual Subnet Calculator
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../azure-subnets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Visual Subnet Calculator (Azure Edition)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Who is Phil Huang?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recording/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Recording
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="openshift">openshift</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-29 00:00:00">May 29, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-4-etcd"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹äºŒ</a></h2>
<p>æ‰¿è¥²ä¸Šæ–‡ <a href="https://blog.pichuang.com.tw/20200528-openshift-etcd-operator-1/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a>ï¼Œç¹¼çºŒé‡å°ç¡¬ç¢Ÿçš„éƒ¨åˆ†é€²è¡Œèª¿æ•´ï¼Œç•¢ç«Ÿ etcd å°<a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/hardware.md#disks">ç¡¬ç¢Ÿ</a> IOPS ç›¸ç•¶è¦æ±‚ï¼Œå»ºè­°ç”¨ SSD æ¯”è¼ƒå¥½</p>
<p>æ²’æ„å¤–çš„ï¼Œé–‹å ´åˆ†äº«å€‹ <a href="https://www.openshift.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7">Deploying OpenShift 4.4 to VMware vSphere 7</a>ï¼Œæ•´é«”ä¸Šæ¯”è¼ƒé‡è¦çš„æ˜¯åˆ©ç”¨ VMware vSphere 7 è£¡é¢çš„ DRS (Dynamic Resource Scheduler) åŠ NSX-T çš„éƒ¨åˆ†ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒå†èªª</p>
<p>{% youtube PdyNQXpYknI %}</p>
<!--more-->

<h3 id="etcd"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#etcd">etcd ç¯€é»ç¡¬ç¢Ÿèª¿æ•™</a></h3>
<blockquote>
<p>ionice: set or get process I/O scheduling class and priority</p>
</blockquote>
<p>é€™é‚Šä½¿ç”¨ <a href="https://www.systutorials.com/docs/linux/man/1-ionice/">ionice (1) - Linux Man Pages</a> ä¾†å®Œæˆé€™ä»¶äº‹ï¼Œå‰›å¥½ CoreOS å…§å»ºæœ‰æ”¯æ´é€™å€‹æŒ‡ä»¤ XDï¼Œå·®é»å°±è¦åŒ…ä¸€å€‹ Container è€Œä¸”è¦è »é«˜çš„æ¬Šé™ (éœ€è¦ root) å»å®šæœŸåŸ·è¡Œäº†</p>
<h4 id="before"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#before">Before</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>pgrep<span class="w"> </span>etcd
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="m">740369</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="m">740441</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>ps<span class="w"> </span>uax<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="m">740369</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>root<span class="w">      </span><span class="m">740369</span><span class="w">  </span><span class="m">7</span>.6<span class="w">  </span><span class="m">8</span>.4<span class="w"> </span><span class="m">9672968</span><span class="w"> </span><span class="m">1382392</span><span class="w"> </span>?<span class="w">     </span>Ssl<span class="w">  </span><span class="m">17</span>:05<span class="w">   </span><span class="m">4</span>:25<span class="w"> </span>etcd<span class="w"> </span>--initial-advertise-peer-urls<span class="o">=</span>https://10.0.97.3:2380<span class="w"> </span>--cert-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.crt<span class="w"> </span>--key-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.key<span class="w"> </span>--trusted-ca-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt<span class="w"> </span>--client-cert-auth<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--peer-cert-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt<span class="w"> </span>--peer-key-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key<span class="w"> </span>--peer-trusted-ca-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt<span class="w"> </span>--peer-client-cert-auth<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--advertise-client-urls<span class="o">=</span>https://10.0.97.3:2379<span class="w"> </span>--listen-client-urls<span class="o">=</span>https://0.0.0.0:2379<span class="w"> </span>--listen-peer-urls<span class="o">=</span>https://0.0.0.0:2380<span class="w"> </span>--listen-metrics-urls<span class="o">=</span>https://0.0.0.0:9978
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>core<span class="w">      </span><span class="m">901685</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">12760</span><span class="w">  </span><span class="m">1076</span><span class="w"> </span>pts/0<span class="w">    </span>S+<span class="w">   </span><span class="m">18</span>:03<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>grep<span class="w"> </span>--color<span class="o">=</span>auto<span class="w"> </span><span class="m">740369</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>ps<span class="w"> </span>uax<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>root<span class="w">      </span><span class="m">740441</span><span class="w">  </span><span class="m">0</span>.9<span class="w">  </span><span class="m">0</span>.1<span class="w"> </span><span class="m">124764</span><span class="w"> </span><span class="m">25288</span><span class="w"> </span>?<span class="w">        </span>Ssl<span class="w">  </span><span class="m">17</span>:05<span class="w">   </span><span class="m">0</span>:32<span class="w"> </span>etcd<span class="w"> </span>grpc-proxy<span class="w"> </span>start<span class="w"> </span>--endpoints<span class="w"> </span>https://10.0.97.3:9978<span class="w"> </span>--metrics-addr<span class="w"> </span>https://0.0.0.0:9979<span class="w"> </span>--listen-addr<span class="w"> </span><span class="m">127</span>.0.0.1:9977<span class="w"> </span>--key<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key<span class="w"> </span>--key-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.key<span class="w"> </span>--cert<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt<span class="w"> </span>--cert-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.crt<span class="w"> </span>--cacert<span class="w"> </span>/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt<span class="w"> </span>--trusted-ca-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/configmaps/etcd-metrics-proxy-serving-ca/ca-bundle.crt
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>core<span class="w">      </span><span class="m">902165</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">12760</span><span class="w">  </span><span class="m">1060</span><span class="w"> </span>pts/0<span class="w">    </span>S+<span class="w">   </span><span class="m">18</span>:03<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>grep<span class="w"> </span>--color<span class="o">=</span>auto<span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="c1"># Get priority and class</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-p<span class="w"> </span><span class="m">740369</span><span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>none:<span class="w"> </span>prio<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>none:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<h4 id="tuning"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#tuning">Tuning</a></h4>
<p>æˆ‘å€‘å¯ä»¥ç›´æ¥ç™»å…¥ CoreOS å¾Œä¸‹ <code>ionice</code> å°ç‰¹å®š PID å’Œç¡¬ç¢Ÿè™•ç†æ¬Šé™æ‹‰é«˜ï¼Œå¯ä»¥æ­é… ansible ä¾†é‡å° master node åŸ·è¡Œ</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Set priority and class</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-c2<span class="w"> </span>-n0<span class="w"> </span>-p<span class="w"> </span><span class="sb">`</span>pgrep<span class="w"> </span>etcd<span class="sb">`</span>
</code></pre></div>
  - <code>-c2</code>: best-effort
  - <code>-n0</code>: the highest priority level</p>
<h4 id="after"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#after">After</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>pgrep<span class="w"> </span>etcd
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="m">740369</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="m">740441</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-p<span class="w"> </span><span class="m">740369</span><span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>best-effort:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>best-effort:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<h3 id="_1"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#_1">å¾Œè©±</a></h3>
<p>æ©...åæ­£è£ etcd çš„é‚£å€‹ç¯€é»ä¹‹ç¡¬ç¢Ÿé¸ç”¨é«˜ IOPSï¼Œä¾‹å¦‚ç”¨ SSDï¼Œæ•ˆç‡å’Œç©©å®šæ€§æœƒæå‡ä¸å°‘</p>
<h3 id="references"><a class="toclink" href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#references">References</a></h3>
<ul>
<li><a href="https://www.systutorials.com/docs/linux/man/1-ionice/">ionice (1) - Linux Man Pages</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/architecture/architecture-rhcos.html">machineconfig</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/111245626">etcd æ€§èƒ½æµ‹è¯•ä¸è°ƒä¼˜</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/nodes/jobs/nodes-pods-daemonsets.html">Running background tasks on nodes automatically with daemonsets</a></li>
<li><a href="https://rancher.com/docs/rancher/v2.x/en/installation/options/etcd/">Tuning etcd for Large Installations - Rancher</a></li>
<li><a href="https://blog.pichuang.com.tw/20200528-openshift-etcd-operator-1/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/hardware.md#disks">etcd - hardware</a></li>
<li><a href="https://www.openshift.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7">Deploying OpenShift 4.4 to VMware vSphere 7</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-28 00:00:00">May 28, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-4-etcd"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a></h2>
<p>æ‰“å¾ OpenShift 4 ä¹‹å¾Œï¼Œetcd çš„å®‰è£è®Šæˆæ˜¯é€é <code>etcd-operator</code> ä¾†é€²è¡Œå®‰è£çš„ï¼Œé è¨­ç‹€æ³ä¸‹ä¸€æ¬¡æœƒå»ºç«‹ 3 å€‹ etcd instancesï¼Œç„¶å¾ŒæŠŠä»–å€‘å¼„æˆä¸€å€‹ etcd clusterï¼Œæœ¬æ–‡æœƒè¨˜éŒ„ä¸€äº›é—œæ–¼ OpenShift è·Ÿ etcd ä¹‹é–“çš„ä¸€äº›æ“ä½œè¨˜éŒ„</p>
<p><img alt="" src="/images/etcd-operator-overview.png" /></p>
<!--more-->

<h3 id="oc-etcd"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#oc-etcd">é€é oc æª¢æŸ¥ etcd ç‹€æ…‹</a></h3>
<p>æ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œæ­£å¸¸ç‹€æ…‹ä¸‹ä¸€å®šæ˜¯è¦å¥½çš„ï¼Œå®ƒçš„ç©©å®šæ€§æœƒç›´æ¥é—œè¯åˆ° etcd å¢é›†çš„ç©©å®šæ€§ï¼Œå…©é»ä¹‹é–“å»ºè­°é ˆä½æ–¼ <code>&gt;100ms</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>openshift-etcd<span class="w"> </span>-o<span class="w"> </span>wide<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>etcd
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>etcd-control-plane-0<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.1<span class="w">     </span>control-plane-0<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>etcd-control-plane-1<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.2<span class="w">     </span>control-plane-1<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>etcd-control-plane-2<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.3<span class="w">     </span>control-plane-2<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
</code></pre></div>
<h3 id="etcd"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcd">æª¢æŸ¥ etcd å¢é›†ç‹€æ…‹</a></h3>
<p>æ¡ç”¨è·Ÿå‰ä¸€ç¯‡ä»‹ç´¹çš„æ–¹æ³• <a href="https://blog.pichuang.com.tw/20200521-openshift-with-coreos-part-7/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a> é€²è¡Œ <code>etcdctl</code> çš„åŸºç¤æ“ä½œ</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-n<span class="w"> </span>openshift-etcd<span class="w"> </span>etcd-control-plane-0
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>Defaulting<span class="w"> </span>container<span class="w"> </span>name<span class="w"> </span>to<span class="w"> </span>etcdctl.
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Use<span class="w"> </span><span class="s1">&#39;oc describe pod/etcd-control-plane-0 -n openshift-etcd&#39;</span><span class="w"> </span>to<span class="w"> </span>see<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>containers<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>pod.
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>version
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>etcdctl<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3.18
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>API<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>endpoint<span class="w"> </span>status<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="p">|</span><span class="w">        </span>ENDPOINT<span class="w">        </span><span class="p">|</span><span class="w">        </span>ID<span class="w">        </span><span class="p">|</span><span class="w"> </span>VERSION<span class="w"> </span><span class="p">|</span><span class="w"> </span>DB<span class="w"> </span>SIZE<span class="w"> </span><span class="p">|</span><span class="w"> </span>IS<span class="w"> </span>LEADER<span class="w"> </span><span class="p">|</span><span class="w"> </span>RAFT<span class="w"> </span>TERM<span class="w"> </span><span class="p">|</span><span class="w"> </span>RAFT<span class="w"> </span>INDEX<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>8e7cdeadd4c04bd3<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>65124c220e1d1efa<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="nb">false</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>23675b8f347a5bea<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="nb">false</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>endpoint<span class="w"> </span>health<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="p">|</span><span class="w">        </span>ENDPOINT<span class="w">        </span><span class="p">|</span><span class="w"> </span>HEALTH<span class="w"> </span><span class="p">|</span><span class="w">    </span>TOOK<span class="w">     </span><span class="p">|</span><span class="w"> </span>ERROR<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">12</span>.52718ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">16</span>.830977ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">21</span>.484222ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>member<span class="w"> </span>list<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>+------------------+---------+-----------------+------------------------+------------------------+
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="p">|</span><span class="w">        </span>ID<span class="w">        </span><span class="p">|</span><span class="w"> </span>STATUS<span class="w">  </span><span class="p">|</span><span class="w">      </span>NAME<span class="w">       </span><span class="p">|</span><span class="w">       </span>PEER<span class="w"> </span>ADDRS<span class="w">       </span><span class="p">|</span><span class="w">      </span>CLIENT<span class="w"> </span>ADDRS<span class="w">      </span><span class="p">|</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>+------------------+---------+-----------------+------------------------+------------------------+
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="p">|</span><span class="w"> </span>23675b8f347a5bea<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-2<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="p">|</span><span class="w"> </span>65124c220e1d1efa<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="p">|</span><span class="w"> </span>8e7cdeadd4c04bd3<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-0<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>+------------------+---------+-----------------+------------------------+------------------------+
</code></pre></div>
<h3 id="etcdctl"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcdctl">ä½¿ç”¨ etcdctl åŸç”Ÿæ•ˆèƒ½æª¢æŸ¥</a></h3>
<p>æ‰¿ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ etcdctl åšä¸€å€‹ 60 ç§’çš„æª¢æ¸¬ï¼Œ
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>check<span class="w"> </span>perf<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w"> </span><span class="m">60</span><span class="w"> </span>/<span class="w"> </span><span class="m">60</span><span class="w"> </span>Boooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo!<span class="w"> </span><span class="m">100</span>.00%1m0s
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>PASS:<span class="w"> </span>Throughput<span class="w"> </span>is<span class="w"> </span><span class="m">150</span><span class="w"> </span>writes/s
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>PASS:<span class="w"> </span>Slowest<span class="w"> </span>request<span class="w"> </span>took<span class="w"> </span><span class="m">0</span>.134647s
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>PASS:<span class="w"> </span>Stddev<span class="w"> </span>is<span class="w"> </span><span class="m">0</span>.003738s
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>PASS
</code></pre></div></p>
<h3 id="_1"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#_1">é—œæ–¼é è¨­åƒæ•¸</a></h3>
<p>é€é <code>oc describe pod/etcd-control-plane-0 -n openshift-etcd</code> å¯çŸ¥ï¼Œ</p>
<ol>
<li>ETCD é¸èˆ‰è¶…æ™‚é è¨­æ™‚é–“ (ETCD_ELECTION_TIMEOUT): 1000ms</li>
<li>ETCD å¿ƒè·³é–“éš”é è¨­æ™‚é–“ (ETCD_HEARTBEAT_INTERVAL): 100ms</li>
</ol>
<p>etcd çš„åˆ†æ•£å¼ä¸€è‡´æ€§å”å®šä»°è³´ä¸Šè¿° 2 å€‹åƒæ•¸ä¾†ä¿è­‰ç¯€é»ä¹‹é–“èƒ½å¤ åœ¨éƒ¨åˆ†ç¯€é»æ–·ç·šçš„ç‹€æ³ä¸‹ä¾ç„¶èƒ½å¤ æ­£ç¢ºè™•ç† Leader Node çš„é¸èˆ‰ã€‚</p>
<p>ä¾æ“š <a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a> åŠå€‹äººç¶“é©—å¯çŸ¥ï¼Œ<code>ETCD_HEARTBEAT_INTERVAL</code>ï¼Œå³ç”± Leader ç¯€é»é€šçŸ¥å…¶ä»–ç¯€é» <code>å®ƒé‚„æ˜¯ Leader</code> çš„é »ç‡ï¼Œå»ºè­°è¨­å®šç‚º 2 å€‹ç¯€é»ä¹‹é–“ RTT æœ€å¤§å€¼æ™‚é–“ * 1 ~ 1.5 å€ï¼Œè‹¥è©²å€¼è¨­å®šå¤ªçŸ­ï¼Œetcd æœƒç™¼é€ç„¡ç”¨çš„å¿ƒè·³ç¢ºèªè¨Šæ¯ï¼Œåè€Œå¢åŠ  CPU / Network / Disk ç„¡è¬‚çš„è³‡æºæ¶ˆè€—ï¼›è‹¥è©²å€¼è¨­å®šå¤ªé•·ï¼Œå°±æœƒå°è‡´ç›£æ§ç¯€é»ç•°å¸¸æ™‚é–“éé•·ï¼Œæœƒæœ‰é‡æ–°é¸èˆ‰çš„äº‹æƒ…ç™¼ç”Ÿã€‚åˆ¤æ–· RTT çš„æœ€ç°¡å–®æ–¹å¼å°±æ˜¯ä½¿ç”¨ pingï¼Œå¦‚ä¸‹</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># ç™»å…¥ç¯€é»</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>node/control-plane-0
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>Starting<span class="w"> </span>pod/control-plane-0-debug<span class="w"> </span>...
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>To<span class="w"> </span>use<span class="w"> </span>host<span class="w"> </span>binaries,<span class="w"> </span>run<span class="w"> </span><span class="sb">`</span>chroot<span class="w"> </span>/host<span class="sb">`</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.0.97.1
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>sh-4.2#<span class="w"> </span>chroot<span class="w"> </span>/host
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>sh-4.4#<span class="w"> </span>ping<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span>-c60
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>PING<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span><span class="o">(</span><span class="m">10</span>.0.97.5<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.191<span class="w"> </span>ms
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.151<span class="w"> </span>ms
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.213<span class="w"> </span>ms
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>...omit...
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">59</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.142<span class="w"> </span>ms
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">60</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.204<span class="w"> </span>ms
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>---<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="m">60</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">60</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>59000ms
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.112/0.212/0.435/0.054<span class="w"> </span>ms
</code></pre></div>
<p>å¦‚ä¸Šé¢æ•¸å­—è¡¨ç¾ï¼ŒRTT æ¸¬è©¦å‡ºä¾†æ˜¯ <code>0.435ms</code>ï¼Œé ä½æ–¼é è¨­å€¼ <code>100ms</code>ï¼Œæ‰€ä»¥å°±ä¸ç”¨ç‰¹åˆ¥æ”¹</p>
<p><code>ETCD_ELECTION_TIMEOUT</code>ï¼Œå‰‡æ˜¯è¡¨ç¤ºå¦‚æœç¯€é»ç­‰å¾…å¤šä¹…æ²’æ”¶åˆ° Leader çš„å¿ƒè·³ç¢ºèªçš„è©±ï¼Œå°±æœƒé–‹å§‹å˜—è©¦å»ç«¶é¸ Leader çš„ä½å­ï¼Œå»ºè­°è¨­å®šç‚º 2 å€‹ç¯€é»ä¹‹é–“ RTT æœ€å¤§å€¼æ™‚é–“ * 10ï¼Œä»¥æ‡‰å°ç¶²è·¯è®ŠåŒ–ï¼Œæ•…å¦‚æœåŸæœ‰ RTT ç‚º 100ms çš„è©±ï¼Œå‰‡é¸èˆ‰è¶…æ™‚è¨­å®šå‰‡ç‚º 1000msã€‚</p>
<p>å¦å¤–é¸èˆ‰è¶…æ™‚å»ºè­°ä¸Šé™å€¼ç‚º 50,000 msï¼Œå¿ƒè·³é–“éš”ä¸Šé™å€¼ç‚º 5,000 ms</p>
<h3 id="etcd-database"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcd-database">å‚™ä»½ etcd database</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$<span class="w"> </span>ssh<span class="w"> </span>core@control-plane-1<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa_ocp4_vcenter.pub
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Last<span class="w"> </span>login:<span class="w"> </span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">16</span>:49:17<span class="w"> </span><span class="m">2020</span><span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.100
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="c1"># Backup</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>/usr/local/bin/cluster-backup.sh<span class="w"> </span>./assets/backup
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>385e44c057e47b6fe0b02d534dc4cb452056d33f9174271d1ecced45bc317e50
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>etcdctl<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3.18
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>API<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-apiserver-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-apiserver-pod-131
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-controller-manager-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-controller-manager-pod-13
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-scheduler-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-scheduler-pod-17
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>found<span class="w"> </span>latest<span class="w"> </span>etcd-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/etcd-pod-139
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>Snapshot<span class="w"> </span>saved<span class="w"> </span>at<span class="w"> </span>./assets/backup/snapshot_2020-05-27_165016.db
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>snapshot<span class="w"> </span>db<span class="w"> </span>and<span class="w"> </span>kube<span class="w"> </span>resources<span class="w"> </span>are<span class="w"> </span>successfully<span class="w"> </span>saved<span class="w"> </span>to<span class="w"> </span>./assets/backup
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="c1"># Check</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./assets/backup/
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>backup<span class="o">]</span>$<span class="w"> </span>ls
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>snapshot_2020-05-27_165016.db<span class="w">  </span>static_kuberesources_2020-05-27_165016.tar.gz
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="c1"># Copy to outside</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>backup<span class="o">]</span>$<span class="w"> </span>scp<span class="w"> </span>snapshot_2020-05-27_165016.db<span class="w"> </span>static_kuberesources_2020-05-27_165016.tar.gz<span class="w"> </span>root@bastion.ocp4.internal:~/
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>snapshot_2020-05-27_165016.db<span class="w">                                                                                                             </span><span class="m">100</span>%<span class="w">  </span>171MB<span class="w"> </span><span class="m">135</span>.1MB/s<span class="w">   </span><span class="m">00</span>:01
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>static_kuberesources_2020-05-27_165016.tar.gz<span class="w">                                                                                             </span><span class="m">100</span>%<span class="w">   </span>64KB<span class="w">  </span><span class="m">56</span>.1MB/s<span class="w">   </span><span class="m">00</span>:00
</code></pre></div>
<p>æœ‰åœ–æœ‰çœŸç›¸</p>
<p><img alt="" src="/images/etcd-backup.png" /></p>
<h3 id="_2"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#_2">å¾Œè©±</a></h3>
<p>ä¸‹å›å¾…çºŒ</p>
<h3 id="references"><a class="toclink" href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#references">References</a></h3>
<ul>
<li><a href="https://blog.pichuang.com.tw/20200521-openshift-with-coreos-part-7/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a></li>
<li><a href="https://www.huweihuang.com/kubernetes-notes/etcd/etcdctl-v3.html">etcdctl å¸¸ç”¨å‘½ä»¤</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/backup_and_restore/backing-up-etcd.html">Backing up etcd</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/backup_and_restore/replacing-unhealthy-etcd-member.html#restore-replace-stopped-etcd-member_replacing-unhealthy-etcd-member">Replacing an unhealthy etcd member</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-21 00:00:00">May 21, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-pod-container"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a></h2>
<p>é€™å¹¾å¤©æœ‰ä½å®¢æˆ¶å•äº†ä¸€å€‹å¾ˆä¸éŒ¯çš„å•é¡Œ</p>
<blockquote>
<p>å¦‚æœåœ¨ 1 å€‹ Pod è£¡é¢ï¼Œæœ‰ 2 å€‹ Containers çš„ç‹€æ³ä¸‹ï¼ŒOpenShift è©²å¦‚ä½•é‡å°ç‰¹å®šçš„ Container é€²è¡Œæ“ä½œ?</p>
</blockquote>
<p>æŒ‰ç…§ Kuberentes çš„è¨­è¨ˆï¼ŒKubernetes æœ€å°å–®ä½æ˜¯ Podï¼Œè€Œä¸æ˜¯ Containerï¼Œç„¶è€Œ 1 å€‹ Podï¼Œå¯ä»¥æœ‰ 1 å€‹æˆ–å¤šå€‹çš„ Container è¢«åŒ…å«åœ¨è£¡é¢ï¼Œåœ–ç¤ºå¯ä»¥åƒè€ƒ <a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking?slide=6">20190817 Container Bare Metal for Networking</a>ï¼Œä½†å¯¦éš›ä¸Šé‡åˆ°å¤šå€‹ Container è¢«åŒ…å«åœ¨ 1 å€‹ Pods çš„æ™‚å€™ï¼Œåœ¨ OpenShift è£¡é¢æ˜¯æ€éº¼æ“ä½œçš„å‘¢? ç§‰æŒè‘—æœ¬äººéµå¾ªå®¢æˆ¶é©…å‹•æœå‹™ (Customer Driven Service)ï¼Œç‰¹åˆ¥å¯«ä¸€ç¯‡è¨˜éŒ„</p>
<p>å› ç‚ºæœ€è¿‘å¤ªç´¯ï¼Œæ‡¶å¾—æƒ³æ¢—åœ–ï¼Œæ‰€ä»¥é™„ä¸Šä¸€å€‹è¿‘æœŸæˆ‘è¦ºå¾—ç›¸ç•¶ä¸éŒ¯çš„ Demoï¼Œåœ¨ OpenShift è£¡é¢é–‹ Windows Server 2019 èµ·ä¾†åšä½¿ç”¨</p>
<p>{% youtube Kx110kqoHo0 %}</p>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#_1">èµ°é¦¬çœ‹èŠ±ä¹‹æ—…: ç¬¬ä¸ƒå¤©</a></h3>
<h4 id="pods-container"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#pods-container">é¡¯ç¤ºä¸€å€‹ Pods è£¡é¢æ‰€åŒ…å«çš„ Container</a></h4>
<p>é è¨­ç‹€æ³ä¸‹ï¼Œå…¶å¯¦å…§å»ºçš„ <code>api-resources</code> ä¸¦æ²’æœ‰åŒ…å«ä¸€å€‹é¡å‹æ˜¯ <code>container</code>ï¼Œæ‰€ä»¥å¦‚æœè¦çŸ¥é“ä¸€å€‹ Pod è£¡é¢æœ‰åŒ…å«å¤šå°‘å€‹ Container èƒ½ç”¨ä¸‹åˆ— 2 å€‹æ–¹å¼æ‰¾</p>
<ol>
<li>
<p>é€é oc æŒ‡ä»¤ filter å‡ºä¾†
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># å…ˆç²å¾—åˆ° Pod æ¸…å–®ï¼Œé€™é‚Šé¸æ“‡ productpage-v1-597b74b4c-x2pgk</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>NAME<span class="w">                             </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>details-v1-6657b8bdf-mm4r4<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>productpage-v1-597b74b4c-x2pgk<span class="w">   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>ratings-v1-66cddbfb8f-wvpbz<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>reviews-v1-6788566f98-slm9q<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>reviews-v2-7c4bffdcc4-6wmg2<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>reviews-v3-69b6d8786-rbhw5<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="c1"># oc get pods &lt;PDO NAME&gt; -o jsonpath=&#39;{.spec.containers[*].name}&#39;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>productpage-v1-597b74b4c-x2pgk<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.containers[*].name}&#39;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>productpage<span class="w"> </span>istio-proxy
</code></pre></div></p>
</li>
<li>
<p>é€é OpenShift Web Console</p>
</li>
</ol>
<p>é€™å€‹åšæ³•æ˜¯ç›´æ¥é€éç›¸ç•¶å¥½ç”¨çš„ Web Console ç›´æ¥è§€å¯Ÿï¼Œç›´è§€æ–¹ä¾¿</p>
<p><img alt="" src="/images/show-containes.png" /></p>
<h4 id="container"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#container">ç™»å…¥å…¶ä¸­ä¸€å€‹ Container è£¡é¢</a></h4>
<p>ä¸€æ¨£ä¹Ÿæ˜¯ 2 ç¨®æ–¹å¼</p>
<ol>
<li>é€é oc rsh æŒ‡ä»¤</li>
</ol>
<p>Red Hat OpenShift æœ‰ä¸€å€‹å…§å»ºçš„æŒ‡ä»¤å¯ä»¥åšåˆ° - <code>oc rsh</code></p>
<blockquote>
<p>oc rsh = Open a remote shell session to a container</p>
</blockquote>
<p>ä¸€èˆ¬ç‹€æ³ä¸‹ï¼Œ<code>oc rsh &lt;PDO NAME&gt;</code> éƒ½æ˜¯ç›´æ¥é€£åˆ°<code>ç¬¬ä¸€å€‹</code> Containerï¼Œå¦‚æœè¦é¸æ“‡è£¡é¢çš„ç¬¬äºŒå€‹ï¼Œæ›´ç”šè‡³æ˜¯ç¬¬ä¸‰å€‹çš„å®¹å™¨ï¼Œå‰‡éœ€è¦ç‰¹åˆ¥å¤šä¸€å€‹ <code>--container</code> æŒ‡å®šï¼Œæ›´å¤šå…§å®¹å¯ä»¥ç›´æ¥åƒè€ƒ <code>oc rsh -h</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Open a shell session on the container named &#39;index&#39; inside a pod</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># oc rsh -c &lt;CONTAINER NAME&gt; pod/&lt;PDO NAME&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-c<span class="w"> </span>istio-proxy<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>sh-4.4$<span class="w"> </span>ls
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>bin<span class="w">   </span>dev<span class="w">  </span>home<span class="w">  </span>lib64<span class="w">       </span>media<span class="w">  </span>opt<span class="w">   </span>root<span class="w">  </span>sbin<span class="w">  </span>sys<span class="w">  </span>usr
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>boot<span class="w">  </span>etc<span class="w">  </span>lib<span class="w">   </span>lost+found<span class="w">  </span>mnt<span class="w">    </span>proc<span class="w">  </span>run<span class="w">   </span>srv<span class="w">   </span>tmp<span class="w">  </span>var
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-c<span class="w"> </span>productpage<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>$<span class="w"> </span>ls
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>__pycache__<span class="w">       </span>productpage.py<span class="w">    </span>static<span class="w">      </span>stdout.log<span class="w">  </span>test_productpage.py
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>microservice.log<span class="w">  </span>requirements.txt<span class="w">  </span>stderr.log<span class="w">  </span>templates
</code></pre></div>
<p>å¥½æˆ‘çŸ¥é“å„ä½ä¸€å®šçœ‹ä¸æ‡‚ï¼Œä¸‹é¢æœ‰æˆªåœ–</p>
<p><img alt="" src="/images/rsh-container.png" /></p>
<ol>
<li>é€é OpenShift Web Console</li>
</ol>
<p>ç›¸ç•¶ç›´è§€å°±æ˜¯ç›´æ¥å° Web Console æ“ä½œï¼Œå¦‚ä¸‹åœ–ç¤ºè¡¨ç¾</p>
<p><img alt="" src="/images/terminal-container.gif" /></p>
<h4 id="container_1"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#container_1">é‡å°å…¶ä¸­ä¸€å€‹ Container é™¤éŒ¯</a></h4>
<p>åªæœ‰ä¸€å€‹ä½œæ³•ï¼Œé€é Red Hat OpenShift å…§å»ºçš„æŒ‡ä»¤ - <code>oc debug</code></p>
<blockquote>
<p>oc debug = Launch a command shell to debug a running application</p>
</blockquote>
<p>ä¸€èˆ¬ç‹€æ³ä¸‹ï¼Œå¦‚åŒ <code>oc rsh</code>ï¼Œä½¿ç”¨ <code>oc debug</code> æ™‚ï¼Œéƒ½æ˜¯ç›´æ¥é€£åˆ°<code>ç¬¬ä¸€å€‹</code> Containerï¼Œå¦‚æœè¦é¸æ“‡è£¡é¢çš„ç¬¬äºŒå€‹ï¼Œæ›´ç”šè‡³æ˜¯ç¬¬ä¸‰å€‹çš„å®¹å™¨ï¼Œå‰‡éœ€è¦ç‰¹åˆ¥å¤šä¸€å€‹ <code>--container</code> æŒ‡å®šï¼Œæ›´å¤šå…§å®¹å¯ä»¥ç›´æ¥åƒè€ƒ <code>oc debug -h</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>-c<span class="w"> </span>istio-proxy<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>Starting<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk-debug<span class="w"> </span>...
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.128.2.27
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>sh-4.4$<span class="w"> </span>ls
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>bin<span class="w">   </span>dev<span class="w">  </span>home<span class="w">  </span>lib64<span class="w">       </span>media<span class="w">  </span>opt<span class="w">   </span>root<span class="w">  </span>sbin<span class="w">  </span>sys<span class="w">  </span>usr
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>boot<span class="w">  </span>etc<span class="w">  </span>lib<span class="w">   </span>lost+found<span class="w">  </span>mnt<span class="w">    </span>proc<span class="w">  </span>run<span class="w">   </span>srv<span class="w">   </span>tmp<span class="w">  </span>var
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>sh-4.4$
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>-c<span class="w"> </span>productpage<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>Starting<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk-debug<span class="w"> </span>...
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.128.2.28
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>$<span class="w"> </span>ls
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>__pycache__<span class="w">       </span>productpage.py<span class="w">    </span>static<span class="w">     </span>test_productpage.py
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>microservice.log<span class="w">  </span>requirements.txt<span class="w">  </span>templates
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>$
</code></pre></div>
<p>ä¸€æ¨£æˆ‘çŸ¥é“å„ä½é‚„æ˜¯çœ‹ä¸æ‡‚ï¼Œæˆªåœ–å¦‚ä¸‹</p>
<p><img alt="" src="/images/debug-container.png" /></p>
<h3 id="_2"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#_2">å¾Œè©±</a></h3>
<p>å¦‚æœæœ‰ä»”ç´°çœ‹å…§å®¹çš„è©±ï¼Œå…¶å¯¦æˆ‘çš„æ“ä½œç’°å¢ƒå°±æ˜¯å»ºå¥½ä¸€å€‹ bookinfo ä¹‹å¾Œï¼ŒService Mesh è‡ªå‹•æ³¨å…¥ (inject) Sidecard é€²å»åˆ°æ¯ä¸€å€‹ Podï¼Œæ‰€ä»¥æ‰æœƒæœ‰ 1 å€‹ Pod æœƒæœ‰ 2 å€‹ Container çš„ç¾è±¡ç™¼ç”Ÿï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå€‹äººç¶“é©—é‚„æœ‰å¦‚æœéœ€è¦æ•´åˆç¶²è·¯å» å•†æ‰€æä¾›çš„ CNI Pluginï¼Œä¹Ÿæœ‰æ©Ÿæœƒæœƒé‡åˆ°é€™ç¨®ç­‰ç´šçš„æ“ä½œ</p>
<p>çµè«–ä¸Šä¾†èªªï¼Œé›–ç„¶ Kubernetes æœ€å°å–®ä½æ˜¯ Podï¼Œä¸€èˆ¬æ“ä½œçš„å±¤ç´šéƒ½æ˜¯åœ¨é€™å€‹å±¤ç´šï¼Œä½†è‹¥æƒ³åœ¨ OpenShift ä¸Šé‡å°ç‰¹å®šçš„ Container é€²è¡ŒæŒ‡ä»¤æ“ä½œã€é™¤éŒ¯ï¼Œéƒ½é‚„æ˜¯å¯ä»¥å¾ˆè¼•é¬†åœ°è¾¦åˆ°ï¼Œä¹Ÿç›¸ç•¶çš„ç›´è¦º</p>
<p>æœ€å¾Œï¼Œè«‹å¤§å®¶å¤šå¤šè¨‚é–± Red Hat æœå‹™ã€åˆ†äº«é–‹æºæŠ€è¡“åŠé–‹å•ŸæŠ€è¡“å‹å–„å¥½ç’°å¢ƒï¼Œæˆ‘å€‘å®…å®…å€‘å°±é å„ä½å®¢æˆ¶é¤Šäº† XD</p>
<h3 id="references"><a class="toclink" href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#references">References</a></h3>
<ul>
<li><a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking?slide=6">20190817 Container Bare Metal for Networking</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-04-13 00:00:00">April 13, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-v4"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/">Red Hat OpenShift v4 æ±è¥¿å—åŒ—å‘ç¶²è·¯æµ</a></h2>
<p>å»å¹´ 2019/04 çš„æ™‚å€™æœ‰é‡‹æ”¾å‡º <a href="https://blog.pichuang.com.tw/20190404-openshift-network-traffic-overview/">Red Hat OpenShift v3.11 æ±è¥¿å—åŒ—å‘ç¶²è·¯æ¢è¨ - Phil Huang</a> ä¸€æ–‡ï¼Œéäº†ä¸€å¹´å¾Œï¼ŒRed Hat OpenShift 4 å‡ºäº†ï¼Œé‚£å…©å€‹ä¸åŒå¤§ç‰ˆæœ¬çš„ç¶²è·¯è¨­è¨ˆæœ‰ä»€éº¼æ¨£å­å·®ç•°å‘¢?</p>
<p>{% youtube DMb4L92Z7z8 %}</p>
<!--more-->

<h3 id="red-hat-openshift-4"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#red-hat-openshift-4">Red Hat OpenShift 4 æ±è¥¿å—åŒ—å‘ç¶²è·¯æµ</a></h3>
<p>é¦–å…ˆå…ˆä¾†å¼µé‡å° v4 çš„æ¶æ§‹åœ–</p>
<p><img alt="" src="/images/ocp4-network-traffic.png" /></p>
<p>ä»¥ Red Hat OpenShift ç‚ºæ ¸å¿ƒè¦–è§’ï¼Œå¯ä»¥åˆ†ç‚ºä¸‰æ®µç¶²è·¯æµ</p>
<ol>
<li>åŒ—å‘ç¶²è·¯æµ Ingress Traffic</li>
<li>æ±è¥¿å‘ç¶²è·¯æµ</li>
<li>å—å‘ç¶²è·¯æµ Egress Traffic</li>
</ol>
<p>å¦å¤–ï¼Œä»¥ä¸Šé€™äº›æµé‡ï¼Œå¯¦éš›ä¸Šéƒ½æ˜¯é€éæ¯ä¸€å°ç¯€é»ä¸Šçš„ <code>Node IP</code> é€²è¡Œæºé€šçš„ï¼Œä¹Ÿå°±æ˜¯ä½ åªéœ€è¦æä¾›é€™äº›ç¯€é»<code>ä¸€å€‹ IP</code> å³å¯ä½¿ç”¨ï¼Œæ„æŒ‡<code>ä¸éœ€è¦æŒ‡æ´¾å¤šç¶²å¡æ–¼å–®ä¸€ç¯€é»ä¸Š</code>ï¼Œé‚£å…·é«”æ˜¯å“ªå€‹ IP å‘¢? ä¸»è¦æ˜¯çœ‹ <code>INTERNAL-IP</code> é‚£å€‹æ¬„ä½çš„ IP</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>NAME<span class="w">              </span>STATUS<span class="w">   </span>ROLES<span class="w">    </span>AGE<span class="w">   </span>VERSION<span class="w">   </span>INTERNAL-IP<span class="w">   </span>EXTERNAL-IP<span class="w">   </span>OS-IMAGE<span class="w">                                                       </span>KERNEL-VERSION<span class="w">                </span>CONTAINER-RUNTIME
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>compute-0<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>26d<span class="w">   </span>v1.16.2<span class="w">   </span><span class="m">10</span>.0.97.4<span class="w">     </span><span class="m">10</span>.0.97.4<span class="w">     </span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="w"> </span>CoreOS<span class="w"> </span><span class="m">43</span>.81.202003230848.0<span class="w"> </span><span class="o">(</span>Ootpa<span class="o">)</span><span class="w">   </span><span class="m">4</span>.18.0-147.5.1.el8_1.x86_64<span class="w">   </span>cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>compute-1<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>26d<span class="w">   </span>v1.16.2<span class="w">   </span><span class="m">10</span>.0.97.5<span class="w">     </span><span class="m">10</span>.0.97.5<span class="w">     </span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="w"> </span>CoreOS<span class="w"> </span><span class="m">43</span>.81.202003230848.0<span class="w"> </span><span class="o">(</span>Ootpa<span class="o">)</span><span class="w">   </span><span class="m">4</span>.18.0-147.5.1.el8_1.x86_64<span class="w">   </span>cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>control-plane-0<span class="w">   </span>Ready<span class="w">    </span>master<span class="w">   </span>26d<span class="w">   </span>v1.16.2<span class="w">   </span><span class="m">10</span>.0.97.1<span class="w">     </span><span class="m">10</span>.0.97.1<span class="w">     </span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="w"> </span>CoreOS<span class="w"> </span><span class="m">43</span>.81.202003230848.0<span class="w"> </span><span class="o">(</span>Ootpa<span class="o">)</span><span class="w">   </span><span class="m">4</span>.18.0-147.5.1.el8_1.x86_64<span class="w">   </span>cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>control-plane-1<span class="w">   </span>Ready<span class="w">    </span>master<span class="w">   </span>26d<span class="w">   </span>v1.16.2<span class="w">   </span><span class="m">10</span>.0.97.2<span class="w">     </span><span class="m">10</span>.0.97.2<span class="w">     </span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="w"> </span>CoreOS<span class="w"> </span><span class="m">43</span>.81.202003230848.0<span class="w"> </span><span class="o">(</span>Ootpa<span class="o">)</span><span class="w">   </span><span class="m">4</span>.18.0-147.5.1.el8_1.x86_64<span class="w">   </span>cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>control-plane-2<span class="w">   </span>Ready<span class="w">    </span>master<span class="w">   </span>26d<span class="w">   </span>v1.16.2<span class="w">   </span><span class="m">10</span>.0.97.3<span class="w">     </span><span class="m">10</span>.0.97.3<span class="w">     </span>Red<span class="w"> </span>Hat<span class="w"> </span>Enterprise<span class="w"> </span>Linux<span class="w"> </span>CoreOS<span class="w"> </span><span class="m">43</span>.81.202003230848.0<span class="w"> </span><span class="o">(</span>Ootpa<span class="o">)</span><span class="w">   </span><span class="m">4</span>.18.0-147.5.1.el8_1.x86_64<span class="w">   </span>cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8
</code></pre></div>
<h4 id="ingress-traffic"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#ingress-traffic">åŒ—å‘: Ingress Traffic</a></h4>
<p>Ingress ä¸»è¦çš„ç›®çš„å°±æ˜¯è®“å¤–éƒ¨ä½¿ç”¨è€…å¯ä»¥é€é Ingress Controller ä»¥æ¥è§¸åˆ° Kubernestes è£¡é¢çš„ Serviceï¼Œè€Œåœ¨ Red Hat OpenShift è£¡é¢çš„è¡“èªå‰‡æ˜¯ä½¿ç”¨ Router ä¾†åšé—¡è¿°</p>
<p>éš¨è‘—å„å¼å„æ¨£çš„æœå‹™éƒ½åœ¨ OpenShift 4 ä¸Šéƒ½è¢«å¯¦ä½œæˆ Operator Frameworkï¼Œç•¶ç„¶é€£ Ingress Controller ä¹Ÿä¸ä¾‹å¤–ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ<a href="https://docs.openshift.com/container-platform/4.3/networking/configuring_ingress_cluster_traffic/overview-traffic.html">Configuring ingress cluster traffic overview - OpenShift 4.3</a></p>
<p>å¾å¤–éƒ¨é€£åˆ°åˆ° OpenShift ä¸Š Service çš„æ–¹å¼ä¸»è¦æœ‰ 4 ç¨®æ–¹å¼</p>
<ol>
<li>ä½¿ç”¨ OpenShift Router</li>
<li>ä½¿ç”¨ Service Type: LoadBalancer</li>
<li>ä½¿ç”¨ externalIngressIP</li>
<li>ä½¿ç”¨ nodePort</li>
</ol>
<p>è©³ç´°å¯ä»¥åƒè€ƒ <a href="https://blog.pichuang.com.tw/20190321-reach-out-services-and-pods-from-outside-into-openshift/">å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods</a></p>
<h4 id="east-west-traffic"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#east-west-traffic">æ±è¥¿å‘: East-West Traffic</a></h4>
<p>åœ¨ Red Hat OpenShift å¹³å°åº•ä¸‹ï¼Œç„¡è«–æ˜¯è¦è·¨ Pod / Service / Host é€²è¡Œæ©«å‘çš„æºé€šï¼Œéƒ½æ˜¯éœ€è¦æœ‰ CNI (Cotainer Network Interface) çš„å¯¦è¸æ‰èƒ½å°‡ä¸åŒä¸»æ©Ÿä¹‹é–“çš„é€£ç·šå»ºç«‹èµ·ä¾†ã€‚CNI æœ¬èº«æ˜¯ä¸€å¥—æ¨™æº–ï¼Œå¯¦ä½œä¸Šå°±æœƒæœ‰ç™¾èŠ±é½Šæ”¾çš„å°ˆæ¡ˆå¯ä¾›ä½¿ç”¨ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking">20190817 Container Bare Metal for Networking</a></p>
<p><img alt="" src="/images/ocp-multus.png" /></p>
<p>é è¨­å®‰è£ä¸‹ï¼Œ<code>Multus CNI</code> æœƒè¢«å®‰è£åœ¨ OpenShift 4 è£¡é¢ï¼Œç•¶ç„¶ä¹Ÿå¯ä»¥ä¸å®‰è£æŠŠå®ƒé—œæ‰ï¼Œè«‹åƒè€ƒ <a href="https://access.redhat.com/solutions/4850181">KB4850181: How to install OpenShift 4 without Multus in place</a></p>
<p>è€ŒåŸç”Ÿå¿…é ˆå®‰è£çš„ OpenShift SDN CNI ä¸»è¦æœ‰ 2 å€‹å¯ä»¥ä½¿ç”¨:</p>
<ol>
<li>OpenShiftSDN (é è¨­)</li>
<li>OVNKubernetes (4.5 GA)</li>
</ol>
<p>å…¶ä»–ç¬¬ä¸‰æ–¹ä¾›æ‡‰å•†çš„ CNI Plugin å°±ä¸ç´°åˆ—äº†</p>
<p>è€Œå¦‚æœæœ‰éœ€è¦å¯¦è¸ <a href="https://docs.openshift.com/container-platform/4.3/networking/multiple_networks/understanding-multiple-networks.html">Multiple Networks</a> å‰‡å¯ä»¥é¸æ“‡ 5 ç¨® CNI Plugin ä¹‹ä¸€æ›è¼‰</p>
<ol>
<li>bridge</li>
<li>host-device</li>
<li>macvlan</li>
<li>ipvlan</li>
<li><a href="https://docs.openshift.com/container-platform/4.3/networking/hardware_networks/about-sriov.html">SR-IOV</a></li>
</ol>
<h3 id="openshift-311"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#openshift-311">èˆ‡ OpenShift 3.11 çš„ç¶²è·¯å·®ç•°</a></h3>
<ol>
<li>æ–¼ 4 ä»£ï¼ŒWeb Console ç”± <code>Infra Node</code> ä¸Šçš„ <code>OpenShift Router</code> æä¾›ï¼Œè€Œä¸æ˜¯é€é <code>Master Node</code> æä¾›</li>
<li>æ–¼ 4 ä»£ï¼ŒOpenShift Router çš„åŠŸèƒ½ï¼Œæ”¾ç½®åœ¨ <code>openshift-ingress-operator</code>ï¼Œè€Œä¸æ˜¯æ”¾ç½®åœ¨ <code>default</code></li>
<li>æ–¼ 4 ä»£ï¼ŒOpenShift CNI æä¾› <code>OpenShiftSDN</code> åŠ <code>OVNKubernetes</code> å’Œé è¨­æä¾› <code>multus</code> æä¾› Pod å¤šç¶²å¡èƒ½åŠ›</li>
</ol>
<h3 id="openshift-4"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#openshift-4">å¯¦å‹™ä¸Šåœ¨ OpenShift 4 çš„ç¶²è·¯è¨­å®š</a></h3>
<p>å¯¦éš›ä¸Šå°æ‡‰åˆ° Red Hat OpenShift 4 çš„è¨­å®šæª” <a href="https://docs.openshift.com/container-platform/4.3/installing/installing_bare_metal/installing-bare-metal.html#installation-bare-metal-config-yaml_installing-bare-metal">install-config.yaml</a></p>
<p><code>yaml install-config.yaml
apiVersion: v1
baseDomain: example.com
...omit...
networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16
...omit...</code></p>
<p>å¯¦éš›ä¸Šï¼Œéœ€è¦è¨­å®š 3 å¤§æ®µç¶²è·¯ï¼Œ</p>
<ol>
<li>Node Subnet: ä¸»è¦çµ¦<code>åŒ—å‘</code>æˆ–<code>å—å‘</code>æºé€šç”¨</li>
<li>Service Subnet: ä¸»è¦çµ¦<code>æ±è¥¿å‘</code>ç¶²è·¯æµç”¨</li>
<li>Pod Subnet: Kubernetes Pod å¯¦éš›ä¸Šæ‹¿åˆ°çš„ IPï¼Œæºé€šä¸»è¦éƒ½æ˜¯ä½¿ç”¨ <code>Service Subnet</code> é€²è¡Œæºé€š</li>
</ol>
<p>å…¶ä»–è©³ç´°åƒæ•¸è§£é‡‹è«‹çœ‹ <a href="https://blog.pichuang.com.tw/20200403-openshift-with-coreos-part-2/#%E4%BA%86%E8%A7%A3%E7%95%B6%E4%B8%8B%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A-Cluster-Network-Operator">æ„›çš„èµ°é¦¬çœ‹èŠ± Red Hat CoreOS èˆ‡ Red Hat OpenShift Part 2 - Cluster Network Operator</a></p>
<h3 id="references"><a class="toclink" href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/#references">References</a></h3>
<ul>
<li><a href="https://blog.pichuang.com.tw/20190404-openshift-network-traffic-overview/">Red Hat OpenShift v3.11 æ±è¥¿å—åŒ—å‘ç¶²è·¯æ¢è¨ - Phil Huang</a></li>
<li><a href="https://blog.pichuang.com.tw/20200403-openshift-with-coreos-part-2/#%E4%BA%86%E8%A7%A3%E7%95%B6%E4%B8%8B%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A-Cluster-Network-Operator">æ„›çš„èµ°é¦¬çœ‹èŠ± Red Hat CoreOS èˆ‡ Red Hat OpenShift Part 2 - Cluster Network Operator</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/installing/installing_bare_metal/installing-bare-metal.html#installation-bare-metal-config-yaml_installing-bare-metal">Sample install-config.yaml file for bare metal - OpenShift 4.3</a></li>
<li><a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking">20190817 Container Bare Metal for Networking</a></li>
<li><a href="https://access.redhat.com/solutions/4850181">KB4850181: How to install OpenShift 4 without Multus in place</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/networking/multiple_networks/understanding-multiple-networks.html">Understanding multiple networks - OpenShift 4.3</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/networking/hardware_networks/about-sriov.html">About Single Root I/O Virtualization (SR-IOV) hardware networks</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/networking/configuring_ingress_cluster_traffic/overview-traffic.html">Configuring ingress cluster traffic overview - OpenShift 4.3</a></li>
<li><a href="https://blog.pichuang.com.tw/20190321-reach-out-services-and-pods-from-outside-into-openshift/">å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2020/04/13/red-hat-openshift-v4-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%B5%81/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-04-04 00:00:00">April 4, 2019</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-v311"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/">Red Hat OpenShift v3.11 æ±è¥¿å—åŒ—å‘ç¶²è·¯æ¢è¨</a></h2>
<h3 id="_1"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#_1">è³‡æ–™ä¸­å¿ƒæ±è¥¿å—åŒ—å‘ç¶²è·¯æµ</a></h3>
<p>ä¸€èˆ¬è¨è«–çš„è³‡æ–™ä¸­å¿ƒè³‡æ–™æµé‡ï¼Œä¸»è¦åˆ†ç‚ºå…©å¤§æµå‘
- å—åŒ—å‘ (North-South Traffic):  Client èˆ‡ Server ä¹‹é–“çš„ç¶²è·¯æµé‡
- æ±è¥¿å‘ (East-West Traffic): Server èˆ‡ Server ä¹‹é–“çš„ç¶²è·¯æµé‡</p>
<p><img alt="" src="/images/network-traffic.png" /></p>
<p>é‚£å¦‚æœå¥—ç”¨åœ¨ Red Hat OpenShift v3.11 å®¹å™¨å¹³å°æ¶æ§‹ä¸‹ï¼Œé‚£å¯¦éš›ç¶²è·¯æµé‡æ˜¯å¦‚ä½•å°æ‡‰?</p>
<!--more-->

<h3 id="red-hat-openshift-311"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#red-hat-openshift-311">Red Hat OpenShift 3.11 æ±è¥¿å—åŒ—å‘ç¶²è·¯æµ</a></h3>
<p>é¦–å…ˆå…ˆä¾†å¼µå¸¸è¦‹çš„æ¶æ§‹åœ–</p>
<p><img alt="" src="/images/openshift-network-traffic-1.png" /></p>
<p>ä»¥ Red Hat OpenShift ç‚ºæ ¸å¿ƒè¦–è§’ï¼Œå¯ä»¥åˆ†ç‚ºä¸‰æ®µç¶²è·¯
1. åŒ—å‘ç¶²è·¯æµ Ingress Traffic
2. æ±è¥¿å‘ç¶²è·¯æµ
3. å—å‘ç¶²è·¯æµ Egress Traffic</p>
<h4 id="ingress-traffic"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#ingress-traffic">åŒ—å‘: Ingress Traffic</a></h4>
<p>å¾ <a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#what-is-ingress">What is Ingress? - Kubernetes</a> å®šç¾©ä¸Šä¾†èªªï¼Œå¯ä»¥äº†è§£åˆ° Ingress ä¸»è¦çš„ç›®çš„å°±æ˜¯è®“å¤–éƒ¨ä½¿ç”¨è€…å¯ä»¥é€é <code>Ingress Controller</code> æ¥è§¸åˆ° Kubernestes è£¡é¢çš„ Serviceï¼Œè€Œåœ¨ Red Hat OpenShift è£¡é¢çš„è¡“èªå‰‡æ˜¯ä½¿ç”¨ <code>Router</code> ä¾†åšé—¡è¿°</p>
<p>æ•…åœ¨ <a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html">Routes - OpenShift Docs v3.11</a> è£¡é¢æ‰€æè¿°çš„å…§å®¹ï¼Œå¯ä»¥ç”¨ä¸‹è¡¨é€²è¡Œè¡“èªä¸Šçš„å°æ‡‰</p>
<table>
<thead>
<tr>
<th>Kubernetes</th>
<th>OpenShift</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ingress resource (rules)</td>
<td>Route (rules)</td>
</tr>
<tr>
<td>Ingress controller (Nginx/Ambassador/...)</td>
<td>Router (HAProxy)</td>
</tr>
</tbody>
</table>
<p>è€Œ Ingress Controller å…¶å¯¦æ˜¯ä¸€å€‹çµ±ç¨±ï¼Œåœ¨ OpenShift Router å…·é«”å¯¦è¸ä¸Šä¸»è¦æœ‰<a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/assembly_available_router_plugins.html#architecture-additional-concepts-router-plugins">æ”¯æ´å…©ç¨®é¡å‹</a>
1. OpenShift Router (é è¨­)
2. F5 BIG-IP Controller (è¦æ­ F5)</p>
<p>æœ‰äº›äººæœƒå•èªªåŒä¸€å¹³å°å…§ï¼Œèƒ½ä¸èƒ½å­˜åœ¨å¤šå€‹ Ingress Controller? ç­”æ¡ˆæ˜¯å¯ä»¥ï¼Œä½†è¦ç•™æ„å„ Ingress Controller çš„å¯¦ä½œæ–¹å¼ï¼Œè­¬å¦‚èªª OpenShift Router çš„æ–¹å¼æ˜¯æ¡ç”¨ <code>hostnetwork</code> çš„èµ°æ³•ï¼Œæ‰€ä»¥æ¯ä¸€å° host åƒ…èƒ½å®‰è£ä¸€å€‹ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://blog.pichuang.com.tw/20190321-reach-out-services-and-pods-from-outside-into-openshift/">å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods - Phil Workspace</a></p>
<h4 id="east-west-traffic"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#east-west-traffic">æ±è¥¿å‘: East-West Traffic</a></h4>
<p>åœ¨ Red Hat OpenShift å¹³å°åº•ä¸‹ï¼Œç„¡è«–æ˜¯è¦è·¨ Pod / Service / Host é€²è¡Œæ©«å‘çš„æºé€šï¼Œéƒ½æ˜¯éœ€è¦æœ‰ CNI (Cotainer Network Interface) çš„å¯¦è¸æ‰èƒ½å°‡ä¸åŒä¸»æ©Ÿä¹‹é–“çš„é€£ç·šå»ºç«‹èµ·ä¾†ã€‚CNI æœ¬èº«æ˜¯ä¸€å¥—æ¨™æº–ï¼Œå¯¦ä½œä¸Šå°±æœƒæœ‰ç™¾èŠ±é½Šæ”¾çš„å°ˆæ¡ˆå¯ä¾›ä½¿ç”¨ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://www.hwchiu.com/cni-compare.html">å¸¸è¦‹ CNI (Container Network Interface) Plugin ä»‹ç´¹ - hwchiu</a></p>
<p>è€Œé è¨­ä¸Šï¼ŒRed Hat OpenShift æä¾›ä¸‰å€‹ CNI Plugin å¯ä¾›ä½¿ç”¨
1. ovs-subnet: å–®ç´” L2ï¼Œé¡åŒ flat network
2. ovs-multitenant: å¯é‡å°ä¸åŒçš„ namespace/project é€²è¡Œéš”é›¢
3. ovs-networkpolicy: æ§åˆ¶ç´°ç²’åº¦æœ€ç´°ï¼Œå¯ä»¥ä½¿ç”¨ <code>NetworkPolicy</code> objectï¼Œé¡åŒæ–¼å¯« iptables rules ä¸€æ¨£</p>
<p>ç•¶ç„¶å¦‚æœé é è¦ºå¾—é€™ä¸‰å€‹åŠŸèƒ½ä¸ç¬¦åˆéœ€æ±‚çš„è©±ï¼Œé‚„å¯ä»¥ä»‹æ¥ç¬¬ä¸‰æ–¹å» å•†çš„ CNI Pluginï¼Œè­¬å¦‚ Juniper Contrailã€VMWare NSX-T ç­‰å°ˆæ¥­ç¶²è·¯å» å•†çš„æ–¹æ¡ˆé€²è¡Œè™›å¯¦æ•´åˆ (Overlay + Underlay Integration)</p>
<h4 id="egress-traffic"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#egress-traffic">å—å‘: Egress Traffic</a></h4>
<p>Egress é¡§åæ€ç¾©å¯ä»¥äº†è§£åˆ°æ˜¯å¾ OpenShift çš„ Pod å‘å¤–å»å­˜å–å¤–éƒ¨æœå‹™ (ä¾‹: Database)ï¼Œåœ¨æ²’æœ‰ä»»ä½•é™åˆ¶ä¹‹ä¸‹ï¼Œåœ¨ OpenShift åº•ä¸‹çš„ä»»ä½• Pod ç•¶ç„¶æ˜¯å¯ä»¥éš¨æ„åœ°å»å­˜å–å¤–éƒ¨æœå‹™ï¼Œä»¥ä¸‹åœ–è¡¨æ¥ç¯€éŒ„ <a href="https://www.redhat.com/files/summit/session-assets/2018/Network-security-for-apps-on-OpenShift.pdf">Network Security for Apps on OpenShift - Red Hat Summit</a></p>
<p><img alt="" src="/images/egress-network.png" /></p>
<p>è©¦æƒ³è‹¥ä½ çš„å¤–éƒ¨æœå‹™æœ‰éœ€è¦ç‚ºäº†è³‡å®‰ä¿è­·é€²è¡Œå­˜å–é™åˆ¶ï¼Œè€Œä½ çš„ Compute Node å»æœ‰è¤‡æ•¸å°ä»¥ä¸Šçš„è©±ï¼Œæ˜¯ä¸æ˜¯è¦ç‰¹åˆ¥æŠŠé€™äº› Compute Node çš„ IP æ”¶é›†èµ·ä¾†å¾Œï¼Œåœ¨å¤–éƒ¨æœå‹™ä¸­è¨­å®šç™½åå–®é–‹å•Ÿ? å€˜è‹¥ç’°å¢ƒåˆæ˜¯ç¶“å¸¸æ€§è®Šå‹•çš„è©±ï¼Œæ˜¯ä¸æ˜¯æ¯æ¬¡è®Šå‹•éƒ½è¦é€²è¡Œä¸€æ¬¡ä¿®æ”¹å‘¢? æ‰€ä»¥é€™æ™‚å€™å°±æœƒæœ‰é‡å° Egress Traffic çš„ä¸‰ç¨®åšæ³•</p>
<ol>
<li>OpenShift Egress Firewall</li>
<li>OpenShift Egress Routers</li>
<li>Egress static IP</li>
</ol>
<p><img alt="" src="/images/egress-firewall.png" />
<img alt="" src="/images/egress-router.png" />
<img alt="" src="/images/egress-static.png" /></p>
<p>å…¶ä¸­ OpenShift Egress Routers çš„æŠ€è¡“ç´°ç¯€è·Ÿä¸Šé¢æ‰€è¨è«–çš„ Ingress Controller: OpenShift Router æ˜¯å¾ˆé¡ä¼¼çš„ï¼Œè€Œæ¨¡å¼ä¸Šä¹Ÿæœ‰ä¸‰ç¨®åšæ³•å¯ä»¥é¸æ“‡ï¼Œåˆ†åˆ¥æ˜¯ Redirectã€HTTP Proxyã€DNS Proxy</p>
<table>
<thead>
<tr>
<th>åˆ†é¡</th>
<th>Redirect mode</th>
<th>HTTP Proxy mode</th>
<th>DNS Proxy mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>Support Protocols</td>
<td>TCP/UDP</td>
<td>HTTP/HTTPS</td>
<td>TCP</td>
</tr>
<tr>
<td>Image</td>
<td>ose-pod</td>
<td>ose-egress-http-proxy</td>
<td>ose-egress-dns-proxy</td>
</tr>
<tr>
<td>Technology</td>
<td>Netfilter rules</td>
<td>Squid</td>
<td>HAProxy</td>
</tr>
</tbody>
</table>
<h3 id="summary"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#summary">Summary</a></h3>
<p>ç„¡è«–æ˜¯ Kubernetes / OpenShift ä¸€èˆ¬åœ¨è¨è«–å®¹å™¨å¹³å°ç¶²è·¯çš„ä¸å¤–ä¹éƒ½æ˜¯åœ¨è¨è«– Pod / Service / NodePort ç­‰ç­‰çš„æ‡‰ç”¨ï¼Œä½†å¯¦éš›ä¸Šä½¿ç”¨çš„æ™‚å€™æœƒè »æ¨è–¦ç”¨è³‡æ–™æµ (Data Flow) çš„è§€é»ä¸‹å»åšæ¯ä¸€å€‹é»çš„è¨è«–ï¼Œé€™æ¨£åœ¨æŠ€è¡“é¸å‹ä¸Šæ‰ä¸æœƒæ€è€ƒå¤ªä¹…ï¼Œç•¶ç„¶æ•´é«”ç¶²è·¯è€ƒæ…®ä¸æœƒåªæœ‰å–®å–®é€™ä¸€ç¯‡æ–‡ç« å°±å¯ä»¥å…¨éƒ¨è¬›å®Œçš„ï¼Œå…¶å¯¦æœ‰éå¸¸å¤šç´°ç¯€å¯ä»¥åšæ¢è¨ï¼Œå°¤å…¶æ˜¯å¦‚ä½•è·Ÿç¾æœ‰ç¶²è·¯åšå°æ¥ã€é˜²ç«ç‰†ç’°å¢ƒéš”é›¢ç­‰ç­‰éƒ½å¾—ä¸€ä½µè€ƒæ…®é€²å»ã€‚</p>
<p>å¸Œæœ›é€™ç¯‡èƒ½å¹«åŠ©å¤§å®¶ç”¨é«˜è¦–è§’çš„æ–¹å¼ä¾†ç†è§£æ•´å€‹ Red Hat OpenShift v3.11 ç¶²è·¯æµé‡èµ°å‘</p>
<h3 id="appendix-openshift-v3-f5"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#appendix-openshift-v3-f5">Appendix: é‡å° OpenShift v3 ç‰ˆæœ¬ä¹‹ F5 è¨­å®š</a></h3>
<p><img alt="" src="/images/ocp3_f5.png" /></p>
<h3 id="references"><a class="toclink" href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/#references">References</a></h3>
<ul>
<li><a href="https://www.cisco.com/c/en/us/products/collateral/switches/nexus-7000-series-switches/white-paper-c11-737022.html">Cisco Data Center Spine-and-Leaf Architecture: Design Overview White Paper</a></li>
<li><a href="https://kubernetes.io/docs/concepts/services-networking/ingress/#what-is-ingress">What is Ingress? - Kubernetes</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/assembly_available_router_plugins.html#architecture-additional-concepts-router-plugins">Available router plug-ins - OpenShift Docs v3.11</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html">Routes - OpenShift Docs v3.11</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/sdn.html">OpenShift SDN - OpenShift Docs v3.11</a></li>
<li><a href="https://blog.pichuang.com.tw/20190321-reach-out-services-and-pods-from-outside-into-openshift/">å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods</a></li>
<li><a href="https://www.hwchiu.com/cni-compare.html">å¸¸è¦‹ CNI (Container Network Interface) Plugin ä»‹ç´¹ - hwchiu</a></li>
<li><a href="https://www.redhat.com/files/summit/session-assets/2018/Network-security-for-apps-on-OpenShift.pdf">Network Security for Apps on OpenShift - Red Hat Summit</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/admin_guide/managing_networking.html#admin-guide-controlling-egress-traffic">Controlling Egress Traffic - OpenShift Docs v3.11</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2019/04/04/red-hat-openshift-v311-%E6%9D%B1%E8%A5%BF%E5%8D%97%E5%8C%97%E5%90%91%E7%B6%B2%E8%B7%AF%E6%8E%A2%E8%A8%8E/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-03-21 00:00:00">March 21, 2019</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="./" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-services-pods"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/">å¾ Red Hat OpenShift å¤–éƒ¨è¨ªå• Services æˆ– Pods</a></h2>
<p>Red Hat OpenShift v3.11 æ¶æ§‹è£¡ç¶²è·¯ä¸»è¦åˆ†ç‚ºä¸‰å¤§å¡Š:</p>
<ol>
<li>Hosts subnet</li>
<li>Service subnet</li>
<li>Pod subnet</li>
</ol>
<!--more-->

<p>Host subnet æ¯«ç„¡æ‡¸å¿µæŒ‡çš„å°±æ˜¯ä¸»æ©Ÿæ‰€ä½¿ç”¨çš„ IPï¼Œä¹Ÿå°±æ˜¯å°å¤–å¯ä»¥æ¥è§¸åˆ°ä¸»æ©Ÿçš„ç¶²è·¯; è€Œ Service å’Œ Pods subnet åœ¨ OpenShift è£¡é¢æ˜¯ä¸€å€‹è™›æ“¬æ¦‚å¿µï¼Œæ­£å¸¸ç‹€æ³ä¸‹å¤–éƒ¨ç¶²è·¯ç„¡æ³•é€é Pod IP/Port å’Œ Service IP/Port æ¥è§¸åˆ°æœå‹™</p>
<p>é‚£å¦‚æœæˆ‘æƒ³è¦è®“ Pod æˆ– Service IP å¯ä»¥è¢«å¤–é¢æ¥è§¸åˆ°å‘¢? ä»¥ä¸‹åˆ†ç‚ºå…©å€‹å±¤ç´šä¾†è¨è«–:
1. Pod mapping to host
2. Service mapping to host</p>
<h3 id="pod-port-mapping-to-host-port"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#pod-port-mapping-to-host-port">Pod port Mapping to Host port</a></h3>
<h4 id="hostnetworktrue"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#hostnetworktrue">ä½¿ç”¨ <code>hostNetwork=true</code></a></h4>
<p>è‹¥æ²’æœ‰ç‰¹åˆ¥æŒ‡å®šçš„è©±ï¼Œé è¨­ <code>hostPort</code> ç­‰æ–¼ <code>containerPort</code>ï¼Œæ„æ€æ˜¯èªª Pod è£¡é¢çš„å®¹å™¨é–‹äº†ä»€éº¼ Port å°±æœƒç›´æ¥å°æ‡‰åˆ° host ä¸Šé¢çš„ Portï¼Œè€Œ Pod IP å‰‡æœƒç†æ‰€ç•¶ç„¶åœ°ç­‰æ–¼ Host IP</p>
<p>å¤–é¢è¨ªå•æœå‹™çš„ IP/Portï¼Œè«‹æ±‚æœƒç›´æ¥è½‰åˆ°å’Œ Pod ç›¸åŒçš„ IP/Port ï¼Œé€”ä¸­ä¸ç¶“é iptables åŠ service è™•ç†</p>
<p>å„ªé»: ç›´æ¥å¯ä»¥å¾å¤–é¢ç›´æ¥æ¥è§¸åˆ° Pod å±¤ç´šæœå‹™ï¼Œç¶²è·¯è½‰ç™¼æ•ˆç‡æœƒæ¯” nodePort å¥½
ç¼ºé»: ä¸èƒ½åœ¨åŒä¸€å°ä¸»æ©Ÿ (Host) é–‹å•Ÿç¬¬äºŒå€‹ç›¸åŒçš„ Podï¼Œå› ç‚ºæœƒæœ‰ Port è¡çªçš„å•é¡Œï¼Œä¹Ÿä¸èƒ½è·¨ä¸»æ©Ÿå»ºç«‹æœå‹™</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nn">---</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="nt">hostNetwork</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true &lt;----</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</code></pre></div>
<h4 id="hostport"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#hostport">ä½¿ç”¨ <code>hostPort</code></a></h4>
<p>æ¦‚å¿µè·Ÿå‰è€…å¾ˆåƒï¼Œå·®ç•°æœƒåœ¨å¯ä»¥æŒ‡å®šç‰¹å®šçš„ <code>hostPort</code> å°æ‡‰åˆ° <code>containerPort</code>ï¼Œä½†ä¸¦ä¸éœ€è¦å…¨éƒ¨çš„ Pod Port éƒ½è·Ÿ Host åšå°æ‡‰ï¼Œå¯ä»¥æœ‰é™åº¦çš„é–‹æ”¾å‡ºå»</p>
<p>å„ªé»: ç›´æ¥å¯ä»¥å¾å¤–é¢ç›´æ¥æ¥è§¸åˆ° Pod å±¤ç´šæœå‹™
ç¼ºé»: ä¸èƒ½åœ¨åŒä¸€å°ä¸»æ©Ÿ (Host) é–‹å•Ÿç¬¬äºŒå€‹ç›¸åŒçš„ Podï¼Œå› ç‚ºæœƒæœ‰ Port è¡çªçš„å•é¡Œï¼Œä¹Ÿä¸èƒ½è·¨ä¸»æ©Ÿå»ºç«‹æœå‹™</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nn">---</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="nt">hostPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080 &lt;----</span>
</code></pre></div>
<h3 id="service-port-mapping-to-host-port"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#service-port-mapping-to-host-port">Service port Mapping to Host port</a></h3>
<h4 id="nodeport"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#nodeport">ä½¿ç”¨ <code>nodePort</code></a></h4>
<p>å»£æ³›æ‡‰ç”¨çš„æœå‹™æ­éœ²æ–¹å¼ï¼Œåœ¨é è¨­æƒ…æ³ä¸‹ï¼Œæ¯å•Ÿå‹•ä¸€å€‹ Service éƒ½æœƒæ­é…ä¸€å€‹ <code>ClusterIP</code>ï¼Œè€Œé€™å€‹ <code>ClusterIP</code> åƒ…èƒ½åœ¨åŒä¸€å€‹é›†ç¾¤å…§éƒ¨è¢«è¨ªå•ï¼Œå¤–é¢ä¸èƒ½æ¥è§¸åˆ°ï¼Œå€˜è‹¥æƒ³è¦è®“ä»–è¢«æ¥è§¸çš„è©±ï¼Œå°±è¦æŒ‡å®š <code>nodePort</code> å°å¤–æ­éœ²</p>
<p>hostPort è·Ÿ nodePort çš„å·®ç•°åœ¨ï¼Œå‰è€…æ˜¯é‡å°å–®ä¸€ä¸»æ©Ÿè£¡çš„å–®ä¸€å®¹å™¨é€²è¡Œè¨­å®šï¼Œå¾Œè€…å‰‡æ˜¯ä»¥ä¸€å€‹é›†ç¾¤ä¾†çœ‹å¾…ï¼Œæœå‹™å¯ä»¥è·¨ä¸»æ©Ÿ</p>
<p>å„ªé»: å¯è·¨ä¸»æ©Ÿï¼Œç›´æ¥å¯ä»¥å¾å¤–é¢ç›´æ¥æ¥è§¸åˆ° Service å±¤ç´šæœå‹™ï¼Œä¸”èƒ½é€éæ‰€ç”¢ç”Ÿçš„ ClusterIP å°å¾Œç«¯çš„ Pod åšè² è¼‰å‡è¡¡
ç¼ºé»: æ‰€æœ‰é›†ç¾¤çš„ Port éƒ½æœƒåŒæ™‚è¢«é–‹èµ·ä¾†ï¼Œè®“å¤–éƒ¨åšæ¥è§¸</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nn">---</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30000 &lt;---</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</code></pre></div>
<p>å»ºè­°å¯ä»¥æ­ä¸€å€‹å¤–éƒ¨ Reverse Proxy ä¾†åšä½¿ç”¨ï¼Œè­¬å¦‚åƒæ˜¯ F5 / A10 / HAProxy</p>
<h4 id="ingress-controller-openshift-router"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#ingress-controller-openshift-router">ä½¿ç”¨ Ingress Controller: OpenShift Router</a></h4>
<p>ç¶œåˆ Pod è·Ÿ Service çš„å„ªé»çš„æ”¹è‰¯ä½œæ³•ï¼Œä¹Ÿæ˜¯æ™®éå»ºç«‹å°å¤–æœå‹™æ™‚çš„æœ€ä½³å¯¦è¸ã€‚ä½ ä¸éœ€è¦è‡ªå·±å°æ‰€æœ‰çš„ Service å»æ–°å¢ <code>nodePort</code>ï¼Œè€Œå¯ä»¥ç›´æ¥åœ¨ OpenShift ä¸Šå»ºç«‹ä¸€å€‹ Reverse Proxy çš„æœå‹™ï¼Œç›´æ¥é€²è¡Œå°å¤–æœå‹™æ­éœ²åŠå°å…§æœå‹™è² è¼‰å¹³è¡¡ï¼Œä¾æ“šä¸åŒçš„ Ingress Controller å¯¦ä½œï¼Œé€šå¸¸åŠŸèƒ½éƒ½æœƒåŒ…å« HTTP è·¯å¾‘æ­éœ²ã€Session Stickyã€SSL Transparent/Re-encrypt/Terminated ç­‰ç­‰è² è¼‰å¹³è¡¡çš„åŠŸèƒ½</p>
<p>OpenShift Router æ˜¯æ¡ç”¨ <code>hostnetwork</code> çš„æ–¹å¼å»ºç«‹ï¼Œæ‰€ä»¥æ¯ä¸€å°ä¸»æ©Ÿè‡³å¤šåªèƒ½å®‰è£ä¸€å€‹ï¼ŒåŒæ™‚ 80 / 443 /1936 é€™ä¸‰å€‹ Port æœƒè¢«é è¨­ä½”èµ°</p>
<p>æƒ³äº†è§£æ–¼ OpenShift å°æ–¼ Ingress Controller çš„å¯¦ä½œ <code>Router</code> å¯ä»¥åƒè€ƒ <a href="https://docs.openshift.com/container-platform/3.11/install_config/router/index.html">Router Overview - OpenShift v3.11 Docs</a></p>
<h4 id="service-type-loadbalancer"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#service-type-loadbalancer">ä½¿ç”¨ Service Type: <code>LoadBalancer</code></a></h4>
<p>æ­£å¸¸ä½¿ç”¨ä¸‹ï¼Œé€™åŠŸèƒ½åƒ…é™æ–¼å…¬æœ‰é›²ï¼Œä½†åœ¨ OpenShift è£¡é¢æœ‰æ”¯æ´ä¸€å€‹åŠŸèƒ½å«åš <code>ingress IP</code>ï¼Œæ•ˆæœå°±æ˜¯çµ¦ OpenShift åƒ…ä¸€å€‹ç‰¹å®šçš„ç¶²æ®µ (Subnet) ä¹‹å¾Œï¼Œå¯ä»¥å¾ä¸­é¸å–ä»»ä¸€ IPï¼Œä¸¦ä½¿ç”¨ <code>type: LoadBalancer</code> å°å¤–æ­éœ²æœå‹™ï¼Œè©³ç´°å¯ä»¥åƒè€ƒ <a href="http://v1.uncontained.io/playbooks/operationalizing/ingress.html">Using Ingress to Expose Services</a></p>
<h4 id="external-ingressip"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#external-ingressip">ä½¿ç”¨ External IngressIP</a></h4>
<p>å€˜è‹¥ä¸€å®šè¦èµ° non-HTTP/HTTPS çš„æœå‹™ï¼Œåˆæƒ³è¦æœ‰é¡ä¼¼æ–¼ä½¿ç”¨ <code>Service Type: LoadBalancer</code>ï¼Œé‚£å¯ä»¥è€ƒæ…®ä½¿ç”¨ IngressIP ä¾†åšä½¿ç”¨ï¼Œ<a href="http://v1.uncontained.io/playbooks/operationalizing/ingress.html">Using Ingress to Expose Services</a></p>
<p>å¯ä»¥åšæˆä¸‹é¢çš„æ•ˆæœ</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>openshift-ingress
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>NAME<span class="w">                      </span>TYPE<span class="w">           </span>CLUSTER-IP<span class="w">      </span>EXTERNAL-IP<span class="w">      </span>PORT<span class="o">(</span>S<span class="o">)</span><span class="w">                      </span>AGE
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>router-default<span class="w">            </span>LoadBalancer<span class="w">   </span><span class="m">172</span>.30.16.119<span class="w">   </span><span class="m">52</span>.230.228.163<span class="w">   </span><span class="m">80</span>:30745/TCP,443:32561/TCP<span class="w">   </span>2d6h
</code></pre></div>
<h3 id="summary"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#summary">Summary</a></h3>
<p>åœ¨ OpenShift çš„ç’°å¢ƒä¹‹ä¸‹</p>
<ol>
<li>å°æ–¼ http/https çš„æœå‹™ï¼Œå°å¤–é€é Ingress Controller: OpenShift Router æ­éœ² FQDN è®“å¤–é¢ä½¿ç”¨</li>
<li>å°æ–¼é http/https çš„æœå‹™ï¼Œå¦‚ mysqlï¼Œæœ‰ä¸‹åˆ—å…©ç¨®åšæ³•:</li>
<li>è‹¥ä¸éœ€è¦æä¾›å°å¤–æœå‹™ï¼Œåƒ…ä½¿ç”¨ <code>ClusterIP</code> åœ¨å…§éƒ¨é€²è¡Œä½¿ç”¨</li>
<li>è‹¥éœ€è¦æä¾›å°å¤–æœå‹™ï¼Œæœ‰ä¸‹åˆ—ä¸‰ç¨®åšæ³•:<ol>
<li>Single Instanceï¼Œä¸éœ€è¦åœ¨å¤šå€‹ node ä¸Šé¢é‹è¡Œï¼Œä½¿ç”¨ <code>hostnetwork</code> æˆ– <code>hostPort</code></li>
<li>Multiple Instanceï¼Œéœ€è¦åœ¨å¤šå€‹ node ä¸Šé¢é‹è¡Œï¼Œåšåˆ° scale-out çš„æ•ˆæœï¼Œå‰‡ä½¿ç”¨ <code>ingress IP</code> ç‚ºä½³</li>
</ol>
</li>
</ol>
<h3 id="references"><a class="toclink" href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/#references">References</a></h3>
<ul>
<li><a href="https://blog.csdn.net/huqigang/article/details/76428017">kuberneteså­¦ä¹ è®°å½•ï¼ˆ3ï¼‰â€”â€”é›†ç¾¤å¤–éƒ¨è®¿é—®Podæˆ–Service</a></li>
<li><a href="https://www.slideshare.net/erhwenkuo/cncf-k8snetworkpart1/erhwenkuo/cncf-k8snetworkpart1">Kubernetes ç¶²è·¯æ˜¯å¦‚ä½•é‹ä½œ? Part 1- Erhwen Kuo</a></li>
<li><a href="https://www.slideshare.net/erhwenkuo/cncf-k8snetwork02-137938815">Kubernetes ç¶²è·¯æ˜¯å¦‚ä½•é‹ä½œ? Part 2- Erhwen Kuo</a></li>
<li><a href="https://jimmysong.io/kubernetes-handbook/guide/accessing-kubernetes-pods-from-outside-of-the-cluster.html">ä»å¤–éƒ¨è®¿é—®Kubernetesä¸­çš„Pod - JimmySong</a></li>
<li><a href="http://alesnosek.com/blog/2017/02/14/accessing-kubernetes-pods-from-outside-of-the-cluster/">Accessing Kubernetes Pods from Outside of the Cluster</a></li>
<li><a href="https://docs.openshift.com/container-platform/3.11/install_config/router/index.html">Router Overview - OpenShift v3.11 Docs</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1101219">æ·±åº¦ç†è§£ï¼šOpenshiftç«¯å£æ–¹å¼å…¨è§£æ - å¤§è¡›åˆ†äº«</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1375943">OpenShift ç½‘ç»œåˆ†æ-(å®¹å™¨ç½‘ç»œé€‰å‹å’Œæ–¹æ¡ˆå»ºè®®) - å¤§è¡›åˆ†äº«</a></li>
<li><a href="http://v1.uncontained.io/playbooks/operationalizing/ingress.html">Using Ingress to Expose Services</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../2019/03/21/%E5%BE%9E-red-hat-openshift-%E5%A4%96%E9%83%A8%E8%A8%AA%E5%95%8F-services-%E6%88%96-pods/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/pichuang" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/phil-huang-09b09895" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/@pichuang-tw" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="http://speakerdeck.com/pichuang" target="_blank" rel="noopener" title="speakerdeck.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M213.86 296H100a100 100 0 0 1 0-200h132.84a40 40 0 0 1 0 80H98c-26.47 0-26.45 40 0 40h113.82a100 100 0 0 1 0 200H40a40 40 0 0 1 0-80h173.86c26.48 0 26.46-40 0-40zM298 416a120.21 120.21 0 0 0 51.11-80h64.55a19.83 19.83 0 0 0 19.66-20V196a19.83 19.83 0 0 0-19.66-20H296.42a60.77 60.77 0 0 0 0-80h136.93c43.44 0 78.65 35.82 78.65 80v160c0 44.18-35.21 80-78.65 80z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.code.copy", "content.code.annotate", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.path", "navigation.sections", "navigation.indexes", "navigation.expand", "navigation.prune", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "header.autohide"], "search": "../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8e8db93a.min.js"></script>
      
    
  </body>
</html>