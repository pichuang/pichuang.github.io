{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"about.html","title":"Who is Phil Huang?","text":"Phil_Huang.yaml<pre><code>apiVersion: microsoft.com/azure/v1\nkind: Author\nmetadata:\n  name: Phil Huang\n  position: Senior Cloud Solution Architect\n  team: Customer Success Unit\n  company: Microsoft\n  location: Taiwan\n  interesting: [\"OpenSource\", \"Hybrid Networking\", \"CNCF\", \"IT Automation\"]\n  alias: [\"pichuang\", \"\u5c0f\u98db\u6a5f\", \"pinhuang@microsoft\", \"hphil@vmware\", \"pinhuang@redhat\", \"phil.huang@edgecore\"]\n\nspec:\n  replicas: 1 # (1)\n\n  template:\n    metadata:\n      labels:\n        email: pichuang at pichuang.com.tw\n    spec:\n      containers:\n\n      - name: Experience\n        image: pichuang/brain:v33\n        knowledgeMounts:\n        - name: Microsoft Senior Cloud Solution Architect\n          mountPath: Azure Core\n        - name: VMware Senior Systems Engineer\n          mountPath: Tanzu RUN and MANAGE\n        - name: Red Hat Senior Solution Architect\n          mountPath: Infrastructure\n        - name: Edgecore Networks Open Networking Solution Engineer\n          mountPath: Open Networking\n\n      - name: Education\n        image: pichuang/education:latest\n        educationMounts:\n        - name: National Chiao Tung University (NCTU), Taiwan # (2)\n          mountPath: Master's degree in Compute Science\n        - name: Tunghai University (THU), Taiwan # (3)\n          mountPath: Bachelor's degree in Compute Science\n\n      - name: Community\n        image: pichuang/root:latest\n        communityMounts:\n        - name: CNCF Amassador\n          mountPath: https://www.cncf.io/people/ambassadors/\n        - name: Cloud Native Taiwan User Group\n          mountPath: https://www.facebook.com/groups/cloudnative.tw/\n\n      - name: Social Networks\n        images: pichuang/social:latest\n        socialMounts:\n        - name: GitHub\n          mountPath: http://github.com/pichuang\n        - name: SpeakerDeck\n          mountPath: http://speakerdeck.com/pichuang\n        - name: Linkedin\n          mountPath: https://www.linkedin.com/in/phil-huang-09b09895\n        - name: YouTube\n          mountPath: https://www.youtube.com/@pichuang-tw\n</code></pre> <ol> <li>Should be!</li> <li>\u4ea4\u901a\u5927\u5b78\u8cc7\u8a0a\u79d1\u5b78\u5de5\u7a0b\u7814\u7a76\u6240\u7cfb\u7d71\u5be6\u52d9\u7d44(\u4e01\u7d44)</li> <li>\u6771\u6d77\u5927\u5b78\u8cc7\u8a0a\u5de5\u7a0b\u7cfb</li> </ol>","tags":["aboutme"]},{"location":"azure-subnets-dev.html","title":"Azure subnets dev","text":"Visual Subnet Calculator (Azure Edition)   Visual Subnet Calculator (Azure Edition)  <p>Enter the Azure Virtual Network (VNet) Address you wish to subnet:</p> Network Address Mask bits                  /                  <p>Show columns:             Subnet               name Subnet               address Netmask Range of               addresses Azure               Subnet Useable IPs Azure               Usable               Hosts Divide Join </p> <p>Click below to split and join subnets.           If you wish to save this subnetting for later, copy the bookmark this             hyperlink.</p> Subnet name Subnet address Netmask Range of addresses Azure Subnet Useable IPs Azure Usable Hosts Divide Join"},{"location":"azure-subnets-dev.html#tips-for-azure-virtual-network","title":"Tips for Azure Virtual Network","text":""},{"location":"azure-subnets-dev.html#azure-reserved-subnet-name","title":"Azure Reserved Subnet Name","text":"Reserved Subnet Name min. Size of Subnet Max. Size of Subnet Recommand Size of Subnet Related Azure Services GatewaySubnet /29 /27 /27 Azure Virtual Network Gateway / ExpressRoute / Site-to-Site VPN RouteServerSubnet /27 /24 /27 Azure Route Server AzureBastionSubnet /26 /24 /26 Azure Bastion AzureFirewallSubnet /26 /26 /26 Azure Firewall AzureFirewallManagementSubnet /26 /16 /26 Azure Firewall Manager"},{"location":"azure-subnets-dev.html#rule","title":"Rule","text":"<ul> <li> <p>Based on Are there any restrictions on using IP addresses within these subnets?, Azure Subnet reserves 5 IP addresses in each subnet for internal use: the first 4 (Network ID, Default Gateway IP, Azure DNS reserved-1, Azure DNS reserved-2) and the last 1 (Network broadcast address) IP addresses.</p> </li> <li> <p>Based on  Azure VMet - How small and how large can VNets and subnets be?, The smallest supported IPv4 subnet is /29, and the largest is /2 (using CIDR subnet definitions). IPv6 subnets must be exactly /64 in size.</p> </li> </ul>"},{"location":"azure-subnets-dev.html#spotlight","title":"Spotlight","text":"<p>Special Thanks to davidc + ChatGPT</p> <p>The source code for Azure Edition page has been forked and ported from davidc/subnets. If you're searching for the original Visual Subnet Calculator, I encourage you to check out Visual Subnet Calculator. Furthermore, as I am not a front-end engineer, the project utilized ChatGPT for suggestions on modifications to HTML / CSS / Javascript.</p>"},{"location":"recording.html","title":"Recording","text":"","tags":["public speach","aboutme"]},{"location":"recording.html#2023-total-7","title":"2023 (Total: 7)","text":"<ul> <li>20231210, Azure Kubernetes Services \u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b\u8a2d\u8a08\u65b9\u91dd, Slide, Dot Net Conf Taiwan 2023, Taiwan</li> <li>20231129, \u5982\u4f55\u9078\u64c7\u9069\u7576\u7684 CNCF Project \u4f86\u4f7f\u7528, Slide, CNTUG Meetup 2023/11, Taiwan</li> <li>20231113, Cloud Native Taiwan User Group: Governance of Open-Source Communities in Non-English Region, Slide, KubeCon + CloudNativeCon North America 2023, US</li> <li>20231024, CNSW Lightning Talk: TAG Environmental Sustainability, Slide, Cloud Native Sustainability Week, Taiwan</li> <li>20230913, \u63a1\u7528 Azure OpenAI \u548c Azure Kubernetes Service \u4f86\u5efa\u69cb\u60a8\u81ea\u5df1\u7684 AI \u61c9\u7528\u7a0b\u5f0f, Slide, DevDaysAsia2023, Taiwan</li> <li>20230615, Kubernetes Scalable Workloads, Slide, CNTUG 2023/06 Meetup, Taiwan</li> <li>20230504, \u6df7\u5408\u96f2\u57fa\u790e\u67b6\u69cb\u63a2\u8a0e Microsoft Azure Infrastructure, Slide, Azure Marketing, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2022-total-7","title":"2022 (Total: 7)","text":"<ul> <li>20221222, Unleashing the Power of Azure VMware Solution, Slide, VMware User Group, Taiwan</li> <li>20221116, \u6df7\u5408\u96f2\u67b6\u69cb\u5e2b\u65e5\u5e38 \u5982\u4f55\u4f7f\u7528 WSL 2 \u642d\u914d Ansible \u81ea\u52d5\u5316\u9032\u884c Azure \u7dad\u904b\u7ba1\u7406, Slide, DevDays Asia 2022, Taiwan</li> <li>20221028, \u6dfa\u8ac7 Azure Private 5G Core \u548c Kubernetesm, Slide, CNTUG \u958b\u6e90\u6280\u8853\u5de5\u4f5c\u574a, Taiwan</li> <li>20220731, \u5982\u4f55\u8ddf\u96a8\u958b\u6e90\u6280\u8853\u4fdd\u6301\u4f60\u7684\u8077\u6daf\u767c\u5c55, Slide, Recording, COSCUP x KCD 2022, Taiwan</li> <li>20220323, Harbor \u6280\u8853\u96dc\u8ac7, Slide and Recording, Will \u4fdd\u54e5\u7684\u6280\u8853\u4ea4\u6d41\u4e2d\u5fc3, Taiwan</li> <li>20220121, NVIDIA x VMware \u91cb\u653e AI \u6f5b\u529b, Online Webinar, Taiwan</li> <li>20220119, \u5f48\u6307\u4e4b\u9593\u7ba1\u7406 AI MLOps \u5e73\u53f0\u7dad\u904b\u7ba1\u7406, Online Webinar, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2021-total-10","title":"2021 (Total: 10)","text":"<ul> <li>20211222, VMware Tanzu \u9ad4\u9a57\u5de5\u4f5c\u574a, iThome Kubernetes Summit 2021, Taiwan</li> <li>20211208, VMworld 2021 \u7cbe\u83ef\u7bc7, VMware \u9031\u4e09\u7dda\u4e0a\u8b1b\u5802, Taiwan</li> <li>20211124, \u96f2\u539f\u751f\u4eba\u624d?\u770b\u5f97\u5230, \u627e\u4e0d\u5230 Part 2, Agile HsinChu, Taiwan</li> <li>20211123, Kubernetes \u591a\u53e2\u96c6\u53ca\u55ae\u53e2\u96c6\u67b6\u69cb\u9078\u64c7\u63a2\u8a0e, SDN x Cloud Native Meetup #42, Taiwan</li> <li>20211110, VMware Tanzu \u52a9\u9663\u7df4\u5c31\u8de8\u96f2\u7ba1\u7406 K8s \u7684\u5373\u6230\u529b, VMware \u9031\u4e09\u7dda\u4e0a\u8b1b\u5802, Taiwan</li> <li>20211020, HiExpert 2021 DevOps\u9818\u822a\u8005\u8ad6\u58c7, HiSKIO, Taiwan</li> <li>20210825, \u96f2\u539f\u751f\u4eba\u624d?\u770b\u5f97\u5230, \u627e\u4e0d\u5230, SDN x Cloud Native Meetup #39, Taiwan</li> <li>20210812, \u5982\u4f55\u63a1\u7528\u96f2\u539f\u751f\u4f5c\u6cd5 Velero \u5099\u4efd\u9084\u539f\u4f60\u7684 Kubernetes \u53e2\u96c6?, DevDays Asia 2021 Online, Taiwan</li> <li>20210623, Azure Red Hat OpenShift \u5354\u52a9\u4f01\u696d\u52a0\u901f\u5275\u65b0, ITHome \u6578\u4f4d\u8f49\u578b\u653b\u7565 - IT \u5373\u6230\u529b Online Webinar, Taiwan</li> <li>20210616, F5 + Red Hat \u89e3\u78bc\u96f2\u539f\u751f\u5bb9\u5668\u6642\u4ee3\u7684 IT \u6311\u6230 - \u5b89\u5168\u3001\u64f4\u5c55\u3001\u81ea\u52d5\u5316, ITHome \u6578\u4f4d\u8f49\u578b\u653b\u7565 - IT \u5373\u6230\u529b Online Webinar, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2020-total-19","title":"2020 (Total: 19)","text":"<ul> <li>20201216, F5 Networks &amp; RedHat \u806f\u5408\u7dda\u4e0a\u865b\u64ec\u7814\u8a0e\u6703, Online Webinar, Taiwan</li> <li>20201212, \u4e00\u8a00\u96e3\u76e1\u7684\u95dc\u4fc2\uff1aKubernetes \u548c Docker \u4e4b\u7dda\u4e0a\u8a0e\u8ad6\u5206\u4eab\u6703, Online Webinar, Taiwan</li> <li>20201205, \u300a\u79d1\u6280\u3001\u8f49\u8b8a\u8207\u53ef\u80fd \u7cfb\u5217\u8b1b\u5ea7\u300b\u5f9e\u8edf\u9ad4\u67b6\u69cb\u5230\u89e3\u6c7a\u65b9\u6848\uff0c\u63a2\u7d22\u4e0b\u4e00\u4ee3\u667a\u6167\u5de5\u5ee0, \u53f0\u7063\u8edf\u9ad4\u5de5\u7a0b\u5b78\u6703, Taiwan</li> <li>20201111, \u6211\u7684 Kubernetes \u602a\u602a\u3109, GDG Taipei, Taiwan</li> <li>20201029, \u6253\u9020\u672a\u4f86 - \u91dd\u5c0d\u6df7\u5408\u96f2\u6642\u4ee3\u6253\u9020\u7684\u7d05\u5e3d\u6700\u65b0\u7248 RHEL, HPE Superdome \u9818\u4e16\u985b\u5cf0 - \u7dda\u4e0a\u76f4\u64ad\u767c\u8868\u6703, Taiwan</li> <li>20201024, Podman \u6280\u8853\u63d0\u5347\u5927\u6cd5, 2020 \u4e2d\u570b\u958b\u6e90\u5e74\u6703 COScon '20 - \u4e91\u539f\u751f\u4e0e\u5fae\u670d\u52a1\u4e13\u573a, China</li> <li>20201014, Red Hat OpenShift \u4fdd\u8b77\u96f2\u7aef\u539f\u751f\u670d\u52d9\u7684\u56db\u5927\u5b89\u5168\u6a21\u578b, Palo Alto Networks Virtual CyberSummit, Taiwan</li> <li>20200908, \u6253\u9020\u8de8\u570b\u6578\u4f4d\u670d\u52d9\u4f9b\u61c9\u93c8\uff0c\u63d0\u5347\u667a\u6167\u5de5\u5ee0\u751f\u7522\u6548\u7387, DForum \u667a\u6167\u5de5\u5ee0\u8ad6\u58c7, Taiwan</li> <li>20200901, \u4f7f\u7528 Ansible \u81ea\u52d5\u5316 Tibero \u8cc7\u6599\u5eab\u90e8\u7f72\u8207\u7dad\u904b, Online Webinar, Taiwan</li> <li>20200730, NetApp &amp; Red Hat \u9ad8\u5f48\u6027\u5bb9\u5668\u5f0f\u5132\u5b58\u7dda\u4e0a\u8ad6\u58c7, DigiTime Online Webinar, Taiwan</li> <li>20200612, How I do troubleshooting on container, more than docker?, HKOSCon 2020, Hong Kong</li> <li>20200526, Red Hat and Sysage Ansible \u7814\u8a0e\u6703, Online Webinar, Taiwan</li> <li>20200508, Red Hat vSummit \u7cbe\u83ef\u7dda\u4e0a\u7814\u8a0e\u6703. Online Webinar, Taiwan</li> <li>20200428, Cloud Native API Webniar, Red Hat \u7dda\u4e0a\u8b1b\u5802, Taiwan</li> <li>20200311, \u3010IBM \u96f2\u8b1b\u5802\u3011\u7b2c\u56db\u96c6\uff1a\u5f48\u6307\u641e\u5b9a\u591a\u96f2\u7ba1\u7406, Online Webinar, Taiwan</li> <li>20200225, \u5c31\u662f\u8981\u8ddf\u4f60\u804a Red Hat Ansible, Online Webinar, Taiwan</li> <li>20200213, SQL Server 2019 \u651c\u624b Red Hat OpenShift Container Platform \u5f37\u5f37\u806f\u624b\u6253\u9020\u4f01\u696d\u7d1a\u6df7\u5408\u96f2, SQL Server 2019 \u8207\u958b\u6e90\u5bb9\u5668Kubernetes\u5be6\u6230\u71df, Taiwan</li> <li>20200212, Red Hat Ansible \u81ea\u52d5\u5316\u61c9\u7528, Red Hat Ansible\u7b56\u7565\u7522\u54c1\u4ea4\u6d41\u6703, Taiwan</li> <li>20200109, SQL Server 2019 \u651c\u624b Red Hat OpenShift Container Platform \u5f37\u5f37\u806f\u624b\u6253\u9020\u4f01\u696d\u7d1a\u6df7\u5408\u96f2, SQL Server 2019 \u8207\u958b\u6e90\u5bb9\u5668Kubernetes\u5be6\u6230\u71df, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2019-total-13","title":"2019 (Total: 13)","text":"<ul> <li>20191221, The First Journey from docker to podman, SDN x Cloud Native Meetup #23, Taiwan</li> <li>20191105, \u7ba1\u7406\u5bb9\u5668\u8207\u6df7\u5408\u96f2\u74b0\u5883\uff1a\u5256\u6790\u8cc7\u8a0a\u5b89\u5168\u81ea\u52d5\u5316\u8207\u6cd5\u898f\u9075\u5f9e, Red Hat Forum Taipei 2019, Taiwan</li> <li>20190911, Red Hat Service Mesh Workshop, Kubernetes Summit 2019, Taiwan</li> <li>20190817, Container Bare Metal for Networking, COSCUP 2019, Taiwan</li> <li>20190730, Security &amp; Insights with Management &amp; Automation, Red Hat Hybrid Cloud Forum, Taiwan</li> <li>20190720, Better Practice: Day 2 Operaition with Ansible, SDN x Cloud Native Meetup #18, Taiwan</li> <li>20190627, Ansible for Network Automation, Ansible Automates, Taiwan</li> <li>20190522, \u4ee5 Ansible Tower \u5354\u52a9\u4f01\u696d\u7db2\u8def\u81ea\u52d5\u5316\u7ba1\u7406, Juniper Networks Innovation Day, Taiwan</li> <li>20190423, OpenShift \u5bb9\u5668\u5e73\u53f0\u6280\u8853\u6982\u89c0, TFC, Taiwan</li> <li>20190218, OpenShift Storage \u67b6\u69cb\u601d\u8003, OpenShift Taiwan Meetup #2, Taiwan</li> <li>20190214, After CoreOS, DevOps Taiwan Meetup #21, Taiwan</li> <li>20190130, Ansible \u6280\u8853\u6982\u89c0\u4ecb\u7d39, TFC #13, Taiwan</li> <li>20190122, \u90a3\u4e9b\u5e74\u7684 OpenShift 3.11 \u5bb9\u5668\u5e73\u53f0\u6280\u8853\u9078\u578b, SDN x Cloud Native Meetup #13, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2018-total-4","title":"2018 (Total: 4)","text":"<ul> <li>20181208, Thinking about MEC/NFV, SDN x Cloud Native Meetup #12, Taiwan</li> <li>20181102, \u7d05\u5e3d\u7ba1\u7406\u65b9\u6848\u4fc3\u9032 IT \u7dad\u904b\u81ea\u52d5\u5316, Red Hat Forum Taipei 2018, Taiwan</li> <li>20181111, NetDevOps 101, Ansible Taipei Meetup #1, Taiwan</li> <li>20180807, \u8b93 Open Hybrid Cloud \u5354\u52a9\u8f49\u578b, OpenInfra Day Taiwan 2018, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2017-total-29","title":"2017 (Total: 29)","text":"<ul> <li>20171224, Up in the Air of SDN, SDN x Cloud Native User Group, Taiwan</li> <li>20171222, The Mission of Open Networking Foundation, Chung Yuan University - EE, Taoyuan, Taiwan</li> <li>20171129, R-CORD Overview,GNTC, Beijing, China</li> <li>20171129, CORD Overview, GNTC, Beijing, China</li> <li>20171128, ONOS Support for P4 Runtime, GNTC, Beijing, China</li> <li>20171116, Introduction of Open Source Networking, \u901a\u8a0a\u958b\u6e90\u8edf\u9ad4\u7522\u5b78\u6280\u8853\u7814\u8a0e\u6703, National Cheng Kung University, Tainan, Taiwan</li> <li>20171109, Trellis Bare Metal Switches From Edgecore, CORD Build 2017, San Jose, USA</li> <li>20171026, \u5317\u7c73\u30db\u30ef\u30a4\u30c8\u30dc\u30c3\u30af\u30b9\u6d3b\u7528\u4e8b\u4f8b\u6700\u65b0\u52d5\u5411, \u30db\u30ef\u30a4\u30c8\u30dc\u30c3\u30af\u30b9\u30b9\u30a4\u30c3\u30c1\u30e6\u30fc\u30b6\u4f1a \u7b2c\u56db\u56de\u52c9\u5f37\u4f1a, \u6771\u4eac, \u65e5\u672c</li> <li>20171019, Overview of DevOps, National Chiao Tung University - NA/SA Course, Taiwan</li> <li>20171016, The Mission of Open Networking Foundation, Tunghai University - CS Seminar, Taiwan</li> <li>20171012, Introduction of Open Networking, National Taiwan Ocean University - Seminar, Taiwan</li> <li>20170923, The Trends of Open Networking, TFC, Taiwan</li> <li>20170904, NetDevOps: How to Become Next-Generation Network Engineer, DevOps Days Taipei 2017, Taiwan</li> <li>20170825, What happened in Data Center Networking,  DigitalOcean Hsinchu, Taiwan</li> <li>20170815, The Future of Open Networking and OpenStack, National Taichung University of Science and Technology, Taiwan</li> <li>20170802, Introduction of ONF CORD, Global SDNFV Tech Conference 2017, Beijing, China</li> <li>20170718, Introduction of ONF CORD, OpenStack Day Taiwan 2017, Taiwan</li> <li>20170518, Build Testing Infrastructure, National Chiao Tung University - NA/SA Course, Taiwan</li> <li>20170512, Open Networking Experience Sharing, SDNDS-TW Workshop 2017, Taiwan</li> <li>20170512, Introduction to SnapRoute/BigSwitch/CumulusLinux/Pica8, SDNDS-TW Workshop 2017, Taiwan</li> <li>20170511, Introduction to Open vSwitch/ONL&amp;OF-DPA/Mininet, SDNDS-TW Workshop 2017, Taiwan</li> <li>20170511, NetDevOps \u2013 Automation and Configuration Management using Ansible, SDNDS-TW Workshop 2017, Taiwan</li> <li>20170503, Overview of Open Networking (OpenSource), Tunghai University - CS Seminar, Taiwan</li> <li>20170429, Overview of Open Networking (Engineering and Business), Study-Area Meetup, Taiwan</li> <li>20170422, Overview of Open Networking (Engineering and Business), Study-Area Meetup, Taiwan</li> <li>20170322, Introduction of Open Networking, National Chiao Tung University, Mentor\u2019s Hours, Taiwan</li> <li>20170319, Why you need to know NetDevOps, Agile Meetup, Taiwan</li> <li>20170316, Network Troubleshooting Methodology, National Chiao Tung University - NA/SA Course, Taiwan</li> <li>20170120, Next-generation Data Center Solution Big Switch Monitoring Fabric, ISAC, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2016-total-10","title":"2016 (Total: 10)","text":"<ul> <li>20161212, Overview of ONOS/CORD and Use Case Study, National Chung Cheng University - CCU Seminar, Taiwan</li> <li>20161201, Overview of DevOps, National Chiao Tung University - NA/SA Course, Taiwan</li> <li>20161119, Experience Sharing of CORD Fabric Hardware Switch,  SDNDS-TW Meetup #4, Taiwan</li> <li>20161003, 2016 Edgecore Networks BCF virtual LAB, Edgecore Partner Summit 2016, Taiwan</li> <li>20161003, 2016 Edgecore Networks BMF virtual LAB, Edgecore Partner Summit 2016, Taiwan</li> <li>20160929, Short Introduction of CORD and Mobile CORD, MOPCON 2016 Unconference, Taiwan</li> <li>20160716, ONOS and Real Deploy Use Case Study, Study-Area 2016, Taiwan</li> <li>20160603, Global ONOS SDN-IP Deployment, ONOS/CORD Workshop, Taiwan</li> <li>20160522, ONOS SDN-IP Deployement Experience Sharing, Open Culture Foundation, Tainan, Taiwan</li> <li>20160519, ONOS SDN-IP Deployement Experience Sharing, Open Culture Foundation, HsinChu, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2015-total-2","title":"2015 (Total: 2)","text":"<ul> <li>20151206, Traveling SDN, OpenSUSE Asia Summit 2015, Taiwan</li> <li>20150921, How to apply NCTUCS via hardcore way, COSCUP 2015 Lightening Talk, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"recording.html#2014-total-2","title":"2014 (Total: 2)","text":"<ul> <li>20141016, Understand OpenvSwitch, SDNDS-TW Meetup #2, Taiwan</li> <li>20140823, About SDNDS-TW, SDNDS-TW Meetup #1, Taiwan</li> </ul>","tags":["public speach","aboutme"]},{"location":"speaker.html","title":"\u8b1b\u8005\u4ecb\u7d39 (Speaker Information)","text":"<ul> <li>Photo</li> </ul> <p>Download The Photo</p> <ul> <li>\u4e2d\u6587\u540d</li> </ul> <pre><code>\u9ec3\u79c9\u921e\n</code></pre> <ul> <li>\u4e2d\u6587\u7c21\u4ecb</li> </ul> <pre><code>\u9ec3\u79c9\u921e Phil Huang \u73fe\u65bc Microsoft \u64d4\u4efb Azure \u8cc7\u6df1\u96f2\u7aef\u89e3\u6c7a\u65b9\u6848\u67b6\u69cb\u5e2b\uff0c\u540c\u6642\u4e5f\u662f\u53f0\u7063\u552f\u4e00 CNCF Ambassador\u3002\u66fe\u4efb\u8077\u65bc Red Hat \u53ca VMware \u64d4\u4efb\u8cc7\u6df1\u552e\u524d\u67b6\u69cb\u5e2b\u4e4b\u8077\uff0c\u4e14\u5177\u5099 7 \u5e74\u4ee5\u4e0a\u7684 IT \u4f01\u696d\u7d1a\u57fa\u790e\u67b6\u69cb\u8a2d\u8a08\u7d93\u9a57\u3002\u57fa\u65bc\u958b\u6e90\u6587\u5316\u85b0\u9676\u4e4b\u4e0b\uff0c\u5c0d Linux / Kubernetes / \u96f2\u5730\u6df7\u5408\u7db2\u8def\u67b6\u69cb\u7686\u6709\u6280\u8853\u7422\u78e8\u53ca\u898b\u89e3\uff0c\u4e14\u8ddf\u96a8\u958b\u6e90\u56de\u994b\u7684\u7cbe\u795e\uff0c\u5c07\u76f8\u95dc\u7684\u77e5\u8b58\u4ee5\u6587\u7ae0\u64b0\u5beb (blog.pichuang.com.tw) \u6216\u65bc Cloud Native Taiwan User Group \u793e\u7fa4\u9032\u884c\u5206\u4eab\uff0c\u76f8\u4fe1\u900f\u904e\u958b\u6e90\u6280\u8853\u548c\u793e\u7fa4\u7684\u529b\u91cf\uff0c\u671f\u671b\u80fd\u5920\u5e6b\u52a9\u66f4\u591a\u4f01\u696d\u548c\u4f7f\u7528\u8005\u5be6\u73fe\u76ee\u6a19\u3002\n</code></pre> <ul> <li>English Name</li> </ul> <pre><code>Phil Huang\n</code></pre> <ul> <li>English Speaker Background</li> </ul> <pre><code>Phil Huang, currently serving as a Senior Cloud Solution Architect for Azure at Microsoft, is the only CNCF Ambassador in Taiwan. With over 7 years of experience in designing IT enterprise infrastructure. Prior to joining Azure, he served as a Solution Architect at Red Hat and a System Engineer at VMware, where he gained extensive experience in implementing OpenSource culture and technologies like Linux, Kubernetes, and hybrid cloud networking.\n\nIn addition to his professional work, Phil is also dedicated to sharing his knowledge and experiences through writing blogs (blog.pichuang.com.tw) and speaking at the Cloud Native Taiwan User Group (CNTUG). Hopes to leverage the power of open-source technology and community to assist more enterprises and users in achieving their goals.\n</code></pre>","tags":["aboutme"]},{"location":"tags.html","title":"Tags","text":"<p>Following is a list of relevant tags:</p> <p>[TAGS]</p>"},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html","title":"\u5f9e Red Hat OpenShift \u5916\u90e8\u8a2a\u554f Services \u6216 Pods","text":"<p>Red Hat OpenShift v3.11 \u67b6\u69cb\u88e1\u7db2\u8def\u4e3b\u8981\u5206\u70ba\u4e09\u5927\u584a:</p> <ol> <li>Hosts subnet</li> <li>Service subnet</li> <li>Pod subnet</li> </ol> <p>Host subnet \u6beb\u7121\u61f8\u5ff5\u6307\u7684\u5c31\u662f\u4e3b\u6a5f\u6240\u4f7f\u7528\u7684 IP\uff0c\u4e5f\u5c31\u662f\u5c0d\u5916\u53ef\u4ee5\u63a5\u89f8\u5230\u4e3b\u6a5f\u7684\u7db2\u8def; \u800c Service \u548c Pods subnet \u5728 OpenShift \u88e1\u9762\u662f\u4e00\u500b\u865b\u64ec\u6982\u5ff5\uff0c\u6b63\u5e38\u72c0\u6cc1\u4e0b\u5916\u90e8\u7db2\u8def\u7121\u6cd5\u900f\u904e Pod IP/Port \u548c Service IP/Port \u63a5\u89f8\u5230\u670d\u52d9</p> <p>\u90a3\u5982\u679c\u6211\u60f3\u8981\u8b93 Pod \u6216 Service IP \u53ef\u4ee5\u88ab\u5916\u9762\u63a5\u89f8\u5230\u5462? \u4ee5\u4e0b\u5206\u70ba\u5169\u500b\u5c64\u7d1a\u4f86\u8a0e\u8ad6: 1. Pod mapping to host 2. Service mapping to host</p>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#pod-port-mapping-to-host-port","title":"Pod port Mapping to Host port","text":"","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#hostnetworktrue","title":"\u4f7f\u7528 <code>hostNetwork=true</code>","text":"<p>\u82e5\u6c92\u6709\u7279\u5225\u6307\u5b9a\u7684\u8a71\uff0c\u9810\u8a2d <code>hostPort</code> \u7b49\u65bc <code>containerPort</code>\uff0c\u610f\u601d\u662f\u8aaa Pod \u88e1\u9762\u7684\u5bb9\u5668\u958b\u4e86\u4ec0\u9ebc Port \u5c31\u6703\u76f4\u63a5\u5c0d\u61c9\u5230 host \u4e0a\u9762\u7684 Port\uff0c\u800c Pod IP \u5247\u6703\u7406\u6240\u7576\u7136\u5730\u7b49\u65bc Host IP</p> <p>\u5916\u9762\u8a2a\u554f\u670d\u52d9\u7684 IP/Port\uff0c\u8acb\u6c42\u6703\u76f4\u63a5\u8f49\u5230\u548c Pod \u76f8\u540c\u7684 IP/Port \uff0c\u9014\u4e2d\u4e0d\u7d93\u904e iptables \u53ca service \u8655\u7406</p> <p>\u512a\u9ede: \u76f4\u63a5\u53ef\u4ee5\u5f9e\u5916\u9762\u76f4\u63a5\u63a5\u89f8\u5230 Pod \u5c64\u7d1a\u670d\u52d9\uff0c\u7db2\u8def\u8f49\u767c\u6548\u7387\u6703\u6bd4 nodePort \u597d \u7f3a\u9ede: \u4e0d\u80fd\u5728\u540c\u4e00\u53f0\u4e3b\u6a5f (Host) \u958b\u555f\u7b2c\u4e8c\u500b\u76f8\u540c\u7684 Pod\uff0c\u56e0\u70ba\u6703\u6709 Port \u885d\u7a81\u7684\u554f\u984c\uff0c\u4e5f\u4e0d\u80fd\u8de8\u4e3b\u6a5f\u5efa\u7acb\u670d\u52d9</p> <pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: influxdb\nspec:\n  hostNetwork: true &lt;----\n  containers:\n    - name: nginx\n      image: nginx\n</code></pre>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#hostport","title":"\u4f7f\u7528 <code>hostPort</code>","text":"<p>\u6982\u5ff5\u8ddf\u524d\u8005\u5f88\u50cf\uff0c\u5dee\u7570\u6703\u5728\u53ef\u4ee5\u6307\u5b9a\u7279\u5b9a\u7684 <code>hostPort</code> \u5c0d\u61c9\u5230 <code>containerPort</code>\uff0c\u4f46\u4e26\u4e0d\u9700\u8981\u5168\u90e8\u7684 Pod Port \u90fd\u8ddf Host \u505a\u5c0d\u61c9\uff0c\u53ef\u4ee5\u6709\u9650\u5ea6\u7684\u958b\u653e\u51fa\u53bb</p> <p>\u512a\u9ede: \u76f4\u63a5\u53ef\u4ee5\u5f9e\u5916\u9762\u76f4\u63a5\u63a5\u89f8\u5230 Pod \u5c64\u7d1a\u670d\u52d9 \u7f3a\u9ede: \u4e0d\u80fd\u5728\u540c\u4e00\u53f0\u4e3b\u6a5f (Host) \u958b\u555f\u7b2c\u4e8c\u500b\u76f8\u540c\u7684 Pod\uff0c\u56e0\u70ba\u6703\u6709 Port \u885d\u7a81\u7684\u554f\u984c\uff0c\u4e5f\u4e0d\u80fd\u8de8\u4e3b\u6a5f\u5efa\u7acb\u670d\u52d9</p> <pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\nspec:\n  containers:\n    - name: nginx\n      image: nginx\n      ports:\n      - containerPort: 80\n        hostPort: 8080 &lt;----\n</code></pre>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#service-port-mapping-to-host-port","title":"Service port Mapping to Host port","text":"","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#nodeport","title":"\u4f7f\u7528 <code>nodePort</code>","text":"<p>\u5ee3\u6cdb\u61c9\u7528\u7684\u670d\u52d9\u63ed\u9732\u65b9\u5f0f\uff0c\u5728\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c\u6bcf\u555f\u52d5\u4e00\u500b Service \u90fd\u6703\u642d\u914d\u4e00\u500b <code>ClusterIP</code>\uff0c\u800c\u9019\u500b <code>ClusterIP</code> \u50c5\u80fd\u5728\u540c\u4e00\u500b\u96c6\u7fa4\u5167\u90e8\u88ab\u8a2a\u554f\uff0c\u5916\u9762\u4e0d\u80fd\u63a5\u89f8\u5230\uff0c\u5018\u82e5\u60f3\u8981\u8b93\u4ed6\u88ab\u63a5\u89f8\u7684\u8a71\uff0c\u5c31\u8981\u6307\u5b9a <code>nodePort</code> \u5c0d\u5916\u63ed\u9732</p> <p>hostPort \u8ddf nodePort \u7684\u5dee\u7570\u5728\uff0c\u524d\u8005\u662f\u91dd\u5c0d\u55ae\u4e00\u4e3b\u6a5f\u88e1\u7684\u55ae\u4e00\u5bb9\u5668\u9032\u884c\u8a2d\u5b9a\uff0c\u5f8c\u8005\u5247\u662f\u4ee5\u4e00\u500b\u96c6\u7fa4\u4f86\u770b\u5f85\uff0c\u670d\u52d9\u53ef\u4ee5\u8de8\u4e3b\u6a5f</p> <p>\u512a\u9ede: \u53ef\u8de8\u4e3b\u6a5f\uff0c\u76f4\u63a5\u53ef\u4ee5\u5f9e\u5916\u9762\u76f4\u63a5\u63a5\u89f8\u5230 Service \u5c64\u7d1a\u670d\u52d9\uff0c\u4e14\u80fd\u900f\u904e\u6240\u7522\u751f\u7684 ClusterIP \u5c0d\u5f8c\u7aef\u7684 Pod \u505a\u8ca0\u8f09\u5747\u8861 \u7f3a\u9ede: \u6240\u6709\u96c6\u7fa4\u7684 Port \u90fd\u6703\u540c\u6642\u88ab\u958b\u8d77\u4f86\uff0c\u8b93\u5916\u90e8\u505a\u63a5\u89f8</p> <pre><code>---\nkind: Service\napiVersion: v1\nmetadata:\n  name: influxdb\nspec:\n  type: NodePort\n  ports:\n    - port: 8086\n      nodePort: 30000 &lt;---\n  selector:\n    name: influxdb\n</code></pre> <p>\u5efa\u8b70\u53ef\u4ee5\u642d\u4e00\u500b\u5916\u90e8 Reverse Proxy \u4f86\u505a\u4f7f\u7528\uff0c\u8b6c\u5982\u50cf\u662f F5 / A10 / HAProxy</p>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#ingress-controller-openshift-router","title":"\u4f7f\u7528 Ingress Controller: OpenShift Router","text":"<p>\u7d9c\u5408 Pod \u8ddf Service \u7684\u512a\u9ede\u7684\u6539\u826f\u4f5c\u6cd5\uff0c\u4e5f\u662f\u666e\u904d\u5efa\u7acb\u5c0d\u5916\u670d\u52d9\u6642\u7684\u6700\u4f73\u5be6\u8e10\u3002\u4f60\u4e0d\u9700\u8981\u81ea\u5df1\u5c0d\u6240\u6709\u7684 Service \u53bb\u65b0\u589e <code>nodePort</code>\uff0c\u800c\u53ef\u4ee5\u76f4\u63a5\u5728 OpenShift \u4e0a\u5efa\u7acb\u4e00\u500b Reverse Proxy \u7684\u670d\u52d9\uff0c\u76f4\u63a5\u9032\u884c\u5c0d\u5916\u670d\u52d9\u63ed\u9732\u53ca\u5c0d\u5167\u670d\u52d9\u8ca0\u8f09\u5e73\u8861\uff0c\u4f9d\u64da\u4e0d\u540c\u7684 Ingress Controller \u5be6\u4f5c\uff0c\u901a\u5e38\u529f\u80fd\u90fd\u6703\u5305\u542b HTTP \u8def\u5f91\u63ed\u9732\u3001Session Sticky\u3001SSL Transparent/Re-encrypt/Terminated \u7b49\u7b49\u8ca0\u8f09\u5e73\u8861\u7684\u529f\u80fd</p> <p>OpenShift Router \u662f\u63a1\u7528 <code>hostnetwork</code> \u7684\u65b9\u5f0f\u5efa\u7acb\uff0c\u6240\u4ee5\u6bcf\u4e00\u53f0\u4e3b\u6a5f\u81f3\u591a\u53ea\u80fd\u5b89\u88dd\u4e00\u500b\uff0c\u540c\u6642 80 / 443 /1936 \u9019\u4e09\u500b Port \u6703\u88ab\u9810\u8a2d\u4f54\u8d70</p> <p>\u60f3\u4e86\u89e3\u65bc OpenShift \u5c0d\u65bc Ingress Controller \u7684\u5be6\u4f5c <code>Router</code> \u53ef\u4ee5\u53c3\u8003 Router Overview - OpenShift v3.11 Docs</p>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#service-type-loadbalancer","title":"\u4f7f\u7528 Service Type: <code>LoadBalancer</code>","text":"<p>\u6b63\u5e38\u4f7f\u7528\u4e0b\uff0c\u9019\u529f\u80fd\u50c5\u9650\u65bc\u516c\u6709\u96f2\uff0c\u4f46\u5728 OpenShift \u88e1\u9762\u6709\u652f\u63f4\u4e00\u500b\u529f\u80fd\u53eb\u505a <code>ingress IP</code>\uff0c\u6548\u679c\u5c31\u662f\u7d66 OpenShift \u50c5\u4e00\u500b\u7279\u5b9a\u7684\u7db2\u6bb5 (Subnet) \u4e4b\u5f8c\uff0c\u53ef\u4ee5\u5f9e\u4e2d\u9078\u53d6\u4efb\u4e00 IP\uff0c\u4e26\u4f7f\u7528 <code>type: LoadBalancer</code> \u5c0d\u5916\u63ed\u9732\u670d\u52d9\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 Using Ingress to Expose Services</p>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#external-ingressip","title":"\u4f7f\u7528 External IngressIP","text":"<p>\u5018\u82e5\u4e00\u5b9a\u8981\u8d70 non-HTTP/HTTPS \u7684\u670d\u52d9\uff0c\u53c8\u60f3\u8981\u6709\u985e\u4f3c\u65bc\u4f7f\u7528 <code>Service Type: LoadBalancer</code>\uff0c\u90a3\u53ef\u4ee5\u8003\u616e\u4f7f\u7528 IngressIP \u4f86\u505a\u4f7f\u7528\uff0cUsing Ingress to Expose Services</p> <p>\u53ef\u4ee5\u505a\u6210\u4e0b\u9762\u7684\u6548\u679c</p> <pre><code>$ oc get svc -n openshift-ingress\nNAME                      TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                      AGE\nrouter-default            LoadBalancer   172.30.16.119   52.230.228.163   80:30745/TCP,443:32561/TCP   2d6h\n</code></pre>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#summary","title":"Summary","text":"<p>\u5728 OpenShift \u7684\u74b0\u5883\u4e4b\u4e0b</p> <ol> <li>\u5c0d\u65bc http/https \u7684\u670d\u52d9\uff0c\u5c0d\u5916\u900f\u904e Ingress Controller: OpenShift Router \u63ed\u9732 FQDN \u8b93\u5916\u9762\u4f7f\u7528</li> <li>\u5c0d\u65bc\u975e http/https \u7684\u670d\u52d9\uff0c\u5982 mysql\uff0c\u6709\u4e0b\u5217\u5169\u7a2e\u505a\u6cd5:</li> <li>\u82e5\u4e0d\u9700\u8981\u63d0\u4f9b\u5c0d\u5916\u670d\u52d9\uff0c\u50c5\u4f7f\u7528 <code>ClusterIP</code> \u5728\u5167\u90e8\u9032\u884c\u4f7f\u7528</li> <li>\u82e5\u9700\u8981\u63d0\u4f9b\u5c0d\u5916\u670d\u52d9\uff0c\u6709\u4e0b\u5217\u4e09\u7a2e\u505a\u6cd5:<ol> <li>Single Instance\uff0c\u4e0d\u9700\u8981\u5728\u591a\u500b node \u4e0a\u9762\u904b\u884c\uff0c\u4f7f\u7528 <code>hostnetwork</code> \u6216 <code>hostPort</code></li> <li>Multiple Instance\uff0c\u9700\u8981\u5728\u591a\u500b node \u4e0a\u9762\u904b\u884c\uff0c\u505a\u5230 scale-out \u7684\u6548\u679c\uff0c\u5247\u4f7f\u7528 <code>ingress IP</code> \u70ba\u4f73</li> </ol> </li> </ol>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190321-reach-out-services-and-pods-from-outside-into-openshift.html#references","title":"References","text":"<ul> <li>kubernetes\u5b66\u4e60\u8bb0\u5f55\uff083\uff09\u2014\u2014\u96c6\u7fa4\u5916\u90e8\u8bbf\u95eePod\u6216Service</li> <li>Kubernetes \u7db2\u8def\u662f\u5982\u4f55\u904b\u4f5c? Part 1- Erhwen Kuo</li> <li>Kubernetes \u7db2\u8def\u662f\u5982\u4f55\u904b\u4f5c? Part 2- Erhwen Kuo</li> <li>\u4ece\u5916\u90e8\u8bbf\u95eeKubernetes\u4e2d\u7684Pod - JimmySong</li> <li>Accessing Kubernetes Pods from Outside of the Cluster</li> <li>Router Overview - OpenShift v3.11 Docs</li> <li>\u6df1\u5ea6\u7406\u89e3\uff1aOpenshift\u7aef\u53e3\u65b9\u5f0f\u5168\u89e3\u6790 - \u5927\u885b\u5206\u4eab</li> <li>OpenShift \u7f51\u7edc\u5206\u6790-(\u5bb9\u5668\u7f51\u7edc\u9009\u578b\u548c\u65b9\u6848\u5efa\u8bae) - \u5927\u885b\u5206\u4eab</li> <li>Using Ingress to Expose Services</li> </ul>","tags":["redhat","openshift3","openshift4","openshift","router","services","pods"]},{"location":"20190404-openshift-network-traffic-overview.html","title":"Red Hat OpenShift v3.11 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u63a2\u8a0e","text":"","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#_1","title":"\u8cc7\u6599\u4e2d\u5fc3\u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u6d41","text":"<p>\u4e00\u822c\u8a0e\u8ad6\u7684\u8cc7\u6599\u4e2d\u5fc3\u8cc7\u6599\u6d41\u91cf\uff0c\u4e3b\u8981\u5206\u70ba\u5169\u5927\u6d41\u5411 - \u5357\u5317\u5411 (North-South Traffic):  Client \u8207 Server \u4e4b\u9593\u7684\u7db2\u8def\u6d41\u91cf - \u6771\u897f\u5411 (East-West Traffic): Server \u8207 Server \u4e4b\u9593\u7684\u7db2\u8def\u6d41\u91cf</p> <p></p> <p>\u90a3\u5982\u679c\u5957\u7528\u5728 Red Hat OpenShift v3.11 \u5bb9\u5668\u5e73\u53f0\u67b6\u69cb\u4e0b\uff0c\u90a3\u5be6\u969b\u7db2\u8def\u6d41\u91cf\u662f\u5982\u4f55\u5c0d\u61c9?</p>","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#red-hat-openshift-311","title":"Red Hat OpenShift 3.11 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u6d41","text":"<p>\u9996\u5148\u5148\u4f86\u5f35\u5e38\u898b\u7684\u67b6\u69cb\u5716</p> <p></p> <p>\u4ee5 Red Hat OpenShift \u70ba\u6838\u5fc3\u8996\u89d2\uff0c\u53ef\u4ee5\u5206\u70ba\u4e09\u6bb5\u7db2\u8def 1. \u5317\u5411\u7db2\u8def\u6d41 Ingress Traffic 2. \u6771\u897f\u5411\u7db2\u8def\u6d41 3. \u5357\u5411\u7db2\u8def\u6d41 Egress Traffic</p>","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#ingress-traffic","title":"\u5317\u5411: Ingress Traffic","text":"<p>\u5f9e What is Ingress? - Kubernetes \u5b9a\u7fa9\u4e0a\u4f86\u8aaa\uff0c\u53ef\u4ee5\u4e86\u89e3\u5230 Ingress \u4e3b\u8981\u7684\u76ee\u7684\u5c31\u662f\u8b93\u5916\u90e8\u4f7f\u7528\u8005\u53ef\u4ee5\u900f\u904e <code>Ingress Controller</code> \u63a5\u89f8\u5230 Kubernestes \u88e1\u9762\u7684 Service\uff0c\u800c\u5728 Red Hat OpenShift \u88e1\u9762\u7684\u8853\u8a9e\u5247\u662f\u4f7f\u7528 <code>Router</code> \u4f86\u505a\u95e1\u8ff0</p> <p>\u6545\u5728 Routes - OpenShift Docs v3.11 \u88e1\u9762\u6240\u63cf\u8ff0\u7684\u5167\u5bb9\uff0c\u53ef\u4ee5\u7528\u4e0b\u8868\u9032\u884c\u8853\u8a9e\u4e0a\u7684\u5c0d\u61c9</p> Kubernetes OpenShift Ingress resource (rules) Route (rules) Ingress controller (Nginx/Ambassador/...) Router (HAProxy) <p>\u800c Ingress Controller \u5176\u5be6\u662f\u4e00\u500b\u7d71\u7a31\uff0c\u5728 OpenShift Router \u5177\u9ad4\u5be6\u8e10\u4e0a\u4e3b\u8981\u6709\u652f\u63f4\u5169\u7a2e\u985e\u578b 1. OpenShift Router (\u9810\u8a2d) 2. F5 BIG-IP Controller (\u8981\u642d F5)</p> <p>\u6709\u4e9b\u4eba\u6703\u554f\u8aaa\u540c\u4e00\u5e73\u53f0\u5167\uff0c\u80fd\u4e0d\u80fd\u5b58\u5728\u591a\u500b Ingress Controller? \u7b54\u6848\u662f\u53ef\u4ee5\uff0c\u4f46\u8981\u7559\u610f\u5404 Ingress Controller \u7684\u5be6\u4f5c\u65b9\u5f0f\uff0c\u8b6c\u5982\u8aaa OpenShift Router \u7684\u65b9\u5f0f\u662f\u63a1\u7528 <code>hostnetwork</code> \u7684\u8d70\u6cd5\uff0c\u6240\u4ee5\u6bcf\u4e00\u53f0 host \u50c5\u80fd\u5b89\u88dd\u4e00\u500b\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 \u5f9e Red Hat OpenShift \u5916\u90e8\u8a2a\u554f Services \u6216 Pods - Phil Workspace</p>","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#east-west-traffic","title":"\u6771\u897f\u5411: East-West Traffic","text":"<p>\u5728 Red Hat OpenShift \u5e73\u53f0\u5e95\u4e0b\uff0c\u7121\u8ad6\u662f\u8981\u8de8 Pod / Service / Host \u9032\u884c\u6a6b\u5411\u7684\u6e9d\u901a\uff0c\u90fd\u662f\u9700\u8981\u6709 CNI (Cotainer Network Interface) \u7684\u5be6\u8e10\u624d\u80fd\u5c07\u4e0d\u540c\u4e3b\u6a5f\u4e4b\u9593\u7684\u9023\u7dda\u5efa\u7acb\u8d77\u4f86\u3002CNI \u672c\u8eab\u662f\u4e00\u5957\u6a19\u6e96\uff0c\u5be6\u4f5c\u4e0a\u5c31\u6703\u6709\u767e\u82b1\u9f4a\u653e\u7684\u5c08\u6848\u53ef\u4f9b\u4f7f\u7528\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 \u5e38\u898b CNI (Container Network Interface) Plugin \u4ecb\u7d39 - hwchiu</p> <p>\u800c\u9810\u8a2d\u4e0a\uff0cRed Hat OpenShift \u63d0\u4f9b\u4e09\u500b CNI Plugin \u53ef\u4f9b\u4f7f\u7528 1. ovs-subnet: \u55ae\u7d14 L2\uff0c\u985e\u540c flat network 2. ovs-multitenant: \u53ef\u91dd\u5c0d\u4e0d\u540c\u7684 namespace/project \u9032\u884c\u9694\u96e2 3. ovs-networkpolicy: \u63a7\u5236\u7d30\u7c92\u5ea6\u6700\u7d30\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>NetworkPolicy</code> object\uff0c\u985e\u540c\u65bc\u5beb iptables rules \u4e00\u6a23</p> <p>\u7576\u7136\u5982\u679c\u9060\u9060\u89ba\u5f97\u9019\u4e09\u500b\u529f\u80fd\u4e0d\u7b26\u5408\u9700\u6c42\u7684\u8a71\uff0c\u9084\u53ef\u4ee5\u4ecb\u63a5\u7b2c\u4e09\u65b9\u5ee0\u5546\u7684 CNI Plugin\uff0c\u8b6c\u5982 Juniper Contrail\u3001VMWare NSX-T \u7b49\u5c08\u696d\u7db2\u8def\u5ee0\u5546\u7684\u65b9\u6848\u9032\u884c\u865b\u5be6\u6574\u5408 (Overlay + Underlay Integration)</p>","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#egress-traffic","title":"\u5357\u5411: Egress Traffic","text":"<p>Egress \u9867\u540d\u601d\u7fa9\u53ef\u4ee5\u4e86\u89e3\u5230\u662f\u5f9e OpenShift \u7684 Pod \u5411\u5916\u53bb\u5b58\u53d6\u5916\u90e8\u670d\u52d9 (\u4f8b: Database)\uff0c\u5728\u6c92\u6709\u4efb\u4f55\u9650\u5236\u4e4b\u4e0b\uff0c\u5728 OpenShift \u5e95\u4e0b\u7684\u4efb\u4f55 Pod \u7576\u7136\u662f\u53ef\u4ee5\u96a8\u610f\u5730\u53bb\u5b58\u53d6\u5916\u90e8\u670d\u52d9\uff0c\u4ee5\u4e0b\u5716\u8868\u63a5\u7bc0\u9304 Network Security for Apps on OpenShift - Red Hat Summit</p> <p></p> <p>\u8a66\u60f3\u82e5\u4f60\u7684\u5916\u90e8\u670d\u52d9\u6709\u9700\u8981\u70ba\u4e86\u8cc7\u5b89\u4fdd\u8b77\u9032\u884c\u5b58\u53d6\u9650\u5236\uff0c\u800c\u4f60\u7684 Compute Node \u537b\u6709\u8907\u6578\u53f0\u4ee5\u4e0a\u7684\u8a71\uff0c\u662f\u4e0d\u662f\u8981\u7279\u5225\u628a\u9019\u4e9b Compute Node \u7684 IP \u6536\u96c6\u8d77\u4f86\u5f8c\uff0c\u5728\u5916\u90e8\u670d\u52d9\u4e2d\u8a2d\u5b9a\u767d\u540d\u55ae\u958b\u555f? \u5018\u82e5\u74b0\u5883\u53c8\u662f\u7d93\u5e38\u6027\u8b8a\u52d5\u7684\u8a71\uff0c\u662f\u4e0d\u662f\u6bcf\u6b21\u8b8a\u52d5\u90fd\u8981\u9032\u884c\u4e00\u6b21\u4fee\u6539\u5462? \u6240\u4ee5\u9019\u6642\u5019\u5c31\u6703\u6709\u91dd\u5c0d Egress Traffic \u7684\u4e09\u7a2e\u505a\u6cd5</p> <ol> <li>OpenShift Egress Firewall</li> <li>OpenShift Egress Routers</li> <li>Egress static IP</li> </ol> <p> </p> <p>\u5176\u4e2d OpenShift Egress Routers \u7684\u6280\u8853\u7d30\u7bc0\u8ddf\u4e0a\u9762\u6240\u8a0e\u8ad6\u7684 Ingress Controller: OpenShift Router \u662f\u5f88\u985e\u4f3c\u7684\uff0c\u800c\u6a21\u5f0f\u4e0a\u4e5f\u6709\u4e09\u7a2e\u505a\u6cd5\u53ef\u4ee5\u9078\u64c7\uff0c\u5206\u5225\u662f Redirect\u3001HTTP Proxy\u3001DNS Proxy</p> \u5206\u985e Redirect mode HTTP Proxy mode DNS Proxy mode Support Protocols TCP/UDP HTTP/HTTPS TCP Image ose-pod ose-egress-http-proxy ose-egress-dns-proxy Technology Netfilter rules Squid HAProxy","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#summary","title":"Summary","text":"<p>\u7121\u8ad6\u662f Kubernetes / OpenShift \u4e00\u822c\u5728\u8a0e\u8ad6\u5bb9\u5668\u5e73\u53f0\u7db2\u8def\u7684\u4e0d\u5916\u4e4e\u90fd\u662f\u5728\u8a0e\u8ad6 Pod / Service / NodePort \u7b49\u7b49\u7684\u61c9\u7528\uff0c\u4f46\u5be6\u969b\u4e0a\u4f7f\u7528\u7684\u6642\u5019\u6703\u883b\u63a8\u85a6\u7528\u8cc7\u6599\u6d41 (Data Flow) \u7684\u89c0\u9ede\u4e0b\u53bb\u505a\u6bcf\u4e00\u500b\u9ede\u7684\u8a0e\u8ad6\uff0c\u9019\u6a23\u5728\u6280\u8853\u9078\u578b\u4e0a\u624d\u4e0d\u6703\u601d\u8003\u592a\u4e45\uff0c\u7576\u7136\u6574\u9ad4\u7db2\u8def\u8003\u616e\u4e0d\u6703\u53ea\u6709\u55ae\u55ae\u9019\u4e00\u7bc7\u6587\u7ae0\u5c31\u53ef\u4ee5\u5168\u90e8\u8b1b\u5b8c\u7684\uff0c\u5176\u5be6\u6709\u975e\u5e38\u591a\u7d30\u7bc0\u53ef\u4ee5\u505a\u63a2\u8a0e\uff0c\u5c24\u5176\u662f\u5982\u4f55\u8ddf\u73fe\u6709\u7db2\u8def\u505a\u5c0d\u63a5\u3001\u9632\u706b\u7246\u74b0\u5883\u9694\u96e2\u7b49\u7b49\u90fd\u5f97\u4e00\u4f75\u8003\u616e\u9032\u53bb\u3002</p> <p>\u5e0c\u671b\u9019\u7bc7\u80fd\u5e6b\u52a9\u5927\u5bb6\u7528\u9ad8\u8996\u89d2\u7684\u65b9\u5f0f\u4f86\u7406\u89e3\u6574\u500b Red Hat OpenShift v3.11 \u7db2\u8def\u6d41\u91cf\u8d70\u5411</p>","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#appendix-openshift-v3-f5","title":"Appendix: \u91dd\u5c0d OpenShift v3 \u7248\u672c\u4e4b F5 \u8a2d\u5b9a","text":"","tags":["openshift3","openshift"]},{"location":"20190404-openshift-network-traffic-overview.html#references","title":"References","text":"<ul> <li>Cisco Data Center Spine-and-Leaf Architecture: Design Overview White Paper</li> <li>What is Ingress? - Kubernetes</li> <li>Available router plug-ins - OpenShift Docs v3.11</li> <li>Routes - OpenShift Docs v3.11</li> <li>OpenShift SDN - OpenShift Docs v3.11</li> <li>\u5f9e Red Hat OpenShift \u5916\u90e8\u8a2a\u554f Services \u6216 Pods</li> <li>\u5e38\u898b CNI (Container Network Interface) Plugin \u4ecb\u7d39 - hwchiu</li> <li>Network Security for Apps on OpenShift - Red Hat Summit</li> <li>Controlling Egress Traffic - OpenShift Docs v3.11</li> </ul>","tags":["openshift3","openshift"]},{"location":"20190527-bandwidth-and-throughput.html","title":"Bandwidth &amp; Throughput","text":"<ul> <li>\u983b\u5bec (Bandwidth)\uff1a\u6c34\u7ba1\u7684\u5927\u5c0f</li> <li>\u541e\u5410\u91cf (Throughput)\uff1a\u5f9e\u6c34\u7ba1\u5be6\u969b\u6d41\u51fa\u7684\u6c34\u91cf</li> <li>\u5ef6\u9072 (Latency)\uff1a\u6c34\u5f9e\u4e00\u7aef\u5230\u53e6\u4e00\u7aef\u6240\u82b1\u8cbb\u7684\u6642\u9593</li> </ul>","tags":["networking","telco"]},{"location":"20190527-bandwidth-and-throughput.html#bandwidth","title":"\u7406\u8ad6\u503c\u983b\u5bec (Bandwidth) \u63db\u7b97","text":"<pre><code>1 Gbps = 1024 Mbps = 128 MBps = 0.125 GBps\n7 Gbps = 7168 Mbps = 896 MBps = 0.875 GBps\n10 Gbps = 10240 Mbps = 1280 MBps = 1.25 GBps\n20 Gbps = 20480 Mbps = 2560 MBps = 2.5 GBps\n25 Gbps = 25600 Mbps = 3200 MBps = 3.125 GBps\n40 Gbps = 40960 Mbps = 5120 MBps = 5 GBps\n50 Gbps = 51200 Mbps = 6400 MBps = 6.25 GBps\n100 Gbps = 102400 Mbps = 12800 MBps = 12.5 GBps\n</code></pre>","tags":["networking","telco"]},{"location":"20190527-bandwidth-and-throughput.html#_1","title":"\u8cc7\u6599\u50b3\u8f38\u63db\u7b97","text":"<p>\u7406\u8ad6\u50b3\u8f38\u516c\u5f0f\uff1aTime (s) = File Size / Bandwidth \u5be6\u969b\u50b3\u8f38\u516c\u5f0f\uff1aTime (s) = File Size / Throughput</p>","tags":["networking","telco"]},{"location":"20190618-ansible-troubleshooting.html","title":"Ansible \u5982\u4f55\u9664\u932f? \u8ab0\u53ef\u4ee5\u6551\u6551\u6211?","text":"<p>\u53ef\u559c\u53ef\u8cc0\uff0c\u606d\u559c\u4e00\u4e0b Ansible \u4f86\u5230\u4e86 2.8 \u7248\u865f\u5566! \u6709\u8208\u8da3\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b Release Note</p> <p>\u5c31\u500b\u4eba\u7d93\u9a57\u4e0a\uff0c\u9084\u883b\u5e38\u9047\u5230\u6703\u5beb Ansible Playbook \u7684\u6280\u8853\u5de5\u7a0b\u5e2b\uff0c\u800c\u4ed6\u5011\u7684\u5171\u901a\u7169\u60f1\u90fd\u662f Ansible \u4f3c\u4e4e\u7591\u96e3\u6392\u89e3 (Trouble Shooting) \u6709\u4e9b\u56f0\u96e3\uff0c\u5e38\u5e38\u9047\u5230\u4e00\u500b\u554f\u984c\u6703\u770b\u5f88\u4e45\u4e0d\u77e5\u9053\u600e\u9ebc\u4e0b\u624b\u958b\u59cb\u9664\u932f (Debug)\u3002\u672c\u7bc7\u5c07\u5206\u4eab\u4e00\u4e0b\u7b46\u8005\u5e73\u6642\u7684\u4f5c\u6cd5\uff0c\u4f9b\u5ee3\u5927\u770b\u500c\u5011\u53c3\u8003\u7701\u4e0b\u4e0d\u5c11\u51a4\u6789\u8def\u3002\u800c\u5982\u679c\u4f60\u89ba\u5f97\u6211\u5beb\u7684\u770b\u4e0d\u592a\u61c2\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\u8266\u9577\u7684\u5169\u7bc7\u5927\u4f5c  \u8b93\u60a8\u5b89\u5fc3\u57f7\u884c-ansible-playbook-\u7684\u5c0f\u6280\u5de7-1 \u3001\u8b93\u60a8\u5b89\u5fc3\u57f7\u884c-ansible-playbook-\u7684\u5c0f\u6280\u5de7-2</p>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#_1","title":"\u7d93\u9a57\u5206\u4eab","text":"","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#_2","title":"\u6539\u6210\u5de5\u7a0b\u5e2b\u770b\u5f97\u61c2\u7684\u9664\u932f\u8a0a\u606f\uff1a\u4e0d\u6253\u8ff7\u7cca\u4ed7","text":"<p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0cAnsible \u8f38\u51fa\u7684\u683c\u5f0f\u662f\u4ee5 JSON \u683c\u5f0f\u70ba\u4e3b\uff0c\u7136\u5f8c\u901a\u5e38\u8f38\u51fa\u7684\u6642\u5019\u90fd\u6703\u5982\u4e0b\u5716\u986f\u793a\u8b8a\u6210\u4e00\u5768\u4e0d\u77e5\u9053\u5728\u5beb\u4ec0\u9ebc\u7684\u8a0a\u606f\uff0c\u5341\u5206\u96e3\u4ee5\u5224\u8b80</p> <p></p> <p>\u4f46 Ansible Callback Plugins \u6709\u652f\u63f4\u4e00\u500b\u5916\u639b\u6a21\u7d44\u53eb\u505a <code>debug</code>\uff0c\u4e3b\u8981\u662f\u5354\u52a9\u628a\u4e0a\u9762\u90a3\u4e00\u5768\u6771\u897f\u7684 stdout \u53ca stderr \u683c\u5f0f\u5316 (Format) \u6210\u4e0b\u5716\uff0c\u8b93\u4f60\u6e05\u6670\u5730\u4e86\u89e3\u932f\u8aa4\u8a0a\u606f\u5728\u5beb\u4ec0\u9ebc</p> <p></p> <p>\u958b\u8d77\u4f86\u7684\u65b9\u5f0f\u5f88\u7c21\u55ae\uff0c\u958b\u555f <code>ansible.cfg</code>\uff0c\u586b\u5165\u4ee5\u4e0b\u5167\u5bb9\u5373\u53ef</p> <pre><code>[default]\n...\nstdout_callback = debug\n</code></pre>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#debug","title":"\u611b\u7528 debug \u6a21\u7d44\uff1a\u5176\u5be6\u5c31\u662f\u591a\u5674\u9ede\u8cc7\u8a0a","text":"<p>\u82e5\u5728 Ansible \u57f7\u884c\u904e\u7a0b\u4e2d\uff0c\u4f60\u60f3\u8981\u4e86\u89e3\u67d0\u4e00\u500b\u8b8a\u6578\u88e1\u9762\u7684\u503c\u662f\u4ec0\u9ebc\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>debug</code> \u6a21\u7d44\u4f86\u7372\u53d6\u904b\u884c\u4e2d\u7684 Ansible \u57f7\u884c\u8b8a\u6578\u8cc7\u8a0a\u3002\u8981\u7559\u610f\u7684\u4e8b\u60c5\u662f\uff0c\u9019\u908a\u7684 debug \u662f\u4e00\u500b Ansible \u6a21\u7d44 (Modules)\uff0c\u4e0a\u9762\u7ae0\u7bc0\u6240\u63d0\u8d77\u7684\u5247\u662f Callback \u5916\u639b\u7576\u4e2d\u4e00\u500b\u6a21\u7d44\uff0c\u5169\u8005\u4e0d\u4e00\u6a23\u3002</p> <p>\u901a\u5e38 <code>debug</code> \u6a21\u7d44\u90fd\u6703\u642d\u914d <code>register</code> \u4e00\u4f75\u4f7f\u7528\uff0c<code>register</code> \u6700\u4e3b\u8981\u529f\u7528\u662f\u5c07\u55ae\u4e00 Task \u7d50\u679c\u8f38\u51fa\u6307\u6d3e\u7d66 <code>register</code> \u6240\u5b9a\u7fa9\u597d\u7684\u8b8a\u6578\uff0c\u5982\u4e0b\u7a0b\u5f0f\u78bc</p> <pre><code>---\n- hosts: all\n  tasks:\n    - name: Test connectivity\n      ping:\n      register: result\n\n    - name: Print result\n      debug:\n        msg: \"{{ result }}\"\n</code></pre> <p>\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u770b\u5230\uff0c\u7b2c\u4e00\u500b Task \u5c07\u6703\u57f7\u884c <code>ping</code> \u6a21\u7d44\uff0c\u800c\u5b83\u7522\u751f\u51fa\u4f86\u7684\u7d50\u679c\u5c07\u6703\u88ab\u6307\u5411 register \u6240\u5b9a\u7fa9\u7684 <code>result</code> \u8b8a\u6578\u88e1\u9762\uff0c\u800c\u7b2c\u4e8c\u500b Task \u5c07\u6703\u57f7\u884c <code>debug</code> \u6a21\u7d44\uff0c\u5c07\u88e1\u9762 <code>result</code> \u7684\u7d50\u679c\u5012\u51fa\u4f86\u986f\u793a\u5728\u5982\u4e0b\u756b\u9762</p> <p></p>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#dry-run","title":"\u5be6\u969b\u57f7\u884c\u524d\u5148\u8dd1 Dry Run \u770b\u770b\uff1a\u6c38\u4fdd\u5b89\u5eb7","text":"<p>\u883b\u591a\u5de5\u7a0b\u5e2b\u56e0\u70ba\u4e0d\u719f Ansible\uff0c\u5f88\u64d4\u5fc3\u6703\u4e0d\u6703\u4e00\u57f7\u884c\u932f\u8aa4\u7684\u6307\u4ee4\u4e0b\u53bb\uff0c\u5c31\u6703\u5c0e\u81f4\u707d\u96e3\u9019\u6a23\uff0c\u6240\u4ee5 Ansible \u63d0\u4f9b\u4e00\u500b\u6aa2\u67e5\u6a21\u5f0f <code>dry-run</code>\uff0c\u4f9b\u5de5\u7a0b\u5e2b\u5728\u6b63\u5f0f\u57f7\u884c\u524d\u53ef\u4ee5\u900f\u904e\u6a21\u64ec\u6307\u4ee4\u7684\u65b9\u5f0f\u5354\u52a9\u6aa2\u67e5\u4e00\u4e0b\u7576\u524d\u57f7\u884c\u7684 Playbook \u88e1\u9762\u6253\u7b97\u8981\u505a\u4ec0\u9ebc\u4e8b</p> <p>\u4e00\u822c\u4f5c\u6cd5\u61c9\u8a72\u662f\u5728\u4e0b <code>ansible-playbook</code> \u6307\u4ee4\u7684\u5f8c\u9762\u591a\u5e36 <code>--check</code> \u6307\u4ee4</p> <p><pre><code># \u8d77\u624b\u5f0f\n$ ansible-playbook -i pichuang.yml --check\n\n# \u5acc\u8cc7\u8a0a\u592a\u5c11\u6642\n$ ansible-playbook -i pichuang.yml --check -v\n\n# \u60f3\u8981\u4e00\u500b\u4e00\u500b Tasks \u6162\u6162\u770b\u6642\n$ ansible-playbook -i pichuang.yml --step --check\n</code></pre> </p>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#playbook-debugger-ansible","title":"Playbook Debugger\uff1a\u7576\u4f60\u60f3\u8981\u6210\u70ba Ansible \u8d85\u9ad8\u7d1a\u5beb\u624b\u6642...","text":"<p>\u5728\u5148\u524d\u7684\u793e\u7fa4\u5206\u4eab\u4e2d\uff0c\u7b46\u8005\u6709\u591a\u6b21\u63d0\u5230\u76ee\u524d\u628a Ansible Playbook \u5beb\u7684\u7b2c\u4e00\u7121\u6575\u8907\u96dc\u7684\u7bc4\u4f8b\u5c31\u662f GitHub - openshift/openshift-ansible \u9019\u500b\u5c08\u6848\u4e86\uff0c\u96d6\u7136\u6574\u500b\u5b89\u88dd\u53ea\u9700\u8981\u8dd1\u5169\u4e09\u884c\u6307\u4ee4\uff0c\u4f46\u53ea\u8981\u8b8a\u6578\u5beb\u932f\u6216\u8005\u662f\u5fd8\u8a18\u5beb\uff0c\u5c31\u8981\u53cd\u8986\u8dd1\u597d\u5e7e\u6b21\uff0c\u800c\u8dd1\u4e00\u6b21\u5927\u6982\u5c31\u8981\u82b1\u4e0a\u597d\u5e7e\u500b\u534a\u5c0f\u6642\u7684\u5149\u9670\u3002</p> <p>\u800c\u5148\u524d\u70ba\u4e86\u6293 <code>openshift-ansible</code> \u5b89\u88dd\u6642\u7684\u5176\u4e2d\u4e00\u500b\u5f88\u5f14\u8a6d\u7684\u554f\u984c\uff0c\u6700\u5f8c\u52d5\u7528\u4e86 <code>debugger</code> \u624d\u627e\u5230\u4e00\u500b\u795e\u5947\u7684\u5b57\u4e32\u554f\u984c\u3002\u6b63\u5e38\u6c92\u5beb\u5230\u9019\u9ebc\u8907\u96dc\u7684\u72c0\u6cc1\u4e0b\uff0c\u5176\u4ed6\u4e0a\u8ff0\u6240\u5217\u7684\u65b9\u5f0f\u5176\u5be6\u5c31\u5f88\u5920\u65e5\u5e38\u7dad\u904b\u7528\u4e86\u3002</p> <p>\u958b\u555f Playbook Debugger \u7684\u65b9\u5f0f\u5f88\u7c21\u55ae\uff0c\u958b\u555f <code>ansible.cfg</code>\uff0c\u586b\u5165\u4ee5\u4e0b\u5167\u5bb9\u5373\u53ef</p> <pre><code>[default]\n...\nstrategy = debug\n</code></pre> <p>\u958b\u555f\u4e4b\u5f8c\uff0c debugger \u6703\u5728\u9047\u5230 <code>Task Failed</code> \u7684\u6642\u5019\uff0c\u81ea\u52d5\u5207\u63db\u5230 debug mode\uff0c\u8a73\u7d30\u64cd\u4f5c\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b Available Commands</p> <p></p>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#_3","title":"\u5f8c\u8a00","text":"<p>Ansible \u672c\u8cea\u4e0a\u662f\u9075\u5faa\u4e09\u5927\u8981\u7d20\uff1aSimple\u3001Agentless\u3001Powerful\uff0c\u64b0\u5beb\u908f\u8f2f\u4e0a\u662f\uff0c\u80fd\u5beb\u5f97\u7c21\u55ae\u5c31\u76e1\u91cf\u5beb\u7684\u55ae\u7d14\uff0c\u4e0d\u8981\u5beb\u5f97\u592a\u904e\u8907\u96dc\u3002\u4f9d\u64da\u4e0d\u540c\u7684\u60c5\u5883\u4e4b\u4e0b\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u6703\u5c07\u8d8a\u4f86\u8d8a\u591a\u7684\u60c5\u5883\u8003\u616e\u9032\u53bb\uff0c\u4ee5\u81f3\u65bc Ansible Playbook \u8d8a\u4f86\u8d8a\u5927\uff0c\u4e0d\u592a\u5bb9\u6613\u9032\u884c\u57fa\u672c\u9664\u932f\uff0c\u6545\u5e0c\u671b\u672c\u7bc7\u80fd\u5e6b\u52a9\u5230\u5404\u4f4d\u5feb\u901f\u4e0a\u624b\u9664\u932f\u6280\u5de7\u3002\u800c\u5982\u679c\u4f60\u5c0d\u65bc\u5176\u4ed6 Ansible \u64b0\u5beb\u6280\u80fd\u6709\u8208\u8da3\u7684\u8a71\uff0c\u4e5f\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\u53bb\u5e74\u62d9\u4f5c  \u5e7e\u500b\u5c0f\u5efa\u8b70\u6539\u5584\u4f60\u7684 Ansible \u6280\u80fd - Phil Huang\u3002</p>","tags":["ansible","troubleshooting"]},{"location":"20190618-ansible-troubleshooting.html#references","title":"References","text":"<ul> <li>\u8b93\u60a8\u5b89\u5fc3\u57f7\u884c-ansible-playbook-\u7684\u5c0f\u6280\u5de7-1 - Chengwei Chen</li> <li>\u8b93\u60a8\u5b89\u5fc3\u57f7\u884c-ansible-playbook-\u7684\u5c0f\u6280\u5de7-2 - Chengwei Chen</li> <li>Ansible Callback Plugins List</li> <li>Ansible Callback Plugins - Debug</li> <li>Ansible Modules - Debug</li> <li>Ansible 2.8 Release Note</li> <li>GitHub - openshift/openshif-ansible</li> <li>Ansible Strategy - Playbook Debugger</li> <li>\u5e7e\u500b\u5c0f\u5efa\u8b70\u6539\u5584\u4f60\u7684 Ansible \u6280\u80fd - Phil Huang</li> </ul>","tags":["ansible","troubleshooting"]},{"location":"20191114-homelcloud-high-level-design-1.html","title":"2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-1 \u7e3d\u7db1\u53ca\u88dd\u5099\u6e05\u55ae","text":"<p>\u6700\u8fd1\u9019\u5169\u4e09\u5e74\u767c\u73fe\u6280\u8853\u8d8a\u8b8a\u8d8a\u5feb\uff0c\u800c\u4e14\u9084\u8d8a\u8b8a\u8d8a\u591a\uff0c\u7b49\u8457\u5225\u4eba\u7d66\u6211\u8cc7\u6e90\u5b78\u7fd2\uff0c\u4e0d\u5982\u9084\u662f\u9760\u81ea\u5df1\u6e96\u5099\u8cc7\u6e90\u4f86\u505a\u4e00\u4e9b Lab \u6027\u8cea\u7684\u6e2c\u8a66\uff0c\u4f46\u53f0\u5317\u82b1\u8cbb\u771f\u7684\u662f\u592a\u9ad8\u4e86\uff0c\u85aa\u6c34\u4e0d\u592a\u5920\u4ed8\u96fb\u8cbb\uff0c\u6240\u4ee5\u70ba\u4e86\u7bc0\u7701\u96fb\u8cbb\u6551\u6551\u9322\u5305\u541b\uff0c\u6240\u4ee5\u628a\u6574\u500b\u5bb6\u88e1\u7684\u5b85\u5b85\u96f2\u6539\u9020\u4e86\u4e00\u4e0b\u3002</p> <p>\u672c\u7cfb\u5217\u6587\u9084\u883b\u9069\u5408\u60f3\u8981\u5617\u8a66\u5728\u5bb6\u88e1\u571f\u7832\u57fa\u790e\u67b6\u69cb\u505a\u4e00\u4e9b\u5947\u602a\u6e2c\u8a66\u7684\u4eba\u4ea4\u6d41\uff0c\u96d6\u7136\u6211\u89ba\u5f97\u61c9\u8a72\u883b\u591a\u4eba\u90fd\u77e5\u9053\u76f8\u95dc\u7684\u6280\u8853\u4e86\uff0c\u53ea\u662f\u6574\u5408\u5728\u4e00\u8d77\u7684\u6a23\u5b50\u53ef\u80fd\u4e0d\u662f\u5f88\u591a\u4eba\u770b\u904e\uff0c\u53cd\u6b63\u5c31\u7576\u5fc3\u8def\u6b77\u7a0b\u770b\u770b\u5427\u3002</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#_1","title":"\u5b85\u5b85\u96f2\u7e3d\u9ad4\u6230\u7565\u76ee\u6a19","text":"<ol> <li>\u5f9e\u4e16\u754c\u5404\u5730\u7684\u67d0\u500b\u89d2\u843d\uff0c\u9060\u7aef\u555f\u52d5\u6216\u95dc\u9589\u6574\u5ea7\u5b85\u5b85\u96f2</li> <li>\u5b85\u5b85\u96f2\u8981\u652f\u63f4\u591a\u7db2\u6bb5\uff0c\u65b9\u4fbf\u5c07\u4e0d\u540c\u76ee\u7684\u6216\u5c08\u6848\u5728\u4e0d\u540c\u7db2\u6bb5\u4e0a\u5207\u5272\u5be6\u4f5c</li> <li>\u6240\u6709\u6a5f\u5668\u9700\u5177\u5099 FQDN\uff0c\u5b85\u5b85\u96f2\u5167\u90e8\u7684\u6240\u6709\u6a5f\u5668\u90fd\u53ef\u6b63\u53cd\u89e3</li> <li>\u61f6\u5f97\u6bcf\u6b21\u90fd\u5728\u90a3\u908a\u9ede\u4f8b\u5916\u8655\u7406\u7684\u6309\u9215\uff0c\u6240\u4ee5\u81ea\u7c3d SSL/TLS \u800c\u6709\u7528\u5230\u7684\u670d\u52d9\u5168\u90fd\u8981\u4e0a</li> <li>\u6240\u6709\u670d\u52d9\uff0c\u80fd\u865b\u64ec\u5316\u7684\u5168\u90e8\u63a1\u7528\u865b\u64ec\u5316</li> <li>\u56e0\u70ba\u6c92\u9322\uff0c\u6240\u4ee5\u4e0d\u8003\u616e\u4efb\u4f55\u9ad8\u53ef\u7528\u6027\u7684\u554f\u984c</li> <li>\u7121\u804a\u7684\u8a2d\u5b9a\u5de5\u4f5c\uff0c\u505a\u8d85\u904e\u4e09\u6b21\uff0c\u8003\u616e\u6216\u4f7f\u7528 Ansible \u81ea\u52d5\u5316\u6d41\u7a0b</li> <li>\u5efa\u7acb Chat Center\uff0c\u7528 bot \u8ddf\u81ea\u5df1\u804a\u5929</li> </ol>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#hld","title":"HLD \u67b6\u69cb\u5716","text":"","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#_2","title":"\u6838\u5fc3\u786c\u9ad4\u88dd\u5099","text":"<p>\u6253\u82f1\u96c4\u806f\u76df\u7684\u6642\u5019\uff0c\u6bcf\u500b\u89d2\u8272\u90fd\u6703\u6709\u6240\u8b02\u7684\u6838\u5fc3\u88dd\u5099\uff0c\u800c\u76f8\u540c\u7684\u5728\u505a\u57fa\u790e\u67b6\u69cb\uff0c\u6211\u500b\u4eba\u63a8\u85a6\u4e5f\u771f\u7684\u6709\u4f7f\u7528\u7684\u6838\u5fc3\u88dd\u5099\u5982\u4e0b\uff1a</p> <ol> <li>SSL VPN: Synology RT2600ac</li> <li>Bastion: Lenovo T480s (Red Hat Employee Special Edition)</li> <li>Storage: Synology DS916+</li> <li>\u5b85\u5b85\u96f2: \u81ea\u7d44\u5854\u5f0f\u4f3a\u670d\u5668 (\u5167\u5efa IPMI)</li> </ol> <p>\u5728\u5e73\u6642\u6c92\u7528\u5b85\u5b85\u96f2\u7684\u72c0\u614b\u4e0b\uff0c1/2/3 \u9805\u6b21\u6703\u4fdd\u6301\u5168\u5e74\u5168\u5929\u958b\u6a5f\u5e38\u99d0\u7684\u72c0\u614b\uff0c\u6709\u9700\u8981\u505a Lab \u7684\u6642\u5019\u624d\u6703\u628a 4 \u958b\u8d77\u4f86\uff0c\u56e0\u70ba\u6700\u5403\u96fb</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#ssl-vpn-synology-rt2600ac","title":"SSL VPN: Synology RT2600ac","text":"<p>\u6709\u4e00\u5929\u7684\u665a\u4e0a\uff0c\u767c\u73fe Synology RT2600ac \u9664\u4e86\u6709\u4e00\u822c 802.11ac / DHCP \u7b49\u5bb6\u7528\u529f\u80fd\u4ee5\u5916\uff0c\u9084\u6709 VPN Plus \u7684\u529f\u80fd\u53ef\u4ee5\u4f7f\u7528\uff0c\u6240\u4ee5\u5c31\u958b\u555f\u4e86\u5927\u6539\u9020\u5b85\u5b85\u96f2\u4e4b\u8def\u3002</p> <p>Q: \u70ba\u4ec0\u9ebc\u6703\u8aaa\u6539\u9020\u5462?</p> <p>\u56e0\u70ba\u4e00\u958b\u59cb\u7684\u6642\u5019 WAN \u662f\u8d70 4G USB Dongle \u4e0a\u7db2\u7684\uff0cSSL VPN \u4e0d\u80fd\u7528\uff0c\u5f8c\u4f86\u9000\u6389\u63db\u6210\u5149\u4e16\u4ee3\uff0c\u7533\u8acb 1+7 \u56fa\u5b9a IP \u65b9\u6848\uff0c\u624d\u80fd\u6b63\u5e38\u904b\u4f5c SSL VPN\u3002\u6b64\u5916\uff0cSynology VPN Plus \u9810\u8a2d\u53ea\u6709\u6388\u6b0a\u4e00\u500b\u4eba\u4f7f\u7528\uff0c\u8981\u591a\u4eba\u9023\u7dda\u7684\u8a71\u8981\u53e6\u5916\u63a1\u8cfc\u6388\u6b0a\uff0c\u8a73\u7d30\u8acb\u6d3d\u4ed6\u5011\u696d\u52d9\u3002</p> <p></p> <p>Q: \u90a3\u6709\u6c92\u6709\u53ef\u4ee5\u66ff\u4ee3\u7684\u65b9\u6848\u5462?</p> <p>\u7b54\u6848\u662f\u6709\u7684\uff0c\u53ea\u8981\u6709\u670d\u52d9\u80fd\u652f\u63f4 OpenVPN / IPSec (\u4f8b: pfSense / OPNsense / ...) \u80fd\u4e0a Public Static IP \u90fd\u53ef\u4ee5\u7576\u4f5c VPN Server \u4f7f\u7528\uff0c\u6211\u500b\u4eba\u5148\u524d\u662f\u6bd4\u8f03\u50be\u5411\u7528 OpenVPN on VM \u70ba\u4e3b\uff0c\u67b6\u69cb\u53ef\u53c3\u8003\u4ee5\u524d\u5beb\u7684 Build Testing Infrastructure - Phil Huang\u3002\u5bb6\u7528\u56e0\u70ba\u9084\u6709\u5176\u4ed6\u8a2d\u5099\u9700\u8981\u7121\u7dda\u4e0a\u7db2 (\u624b\u6a5f / \u7b46\u96fb / Chromecast / PS4 / NS)\uff0c\u6240\u4ee5\u628a\u4e3b\u8981\u7db2\u8def\u6838\u5fc3\u653e\u5728 RT2600ac \u8eab\u4e0a\u3002</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#bastion-lenovo-t480s-red-hat-employee-special-edition","title":"Bastion: Lenovo T480s (Red Hat Employee Special Edition)","text":"<p>\u9019\u53f0\u662f\u5165\u8077 Red Hat \u7684\u6642\u5019\u914d\u767c\u7684\u7b46\u96fb\uff0c\u8001\u95c6\u8aaa\uff1a\u8eab\u70ba\u4e00\u500b Red Hat Infra Solution Architect \u5c31\u61c9\u8a72\u8981\u704c RHEL / Fedora...\uff0c\u6069...\u6240\u4ee5\u6211\u628a\u4ed6\u7576\u5821\u58d8\u6a5f\u7528\uff0c\u6c92\u4e8b\u4e0d\u95dc\u6a5f\u3002</p> <p>\u65e2\u7136\u8eab\u70ba\u4e00\u53f0\u5821\u58d8\u6a5f\uff0c\u5c31\u662f\u671f\u671b\u5728\u4ec0\u9ebc\u72c0\u6cc1\u4e0b\u90fd\u8981\u5c79\u7acb\u4e0d\u6416\uff0c\u5305\u542b\u505c\u96fb\u548c\u77ac\u65b7\uff0c\u525b\u597d\u9019\u53f0\u662f\u500b\u7b46\u96fb\uff0c\u5167\u5efa\u6709\u96fb\u6c60\uff0c\u5e73\u6642\u53c8\u63d2\u8457\u96fb\u6e90\uff0c\u6545\u5165\u8077\u5f8c\u5230\u9032\u884c\u5927\u6539\u9020\u5b85\u5b85\u96f2\u4e4b\u524d\uff0c\u7d2f\u7a4d\u4e86 386 \u5929\u7684 Uptime\uff0c\u4e0a\u6b21\u990a\u9019\u9ebc\u4e45\u7684 Server \u61c9\u8a72\u662f\u7814\u7a76\u6240\u7684\u6642\u4ee3\u4e86... (\u83f8</p> <p></p> <p>Q: \u4ed6\u65e2\u7136\u662f\u500b\u5821\u58d8\u6a5f\uff0c\u90a3\u5e79\u561b\u52d5\u5b83?</p> <p>\u7406\u7531\u662f\u8cc7\u6e90\u4f7f\u7528\u7387\u592a\u4f4e\u4e86\uff0c\u5148\u524d\u53ea\u662f\u5beb\u5beb\u4e00\u4e9b\u602a\u6771\u897f\uff0c\u8dd1\u5e7e\u500b Ansible Playbook\uff0c\u7d55\u5927\u90e8\u5206\u6642\u9593\u7a7a\u6709 8C / 24G \u5728\u90a3\u908a\u9592\u7f6e\uff0c\u4e0d\u5982\u8b93\u4ed6\u505a\u9ede\u6709\u610f\u7fa9\u7684\u4e8b\u60c5\uff0c\u6240\u4ee5\u6539\u9020\u5982\u4e0b\uff1a</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#rhel-77-rhel-81","title":"RHEL 7.7 \u91cd\u704c\u6210 RHEL 8.1","text":"<p>\u525b\u597d\u9806\u4fbf\u8981\u958b\u59cb\u719f\u6089 RHEL 8 \u7cfb\u5217\u4e86\uff0c\u6240\u4ee5\u8d81\u6a5f\u63db\u88dd\u7df4\u7fd2\u770b\u770b\uff0c\u95dc\u65bc\u8a73\u7d30\u7684\u65b0\u529f\u80fd\u689d\u5217\u53ef\u4ee5\u53c3\u8003 Red Hat Enterprise Linux 8.0 \u6b63\u5f0f\u767c\u5e03 - \u958b\u6e90\u5de5\u5834</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#rhel-81-cockpit-vm","title":"RHEL 8.1 \u88dd\u5099 Cockpit \u7ba1\u7406 VM","text":"<p>\u57fa\u790e\u5c31\u662f\u4f7f\u7528 KVM libvirt\uff0c\u6240\u4ee5\u53ea\u8981\u5efa\u597d Linux Bridage \u5c0d\u63a5 Physical NIC \u5373\u53ef\u597d\u597d\u4f7f\u7528........................................</p> <p>Q: \u70ba\u4ec0\u9ebc\u8981\u9ede\u9ede\u9ede...</p> <p>\u56e0\u70ba RHEL 8 \u958b\u59cb\u8981\u958b\u59cb\u5ba3\u63da NetworkManager \u7684\u7f8e\u597d (?) \u4e86\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u7fd2\u6163\u958b\u5834\u628a NM \u95dc\u6389\u7684\u5c0f\u5925\u4f34 (\u5c0f\u5f1f\u6211)\uff0c\u6703\u767c\u73fe\u5230\u4e00\u4e9b\u795e\u7955\u7684\u73fe\u8c61\uff0c\u6240\u4ee5\u773e\u591a\u8003\u91cf\u4e0b\uff0c\u9084\u662f\u5b78\u4e00\u4e0b <code>nmcli</code>\u3002\u95dc\u65bc Linux Bridge with nmcli \u8a73\u7d30\u6b65\u9a5f\u8acb\u53c3\u95b1 Create a Linux Network Bridge on RHEL 8 / CentOS 8 with nmcli\uff0c\u6b65\u9a5f\u5beb\u7684\u5f88\u4e7e\u6de8\u7684\u4e00\u7bc7\u3002</p> <p>Q: VM \u4e3b\u8981\u8dd1\u4ec0\u9ebc?</p> <p>\u6700\u4e3b\u8981\u662f<code>Ansible \u81ea\u52d5\u5316</code>\uff0c\u904e\u5f80\u6211\u90fd\u662f\u5beb\u5b8c Ansible Playbook \u5c31\u76f4\u63a5\u5728\u5821\u58d8\u6a5f\u4e0a\u57f7\u884c\uff0c\u4f46\u6211\u5f8c\u4f86\u5be6\u5728\u662f\u5beb\u5230\u82b1\u6389\uff0c\u5fd8\u8a18\u600e\u9ebc\u4e0b\uff0c\u6240\u4ee5\u5c31\u52d5\u7528\u4e86\u7d05\u5e3d\u54e1\u5de5\u7684\u795e\u529b\u5efa\u4e86 Red Hat Ansible Tower \u8d77\u4f86\uff0c\u5f8c\u4f86\u6211\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u5728 Ansible Tower \u4e0a\u9762\uff0c\u5305\u542b\u7528 IPMI \u53bb\u958b\u95dc\u6a5f\u5b85\u5b85\u96f2...</p> <p></p> <p>[\u5de5\u5546\u6642\u9593] \u5c31\u5728 2019/11/14 \u9019\u5929 Red Hat Ansible Tower \u767c\u4f48\u4e86 3.6.1 \u7248\u672c\uff0c\u81ea\u5e36 Approval \u6309\u7d10\u554a\u554a\u554a\u554a\u554a\u554a!!!!</p> <p></p> <p>\u95dc\u65bc\u6211\u4e4b\u524d\u672a\u6539\u9020\u524d\u7684 Ansible Tower \u7684\u5b9a\u4f4d\uff0c\u5f8c\u9762\u6703\u627e\u500b\u4e00\u7bc7\u8b1b\u4e0b\uff0c\u9019\u670d\u52d9\u5c0d\u6211\u500b\u4eba\u4f7f\u7528\u4f86\u8aaa\u8ddf SSL VPN \u540c\u7b49\u91cd\u8981\u3002</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#rhel-81-cockpit-container","title":"RHEL 8.1 \u88dd\u5099 Cockpit \u7ba1\u7406 Container","text":"<p>\u9019\u908a\u8981\u7279\u5225\u8b1b\u4e00\u4e0b\u95dc\u65bc Container \u7684\u4e8b\u60c5\uff0cRed Hat \u76ee\u524d\u4e3b\u8981\u63a8\u884c\u7684\u5bb9\u5668\u5c08\u6848\u662f\u4ee5 (\u4e0b\u5716\u7531\u5de6\u81f3\u53f3) Podman / Buildah / Skopeo \u70ba\u4e3b\uff0c\u4e0d\u4e3b\u63a8 Docker \u70ba\u4e3b\u7684\u5c08\u6848\uff0c\u4f46\u5169\u8005\u90fd\u662f\u652f\u63f4 OCI (Open Container Initiative) Runtime \u7684\u6a19\u6e96\u898f\u7bc4\uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u4e0a\u8d77\u4f86\u5e7e\u4e4e\u662f\u5927\u540c\u5c0f\u7570\uff0c\u6709\u8208\u8da3\u60f3\u8981\u4f7f\u7528\u540c\u4e00\u4efd Dockerfile \u81ea\u5df1\u7528 podman \u53ca docker \u7de8\u8d77\u4f86\u8a66\u8a66\u770b\u7684\uff0c\u53ef\u4ee5\u53c3\u8003 pichuang/debug-container \u5167\u6709 Makefile \u65b9\u4fbf\u7406\u89e3\uff1b\u82e5\u60f3\u8981\u7406\u89e3\u95dc\u65bc OCI \u7684\u5169\u4e09\u4e8b\uff0c\u8acb\u53c3\u8003 [Day3] \u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u63a2\u8a0e OCI \u5be6\u4f5c - hwchiu</p> <p></p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#storage-synology-ds916","title":"Storage: Synology DS916+","text":"<p>NAS \u7406\u6240\u7576\u7136\u5730\u88ab\u6211\u62ff\u4f86\u7576 NFS Server \u88e1\u9762\u5b58\u4e00\u4e9b\u7279\u6b8a\u6027\u8cc7\u6599</p> <p>\u9664\u4e86 NFS \u7684\u670d\u52d9\u4ee5\u5916\uff0c\u5168\u7ad9\u7684 DNS Server \u6211\u4e5f\u662f\u653e\u5728\u4e0a\u9762\uff0c\u4e0d\u5f97\u4e0d\u8aaa...\u9019\u500b S \u793e GUI \u771f\u7684\u505a\u5f97\u9084\u53ef\u4ee5\u554a...DNS Entry \u9ede\u9ede\u6572\u6572\u5c31\u6709\u4e86\u3002</p> <p>\u56de\u5230\u67b6\u69cb\u9762\u4e0a\uff0cNAS \u5f88\u5c11\u4eba\u5728\u95dc\u6a5f\u5427\uff1f\u500b\u4eba\u5224\u65b7 NAS \u88ab\u95dc\u6a5f\u6a5f\u6703\u57fa\u672c\u4e0a\u9084\u662f\u6703\u5c0f\u65bc\u5821\u58d8\u6a5f (\u65b7\u96fb\u9664\u5916)\uff0c\u525b\u597d\u5b85\u5b85\u96f2\u7684\u5efa\u7f6e\u689d\u4ef6\u90fd\u6709\u914d\u7f6e\u5167\u90e8\u7684 FQDN\uff0c\u6211\u6c92\u6709\u7fd2\u6163\u5beb <code>/etc/hosts</code>\uff0c\u57fa\u65bc <code>/etc/nsswitch.conf</code> \u5167\u6307\u793a</p> <pre><code>cat /etc/nsswitch.conf\n...omit...\nhosts:      files dns myhostname\n...omit...\n</code></pre> <p>\u6240\u4ee5 DNS \u5c0d\u5b85\u5b85\u96f2\u4f86\u8aaa\u8ddf NFS \u670d\u52d9\u4e00\u6a23\u89d2\u8272\u5403\u91cd\uff0c\u6240\u4ee5\u9078\u64c7\u653e\u5728\u8ddf NAS \u4e00\u8d77\u7684\u4f4d\u7f6e\u3002</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#_3","title":"\u5b85\u5b85\u96f2: \u81ea\u7d44\u5854\u5f0f\u4f3a\u670d\u5668","text":"<p>\u9019\u53f0\u8cc7\u8a0a\u592a\u591a\u4e4b\u5f8c\u4e0b\u4e00\u7bc7\u8b1b XD \u50b3\u9001\u9580: 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-2</p>","tags":["linux","infra","homecloud"]},{"location":"20191114-homelcloud-high-level-design-1.html#_4","title":"\u7e3d\u7d50","text":"<p>\u9019\u7bc7\u4e3b\u8981\u662f\u7559\u500b\u7d00\u9304\uff0c\u57fa\u672c\u67b6\u69cb\u90fd\u662f\u57fa\u65bc\u5148\u524d\u5728 Edgecore Network \u5de5\u4f5c\u6642\u81ea\u5efa\u9060\u7aef\u74b0\u5883\u7684\u7d93\u9a57 Build Testing Infrastructure - Phil Huang \u8f49\u63db\u60c5\u5883\u5230\u5bb6\u4e2d\u9019\u7a2e\u5c0f\u898f\u6a21\u6642\u7684\u67b6\u69cb\u7d00\u9304\uff0c\u6c92\u6709\u7d55\u5c0d\u5c0d\u932f (\u6709\u4e00\u4e9b\u7269\u7406\u4e0a\u7684\u8003\u91cf)\uff0c\u50c5\u4f9b\u53c3\u8003</p>","tags":["linux","infra","homecloud"]},{"location":"20191115-homelcloud-high-level-design-2.html","title":"2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-2 \u5b85\u5b85\u96f2\u786c\u9ad4\u4ecb\u7d39","text":"<p>\u627f\u4e0a\u7bc7 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-1 - Phil Workspace \u6240\u63d0\u5230\u4e00\u4e9b\u95dc\u65bc\u6838\u5fc3\u88dd\u5099\u7684\u5217\u8209\u548c\u4f7f\u7528\u7406\u7531\uff0c\u672c\u7bc7\u6703\u6bd4\u8f03\u8457\u91cd\u5728\u5b85\u5b85\u96f2\u5854\u5f0f Server \u7684\u4ecb\u7d39</p>","tags":["linux","infra","homecloud"]},{"location":"20191115-homelcloud-high-level-design-2.html#_1","title":"\u5b85\u5b85\u96f2: \u81ea\u7d44\u5854\u5f0f\u4f3a\u670d\u5668","text":"<p>\u9019\u53f0\u662f\u6211\u5728 2018 \u5e74\u5c3e\u7684\u6642\u5019\u63a1\u8cfc\u7684\u4e00\u53f0\u5854\u5f0f\u4f3a\u670d\u5668\uff0c\u7576\u521d\u6703\u8cb7\u9019\u53f0\u7684\u7406\u7531\u975e\u5e38\u7c21\u55ae\uff0c<code>\u70ba\u4e86\u6df1\u523b\u7406\u89e3 Red Hat OpenShift 3.11 on VMware vSphere \u8dd1\u8d77\u4f86\u7684\u6a23\u5b50\u6703\u9577\u4ec0\u9ebc\u6a23\u5b50</code>\uff0c\u6211\u81ea\u7a31\u9019\u500b\u53eb\u505a <code>\u5ba2\u6236\u9a45\u52d5\u90e8\u7f72 Customer Driven Deployment</code> (???)</p> <p>\u4f46\u56e0\u70ba\u9019\u53f0\u6703\u653e\u5728\u6211\u4f4f\u5bbf\u7684\u5730\u65b9\uff0c\u6240\u4ee5\u6211\u4e00\u958b\u59cb\u7684\u8a2d\u8a08\u8981\u6c42\u5982\u4e0b\uff1a</p> <ol> <li>\u5b89\u975c\u7b2c\u4e00\u7b2c\u4e8c\u7b2c\u4e09</li> <li>\u6548\u80fd\u7b2c\u56db</li> <li>\u7701\u96fb\u7b2c\u4e94</li> </ol> <p>\u6240\u4ee5\u6574\u9ad4\u4e0a\u7684\u9078\u64c7\u5c31\u662f<code>\u975c\u97f3</code>\u70ba\u512a\u5148\u7684\u8a2d\u8a08\uff0c\u5be6\u969b\u4e0a\u958b\u6a5f\u5f8c\u4e5f\u771f\u7684\u662f\u883b\u5b89\u975c\u7684\uff0c\u6bd4 Synolgy DS916+ \u88e1\u9762\u786c\u789f\u904b\u8f49\u7684\u8072\u97f3\u9084\u5c0f...</p>","tags":["linux","infra","homecloud"]},{"location":"20191115-homelcloud-high-level-design-2.html#_2","title":"\u786c\u9ad4\u83dc\u55ae","text":"<p>\u4ee5\u524d\u5728 Mobile01 \u4e0d\u77e5\u54ea\u88e1\u770b\u5230\u4e00\u7bc7\u958b\u7bb1\u6587\uff0c\u8ddf\u6211\u9700\u6c42\u883b\u50cf\u7684\uff0c\u6240\u4ee5\u62ff\u4f86\u4fee\u6539\u6210\u5982\u4e0b\uff1a</p> <ul> <li>CPU: Intel Xeon E5-2620 v4 (8C/16T) / 2011 / 2.1G / \u7121\u5167\u986f * 1</li> <li>MB: ASUS Z10PE-D16 WS (E-ATX / C612 / \u96d9 2011-V3.V4 / 16*DDR4 / M.2 / 2 * NIC) * 1</li> <li>Memory: Samsung 16GB DDR 2133MHz ECC Reg * 16</li> <li>OS Disk: HIKVISION E100NI 256G / M.2 SATA / R:500M / W 250M / TLC * 1</li> <li>\u6a5f\u7bb1: Corsair Obsidian 750D Airflow \u986f\u5361\u957745 / CPU\u9ad817 / SSD x 8 (6\u5171\u7528) / \u524d\u9762\u677f\u7db2\u5b54 /E-ATX  * 1</li> <li>CPU \u6563\u71b1\u5668: Corsair H60 12cm\u51b7\u6392/ \u6241\u5e73\u5316\u5e6b\u6d66/ (\u65b9)\u9285\u5e95\u51b7\u982d/ \u539a:5.2cm * 1</li> <li>\u88dd\u6a5f\u986f\u5361: ASUS GT 710-1-SL / 954MHz / 1G DDR3 / \u975c\u97f3\u7248 / 13.5cm * 1</li> <li>Power: be quiet! Straight Power 11(E11) 650W/\u91d1\u724c/\u5168\u6a21/5\u5e74\u4fdd/LLC+DC-DC/CPU\u4e3b\u7dda:16AWG * 1</li> <li>(Optional) \u5916\u639b\u7db2\u5361: Intel i350-T4 * 1</li> </ul> <p>Q: \u8a72\u8cb7?</p> <p>\u5149\u83ef\u6b61\u8fce\u4f60\uff0c\u6700\u8fd1\u8a18\u61b6\u9ad4\u4fbf\u5b9c\u5230\u7206\u70b8\u9322\u5305\u541b\u89ba\u5f97\u975e\u5e38\u54c0\u50b7</p>","tags":["linux","infra","homecloud"]},{"location":"20191115-homelcloud-high-level-design-2.html#_3","title":"\u8a73\u7d30\u8aaa\u660e","text":"<p>\u95dc\u65bc\u8a08\u7b97\u8cc7\u6e90\uff0cIntel E5-2620 v4 \u4e00\u9846\u5f88\u8cb4\u554a...\u9322\u5305\u541b\u771f\u7684\u6703\u5403\u571f\uff0c\u6240\u4ee5\u90a3\u6642\u5019\u5148\u53ea\u8cb7\u4e00\u9846\uff0c\u7136\u5f8c\u8a18\u61b6\u9ad4\u5148\u8cb7\u6eff\uff0c\u4f46\u5be6\u969b\u4e0a\u53ea\u6703\u7528\u5230\u4e00\u534a\u800c\u5df2\u3002\u7b49\u4eba\u6350\u8d08\u53e6\u4e00\u9846 E5-2620 v4 \u6216\u7b49\u62cb\u552e QQ\u3002\u53e6\u5916\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\uff0cMemory Types \u50c5\u652f\u63f4\u5230 DDR4 2133 ECC Reg\uff0c\u6240\u4ee5\u4e00\u958b\u59cb\u6c92\u6ce8\u610f\u8cb7 DDR4 2600 ECC Reg \u7576\u51a4\u5927\u982d\u3002</p> <p>\u95dc\u65bc\u6a5f\u7bb1\uff0c\u76f4\u63a5\u770b\u5225\u4eba\u958b\u7bb1\u6587\u7ae0 Corsair Obsidian 750D ATX\u6a5f\u6bbc\u4e4b\u88dd\u6a5f\u4f7f\u7528\u5206\u4eab \u6bd4\u8f03\u5feb\uff0c\u914d\u4e0a Corsair H60 \u6563\u71b1\u6574\u9ad4\u4e0a\u883b\u5b89\u975c\u7684\uff0c\u5982\u679c\u6709\u9ede\u8072\u97f3\u7684\u8a71\u62ff\u5438\u5875\u5668\u5438\u4e00\u5438\u98a8\u6247\u5c31\u597d\u4e86\u3002\u7136\u5f8c\u9019\u500b\u6a5f\u7bb1\u7d66 E-ATX \u4e3b\u6a5f\u677f\uff0c\u6240\u4ee5\u771f\u7684\u662f\u883b\u5927\u53f0\u7684\uff0c\u76f8\u5c0d\u64f4\u5145\u6027\u4e5f\u883b\u597d\u7684\uff0c\u7b49\u5f85\u597d\u5fc3\u4eba\u6350 Nvidia V100 / T4 \u73a9\u73a9\u3002</p> <p></p> <p>\u95dc\u65bc\u96fb\u6e90\uff0c\u7121\u611b\u597d\uff0c\u6211\u5c31\u662f\u88ab <code>be quiet!</code> \u9019\u540d\u5b57\u6253\u5230\uff0c\u7522\u54c1\u547d\u540d\u5f88\u91cd\u8981</p> <p>\u95dc\u65bc\u7db2\u8def\uff0c\u9019\u500b\u5c31\u883b\u91cd\u8981\u7684\uff0c\u9996\u5148\u4e3b\u6a5f\u677f ASUS Z10PE-D16 WS  \u6709\u52a0\u88dd\u4e00\u500b BMC\uff0c\u652f\u63f4\u76f8\u5bb9\u65bc <code>IPMI 2.0</code> \u7684 ASMB8-iKVM \u6676\u7247\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u7528 <code>ipmitool</code> \u6216 <code>pyghmi</code> \u4f86\u505a OOB \u9060\u7aef\u4f3a\u670d\u5668\u7ba1\u7406\uff0c\u500b\u4eba\u4f7f\u7528\u4e3b\u8981\u90fd\u662f\u7528 ansible/ipmi_power \u9019\u500b\u6a21\u7d44\u70ba\u4e3b\u3002</p> <p>Q: \u5982\u679c\u4e3b\u6a5f\u677f\u6c92\u6709 BMC\uff0c\u90a3\u6709\u6c92\u6709\u66ff\u4ee3 IPMI \u7684\u65b9\u6848?</p> <p>\u6709\uff0c\u4f46\u6211\u500b\u4eba\u89ba\u5f97\u4e0d\u592a\u597d\uff0cPDU \u9060\u7aef IPMI \u5207\u958b\u95dc\u96fb\u6e90\u7684\u65b9\u5f0f\uff0c\u6216\u8005\u662f\u4e00\u4e9b IoT \u6709\u985e\u4f3c\u9019\u7a2e\u9060\u7aef\u958b\u95dc\u96fb\u6e90\u7684\u65b9\u6848\u3002\u9019\u500b\u8981\u8b39\u614e\u8a2d\u8a08\u4f7f\u7528\uff0c\u56e0\u70ba\u8ddf\u76f4\u63a5\u62d4\u96fb\u6e90\u6c92\u5565\u5169\u6a23 \uff0c\u5c6c\u65bc\u51b7\u95dc\u6a5f\uff0c\u5982\u679c\u771f\u8981\u7528\u7684\u8a71\uff0c\u8a18\u5f97\u8981\u5148\u505a\u71b1\u95dc\u6a5f\uff0c\u518d\u5207\u96fb\u6e90\u6bd4\u8f03\u597d\u3002</p> <p>Ansible Workflow &lt;3 \u4f60</p> <p>\u53e6\u5916\u4e3b\u6a5f\u677f\u6709\u63d0\u4f9b\u5169\u500b\u5167\u5efa 1Gb \u53ef\u4ee5\u7528\uff0c\u9019\u908a\u9078\u4e86\u4e00\u500b\u7576 WAN \u4f7f\u7528\uff0c\u9019\u61c9\u8a72\u662f\u6c92\u4ec0\u9ebc\u61f8\u5ff5\u7684</p> <p></p> <p>Q: \u70ba\u4ec0\u9ebc\u6703\u6709\u4e00\u500b Intel i350-T4 \u5728\u90a3\u908a\u667e\u8457?</p> <p>\u5b8c\u5168\u662f\u4e00\u500b\u8166\u885d\u7684\u7d50\u679c\uff0c\u539f\u5148\u9810\u671f\u76ee\u6a19\u662f\u8981\u505a\u4ee5\u9019\u53f0\u5854\u5f0f Server \u70ba\u6838\u5fc3\u7684\u67b6\u69cb\u8a2d\u8a08\uff0c\u505a Two-Arm\uff0c\u4f46\u770b\u4e86\u770b\u89ba\u5f97\u6709\u9ede\u9867\u616e\u5c31\u4e0d\u641e\u4e86\u3002\u5982\u679c\u5c0d\u7db2\u8def\u8655\u7406\u5403\u91cd\u7684\uff0c\u53ef\u4ee5\u628a <code>SR-IOV</code> \u958b\u8d77\u4f86\uff0c\u53ef\u4ee5\u76f4\u63a5\u6709 8 VFs \u53ef\u4ee5\u4f7f\u7528\uff0c\u7db2\u8def\u6548\u7387\u6703\u883b\u597d\u7684\u3002</p> <p>\u5f8c\u9762\u6703\u6709\u4e00\u7bc7\u89e3\u91cb {pfSense, OPNsense, ooxx UTM} on {vSphere, Proxmox, KVM Libvirt} \u865b\u64ec\u7db2\u8def\u8a2d\u8a08\u600e\u9ebc\u505a Two-Arm\uff0c\u81ea\u5efa Lab \u4f86\u8aaa\u9084\u883b\u597d\u7528\u7684\u67b6\u69cb</p>","tags":["linux","infra","homecloud"]},{"location":"20191115-homelcloud-high-level-design-2.html#_4","title":"\u7e3d\u7d50","text":"<p>\u6574\u9ad4\u4e0a\u4f86\u8aaa\uff0cIPMI \u9019\u500b\u529f\u80fd\u5c0d\u65bc\u6211\u5f9e Bastion \u5821\u58d8\u6a5f\u4e0a\uff0c\u900f\u904e Ansible Tower \u63a7\u5236\u670d\u52d9\u5668\u4f86\u8b1b\u975e\u5e38\u91cd\u8981\uff0c\u5176\u4ed6\u8cc7\u6e90\u90fd\u662f\u70ba\u4e86\u8981\u627f\u8f09 Lab \u6240\u9700\u8981\u7684\u904b\u7b97\u8cc7\u6e90\u800c\u751f\u7684\uff0c\u53ef\u4ee5\u81ea\u884c\u505a\u522a\u6e1b\u3002</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html","title":"2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-3 \u5b85\u5b85\u96f2\u7db2\u8def\u67b6\u69cb\u8a2d\u8a08","text":"<p>2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u7cfb\u5217\u6587\u4f86\u5230\u7b2c 3 \u7bc7\uff0c\u6709\u8208\u8da3\u60f3\u770b\u524d\u9762\u5169\u7bc7\u7684\u53ef\u4ee5\u53c3\u8003\uff1a 1. 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-1\uff1a\u4ecb\u7d39\u5927\u591a\u6578\u7528\u9322\u5305\u541b\u5a01\u529b\u625b\u56de\u5bb6\u7684\u786c\u9ad4\u8a2d\u5099\u548c\u67b6\u69cb\u8a2d\u8a08\u7e3d\u9ad4\u76ee\u6a19 2. 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-2\uff1a\u4ecb\u7d39\u5b85\u5b85\u96f2\u5854\u5f0f\u4f3a\u670d\u5668\u786c\u9ad4\u88dd\u5099</p> <p>\u800c\u7b2c\u4e09\u7bc7\u8981\u4f86\u627f\u7e8c\u7b2c\u4e8c\u7bc7\uff0c\u8b1b\u4e00\u4e0b\u95dc\u65bc\u4e0b\u5716\u85cd\u8272\u5340\u584a vcenter.phil.lab \u90a3\u584a\u865b\u64ec\u7db2\u8def\u6211\u500b\u4eba\u662f\u600e\u9ebc\u8a2d\u8a08\u7684</p> <p></p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#1-2","title":"1 \u53f0 2 \u57e0\u96d9\u81c2\u7db2\u8def\u67b6\u69cb","text":"<p>\u96d9\u81c2\u7db2\u8def (Two-Arm) \u9700\u4f7f\u7528 2 \u500b\u7db2\u8def\u4ecb\u9762\uff0cInbound/Outbound \u5206\u5225\u8d70\u4e0d\u540c\u4ecb\u9762\uff1b\u55ae\u81c2\u7db2\u8def\u5247\u662f (One-Arm) \u50c5\u4f7f\u7528 1 \u500b\u7db2\u8def\u4ecb\u9762\uff0cInbound/Outbound \u90fd\u8d70\u540c\u4e00\u500b\u4ecb\u9762\uff0c\u88e1\u9762\u7684\u7db2\u8def\u9694\u96e2\u662f\u63a1\u7528 802.1Q VLAN Subinterface \u9032\u884c\u5283\u5206\uff0c\u6240\u4ee5\u5f8c\u8005\u76f8\u8f03\u524d\u8005\uff0cOverlay Switch (\u9019\u908a\u6307\u7684\u5c31\u662f Synology RT2600ac ) \u9700\u8981\u591a\u652f\u63f4 VLAN \u80fd\u529b\u624d\u6709\u8fa6\u6cd5\u505a\uff0c\u4f46\u53ef\u60dc\u5b83\u6c92\u6709\uff0c\u5c31\u4fdd\u6301\u505a Two-Arm \u7db2\u8def\u3002\u800c\u6211\u81ea\u5df1\u7d93\u9a57\u57fa\u672c\u90fd\u662f\u505a Two-Arm\uff0c\u55ae\u7d14\u597d\u7406\u89e3</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#port","title":"\u6700\u5c0f Port \u6578?","text":"<p>\u95dc\u65bc\u670d\u52d9\u5668\u786c\u9ad4\u898f\u683c\u53ef\u4ee5\u770b 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-2: \u786c\u9ad4\u83dc\u55ae\uff0c\u4e3b\u8981\u6838\u5fc3\u786c\u9ad4\u9700\u6c42\u662f</p> <p>1 ~ 2 Port</p> <p>\u5c0d...\u53ea\u8981\u5169\u500b Port \u5c31\u4ec0\u9ebc\u90fd\u53ef\u4ee5\u505a\uff0c\u7121\u8ad6\u901f\u7387\u3001\u7121\u8ad6\u67b6\u69cb\u7686\u53ef\uff0c\u4f46\u6700\u5c0f 1 Port \u4e5f\u53ef\u4ee5\u505a\uff0c\u53ea\u662f\u96d9\u81c2\u67b6\u69cb\u6982\u5ff5\u6703\u6709\u9ede\u4e0d\u592a\u4e00\u6a23\uff0c\u770b\u89d2\u5ea6\uff0c\u4e0b\u9762\u6703\u8a73\u7d30\u756b\u5716\u8b1b\u4e00\u4e0b\u3002</p> <p>\u57fa\u672c\u76f8\u540c\u6982\u5ff5\u9069\u7528\u65bc\u5be6\u9ad4\u6a5f\u76f4\u4e0a\u3001VMware vSphere\u3001Linux KVM\u3001Red Hat Virtualization\u3001Proxmox\u3001Red Hat OpenStack \u7b49\u7b49\u865b\u64ec\u5316\u5e73\u53f0\u90fd\u53ef\u4ee5\u505a\u3002</p> <p>Q: Hyper-V \u5462?</p> <p>Sorry\uff0c\u9019\u500b\u6211\u6c92\u7814\u7a76\uff0c\u7121\u6cd5\u8a55\u8ad6</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#vfw-vrouter","title":"vFW? vRouter?","text":"<p>\u4e3b\u8981\u7db2\u8def\u8f49\u767c\u6838\u5fc3\u529f\u80fd\u9700\u6c42\u662f</p> <p>NAT + VLAN Subinterface</p> <p>\u9019\u908a\u63a1\u7528\u7684 vFirewall \u662f pfSense\uff0c\u5148\u524d\u5728 Edgecore Networks \u6a5f\u6ac3\u74b0\u5883\u662f\u7528 OPNsense\uff0c\u800c\u6211\u500b\u4eba\u662f\u6bd4\u8f03\u504f\u597d OPNsense\u3002</p> <p></p> <p>Q: \u8aaa\u597d\u7684 vRouter \u4e0d\u80fd\u641e\u55ce?</p> <p>\u5148\u524d\u4e5f\u6709\u5617\u8a66\u7528 [VyOS][https://vyos.io/] \u7576\u505a\u865b\u64ec\u8def\u7531\u5668\uff0c\u4f46\u4e09\u5e74\u524d\u6e2c\u8a66\u7684\u6642\u5019\uff0c\u5b83\u6c92\u6709\u652f\u63f4 NAT \u554a\u554a\u554a\u554a\u554a\uff01\u5c31\u653e\u68c4\u56de\u5230 pfSense / OPNsesne \u7684\u61f7\u62b1\u4e2d\uff0c\u4e0d\u77e5\u9053\u73fe\u5728\u6709\u6c92\u6709\u652f\u63f4\uff0c\u5fb5\u6c42\u52c7\u8005\u8a66\u8a66</p> <p>Q: \u7591? \u9019\u6a23 iptables \u571f\u70ae\u597d\u50cf\u4e5f\u5f88 ok \u554a?</p> <p>\u7121\u8ad6\u662f Linux iptables / FreeBSD pf \u7cfb\u5217\u7684\u90fd\u53ef\u4ee5\u505a\uff0c\u6280\u8853\u4e0a\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u53ea\u662f\u6211\u61f6\u5f97\u6bcf\u6b21\u90fd\u5728\u60f3 iptables \u7684 <code>masquerade</code> \u8ddf <code>Port Forwarding</code> \u600e\u9ebc\u4e0b</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#ip-design","title":"IP Design?","text":"<p>\u60f3\u7576\u723e\uff0c\u8981\u63d0\u4f9b WAN IP \u7d66\u5c0d\u61c9\u7684\u7db2\u8def\u4ecb\u9762\uff0c\u9019\u908a\u5047\u8a2d\u4ee5\u4e0b\uff1a</p> <ol> <li>WAN IP: 192.168.99.250/24</li> <li>VLAN 100 Subnet: 10.100.0.0/24</li> <li>VLAN 200 Subnet: 10.200.0.0/24</li> <li>Rescue IP: 192.168.1.1/24</li> </ol> <p>\u76ee\u6a19\u4e0a\u5c31\u662f\u62ff\u5230 10.100.0.0/24 \u6216 10.200.0.0/24 \u7684 IP \u90fd\u8981\u80fd\u900f\u904e WAN IP \u8d70 SNAT \u65b9\u5f0f\u51fa\u53bb\uff1b\u53cd\u4e4b\uff0c\u53ef\u4ee5\u5f9e WAN IP \u900f\u904e DNAT \u505a Port Forwarding \u9032 10.100.0.0/24 \u6216 10.200.0.0/24  \u7db2\u6bb5</p> <p>Q: Rescure IP?? \u9019\u5e79\u561b\u7684</p> <p>\u95dc\u65bc Rescue IP \u7684\u4f5c\u7528\u662f\u6551\u63f4\u7528\uff0c\u5047\u8a2d\u6211\u7684 VLAN IP \u6216\u8005\u662f\u6709\u4ec0\u9ebc\u7570\u5e38\u72c0\u6cc1\u4e0d\u80fd\u900f\u904e\u6b63\u5e38\u8a2d\u5b9a\u597d\u7684\u7db2\u8def\u9032\u53bb\u4fee\u6539\uff0c\u6211\u6703\u62d4\u6389\u539f\u5148\u63a5\u5728 LAN Port (eth1) \u4e0a\u7684\u7dda\uff0c\u7528\u81ea\u5df1\u7b46\u96fb\u76f4\u9023\u8a72 Port \u9032\u53bb\u4fee</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#1-vfw","title":"1 . vFW \u96d9\u81c2\u76f4\u4e0a\u5be6\u9ad4\u6a5f\u67b6\u69cb\u5716","text":"<p>\u4e00\u53f0 Server \u76f4\u63a5\u88dd pfSense</p> <p></p> <p>\u9019\u500b\u67b6\u69cb\u7f3a\u9ede\u986f\u800c\u6613\u898b\uff0c\u6574\u53f0\u5be6\u9ad4\u6a5f\u8cc7\u6e90\u90fd\u88ab pfSense \u54ac\u8d70\u4e86\uff0c\u5b8c\u5168\u6c92\u6709\u7528\u5230\u4efb\u4f55\u865b\u64ec\u5316\u5e73\u53f0\uff0c\u4f46\u53ef\u4ee5\u5916\u63a5\u652f\u63f4 VLAN Tagging/Untag \u7684\u4ea4\u63db\u5668\u64f4\u5927\u53ef\u4f7f\u7528\u5be6\u9ad4 Port \u6578</p> <p></p> <p>Q: \u6211\u5bb6\u6c92\u6709\u5177\u5099 VLAN \u529f\u80fd\u7684 Switch...</p> <p>\u5982\u679c\u5bb6\u4e2d\u6709\u4e00\u53f0\u5c0f\u5c0f\u7684\u96fb\u8166\uff0c\u525b\u597d\u4e5f\u6709\u5169\u500b Port\uff0c\u5c31\u5f88\u9069\u5408\u505a\u4e0a\u5716\uff0c \u800c eth1 \u4e0d\u4e00\u5b9a\u8981\u7528 VLAN Subinterface \u8655\u7406\uff0c\u53ef\u4ee5\u76f4\u63a5\u639b IP \u5728\u4e0a\u9762\u4f7f\u7528\uff0c\u5916\u9762\u63a5 L2 Switch \u8d77\u4f86\u7528\uff0c\u64f4\u5927\u53ef\u4f7f\u7528\u5be6\u9ad4 Port \u6578</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#2-vfw-1-port","title":"2. vFW \u96d9\u81c2 + \u865b\u64ec\u5316\u5e73\u53f0 + 1 \u5be6\u9ad4 Port \u67b6\u69cb\u5716","text":"<p>\u4e00\u53f0 Server \u88dd\u865b\u64ec\u5316\u5e73\u53f0\uff0c\u8d77 VM \u88dd pfSense\uff0c\u7db2\u6bb5\u7528 VLAN Subinterface \u5207\u5272\uff0c\u4e0d\u8003\u616e\u5916\u63a5\u5176\u4ed6\u8a2d\u5099</p> <p>\u4e0b\u5716\u662f\u4ee5 VMware vSphere \u4f5c\u70ba\u7bc4\u4f8b</p> <p></p> <p>\u95dc\u65bc Virtual Switch \u7684\u90e8\u5206\uff0c\u7121\u8ad6\u662f vSS (virtual Standard Switch) /vDS (virtual Distributed Swtich) \u7686\u53ef\u4f7f\u7528\uff0c\u8a73\u7d30\u76f8\u95dc\u6280\u8853\u8a55\u4f30\u8acb\u6d3d\u53cb\u5546 VMware\u3002</p> <p>Q:  <code>vDS: WAN</code> \u7aef\u7684\u8a2d\u5b9a\u793a\u610f\u5716?</p> <p></p> <p>\u53f3\u908a\u90a3\u908a Port Group \u53ef\u4ee5\u591a\u52a0\u7db2\u5361\u505a\u9ede\u4e8b\u60c5\uff0c\u8a73\u7d30\u529f\u80fd\u8acb\u53c3\u8003\u5b98\u65b9\u6587\u4ef6 vSphere Distributed Switch Architecture\uff0c\u5de6\u908a\u7559\u610f <code>VLAN \u8b58\u5225\u78bc</code> \u70ba <code>--</code>\uff0c\u4f46\u6211\u4e0d\u78ba\u5b9a\u662f\u4e0d\u662f\u4ee3\u8868\u662f <code>VLAN 1</code> \u7684\u610f\u601d\uff0c\u54ea\u5929\u9047\u5230\u554f\u984c\u518d\u7814\u7a76</p> <p>Q: <code>vDS: Trunk</code> \u7aef\u7684\u4e5f\u4f86\u4e00\u4e0b</p> <p></p> <p>\u53f3\u908a\u7559\u610f Port Group \u662f\u5b8c\u5168\u6c92\u6709\u5be6\u9ad4\u7db2\u5361\u5728\u88e1\u9762\u7684\uff0c\u5de6\u908a\u5247\u662f\u91dd\u5c0d VLAN ID \u8a2d\u5b9a\u500b\u5225\u7684 <code>VM Network</code> (\u6ce8\uff1a\u6211\u5fd8\u8a18\u6b63\u78ba\u63cf\u8ff0\u662f\u4ec0\u9ebc\u4e86\uff0c\u6709\u932f\u8acb\u6572\u6211\u66f4\u6b63)</p> <p>Q: \u591a\u554f\u4e00\u53e5...\u6709\u9b54\u9b3c\u55ce?</p> <p></p> <p>Of course\uff01\u9019\u500b\u8a2d\u5b9a\u61c9\u8a72\u662f\u6709\u505a\u904e\u985e\u4f3c\u4e8b\u60c5\u7684\u670b\u53cb\u90fd\u6703\u9047\u5230\u7684\u6700\u5927\u907a\u6f0f\uff0c\u90a3\u500b\u88ab\u8a2d\u5b9a\u70ba Trunk \u7684 VM Network... \u8981\u628a\u6df7\u5408\u6a21\u5f0f (Promiscuous Mode)\u958b\u555f\u4f86\uff0c\u907f\u514d\u4f86\u81ea\u65bc\u5404\u5f0f\u5404\u6a23\u7684\u7db2\u8def\u7684\u5c01\u5305\u5728 ESXi \u5c64\u5c31\u88ab\u4e1f\u6389\uff0c\u5177\u9ad4\u6280\u8853\u6587\u4ef6\u8acb\u53c3\u7167 Promiscuous Mode Operation</p> <p>\u4e0b\u5716\u662f\u63a1\u7528 libvirt \u70ba\u4e3b\u7684\u6280\u8853\u67b6\u69cb</p> <p></p> <p>Q: \u7591? \u600e\u9ebc\u770b\u8d77\u4f86\u90fd\u5dee\u4e0d\u591a?</p> <p>\u5176\u5be6\u7c21\u55ae\u4f86\u8aaa\u5c31\u662f\u900f\u904e Bridge \u6280\u8853\u642d\u6a4b\u628a\u5be6\u9ad4\u7db2\u5361\u548c\u865b\u64ec\u7db2\u5361\u585e\u5728\u540c\u4e00\u500b Linux Bridge ( or OVS Bridge) \u88e1\u9762\uff0c\u5c31\u5f88\u50cf\u662f\u591a\u53f0\u865b\u64ec L2 \u4ea4\u63db\u6a5f\u5728\u865b\u64ec\u5316\u5e73\u53f0\u88e1\u9762\uff0c\u6982\u5ff5\u5c31\u662f\u9019\u9ebc\u7c21\u55ae\uff0c\u56e0\u70ba VMware vSS/vDS \u8a2d\u5b9a\u65b9\u5f0f\u6bd4\u8f03\u7279\u5225\uff0c\u6240\u4ee5\u7279\u5225\u62c9\u51fa\u4f86\u8b1b</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#3-vfw-2-port","title":"3. vFW \u96d9\u81c2 + \u865b\u64ec\u5316\u5e73\u53f0 + 2 \u5be6\u9ad4 Port \u67b6\u69cb\u5716","text":"<p>\u4e00\u53f0 Server \u88dd\u865b\u64ec\u5316\u5e73\u53f0\uff0c\u8d77 VM \u88dd pfSense\uff0c\u7db2\u6bb5\u7528 VLAN Subinterface \u5207\u5272\uff0c\u9808\u8003\u616e\u5916\u63a5\u5176\u4ed6\u8a2d\u5099</p> <p></p> <p>\u9019\u500b\u5c31\u662f\u5148\u524d\u5728 Edgecore Networks Lab \u6700\u5b8c\u6574\u7684\u67b6\u69cb\uff0c\u8a73\u7d30\u6295\u5f71\u7247\u8acb\u53c3\u7167 2017 \u5e74\u6709\u4e00\u5929\u4e0d\u77e5\u9053\u5728\u54ea\u88e1\u8b1b\u7684 Build Testing Infrastructure \u6295\u5f71\u7247</p> <p>Q:  \u70ba\u4ec0\u9ebc\u8981\u7279\u5225\u505a\u96d9\u81c2?</p> <p></p> <p>\u56e0\u70ba\u5b8c\u5168\u662f\u70ba\u4e86\u7ba1\u7406\u9019\u6574\u6ac3\u6a5f\u6ac3\u88e1\u9762\u8a2d\u5099\u4f7f\u7528\u7684\uff0c\u90a3\u6642\u5019\u6709\u53e6\u5916\u63a5\u5169\u53f0 Cumulus Linux + AS4610-54T \u505a CLAG\uff0c\u8b93\u5e95\u4e0b\u8a2d\u5099\u53ea\u8981\u53ef\u4ee5\u54ac IP \u7684\u5168\u90e8\u914d\u767c\u4e00\u500b IP\uff0c\u7db2\u6bb5\u5168\u90e8\u5207\u958b\u505a VLAN Routing \u907f\u514d\u88ab\u5ee3\u64ad\u5c01\u5305\u6253\u7206</p> <p>Q: VLAN Routing !!! \u662f\u4e0d\u662f\u6f0f\u8b1b\u4e86\u4ec0\u9ebc? \u90a3\u500b pfSense \u88e1\u9762\u600e\u9ebc\u505a\u7684?</p> <p>\u7b2c\u56db\u7bc7\uff0c\u6211\u89ba\u5f97\u4e5f\u883b\u6709\u8da3\u7684\u90e8\u4efd\uff0c\u50b3\u9001\u9580 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-4</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#traffic","title":"Traffic \u5206\u89e3\u5716","text":"","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#snat-traffic","title":"SNAT Traffic","text":"<p>\u9019\u500b\u5f88\u76f4\u89ba\uff0cVLAN Routing + SNAT \u641e\u5b9a</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#dnat-traffic","title":"DNAT Traffic","text":"<p>\u9019\u500b\u4e5f\u5f88\u76f4\u89ba\uff0cDNAT \u505a Port Forwarding\uff0c\u9019\u908a\u63d0\u4f9b\u4e00\u500b\u5c0f\u7955\u6280\uff0c\u642d <code>SSH ProxyCommand</code>\u883b\u597d\u7528\u7684\uff0c\u53c3\u7167 20190720 Better Practice  Day 2 Operaition with Ansible</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-3.html#_1","title":"\u7e3d\u7d50","text":"<p>\u5176\u5be6\u9019\u5e74\u982d\u770b\u5230\u865b\u64ec\u7db2\u8def\u6280\u8853\u4e0d\u7528\u611f\u5230\u7279\u5225\u5bb3\u6015\uff0c\u756b\u9ede\u5716\uff0c\u4e0a\u500b IP\uff0c\u60f3\u50cf\u4e00\u4e0b\u7db2\u8def\u600e\u9ebc\u6d41\uff0c\u5176\u5be6\u5f88\u591a\u554f\u984c\u5c31\u80fd\u89e3\u6c7a\u4e86\uff0c\u5e73\u6642\u53ef\u4ee5\u591a\u591a\u505a\u9ede Lab \u57f9\u990a\u89c0\u843d\u9670\u80fd\u529b</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html","title":"2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-4 pfSense","text":"<p>\u5148\u524d\u5de5\u4f5c\u592a\u5fd9\u3001\u5931\u6200\u6253\u64ca\u904e\u5927\uff0c\u4ee5\u81f4\u61f7\u7591\u4eba\u751f\uff0c\u5c0e\u81f4\u6709\u9663\u5b50\u6c92\u5beb\u6587\u7ae0\uff0c\u6700\u8fd1 Red Hat \u8d0a\u52a9\u5c0f\u5f1f\u4f86\u9b5a\u5c3e\u7345\u738b\u570b\u4e0a\u8ab2\uff0c\u8d81\u7a7a\u64cb\u628a\u9577\u4e45\u4ee5\u4f86\u7528\u7684\u4e00\u4e9b\u6280\u8853\u7d93\u9a57\u5beb\u4e0b\u4f86\u5206\u4eab\u7d66\u5927\u5bb6\uff0c2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587 \u5feb\u901f\u50b3\u9001\u9580\uff0c\u6b61\u8fce\u5927\u5bb6\u628a\u81ea\u5df1 HomeLab/HomeCloud \u7684\u7d93\u9a57\u5206\u4eab\u51fa\u4f86\u8549\u6d41\u8549\u6d41</p> <p></p> <p>\u5982 Logo \u6240\u793a\uff0c\u672c\u7bc7\u5c07\u6703\u627f\u8972\u4e0a\u7bc7 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-3 \u7684\u7d50\u5c3e\uff0c\u5230\u5e95 pfSense \u653e\u5230 VM \u88e1\u9762\u5f8c\u662f\u5982\u4f55\u641e\u5f97?</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#_1","title":"\u670d\u52d9\u592a\u591a? \u5207\u7db2\u5361! \u5207\u7db2\u6bb5!","text":"<p>\u4e0a\u7bc7\u6709\u4eba\u5982\u679c\u773c\u775b\u5f88\u5c16\u7684\u8a71\uff0c\u61c9\u8a72\u6703\u767c\u73fe\u6211\u7d05\u6846\u90a3\u908a\u6709\u597d\u5e7e\u500b\u7db2\u8def\u4ecb\u9762\uff0c\u500b\u5225 VLAN \u90fd\u6703\u5b9a\u7fa9\u4e00\u500b\u670d\u52d9\u7fa4\uff0c\u628a\u76f8\u540c\u6027\u8cea\u7684\u670d\u52d9\u5168\u90e8\u585e\u5728\u4e00\u8d77\uff0c\u907f\u514d\u4e92\u76f8\u5e72\u64fe</p> <p>Q: \u662f\u4e0d\u662f\u4e00\u5b9a\u8981\u5728 VM \u5916\u63d2\u591a\u96bb\u8173\u51fa\u4f86\u624d\u80fd\u505a?</p> <p>\u9019\u500b\u5982\u540c 2019 \u5927\u6539\u9020\u5b85\u5b85\u96f2\u67b6\u69cb\u7cfb\u5217\u6587-3 \u7684\u7db2\u8def\u67b6\u69cb\u4e00\u6a23\uff0c\u5be6\u969b\u4e0a\u6211\u53ea\u6709\u63d2\u5169\u5f35\u7db2\u5361\u5728\u88e1\u9762\uff0c\u5176\u4ed6\u591a\u5f35\u865b\u64ec\u7db2\u5361\u90fd\u7528 802.1q VLAN Subinterface \u5207\u51fa\u4f86</p> <p></p> <p>\u4e0a\u5716\u53ef\u4ee5\u5728 <code>Interfaces &gt; Interface Assignments &gt; VLANs</code> \u88e1\u9762\u627e\u5230\uff0c\u6240\u6709\u900f\u904e 802.1q VLAN Subinterface \u90fd\u6703\u986f\u793a\u5728\u9019\u908a</p> <p></p> <p>\u4ee5\u4e0b\u6211\u65b0\u589e\u4e00\u500b <code>VLAN 104</code> \u7576\u4f5c\u7bc4\u4f8b\uff0c\u8a18\u5f97\u8981\u9078\u6b63\u78ba\u7684 Interface\uff0c\u9019\u908a\u6709\u5169\u5f35\u4ecb\u9762</p> <ol> <li>vmx0: WAN</li> <li>vmx1: LAN &lt;-- \u9078\u4ed6</li> </ol> <p>\u56e0\u70ba\u5728 pfSense \u5b89\u88dd\u6642\u6703\u9700\u8981\u5b9a\u7fa9 WAN / LAN\uff0c\u6240\u4ee5\u9019\u500b\u7406\u8ad6\u4e0a\u8981\u77e5\u9053\uff0c\u8a18\u5f97\u4e0d\u8981\u9078\u932f\uff0c\u4e0d\u7136\u5207\u51fa\u4f86\u7684\u7db2\u8def\u4ecb\u9762\u4e0d\u6703\u52d5\uff0c\u6709\u4e00\u6b21\u773c\u6b98\u9078\u932f\uff0c\u770b\u4e86\u8db3\u8db3\u4e00\u5929\u624d\u767c\u73fe</p> <p>Q: \u9019\u6a23\u5c31\u641e\u5b9a\u4e86\u55ce!?</p> <p></p> <p>\u9084\u8981\u56de\u5230 <code>Interfaces &gt; Interface Assignments</code> \u6b63\u5f0f\u628a\u9019\u5f35\u865b\u64ec\u7db2\u8def\u4ecb\u9762\u5361\u52a0\u9032\u53bb\u624d\u7b97\u6578</p> <p></p> <p>\u628a\u865b\u64ec\u7db2\u8def\u4ecb\u9762\u7684\u8a2d\u5b9a\u586b\u4e00\u586b\u5c31\u641e\u5b9a\u4e86\u7b2c\u4e00\u968e\u6bb5\uff0c\u6240\u4ee5\u67b6\u69cb\u5716\u4e0a\u5c31\u6703\u50cf\u4e0b\u5716\u4e00\u6a23</p> <p></p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#nat","title":"\u9084\u6709 NAT \u5462...","text":"<p>\u5728 pfSense \u88e1\u9762\u95dc\u65bc NAT \u7684\u90e8\u5206\uff0c\u5176\u5be6\u6709\u4e0d\u5c11\u529f\u80fd\u4ecb\u7d39\uff0c\u9019\u908a\u9ad4\u6064\u5c0f\u5f1f\u662f\u500b\u61f6\u4eba\uff0c\u4e3b\u8981\u6703\u7528\u5230</p> <ol> <li>SNAT \u61f6\u4eba\u529f\u80fd: Automatic NAT Rules Generation</li> <li>SNAT \u6b63\u5e38\u529f\u80fd: Advanced Outbound NAT</li> <li>DNAT \u6b63\u5e38\u529f\u80fd: Forwarding Ports with pfSense</li> </ol> <p></p> <p>\u76f8\u95dc\u8a2d\u5b9a\u90fd\u5728 <code>Firewall &gt; NAT &gt; Outbound</code> \u88e1\u9762\u627e\u5f97\u5230\uff0c\u95dc\u65bc <code>Outbound NAT Mode</code> \u6beb\u7121\u61f8\u5ff5\u5730\u958b <code>Hybrid Outbound NAT rule generation</code>\uff0c\u4e3b\u8981\u662f\u56e0\u70ba <code>Automatic NAT Rules Generation</code> \u771f\u7684\u662f\u4e00\u500b<code>\u597d\u68d2\u68d2</code>\u7684\u529f\u80fd (\u6211\u88ab\u6211\u8001\u95c6\u5f71\u97ff\u4e86...) \uff0c\u7576\u4f60\u628a\u4e0a\u4e00\u500b\u7ae0\u7bc0\u7684\u865b\u64ec\u7db2\u8def\u52a0\u9032\u53bb\u5f8c\uff0c\u4ed6\u6703\u81ea\u52d5\u52a0\u4e00\u689d SNAT Rules \u9032\u53bb\uff0c\u5565\u90fd\u4e0d\u7528\u8a2d\u5b9a</p> <p>\u95dc\u65bc DNAT  Port Forward \u7684\u4f7f\u7528\u5c31\u662f\u76f4\u63a5\u958b <code>Firewall &gt; NAT &gt; Port Forward</code> \u88e1\u9762\u4e0a Rule \u5c31\u5b8c\u5de5\u4e86\uff0c\u8a73\u7d30\u8a2d\u5b9a\u4ecb\u7d39 Forwarding Ports with pfSense</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#firewall","title":"\u6211\u77e5\u9053\u4f60\u5fd8\u8a18\u4e86 Firewall \u9019\u4ef6\u4e8b","text":"<p>Q: \u70ba\u4ec0\u9ebc\u7167\u6587\u7ae0\u8a2d\u5b9a\u5b8c\u4e4b\u5f8c\uff0c\u9084\u662f\u4e0d\u6703\u52d5!!!???</p> <p></p> <p>\u9b54\u9b3c\u5c31\u5728\u9019\u5f35\u5716\u88e1\u9762\uff0c\u53ef\u4ee5\u5728 <code>Firewall &gt; Rules &gt; &lt;\u6307\u5b9a\u7684\u7db2\u8def\u4ecb\u9762&gt;</code>\u627e\u5230\u5979\uff0c\u95dc\u65bc\u9019\u500b\u554f\u984c\u641e\u4e86\u534a\u5929\u662f\u9632\u706b\u7246\u9810\u8a2d Firewall Deny All...\u610f\u601d\u4e0a\u5716\u7684 Rules \u662f\u8868\u793a\u5168\u90e8\u4e0d\u7d66\u904e</p> <p>All incoming connections on this interface will be BLOCKED until PASS RULES are ADDED</p> <p></p> <p>\u6240\u4ee5\u4f60\u9700\u8981\u591a\u4e00\u689d Rule</p> <ul> <li>Family: IPv4</li> <li>Protocol: any</li> <li>Source: any</li> <li>S Port: any</li> <li>Destination: any</li> <li>D Port: any</li> </ul> <p>\u57fa\u672c\u4e0a\u5c31\u6703\u901a\u4e86\uff0c\u5176\u4ed6 Rules \u5c31\u662f\u6309\u7167\u81ea\u5df1\u9700\u6c42\u81ea\u5df1\u52a0\u5c31\u597d</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#dhcp","title":"DHCP \u76f8\u95dc","text":"<p>\u56e0\u70ba\u6211\u500b\u4eba Lab \u90fd\u4e0d\u7528 DHCP \u90fd\u662f\u624b\u52d5\u914d IP\uff0c\u4f46\u6700\u8fd1 Red Hat OpenShift 4 \u5b89\u88dd\u5ffd\u7136\u8981\u5f04 DHCP\uff0c\u525b\u597d pfSense \u4e5f\u6709\u652f\u63f4 <code>DHCP Static Mappings for this Interface</code>\uff0c\u6240\u4ee5\u505a\u8d77\u4f86\u975e\u5e38\u65b9\u4fbf\u4f7f\u7528</p>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#_2","title":"\u9084\u6709\u66f4\u591a\u55ce?","text":"<p>\u9664\u4e86\u4ee5\u4e0a\u57fa\u672c\u7684\u529f\u80fd\uff0c\u5982\u679c\u662f\u4ee5 pfSense \u70ba\u6838\u5fc3\u7684\u67b6\u69cb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u628a\u4ee5\u4e0b\u670d\u52d9\u653e\u5728\u4e0a\u9762\u90fd\u6c92\u4ec0\u9ebc\u554f\u984c</p> <ul> <li>Time Synchronization: ntp</li> <li>DNS: bind</li> <li>VPN: OpenVPN</li> </ul>","tags":["linux","infra","homecloud"]},{"location":"20191116-homelcloud-high-level-design-4.html#_3","title":"\u7e3d\u7d50","text":"<p>\u96d6\u7136\u7528 pfSense \u81ea\u67b6\u81ea\u5df1\u7528\u6c92\u4ec0\u9ebc\u592a\u5927\u554f\u984c\uff0c\u4f46\u5982\u679c\u662f\u7d66\u5c0f\u516c\u53f8 (~10) \u4f7f\u7528\u6216\u8005\u662f SMB\uff0c\u8a02\u95b1\u4ed6\u5011\u63d0\u4f9b\u8edf\u9ad4\u652f\u63f4 \u6216\u7522\u54c1\u6703\u662f\u4e00\u500b\u6bd4\u8f03\u5b8c\u5584\u7684\u4fdd\u8b77\uff0c\u5018\u82e5\u5982\u679c\u662f\u5927\u578b\u4f01\u696d\u7684\u8a71\uff0c\u9084\u662f\u5efa\u8b70\u4e56\u4e56\u770b\u5546\u7528\u65b9\u6848\u6bd4\u8f03\u597d</p> <p>\u6700\u5f8c\u6211\u60f3\u8aaa\uff0c\u4f01\u696d\u652f\u6301\u958b\u6e90\u8edf\u9ad4\u7684\u5177\u9ad4\u5be6\u8e10\uff0c\u7528\u539f\u59cb\u78bc\u6216\u9322\u5be6\u969b\u652f\u6301\u9019\u4e9b\u5b85\u5b85\uff0c\u5e6b\u52a9\u9019\u4e9b\u8edf\u9ad4\u6c38\u7e8c\u7d93\u71df\uff0c\u5b85\u5b85\u5011\u4e5f\u662f\u9700\u8981\u5403\u98ef\u559d\u6c34\u990a\u5bb6\u7684</p>","tags":["linux","infra","homecloud"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html","title":"\u7528 Docker Distribution \u5efa\u7acb\u7b2c\u4e00\u500b TLS \u5bb9\u5668\u5009\u5eab","text":"<p>\u9047\u904e\u975e\u5e38\u591a\u4eba\u4f7f\u7528 <code>docekr-distribution</code> \u548c RHEL/CentOS \u4f86\u5efa\u7acb\u4eba\u751f\u7b2c\u4e00\u500b\u5bb9\u5668\u6620\u50cf\u6a94\u5009\u5eab (Container Registry) \u6642\uff0c\u90fd\u6703\u9047\u5230 SSL/TLS \u76f8\u95dc\u7684\u554f\u984c\uff0c\u5927\u591a\u90fd\u662f\u7528 <code>insecure-registries</code> \u4f86\u907f\u6389\uff0c\u4eca\u5929\u8981\u4f86\u5206\u4eab\u81ea\u7c3d\u6191\u8b49\u7684\u4f5c\u6cd5</p>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#_1","title":"\u7cfb\u7d71\u898f\u683c","text":"<ul> <li>Hostname: rhel7.misc.local</li> <li>IP: 10.0.100.7/24</li> <li>Necessary Software</li> <li>docker-distribution 2.6.2</li> <li>RHEL 7.7</li> <li>skopeo 0.1.37</li> </ul>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#_2","title":"\u5b89\u88dd\u904e\u7a0b","text":"","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#os","title":"\u6e96\u5099 OS","text":"<ul> <li><code>Firewalld</code>\u3001<code>SELinux</code> \u9810\u8a2d\u958b\u555f</li> <li>\u4ee5 RHEL7 \u70ba\u6838\u5fc3</li> </ul>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#docker-distribution","title":"Docker Distribution","text":"","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#docker-distribution_1","title":"\u5b89\u88dd docker-distribution","text":"<pre><code>yum install docker-distribution -y\n</code></pre>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#docker-distribution_2","title":"\u8a2d\u5b9a docker-distribution","text":"<pre><code>cat &lt;&lt; EOF &gt; /etc/docker-distribution/registry/config.yml\n---\nversion: 0.1\nlog:\n  fields:\n    service: registry\nstorage:\n    cache:\n        layerinfo: inmemory\n    filesystem:\n        rootdirectory: /var/lib/registry\nhttp:\n    addr: 0.0.0.0:5000\n    host: https://rhel7.misc.local:5000\n    tls:\n      certificate: /etc/docker-distribution/my_self_signed_cert.crt\n      key: /etc/docker-distribution/my_self_signed.key\nEOF\n</code></pre> <p>\u4f9d\u64da\u4e0a\u8ff0\u7684\u8a2d\u5b9a\u6a94\uff0c<code>/var/lib/registry</code> \u662f\u6307\u5b9a\u4e3b\u8981\u653e\u7f6e Container Images \u6a94\u6848\u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u5acc\u592a\u5c0f\u7684\u8a71\uff0c\u53ef\u4ee5\u639b Shared Storage\uff1b<code>:5000</code> \u958b\u7684 Port \u9810\u8a2d\u662f 5000\uff0c\u4f46\u53ef\u4ee5\u4f9d\u64da\u9700\u6c42\u4fee\u6539\uff1b<code>certificate</code>\u3001<code>key</code> \u5247\u662f\u653e\u7f6e SSL/TLS \u7684\u91d1\u9470\u548c\u6191\u8b49\uff0c\u5f8c\u9762\u6703\u8b1b\u600e\u9ebc\u5feb\u901f\u81ea\u7c3d\uff1b\u82e5\u60f3\u8981\u77ad\u89e3\u66f4\u591a\u7684\u8a2d\u5b9a\u6a94\uff0c\u53ef\u4ee5\u53c3\u8003 Docker Official - Configuring a registry</p>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#openssl","title":"\u81ea\u7c3d OpenSSL","text":"<p><pre><code># Command for SSL Cert\nopenssl req -x509 -nodes -days 3650 -newkey rsa:2048 \\\n-keyout /etc/docker-distribution/my_self_signed.key \\\n-out /etc/docker-distribution/my_self_signed_cert.crt\n\n# Sample Out\nGenerating a 2048 bit RSA private key\n......+++\n.................+++\nwriting new private key to '/etc/docker-distribution/my_self_signed.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]: TW\nState or Province Name (full name) []: Taipei\nLocality Name (eg, city) [Default City]: Taipei City\nOrganization Name (eg, company) [Default Company Ltd]: Red Hat\nOrganizational Unit Name (eg, section) []: Solution Architect\nCommon Name (eg, your name or your server\\'s hostname) []: rhel7.misc.local\nEmail Address []: root@rhel7.misc.local\n</code></pre> \u6ce8\u610f <code>Common Name (eg, your name or your server\\'s hostname)</code> \u52d9\u5fc5\u8981\u586b\u81ea\u5df1\u7684 hostname</p> <pre><code># Configure RHEL to trust the self-signed certificate\n# You should put the pem into /etc/pki/ca-trust/source/anchors/\nopenssl x509 \\\n-in /etc/docker-distribution/my_self_signed_cert.crt \\\n-out /etc/pki/ca-trust/source/anchors/workstation.pem \\\n-outform PEM\n\n# Update the system's trust store\nupdate-ca-trust\n</code></pre> <p>\u5efa\u8b70\u628a <code>/etc/docker-distribution/my_self_signed_cert.crt</code> \u9019\u6a94\u6848\u653e\u5230\u4e00\u500b\u53ef\u4ee5\u8b93\u5176\u4ed6\u6a5f\u5668\u4e0b\u8f09\u7684\u5730\u65b9\uff0c\u672a\u4f86\u53ea\u8981\u6709\u9700\u8981\u7528\u5230\u8a72 Container registry \u7684\u670d\u52d9\uff0c\u90fd\u8981\u57f7\u884c\u4e0a\u9762\u7684\u52d5\u4f5c\u532f\u5165\u6191\u8b49</p>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#firewall","title":"\u555f\u7528 Firewall","text":"<pre><code>firewall-cmd --zone=public --add-port=5000/tcp --permanent\nfirewall-cmd --reload\nfirewall-cmd --zone=public --list-all\n</code></pre>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#container-registry","title":"\u9a57\u8b49 Container Registry","text":"<pre><code># Install\nyum install -y skopeo\n\n# Copy the image from DockerHub to on-premise container registry\nskopeo copy docker://docker.io/library/centos:7.7.1908 docker://rhel7.misc.local:5000/library/centos:7.7.1908\n\n# Inspect the information of specific container\nskopeo inspect docker://rhel7.misc.local:5000/library/centos:7.7.1908\n</code></pre>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#_3","title":"\u7d50\u8a9e","text":"<p>\u6574\u500b\u904e\u7a0b\u5176\u5be6\u883b\u7c21\u55ae\u7684\uff0c\u5927\u6982\u4e0d\u7528\u534a\u5c0f\u6642\u5c31\u53ef\u4ee5\u5efa\u7acb\u5b8c\uff0c\u4f46\u4ed6\u80fd\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u5c31\u662f\u975e\u5e38\u57fa\u672c\u4e2d\u7684\u57fa\u672c - <code>\u653e\u6620\u50cf\u6a94</code>\uff0c\u82e5\u8981\u5c0b\u6c42\u591a\u529f\u80fd\u7684 Container Registry\uff0c\u53ef\u4ee5\u8003\u616e\u4f7f\u7528\u7d05\u5e3d\u5ba3\u5e03 Red Hat Introduces open source Project Quay container registry \u7684 Project Quay\uff0c\u6bd4\u8f03\u7b26\u5408\u73fe\u5be6\u751f\u6d3b\u3002</p>","tags":["container"]},{"location":"20191123-how-to-build-up-a-secure-container-registry-using-docker-distribution.html#reference","title":"Reference","text":"<ul> <li>Docker Official - insecure-registries</li> <li>GitHub - docker/distribution</li> <li>Docker Official - Configuring a registry</li> </ul>","tags":["container"]},{"location":"20200308-technical-writer.html","title":"\u6210\u70ba\u4e00\u540d\u6280\u8853\u7559\u8de1\u8005","text":"<p>\u5c0f\u5f1f Blog \u9678\u9678\u7e8c\u7e8c\u4e5f\u5f9e 2013 \u5e74\u5beb\u5230\u73fe\u5728\u4e86\uff0c\u5f9e <code>roan.logdown.com</code> \u5230\u73fe\u5728\u7684 <code>blog.pichuang.com.tw</code> \u81ea\u5df1\u5beb\u4f5c\u98a8\u683c\u597d\u50cf\u4e00\u76f4\u4ee5\u4f86\u90fd\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u9019\u908a\u5206\u4eab\u4e00\u4e0b\u5e7e\u500b\u6211\u89ba\u5f97\u883b\u6709\u7528\u7684\u8cc7\u8a0a</p>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_2","title":"\u6211\u70ba\u4ec0\u9ebc\u8981\u5beb\u4f5c?","text":"<p>\u5beb\u4f5c\u4e0d\u662f\u70ba\u4e86\u5225\u4eba\uff0c\u662f\u70ba\u4e86\u81ea\u5df1</p> <p>\u5f88\u7c21\u55ae\uff0c\u8cc7\u8a0a\u592a\u591a\uff0c\u900f\u904e\u6587\u5b57\u6d88\u5316\u8cc7\u8a0a\u548c\u6574\u7406\u601d\u7dd2</p>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_3","title":"\u6642\u9593\u82b1\u8cbb?","text":"<p>\u8ddf\u770b\u6587\u7ae0\u5b8c\u5168\u4e0d\u4e00\u6a23\uff0c\u5beb\u6587\u7ae0 <code>\u975e\u5e38\u82b1\u6642\u9593</code>\uff0c\u901a\u5e38\u6211\u81ea\u5df1\u5beb\u4e00\u7bc7\u90fd\u8981\u5750\u5728\u6905\u5b50\u4e0a\u8981\u5beb\u4e0a 2 - 3 \u5c0f\u6642\uff0c\u6709\u4e9b\u6bd4\u8f03\u8907\u96dc\u7684\uff0c\u8981\u622a\u5716\u7ffb\u66f8\u548c\u627e\u5f15\u7528\u6587\u4ef6\uff0c\u53ef\u80fd 4 - 5 \u5c0f\u6642\u90fd\u6709\u53ef\u80fd</p> <p>\u6240\u4ee5\u6211\u975e\u5e38\u4f69\u670d\u5beb\u66f8\u7684\u5927\u5927\u5011...</p>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_4","title":"\u63a8\u85a6\u4f7f\u7528\u5957\u8def?","text":"<ul> <li>\u8a9e\u6cd5\u9078\u64c7: <code>Markdown</code>\uff0c\u57fa\u672c\u4e0a\u6c92\u6709\u4ec0\u9ebc\u61f8\u5ff5\uff0cMarkdown \u6587\u5b57\u79fb\u690d\u6027\u592a\u597d\uff0c\u5230\u54ea\u88e1\u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u7528\uff0c\u4f46\u7f3a\u9ede\u5c31\u662f\u5c0d\u65bc\u5716\u7247\u8655\u7406\u4e0d\u597d\uff0c\u4f46\u8eab\u70ba\u4e00\u500b\u5927\u90e8\u5206\u90fd\u662f\u5beb\u5b57\u5c45\u591a\u7684\uff0c\u6c92\u4ec0\u9ebc\u554f\u984c</li> <li>\u5efa\u7acb\u975c\u614b\u7db2\u7ad9: \u73fe\u5728\u8981\u641e\u4e00\u500b\u81ea\u5df1\u7684 Blog \u5df2\u7d93\u4e0d\u662f\u5f88\u9ebb\u7169\u7684\u4e8b\u60c5\u4e86\uff0c\u4e5f\u4e0d\u9700\u8981\u7528\u5230 Wordpress / Drupal \u9019\u7a2e CMS \u6bd4\u8f03\u5927\u7684\u7b49\u7d1a\uff0c\u6709\u500b\u4eba GitHub \u5e33\u865f\u5c31\u53ef\u4ee5\u5efa\u7acb\u975c\u614b\u7db2\u9801\uff0c\u642d\u914d Hexo \u6216 Jekyll \u6216 Hugo \u4e09\u500b\u9078\u4e00\u500b\u4f7f\u7528\uff0c\u6211\u662f\u7528 <code>Hexo</code></li> <li>\u7533\u8acb\u500b\u4eba\u57df\u540d: <code>.tw</code> \u7d50\u5c3e\u7684\u61c9\u8a72\u4e0d\u6703\u592a\u8cb4\u6211\u8a18\u5f97\uff0c\u6211\u500b\u4eba\u662f\u9078 <code>Gandi</code> \u57df\u540d\u5546 (\u611f\u6069 \u54c8\u7dad \u8b9a\u5606 Haway)\uff0c\u639b\u8f09\u5230 Cloudflare \u7684\u8a71\u5c31\u6709 SSL \u7684\u9023\u7dda\u80fd\u529b\u56c9</li> </ul>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_5","title":"\u7d66\u5de5\u7a0b\u5e2b\u770b\u7684\u7d14\u6280\u8853\u6587\u4ef6\u5beb\u4f5c\u98a8\u683c\u9078\u64c7?","text":"<p>\u8acb\u7d66\u6211\u6a19\u6e96\u7684\u6280\u8853\u6587\u4ef6\u898f\u7bc4</p> <p>\u8001\u5be6\u8aaa\uff0c\u9019\u500b\u554f\u984c\u898b\u4ec1\u898b\u667a\uff0c\u6bcf\u500b\u4eba\u7684\u601d\u7dd2\u7406\u89e3\u548c\u98a8\u683c\u4e0d\u540c\uff0c\u6240\u5beb\u51fa\u4f86\u7684\u7528\u5b57\u548c\u6392\u7248\u4e5f\u6703\u6709\u5f88\u5927\u7684\u5dee\u7570\uff0c\u4f46\u5982\u679c\u76ee\u6a19\u662f\u8981\u5beb\u6a19\u6e96\u7684\u6280\u8853\u6587\u4ef6\u7684\u8a71\uff0c\u60f3\u8981\u4e86\u89e3\u683c\u5f0f\u7684\u8a71\uff0c\u5012\u662f\u53ef\u4ee5\u770b\u770b\u5404\u5927\u539f\u5ee0\u7684\u6280\u8853\u6587\u4ef6\u898f\u7bc4</p> <p>Write the Docs \u662f\u4e00\u500b\u95dc\u5fc3\u6280\u8853\u6587\u4ef6\u898f\u7bc4\u7684\u4eba\u6240\u7d44\u6210\u7684\u793e\u7fa4\uff0c\u6bcf\u5e74\u6703\u6709Conferences\u3001Meetups\uff0c\u88e1\u9762\u6709\u4e0d\u5c11\u5b78\u7fd2\u8cc7\u6e90\uff0c\u689d\u5217\u5e7e\u500b\u6bd4\u8f03\u6709\u540d\u7684\u98a8\u683c\u6587\u4ef6\u7d66\u5927\u5bb6\u53c3\u8003</p> <ol> <li>Microsoft Writing Stle Guide</li> <li>IBM DeveloperWorks Style Guide</li> <li>Red Hat Style Guide</li> <li>SUSE Documentation Style Guide</li> <li>Google Developer Documentation Style Guide</li> </ol> <p>\u4f46\u5be6\u969b\u4e0a\u4f86\u8aaa\uff0c\u4f60\u770b\u5b8c\u4e0a\u9762\u7684\u6240\u6709\u6587\u4ef6\uff0c\u5927\u6982\u5c31\u662f\u82f1\u6587\u4f5c\u6587\u80fd\u529b\u8b8a\u597d\uff0c\u5be6\u969b\u4e0a\u5f88\u96e3\u5b8c\u5168\u61c9\u7528\uff0c\u56e0\u70ba\u7562\u7adf\u81ea\u5df1\u5beb\u6587\u7ae0\u8ddf\u9019\u7a2e\u5927\u578b\u7d44\u7e54\u8981\u5beb\u7684\u6587\u4ef6\u662f\u6709\u9ede\u4e0d\u4e00\u6a23\u7684\uff0c\u6240\u4ee5\u4ee5\u4e0b\u518d\u63d0\u4f9b\u5e7e\u500b\u6587\u4ef6\u6bd4\u8f03\u843d\u5730\u4e00\u9ede\uff0c\u4f46\u56e0\u70ba\u5de5\u4f5c\u95dc\u4fc2\uff0c\u6240\u4ee5\u6703\u975e\u5e38\u504f Red Hat \u7684\u683c\u5f0f</p> <ul> <li>\u5982\u679c\u662f\u8981\u5efa\u7acb<code>\u6a21\u7d44\u5316</code>\u7684\u6280\u8853\u6587\u4ef6\uff0c\u53ef\u4ee5\u53c3\u8003 Red Hat Modular Documentation Reference Guide \u6240\u63d0\u7684\u65b9\u6cd5</li> <li>\u5982\u679c\u662f\u8981\u5efa\u7acb<code>\u8207\u793e\u7fa4\u5408\u4f5c</code>\u5efa\u7acb\u76f8\u95dc\u6280\u8853\u6587\u4ef6\uff0c\u53ef\u4ee5\u53c3\u8003 Red Hat Community Collaboration Guide</li> <li>\u5982\u679c\u662f\u60f3\u8981\u5beb\u51fa<code>\u53e3\u8a9e\u5316</code>\u7684\u6587\u7ae0\uff0c\u53ef\u4ee5\u53c3\u8003 Red Hat Developer\uff0c\u4ec0\u9ebc\u98a8\u683c\u90fd\u6709\uff0c\u4f46\u90fd\u662f\u5c0f\u800c\u7f8e\u7684\u5167\u5bb9</li> <li>\u5982\u679c\u53ea\u662f\u60f3\u8981\u5beb\u51fa<code>\u5b89\u88dd\u624b\u518a</code>\u7684\u7b49\u7d1a\uff0c\u53ef\u4ee5\u53c3\u8003 Linuxconfig.org\uff0c\u76ee\u6a19\u660e\u78ba\uff0c\u6307\u793a\u6e05\u695a\uff0c\u6211\u6700\u8fd1\u7684\u5beb\u4f5c\u98a8\u683c\u6709\u53d7\u9019\u7db2\u7ad9\u5f71\u97ff XD</li> </ul>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_6","title":"\u6709\u4ec0\u9ebc\u6559\u5b78\u7db2\u7ad9\u55ce?","text":"<p>Every engineer is also writer</p> <p>\u524d\u9663\u5b50 Google \u767c\u5e03\u4e86\u4e00\u500b Technical Writing Courses \u7db2\u7ad9\uff0c\u4e3b\u8981\u662f\u82f1\u6587\uff0c\u5206\u70ba 2 \u500b\u8ab2\u7a0b</p> <ol> <li>\u57fa\u790e\u6280\u8853\u5beb\u4f5c\u77e5\u8b58\u79d1\u666e</li> <li>\u4e2d\u968e\u6280\u8853\u5beb\u4f5c\u4e3b\u984c\u6559\u5b78</li> </ol> <p>\u500b\u4eba\u662f\u8a8d\u70ba\u9019\u662f\u6a19\u6e96\u7684\u82f1\u6587\u5beb\u4f5c\u8ab2 XD\uff0c\u5c0d\u6211\u9084\u883b\u6709\u7528\u7684\uff0c\u4ee5\u5f8c\u53ef\u4ee5\u5617\u8a66\u5beb\u9ede\u82f1\u6587\u6280\u8853\u6587\u4ef6\u4e0b\u4f86</p> <p>\u9664\u4e86\u6559\u5b78\u7db2\u7ad9\uff0c\u9023\u57fa\u790e\u7684\u6280\u8853\u6587\u4ef6\u7db2\u7ad9\u6a21\u677f\u90fd OpenSource \u4e86\uff0c\u53ef\u4ee5\u53c3\u8003\u4ee5 <code>Hugo</code> \u70ba\u5e95\u7684 google/docsy \u5c08\u6848\u6216\u8005\u662f\u76f8\u7576\u77e5\u540d\u7684 mkdocs \b/ VuePress\uff0c\u6b64\u5916\u9084\u5f04\u4e86\u500b Season of Docs \u4f9b\u5c0d\u65bc\u9019\u985e\u6280\u8853\u4f5c\u5bb6\u5011\u7684\u958b\u6e90\u793e\u7fa4\uff0c\u4e0d\u5f97\u4e0d\u8aaa Google \u771f\u7684\u662f\u883b\u6709\u5fc3\u7684\uff0c\u6574\u5957\u5305\u597d\u597d</p>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_7","title":"\u5beb\u4f5c\u5de5\u5177?","text":"<p>\u9019\u4e5f\u6c92\u4ec0\u9ebc\u597d\u9078\u7684\uff0c\u57fa\u672c\u4e0a\u5c31\u662f\u74b0\u7e5e HackMD \u7684\u5de5\u5177\uff0cHackMD \u662f\u6211\u9577\u4e45\u4f7f\u7528\u7684 \uff2darkdown \u4ee5\u4f86\u6700\u597d\u7528\u7684\u4e00\u500b\u5e73\u53f0\uff0c\u6211\u770b\u6709\u4e9b\u570b\u5916\u6703\u8b70\u7d00\u9304\u4e5f\u90fd\u6539\u7528 HackMD \u4f86\u505a\u5171\u7b46</p> <ul> <li>\u7dda\u4e0a\u7528 Hackmd.io</li> <li>\u7dda\u4e0b\u7528 VSCode + HackMD Markdown VSCode Extension</li> <li>Server \u4e0a<ul> <li>vim</li> <li>VSCode + Remote - SSH</li> </ul> </li> </ul>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#_8","title":"\u5f8c\u8a71","text":"<p>\u6211\u883b\u9f13\u52f5\u53ea\u8981\u662f IT \u6280\u8853\u5f9e\u696d\u4eba\u54e1\uff0c\u7121\u8ad6\u662f\u5728\u5b78\u9084\u662f\u5c31\u8077\u8005\uff0c\u90fd\u61c9\u8a72\u8981\u82b1\u9ede\u6642\u9593\u628a\u4e00\u4e9b\u5e38\u9047\u5230\u7684\u6280\u8853\u6216\u8005\u662f\u89c0\u5bdf\u8a18\u9304\u4e0b\u4f86\uff0c\u5beb\u591a\u4e86\u5176\u5be6\u6700\u5927\u7684\u53d7\u76ca\u8005\u771f\u7684\u4e0d\u662f\u5225\u4eba\uff0c\u662f\u81ea\u5df1\u3002\u8cc7\u8a0a\u91cf\u9019\u9ebc\u5927\u7684\u72c0\u6cc1\u4e0b\uff0c\u57f9\u990a\u51fa\u500b\u7b2c\u4e8c\u5927\u8166\u662f\u76f8\u7576\u91cd\u8981\u7684\uff0c\u6216\u8a31\u4e0d\u9700\u8981\u50cf\u6211\u9019\u6a23\u7fd2\u6163\u5beb\u4f5c\u5f8c\u516c\u958b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5efa\u7acb\u81ea\u5df1\u7684\u79c1\u4eba Wiki \u6216\u8005\u662f\u4f7f\u7528 HackMD \u7d00\u9304\u76f8\u95dc\u7684\u8cc7\u8a0a\uff0c\u597d\u81ea\u5df1\u505a\u500b\u6574\u7406\uff0c\u81e8\u6642\u8981\u7528\u7684\u6642\u5019\u662f\u76f8\u7576\u65b9\u4fbf\u7684</p>","tags":["linux","infra","homecloud"]},{"location":"20200308-technical-writer.html#references","title":"References","text":"<ul> <li>Hugo</li> <li>Jekyll</li> <li>Hexo</li> <li>Write the Docs</li> <li>Write the Docs - Conferences</li> <li>Write the Docs - Meetups</li> <li>google/docsy</li> </ul>","tags":["linux","infra","homecloud"]},{"location":"20200309-ansible-30m.html","title":"30 \u5206\u9418\u5167\u5f9e\u958b\u59cb\u5230\u5165\u9580\u7684 Ansible","text":"<p>Ansible \u771f\u7684\u662f\u4e00\u500b\u883b\u597d\u7528\u7684\u5de5\u5177\uff0c\u4e0d\u7528\u9810\u5148\u585e\u4ee3\u7406\u7a0b\u5f0f (Agentless) \u9019\u9ede\u771f\u7684\u662f\u883b\u5bb9\u6613\u4e0a\u624b\u7684\uff0c\u9019\u908a\u5206\u4eab\u4e00\u4e0b\u5982\u679c\u4f60\u662f\u7b2c\u4e00\u6b21\u63a5\u89f8\u5230 Ansible \u7684\u7cfb\u7d71\u5de5\u7a0b\u5e2b\uff0c\u60f3\u8981\u4f7f\u7528\u770b\u770b\u7684\u8a71\uff0c\u4f46\u53c8\u4e0d\u60f3\u8981\u5b78\u592a\u591a\u76f8\u95dc\u77e5\u8b58\u7684\u8a71\uff0c\u9019\u7bc7\u975e\u5e38\u9069\u5408\u5404\u4f4d</p> <p>{% youtube ysqclCH9Vc0 %}</p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#ansible","title":"\u6c92\u6709 Ansible \u7684\u6642\u5019\u662f\u600e\u9ebc\u7ba1\u7406\u4f3a\u670d\u5668\u7684?","text":"<p>\u7576\u9047\u5230\u6709\u4e00\u7968\u6a5f\u5668\u9700\u8981\u540c\u6642\u9593\u8981\u9032\u884c\u64cd\u4f5c\u7684\u6642\u5019\uff0c\u4ee5\u524d\u6211\u7528\u904e\u5e7e\u500b\u62db\u6578\uff0c\u56e0\u70ba\u6211\u662f Linux \u9577\u671f\u4f7f\u7528\u8005\uff0c\u6545\u4ee5 Linux \u4e0a\u80fd\u7528\u70ba\u4e3b</p> <ol> <li>\u4e00\u500b\u4e00\u500b\u767b\u5165\u64cd\u4f5c: \u6700\u65e9\u671f\uff0c\u6700\u82b1\u6642\u9593\uff0c\u932f\u8aa4\u7387\u8d85\u9ad8</li> <li>\u5beb <code>Shell Script</code> + for \u8ff4\u5708: \u8981\u6703\u5beb\u7a0b\u5f0f\uff0cShell Script \u771f\u5fc3\u4e0d\u597d\u591a\u4eba\u7dad\u8b77</li> <li>\u5beb <code>Python</code>: \u8981\u6703\u5beb\u7a0b\u5f0f\uff0c\u53ea\u8981\u6703\u5beb Python \u7684\u624d\u770b\u5f97\u61c2\u6211\u5728\u5beb\u4ec0\u9ebc</li> <li>tmux \u642d\u914d <code>synchronize panes</code>: \u61f6\u5f97\u5beb\u7a0b\u5f0f\uff0c\u76f4\u63a5\u4e00\u500b\u756b\u9762\u64cd\u4f5c\u5168\u90e8\uff0c\u4f46\u5982\u679c\u9047\u5230\u6a5f\u5668\u7684\u53c3\u6578\u4e0d\u4e00\u6a23\u5c31\u8981\u4e00\u500b\u4e00\u500b\u64cd\u4f5c</li> </ol> <p>\u984c\u5916\u8a71\uff0c<code>tmux</code> \u771f\u7684\u662f\u4eba\u4eba\u5fc5\u7528\u7684\u597d\u5de5\u5177\uff0c\u642d\u914d <code>mosh</code> \u7c21\u76f4\u501a\u5929\u5c60\u9f8d\u528d\u7684\u7d44\u5408\uff0c\u975e\u5e38\u9069\u5408\u88dd\u5728\u5821\u58d8\u6a5f (Bastion) \u4e0a\u4f7f\u7528</p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#linux","title":"\u5e38\u898b Linux \u65e5\u5e38\u7dad\u904b\u64cd\u4f5c","text":"<p>\u57fa\u672c\u4e0a\u5e38\u505a\u7684\u4e0d\u5916\u4e4e\u4ee5\u4e0b\u4e8b\u60c5\uff1a 1. \u5c0d\u591a\u500b\u6a5f\u5668\u4e0b\u76f8\u540c\u7684<code>\u6307\u4ee4</code>\uff0c\u5305\u542b\u91cd\u958b\u670d\u52d9 (systemctl restart ooxx)\u3001\u770b\u6a94\u6848 (cat ooxx)\u3001\u4f8b\u884c\u66f4\u65b0 (yum update -y)\u3001\b\b\u57f7\u884c\u7db2\u8def\u6307\u4ee4 (ip route) \u7b49\u7b49 2. \u5c07\u4e00\u500b<code>\u6a94\u6848</code>\u6216<code>\u8cc7\u6599\u593e</code>\u653e\u5230\u591a\u500b\u6a5f\u5668\u4e0a\u9762 3. \u4fee\u6539\u6a94\u6848\u5167\u5bb9</p> <p>\u9019\u7bc7\u6703\u91dd\u5c0d 1 \u548c 2 \u7684\u5de5\u4f5c\u9805\u76ee\u9032\u884c\u8a0e\u8ad6\uff0c\u4fdd\u8b49\u5f88\u6709\u7528\uff0c3 \u8981\u984d\u5916\u5b78 Jinja2 \u90a3\u500b\u5c31\u7b97\u662f\u6bd4\u8f03\u6df1\u5165\u7684\u90e8\u4efd\u4e86</p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#30","title":"30 \u5206\u9418\u5b78\u7fd2\u958b\u59cb","text":"<p>\u5efa\u8b70\u8981\u6709\u4e00\u53f0\u6a5f\u5668\u7576\u4f5c\u8df3\u677f\u6a5f\uff0c\u53ef\u4ee5\u662f\u4f60\u7684 Mac / Linux (\u5f88\u62b1\u6b49 Windows \u4e0d\u884c)\uff0c\u9019\u908a\u7684\u7bc4\u4f8b\u662f\u900f\u904e Ansible \u4e0b\u53bb\u7ba1\u7406\u4e09\u53f0\u6a5f\u5668</p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#_1","title":"\u4f5c\u696d\u7cfb\u7d71\u74b0\u5883","text":"<ul> <li>Bastion<ul> <li>Red Hat Enterprise Linux 7.x 10.0.96.9/24</li> <li>Ansible 2.x</li> </ul> </li> <li>\u88ab\u63a7\u7aef<ul> <li>ceph3-node01.ceph.internal 10.0.98.1/24</li> <li>ceph3-node02.ceph.internal 10.0.98.2/24</li> <li>ceph3-node03.ceph.internal 10.0.98.3/24</li> </ul> </li> </ul>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#ansible_1","title":"\u5b89\u88dd Ansible","text":"<ul> <li> <p>MacOS <pre><code>brew install ansible\n</code></pre></p> </li> <li> <p>Ubuntu Debian <pre><code>apt install ansible -y\n</code></pre></p> </li> <li> <p>RHEL/CentOS <pre><code>yum install -y ansible\n</code></pre></p> </li> </ul>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#_2","title":"\u4f7f\u7528\u524d\u6e96\u5099","text":"<ol> <li> <p>\u9996\u5148\u8981\u5148\u7528 SSH \u767b\u5165\u904e\u6240\u6709\u53d7\u63a7\u6a5f\u5668\uff0c\u8b93 host fingerprint \u52a0\u5165\u5230 <code>known_hosts</code> \u88e1\u9762\uff0c\u4e0d\u7136\u6703\u5674\u4e0b\u9762\u7684\u932f\u8aa4\uff0c\u7576\u7136\u6700\u597d\u7684\u5efa\u8b70\u662f\u8d70\u514d\u5bc6\u78bc\u91d1\u9470\u7684\u65b9\u5f0f <code>ssh-copy-id</code>\uff0c\u4f46\u9019\u908a\u4e0d\u63d0\uff0c\u964d\u4f4e\u8907\u96dc\u6027</p> </li> <li> <p>Error Output <pre><code>\"Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host's fingerprint to your known_hosts file to manage this host.\"\n</code></pre></p> </li> <li> <p>\u6e96\u5099\u74b0\u5883 <pre><code># \u65b0\u589e\u8cc7\u6599\u593e\nmkdir ansible-workspace &amp;&amp; cd ansible-workspace\n\n# \u65b0\u589e\u53d7\u63a7\u7aef\u8cc7\u8a0a\ncat &gt; inventory &lt;&lt; EOF\nceph3-node01.ceph.internal ansible_host=10.0.98.1 ansible_user=root\nceph3-node02.ceph.internal ansible_host=10.0.98.2 ansible_user=root\nceph3-node03.ceph.internal ansible_host=10.0.98.3 ansible_user=root\nEOF\n</code></pre></p> </li> </ol> <p></p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#0-ansible","title":"\u4efb\u52d9 0: \u4e86\u89e3\u662f\u5426\u4f3a\u670d\u5668\u53ef\u4ee5\u88ab Ansible \u7ba1\u7406","text":"<p><pre><code># ansible -i &lt;INVENTORY FILE&gt; &lt;\u6240\u6709\u4e3b\u6a5f\u6216\u7279\u5b9a\u4e3b\u6a5f&gt; -m ping -k\nansible -i inventory all -m ping -k\n</code></pre> \u4e00\u5b9a\u8981\u662f\u5168\u90e8\u90fd\u662f <code>SUCCESS</code>\uff0c\u9019\u6a23\u5f8c\u9762\u7684\u624d\u80fd\u6307\u4ee4\u4f7f\u7528\uff0c\u6709\u4efb\u4f55\u932f\u8aa4\u7684\u8a71\uff0c\u4e00\u5b9a\u8981\u5148\u641e\u597d\uff0c\u4e0d\u7136\u5f8c\u9762\u4e5f\u5c31\u4e0d\u7528\u770b\u4e86</p> <p></p>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#1","title":"\u4efb\u52d9 1: \u5c0d\u591a\u500b\u4f3a\u670d\u5668\u4e0b\u76f8\u540c\u6307\u4ee4","text":"<pre><code># ansible -i &lt;INVENTORY FILE&gt; &lt;\u6240\u6709\u4e3b\u6a5f\u6216\u7279\u5b9a\u4e3b\u6a5f&gt; -m shell -k -a &lt;\u6307\u4ee4&gt;\nansible -i inventory all -m shell -k -a \"timedatectl\"\nansible -i inventory all -m shell -k -a \"yum update -y\"\nansible -i inventory all -m shell -k -a \"systemctl status tuned\"\nansible -i inventory all -m shell -k -a \"cat /etc/os-release | grep PRETTY_NAME\"\n</code></pre>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#2","title":"\u4efb\u52d9 2: \u5c07\u4e00\u500b\u6a94\u6848\u6216\u8cc7\u6599\u593e\u50b3\u9001\u5230\u591a\u500b\u4f3a\u670d\u5668\u4e0a","text":"<pre><code># \u6a94\u6848\nansible -i inventory all -m copy -k -a \"src=/etc/motd dest=/etc/motd\"\n\n# \u8cc7\u6599\u593e\nansible -i inventory all -m copy -k -a \"src=/etc/yum.repos.d/ dest=/etc/yum.repos.d/\"\n</code></pre>","tags":["ansible","smart start"]},{"location":"20200309-ansible-30m.html#_3","title":"\u60f3\u8981\u5b78\u66f4\u591a?","text":"<p>\u606d\u559c\u5404\u4f4d 30 \u5206\u9418\u5167\u5feb\u901f\u4e0a\u624b\u4f7f\u7528 Ansible\uff0cAnsible \u5165\u624b\u9580\u6abb\u771f\u7684\u662f\u975e\u5e38\u4f4e\uff0c\u4e0d\u9700\u8981\u5b78\u7279\u5225\u7684\u7a0b\u5f0f\u8a9e\u8a00\u5c31\u53ef\u4ee5\u76f4\u63a5\u62ff\u4f86\u4f7f\u7528\uff0c\u4f60\u770b\u770b\u524d\u9762\u5c0d\u65bc\u591a\u6a5f\u5668\u7684\u64cd\u4f5c\u6709\u5beb\u5230 for \u8ff4\u5708\u55ce? \u4f46\u4ed6\u7684\u4f7f\u7528\u4e0d\u55ae\u55ae\u662f\u9019\u6a23\uff0c\u9084\u53ef\u4ee5\u5ef6\u4f38\u66f4\u591a\uff0c\u4ee5\u4e0b\u662f\u5169\u500b\u883b\u9069\u5408\u5165\u9580\u7684\u7c21\u5831</p> <ul> <li>\u73fe\u4ee3 IT \u4eba\u4e00\u5b9a\u8981\u77e5\u9053\u7684 Ansible \u81ea\u52d5\u5316\u7d44\u614b\u6280\u5de7</li> <li>20190720_Better Practice_Day 2 Operaition with Ansible</li> </ul> <p>\u5982\u679c\u4f60\u60f3\u8981\u53c3\u52a0\u76f8\u95dc\u793e\u7fa4\u7684\u8a71\uff0c\u4e5f\u6b61\u8fce\u52a0\u5165 Ansible \u53f0\u7063\u4f7f\u7528\u8005\u793e\u7fa4 \u7576\u4e2d\u7684 Telegram Group \u8ddf\u6211\u5011\u4e00\u8d77\u8a0e\u8ad6</p>","tags":["ansible","smart start"]},{"location":"20200317-openshift-with-coreos-part-1.html","title":"\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 1","text":"<p>\u8aa0\u5982\u5927\u5bb6\u6240\u77e5\uff0c\u56e0\u7232\u7a2e\u7a2e\u6280\u8853\u53ca\u975e\u6280\u8853\u56e0\u7d20\u4e0a - Why Red Hat is investing in CRI-O and Podman\uff0cOpenShift 4 \u5e95\u5c64\u6709\u5169\u500b\u883b\u5927\u7684\u66f4\u65b0</p> <ol> <li>\u5bb9\u5668\u904b\u884c\u6642\u74b0\u5883 (Container Runtime) \u5f9e docker \u63db\u6210\u4e86 CRI-O</li> <li>\u4f5c\u696d\u7cfb\u7d71\u5f9e\u901a\u7528\u578b Red Hat Enterprise Linux \u63db\u6210\u4e86\u5c08\u70ba\u5bb9\u5668\u7279\u5316\u7684\u5bb9\u5668\u4f5c\u696d\u7cfb\u7d71 Red Hat CoreOS</li> </ol> <p>\u672c\u6587\u5c07\u8a18\u9304\u4e00\u4e0b\u65bc Red Hat CoreOS (RHCOS) \u53ca Red Hat OpenShift \u504f\u4f5c\u696d\u7cfb\u7d71\u5c64\u9762\u7684\u63a2\u7d22\u7d00\u9304</p> <p></p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#_1","title":"\u524d\u63d0","text":"<p>\u56e0\u70ba\u5c0f\u5f1f\u5df2\u7d93\u88dd\u597d\u4e86 Red Hat OpenShift 4 \u7684\u74b0\u5883\uff0c\u6240\u4ee5\u6211\u5df2\u7d93\u6709 3 master \u53ca 2 compute \u7bc0\u9ede\u53ef\u4ee5\u767b\u9032\u53bb\u4f7f\u7528\uff0c\u5018\u82e5\u4f60\u60f3\u8981\u81ea\u5df1\u7814\u7a76\u7684\u8a71\uff0c\u53ef\u4ee5\u4e0b\u8f09 Fedora CoreOS \u8a66\u8a66\u770b</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#_2","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u4e00\u5929","text":"","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#coreos","title":"\u767b\u5165 CoreOS \u7bc0\u9ede","text":"<p>Red Hat CoreOS is a container OS</p> <p>\u6709\u5169\u500b\u65b9\u5f0f:</p> <ol> <li>\u76f4\u63a5\u900f\u904e SSH \u767b\u5165</li> <li>\u5982\u679c\u662f\u900f\u904e OpenShift\uff0c\u53ef\u4ee5\u900f\u904e <code>oc debug</code> \u9032\u5165</li> </ol> <p>\u5148\u8b1b\u7b2c\u4e00\u7a2e\u65b9\u5f0f\uff0c\u9019\u908a\u552f\u4e00\u7684\u8981\u7559\u610f\u7684\u5c31\u662f\uff0c\u9810\u8a2d\u767b\u5165\u7684\u5e33\u865f\u662f <code>core</code>\uff0c\u800c\u4e0d\u662f root\uff0c\u800c\u4e14\u50c5\u80fd\u62ff\u7576\u521d\u900f\u904e ignition file \u532f\u5165\u81f3 CoreOS \u7684 SSH Private Key \u767b\u5165</p> <pre><code>$ ssh core@compute-0.ocp4.internal -i ~/.ssh/id_rsa_ocp4_vcenter\n\nRed Hat Enterprise Linux CoreOS 43.81.202003052336.0\n  Part of OpenShift 4.3, RHCOS is a Kubernetes native operating system\n  managed by the Machine Config Operator (`clusteroperator/machine-config`).\n\nWARNING: Direct SSH access to machines is not recommended; instead,\nmake configuration changes via `machineconfig` objects:\n  https://docs.openshift.com/container-platform/4.3/architecture/architecture-rhcos.html\n\n---\nLast login: Tue Mar 17 03:01:29 2020 from 10.0.97.100\n[core@compute-0 ~]$ cat /etc/os-release\nNAME=\"Red Hat Enterprise Linux CoreOS\"\nVERSION=\"43.81.202003052336.0\"\nVERSION_ID=\"4.3\"\nOPENSHIFT_VERSION=\"4.3\"\nRHEL_VERSION=8.0\nPRETTY_NAME=\"Red Hat Enterprise Linux CoreOS 43.81.202003052336.0 (Ootpa)\"\nID=\"rhcos\"\nID_LIKE=\"rhel fedora\"\nANSI_COLOR=\"0;31\"\nHOME_URL=\"https://www.redhat.com/\"\nBUG_REPORT_URL=\"https://bugzilla.redhat.com/\"\nREDHAT_BUGZILLA_PRODUCT=\"OpenShift Container Platform\"\nREDHAT_BUGZILLA_PRODUCT_VERSION=\"4.3\"\nREDHAT_SUPPORT_PRODUCT=\"OpenShift Container Platform\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"4.3\"\nOSTREE_VERSION='43.81.202003052336.0'\n</code></pre> <p>\u7b2c\u4e8c\u7a2e\u65b9\u5f0f\u662f\u900f\u904e <code>oc debug</code> \u904b\u884c\u4e00\u500b debug \u7528\u7684 pod \u5f8c\uff0c\u518d\u900f\u904e <code>chroot</code> \u5207\u63db\u5230 / \u76ee\u9304</p> <pre><code>$ oc debug node/compute-0\nStarting pod/compute-0-debug ...\nTo use host binaries, run `chroot /host`\n\nPod IP: 10.0.97.4\nIf you don't see a command prompt, try pressing enter.\nsh-4.2# chroot /host\nsh-4.4# cat /etc/os-release\nNAME=\"Red Hat Enterprise Linux CoreOS\"\nVERSION=\"43.81.202003052336.0\"\nVERSION_ID=\"4.3\"\nOPENSHIFT_VERSION=\"4.3\"\nRHEL_VERSION=8.0\nPRETTY_NAME=\"Red Hat Enterprise Linux CoreOS 43.81.202003052336.0 (Ootpa)\"\nID=\"rhcos\"\nID_LIKE=\"rhel fedora\"\nANSI_COLOR=\"0;31\"\nHOME_URL=\"https://www.redhat.com/\"\nBUG_REPORT_URL=\"https://bugzilla.redhat.com/\"\nREDHAT_BUGZILLA_PRODUCT=\"OpenShift Container Platform\"\nREDHAT_BUGZILLA_PRODUCT_VERSION=\"4.3\"\nREDHAT_SUPPORT_PRODUCT=\"OpenShift Container Platform\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"4.3\"\nOSTREE_VERSION='43.81.202003052336.0'\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#root","title":"\u5207\u63db\u6210 root","text":"<p>\u9810\u8a2d\u5728 RHCOS \u88e1\u9762\u50c5\u6703\u6709\u5169\u500b\u5e33\u865f\uff0c\u5206\u5225\u662f <code>core</code> \u53ca <code>root</code>\uff0c\u800c\u9810\u8a2d\u5df2\u7d93\u628a sudoers \u5beb\u597d\u4e86\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5 sudo \u5207\u904e\u53bb</p> <pre><code>[core@compute-0 ~]# cat /etc/passwd\nroot:x:0:0:root:/root:/bin/bash\ncore:x:1000:1000:CoreOS Admin:/var/home/core:/bin/bash\n[core@compute-0 ~]$ sudo su -\nLast login: Tue Mar 17 02:41:02 UTC 2020 on pts/0\n[root@compute-0 ~]#\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#cri-o","title":"CRI-O \u63a2\u7d22","text":"<p>CRI-O is a lightwieght container runtime for Kubernetes</p> <p>\u8aa0\u5982\u958b\u982d\u6240\u8aaa\u7684\uff0cOpenShift 4 \u9810\u8a2d\u7684 Container Runtime \u662f\u63a1\u7528 <code>CRI-O</code>\uff0c\u6240\u4ee5\u82e5\u8981\u5728 CoreOS \u4e0a\u627e\u5c0b\u985e\u4f3c\u65bc <code>docker</code> \u6216 <code>podman</code> \u7684\u6307\u4ee4\uff0c\u5247\u70ba <code>crictl</code></p> <p>\u5e38\u7528\u7684\u6307\u4ee4\u7d44\u5408\u4e0d\u5916\u4e4e\u70ba crictl [images | ps | pods | stats]\uff0c\u8a73\u7d30\u7684\u64cd\u4f5c\u6307\u4ee4\u8f38\u51fa\u53ef\u4ee5\u53c3\u8003 Debugging Kubernetes nodes with crictl</p> <pre><code>[root@control-plane-1 ~]# crictl images\nIMAGE                                                                                 TAG                 IMAGE ID            SIZE\n&lt;none&gt;                                                                                &lt;none&gt;              493f2db8b5178       728MB\n</code></pre> <p>\u4f46\u7562\u7adf CRI-O \u4e3b\u8981\u8a2d\u8a08\u4e0a\u9084\u662f\u7d66 OpenShift / Kubernetes \u9019\u985e\u5bb9\u5668\u5e73\u53f0\u4f7f\u7528\uff0c\u6240\u4ee5\u8001\u5be6\u8b1b\uff0c\u62ff\u8457 <code>crictl</code> \u8981\u5728 CoreOS \u4e0a\u9762\u8981\u555f\u52d5\u4e00\u500b\u670d\u52d9\uff0c\u800c\u5b83\u7684\u6700\u5c0f\u55ae\u4f4d\u662f Pod\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u5148\u6e96\u5099\u597d <code>pod-config.json</code> \u53ca <code>container-config.json</code>\uff0c\u800c\u57f7\u884c\u7684\u6307\u4ee4\u5247\u662f\u4f7f\u7528 <code>crictl runp</code> \u53ca <code>crictl create</code>\uff0c\u53bb\u8dd1\u4e00\u500b\u5b8c\u6574\u7684 Pod \u8d77\u4f86\u624d\u80fd\u55ae\u6a5f\u4f7f\u7528\uff0c\u6574\u9ad4\u4e0a\u662f\u76f8\u7576\u6709\u8907\u96dc\u6027\u7684</p> <p>\u5018\u82e5\u662f\u53ea\u662f\u8981\u5728 CoreOS \u4e0a\u9762\u8dd1\u4e00\u500b\u5bb9\u5668\u8a66\u8a66\u7684\u8a71\uff0c\u5c31\u50cf\u662f\u5e38\u898b\u5982 docker \u904b\u884c\u7684\u65b9\u5f0f\u7684\u8a71\uff0c\u9084\u662f\u4f7f\u7528 <code>podman</code> \u8f03\u70ba\u6070\u7576\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u53c3\u8003\u6b64\u6295\u5f71\u7247 The First Journey from Docker to Podman - Phil Huang</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#coreos_1","title":"\u904b\u884c\u4e00\u500b\u5bb9\u5668\u65bc CoreOS \u4e0a","text":"<p>It make sense to run any container on container OS</p> <p>\u5047\u8a2d\u6211\u60f3\u8981\u8dd1 <code>tcpdump</code> \u5728\u7bc0\u9ede\u4e0a\uff0c\u4f46\u539f\u751f RHCOS \u662f\u6c92\u6709\u5305\u542b\u9019\u500b\u5957\u4ef6\u7684\uff0c\u9019\u6642\u5019\u5c31\u5f97\u8981\u57f7\u884c\u4e00\u500b\u81ea\u5e36 <code>tcpdump</code> \u7684\u5bb9\u5668\u904b\u884c\u5728\u7bc0\u9ede\u4e0a\uff0c\u800c\u5148\u524d\u6709\u91dd\u5c0d\u9019\u8b70\u984c\u5beb\u904e\u4e00\u7bc7\u6587\u7ae0 Troubleshooting from Container to Any - Phil Huang \u4e5f\u662f\u57fa\u65bc\u540c\u6a23\u7684\u6982\u5ff5</p> <p>\u6211\u9019\u908a\u50c5\u8a18\u9304 Red Hat CoreOS \u7684\u7528\u6cd5</p> <pre><code>[root@bastion]# ssh core@compute-0.ocp4.internal -i ~/.ssh/id_rsa_ocp4_vcenter\n\n[core@compute-0 ~]$ sudo su -\n\n[root@compute-0 ~]# podman run \\\n    --hostname debug-toolbox \\\n    --name ocp-debug-container \\\n    --network host \\\n    --privileged \\\n    --security-opt label=disable \\\n    --tty \\\n    --rm \\\n    -it \\\n    --volume /:/host/:rslave \\\n    quay.io/pichuang/debug-container\n[root@debug-toolbox /]# tcpdump -i ens192 -w /host/home/core/tcpdump.pcap\n[root@debug-toolbox /]# scp /host/home/core/tcpdump.pcap root@bastion.ocp4.internal:~/\n\n[root@debug-toolbox /]# exit\n[root@compute-0 ~]# podman ps\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#systemd-journalctl","title":"\u5e38\u898b\u670d\u52d9 systemd / journalctl","text":"<p>\u5728 RHCOS \u4e2d\uff0c\u4f60\u9084\u662f\u53ef\u4ee5\u4f7f\u7528 <code>systemd</code> \u6216 <code>journalctl</code> \u505a\u89c0\u5bdf\u6027\u8cea\u7684\u64cd\u4f5c</p> <pre><code>[root@compute-0 ~]# systemctl status crio\n\u25cf crio.service - Open Container Initiative Daemon\n   Loaded: loaded (/usr/lib/systemd/system/crio.service; disabled; vendor preset: disa&gt;\n  Drop-In: /etc/systemd/system/crio.service.d\n           \u2514\u250010-default-env.conf\n   Active: active (running) since Tue 2020-03-17 03:17:12 UTC; 3h 7min ago\n     Docs: https://github.com/cri-o/cri-o\n Main PID: 1588 (crio)\n    Tasks: 37\n   Memory: 638.8M\n      CPU: 15min 23.689s\n   CGroup: /system.slice/crio.service\n           \u251c\u2500  1588 /usr/bin/crio --enable-metrics=true --metrics-port=9537\n           \u251c\u2500587682 /usr/libexec/crio/conmon -c 72482678b7cd9b0384fca2486d89e320c21cfe&gt;\n           \u251c\u2500587683 /usr/bin/runc --root=/run/runc exec --pid-file /tmp/pidfile4561585&gt;\n           \u2514\u2500587693 /usr/bin/runc init\n\n[root@compute-0 ~]# journalctl\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#6-rhcos","title":"6. \u4fee\u6539 RHCOS \u8a2d\u5b9a\u6a94","text":"<p>WARNING: Direct SSH access to machines is not recommended; instead, make configuration changes via <code>machineconfig</code> objects</p> <p>Choosing how to configure RHCOS - Red Hat OpenShift 4.3 \u6307\u51fa 3 \u7a2e\u4fee\u6539\u65b9\u5411</p> <ol> <li>\u900f\u904e Kubernetes \u5167\u5efa\u7684\u7269\u4ef6 (DaemonSet / Deployment) \u7b49\uff0c\u9019\u5e38\u898b\u65bc\u4f60\u60f3\u8981\u88dd\u4e00\u4e9b\u670d\u52d9\u5728 RHCOS \u4e0a\u9762\uff0c\u8b6c\u5982\u50cf\u662f\u7db2\u8def\u5957\u4ef6\u3001\u81ea\u5df1\u5beb\u7684 Agent \u7b49</li> <li>Day 2 Customization: \u4e00\u822c\u4f86\u8aaa\uff0c<code>\u4e0d\u5efa\u8b70\u900f\u904e SSH \u76f4\u63a5\u9023\u7dda</code>\u81f3 RHCOS \u4e0a\u9032\u884c\u4fee\u6539\u8a2d\u5b9a\u6a94\uff0c\u73fe\u884c\u5efa\u8b70\u900f\u904e\u63a7\u5236\u96c6\u7fa4\u7b49\u7d1a (Cluster-level) \u7684 <code>MachineConfigs</code> \u6216\u8005\u662f\u63a7\u5236\u7bc0\u9ede\u7b49\u7d1a (Node-level) \u7684 <code>Tuned</code> \u7b49\u9032\u884c\u8a2d\u5b9a\u6a94\u4fee\u6539</li> <li>Day 1 Customization: \u904b\u884c\u96c6\u7fa4\u524d\u7684\u8a2d\u5b9a\uff0c\u5927\u90e8\u5206\u90fd\u662f\u8981\u6539 ntp / dns \u5c45\u591a\uff0c\u9019\u500b\u5f97\u8981\u9760\u4fee\u6539 <code>ignition</code> \u4f86\u8fa6\u5230\uff0c\u4f46\u5efa\u8b70\u662f\u4e0d\u8981\u4fee\u592a\u591a\uff0c\u5927\u90e8\u5206\u7684\u8a2d\u5b9a\u7b49\u5230\u5b89\u88dd\u5b8c\u4e4b\u5f8c\u518d\u4fee\u5c31\u597d</li> </ol> <p>\u9019\u908a\u8a0e\u8ad6\u6700\u76f4\u89ba\u7684 <code>2. Day 2 Customization</code> \u4e2d\u7684 <code>MachineConfig</code></p> <p>\u5047\u8a2d\u6211\u60f3\u8981\u4fee\u6539\u89d2\u8272\u70ba MachineConfigPools \u7576\u4e2d <code>worker</code> \u7684 <code>/etc/chrony.conf</code>\uff0c\u6703\u6709\u4ee5\u4e0b\u7684\u4e8b\u60c5\u8981\u505a</p> <pre><code># \u6aa2\u67e5\u904b\u884c\u4e2d\u7684 machineconfig\n$ oc get mc\nNAME                                                        GENERATEDBYCONTROLLER                      IGNITIONVERSION   CREATED\n00-master                                                   d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n00-worker                                                   d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n01-master-container-runtime                                 d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n01-master-kubelet                                           d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n01-worker-container-runtime                                 d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n01-worker-kubelet                                           d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n99-master-6d33985b-9a3d-4934-94c5-60df362b79e6-registries   d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n99-master-ssh                                                                                          2.2.0             12h\n99-worker-b3d2e28e-a1e9-44f6-80a5-2d74bca78e7f-registries   d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n99-worker-ssh                                                                                          2.2.0             12h\nrendered-master-069a77d9b6f06c7e88bc0bcf107388bc            d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\nrendered-worker-5109aac45ee18a5b942c38a7bb060f95            d5599de7a6b86ec385e0f9c849e93977fcb4eeb8   2.2.0             12h\n\n# \u986f\u793a 50-worker-chrony \u7684 YAML \u6a94\u6848\n$ cat 50-worker-chrony.yaml\napiVersion: machineconfiguration.openshift.io/v1\nkind: MachineConfig\nmetadata:\n  labels:\n    machineconfiguration.openshift.io/role: worker\n  name: 50-worker-chrony\nspec:\n  config:\n    ignition:\n      version: 2.2.0\n    storage:\n      files:\n      - contents:\n          source: data:text/plain;charset=utf-8;base64,c2VydmVyIHRpY2suc3RkdGltZS5nb3YudHcgbWF4ZGVsYXkgMC40IG9mZmxpbmUKc2VydmVyIHRpbWUuc3RkdGltZS5nb3YudHcgbWF4ZGVsYXkgMC40IG9mZmxpbmU=\n        filesystem: root\n        mode: 0644\n        path: /etc/chrony.conf\n\n$ oc create -f 50-worker-chrony.yaml\n\n# \u91dd\u5c0d worker \u89d2\u8272\u4f9d\u5e8f\u91cd\u958b\n$ oc get nodes -w\ncompute-0         Ready                         worker   13h   v1.16.2\ncompute-0         Ready,SchedulingDisabled      worker   13h   v1.16.2\ncompute-0         NotReady,SchedulingDisabled   worker   13h   v1.16.2\ncompute-0         Ready,SchedulingDisabled      worker   13h   v1.16.2\ncompute-0         Ready                         worker   13h   v1.16.2\ncompute-1         Ready                         worker   13h   v1.16.2\ncompute-1         Ready,SchedulingDisabled      worker   13h   v1.16.2\ncompute-1         NotReady,SchedulingDisabled   worker   13h   v1.16.2\ncompute-1         Ready,SchedulingDisabled      worker   13h   v1.16.2\ncompute-1         Ready                         worker   13h   v1.16.2\n\n# \u6aa2\u67e5\u6a94\u6848\n$ ssh core@compute-0.ocp4.internal -i ~/.ssh/id_rsa_ocp4_vcenter\n[core@compute-0 ~]$ cat /etc/chrony.conf\n</code></pre> <p>\u6c92\u932f\uff0c\u53ea\u8981\u900f\u904e <code>Machine Config</code> \u6709\u4efb\u4f55\u4fee\u6539\uff0c\u9810\u8a2d\u90fd\u6703\u4f9d\u5e8f\u91cd\u958b\u7bc0\u9ede\uff0c\u5018\u82e5\u771f\u7684\u4e0d\u60f3\u8981\u91cd\u958b\u7684\u8a71\uff0c\u53ef\u4ee5\u900f\u904e\u4fee\u6539 <code>Machine Config Pool</code> \u7684 <code>paused</code> \u4f86\u66ab\u6642\u505c\u6b62</p> <pre><code># \u95dc\u9589\u81ea\u52d5\u91cd\u555f\noc patch --type=merge --patch='{\"spec\":{\"paused\":true}}' machineconfigpool/master\noc patch --type=merge --patch='{\"spec\":{\"paused\":true}}' machineconfigpool/worker\n\n# \u6253\u958b\u81ea\u52d5\u91cd\u555f\noc patch --type=merge --patch='{\"spec\":{\"paused\":false}}' machineconfigpool/master\noc patch --type=merge --patch='{\"spec\":{\"paused\":false}}' machineconfigpool/worker\n</code></pre> <p>Openshift Tips - MachineConfig \u9664\u4e86\u6211\u4e0a\u9762\u63d0\u5230\u7684 chrony \u7684\u6539\u8b8a\u4ee5\u5916\uff0c\u88e1\u9762\u9084\u6709\u5e7e\u500b\u7bc4\u4f8b\uff1a 1. Apply sysctl tweaks to nodes 2. Modify MTU in a second interface in workers</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#_3","title":"\u5f8c\u8a18","text":"<p>\u5148\u8a18\u9304\u5230\u9019\u908a\uff0c\u4e4b\u5f8c\u9678\u7e8c\u628a\u4e00\u4e9b\u7dad\u904b\u4e0a\u5e38\u898b\u7684\u554f\u984c\u6162\u6162\u5730\u88dc\u5145\u4e0a\u4f86</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#appendix","title":"Appendix","text":"","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#user-id-container-image","title":"\u5982\u4f55\u4f7f\u7528\u4efb\u610f User ID \u555f\u52d5 Container Image\uff1f","text":"<p>\u4f7f\u7528 <code>oc create serviceaccount</code> \u65b0\u589e\u4e00\u500b\u53ef\u4ee5\u8dd1 anyuid \u7684\u5e33\u865f</p> <pre><code># \u78ba\u8a8d\u7576\u524d service account\noc get serviceaccount\n\n# \u65b0\u589e service account - runasanyuid\noc create serviceaccount runasanyuid\n\n# \u78ba\u8a8d\u65b0\u589e\u5f8c service account\noc get serviceaccount\n</code></pre> <p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c\u5bb9\u5668\u6703\u53d7\u9650\u65bc SCC <code>restricted</code> \u4e0b\u904b\u884c\uff0cRun As User \u7684 Must Run As Range \u7684 UID \u7bc4\u570d\u6703\u53d7\u9650\u65bc\u5c08\u6848 (Porject) \u8a2d\u5b9a</p> <p>\u5018\u82e5\u9700\u8981\u5141\u8a31\u61c9\u7528\u7a0b\u5f0f\u4ee5\u4efb\u4f55\u4f7f\u7528\u8005 ID (\u5305\u542b root) \u57f7\u884c\uff0c\u5247\u9700\u8981\u65b0\u589e SCC <code>anyuid</code> \u7d66\u6307\u5b9a\u7684 service account</p> <pre><code># \u4ee5 administrator \u6b0a\u9650\uff0c\u78ba\u8a8d\u7576\u524d SCC \u6e05\u55ae\noc get scc --as system:admin\n\n# \u78ba\u8a8d SCC - restricted\noc describe scc restricted\n\n# \u65b0\u589e SCC - anyuid \u80fd\u529b\u7d66 service account - runasanyuid \u65bc\u7576\u524d\u5c08\u6848 project - debbuging\noc adm policy add-scc-to-user anyuid -z runasanyuid --as system:admin\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200317-openshift-with-coreos-part-1.html#references","title":"References","text":"<ul> <li>Why Red Hat is investing in CRI-O and Podman - Red Hat Blog</li> <li>CRI-O - LIGHTWEIGHT CONTAINER RUNTIME FOR KUBERNETES</li> <li>Installing CoreOS on Bare Metal - Fedora CoreOS</li> <li>Debugging Kubernetes nodes with crictl - Kubernetes</li> <li>Troubleshooting from Container to Any - Phil Huang</li> <li>How to TCPdump effectively in Kubernetes (part 1)</li> <li>How to TCPdump effectively in Kubernetes (part 2)</li> <li>How can I enable an image to run as a set user ID?</li> <li>\u914d\u7f6e\u5b89\u5168\u74b0\u5883\u5b9a\u7fa9\u9650\u5236</li> <li>The First Journey from Docker to Podman - Phil Huang</li> <li>Choosing how to configure RHCOS - Red Hat OpenShift 4.3</li> <li>Openshift Tips - MachineConfig</li> </ul>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200401-personal-agile.html","title":"\u4e00\u540d\u89e3\u6c7a\u65b9\u6848\u67b6\u69cb\u5e2b\u7684\u81ea\u6211\u654f\u6377","text":"<p>\u8981\u4f86\u9032\u884c\u4eca\u5929\u7684\u5206\u4eab\u4e4b\u524d\uff0c\u6211\u5f97\u8981\u5148\u4f86\u63a8\u4e00\u4e0b David Ko \u524d\u8f29 David Ko Learning Journey\uff0c\u7576\u521d\u7814\u7a76\u6240\u958b\u59cb\u63a5\u89f8 Scurm / Agile \u7b49\u7b49\u7684\u90fd\u662f\b\u4e3b\u8981\u90fd\u662f\u5f9e\u9019\u4f4d\u524d\u8f29\u4e0a\u5b78\u7fd2\u5230\u76f8\u95dc\u7d93\u9a57\u7684\uff0c\u76f4\u5230\u73fe\u5728\u5de5\u4f5c\u4e00\u9663\u5b50\u4e86\uff0c\u89c0\u5ff5\u9084\u662f\u975e\u5e38\u6709\u7528\uff0c\u5927\u63a8</p> <p>\u4eca\u5929\u8981\u4f86\u8b1b\u4e00\u4e0b\u95dc\u65bc\u8eab\u70ba\u4e00\u4f4d\u5728 Red Hat \u6253\u5de5\u4e86\u5feb\u5169\u5e74\u7684\u89e3\u6c7a\u65b9\u6848\u67b6\u69cb\u5e2b (Solution Architect) \u5982\u4f55\u900f\u904e\u654f\u6377\u65b9\u5f0f\u63d0\u9ad8\u500b\u4eba\u751f\u7522\u529b\uff0c\u9019\u7bc7\u5b8c\u5b8c\u5168\u5168\u5c31\u662f<code>\u500b\u4eba\u5be6\u969b\u7d93\u9a57\u5206\u4eab</code> XD</p> <p></p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#_2","title":"\u4f55\u8b02\u89e3\u6c7a\u65b9\u6848\u67b6\u69cb\u5e2b?","text":"<p>\u89e3\u6c7a\u65b9\u6848\u67b6\u69cb\u5e2b (Solution Architect) \u5728 Red Hat \u5b9a\u7fa9\u4e2d\u662f\u552e\u524d\u8077\u4f4d (Pre-sales)\uff0c\u4e3b\u8981\u6bcf\u65e5\u4efb\u52d9\u7c21\u8981\u7248\u672c\u5c31\u662f</p> <ol> <li>\u767d\u5929\u8ddf\u8457\u696d\u52d9\u8dd1\u4f86\u8dd1\u53bb\u958b\u6703</li> <li>\u665a\u4e0a\u5beb\u7c21\u5831 / Lab / \u56de\u4fe1 / \u8b80\u66f8 / \u7814\u7a76</li> </ol> <p>\u9019\u500b\u8077\u4f4d\u6709\u500b\u7279\u6027\u5c31\u662f\uff0c\u7121\u8ad6\u4f86\u81ea\u696d\u52d9\u9084\u662f\u5ba2\u6236\uff0c\u9700\u6c42\u90fd\u662f\u4f86\u5f97\u53c8\u5feb\u53c8\u6025\uff0c\u5f88\u5bb9\u6613\u4e00\u5929\u5167\u88ab\u4e00\u7968\u4e0d\u540c\u7684\u4e8b\u60c5\u885d\u5728\u4e00\u8d77\uff0c\u6240\u4ee5\u5c0d\u81ea\u5df1\u7684\u6bcf\u6708\u6bcf\u9031\u6bcf\u65e5\u5f85\u8fa6\u5de5\u4f5c\u9805\u76ee\u638c\u63e1\u8981\u975e\u5e38\u6e05\u695a\uff0c\u4e0d\u7136\u5f88\u5bb9\u6613\u6703 overloading\u3002\u800c\u525b\u597d\u6bcf\u4e00\u5b63\u7684\u81ea\u6211\u76ee\u6a19\u7ba1\u7406 (Management By Objectives, MBO)\uff0c\u4e5f\u9700\u8981\u56de\u9867\u4e09\u500b\u6708\u5167\u505a\u7684\u4e00\u4e9b\u5c08\u6848\u548c\u5de5\u4f5c\u8ca0\u8f09\u72c0\u6cc1\uff0c\u6545\u70ba\u4e86\u63d0\u9ad8\u751f\u7522\u529b\u548c\u6e96\u6642\u4ea4\u4ed8\u7522\u7269\uff0c\u6240\u4ee5...\u6211\u81ea\u5df1\u958b\u59cb\u4e86\u500b\u4eba\u654f\u6377\u63a2\u7d22</p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#_3","title":"\u5e38\u898b\u7684\u500b\u4eba\u654f\u6377\u65b9\u5f0f","text":"<p>Trello \u6709\u7279\u5225\u91dd\u5c0d<code>\u500b\u4eba</code>\u63d0\u51fa\u4e86\u5e7e\u7a2e\u63d0\u9ad8\u751f\u7522\u529b\u7684\u65b9\u5f0f - \u4ee5 Trello \u63d0\u5347\u500b\u4eba\u751f\u7522\u529b\uff0c\u5305\u542b\u5982\u4e0b 4 \u7a2e\u65b9\u5f0f:</p> <ol> <li>\u500b\u4eba\u751f\u7522\u529b\u7cfb\u7d71\uff1a\u5143\u8001\u7d1a Trello \u4f7f\u7528\u8005\u7684\u500b\u4eba\u751f\u7522\u529b\u6307\u5357</li> <li>\u827e\u68ee\u8c6a\u77e9\u9663 (Eisenhower Matrix)\uff1a\u76f8\u7576\u8457\u540d\u7684\u5de5\u4f5c\u512a\u5148\u6392\u5e8f\u6cd5\u5be6\u8e10</li> <li>\u6bcf\u9031\u6aa2\u8a0e\u6d41\u7a0b\uff1a\u4ee5\u9031\u70ba\u55ae\u4f4d \u300a\u641e\u5b9a\uff01\u300b\u4e00\u66f8\u5efa\u8b70\u990a\u6210\u6bcf\u9031\u81ea\u6211\u6aa2\u8a0e\u7684\u7fd2\u6163\u5be6\u8e10</li> <li>\u5fc3\u667a\u5716\uff1a\u6211\u500b\u4eba\u89ba\u5f97\u8d70\u932f\u68da</li> </ol> <p>\u6216\u8005\u662f\u771f\u7684\u8d70\u770b\u677f\u65b9\u6cd5 (Kanban Method) \u7684\uff0c\u4f46\u662f\u7d66\u500b\u4eba\u7528\u7684</p> <ol> <li>\u904b\u7528\u500b\u4eba\u770b\u677f\u505a\u6642\u9593\u7ba1\u7406 - Ruddy</li> <li>\u539f\u4f86\u6211\u4ee5\u70ba\u7684\u770b\u677f\u6839\u672c\u4e0d\u662f\u770b\u677f\u2026 - Oberon Lai</li> </ol> <p>\u53ef\u80fd\u6709\u4e9b\u4eba\u5c0d\u65bc\u770b\u677f\u65b9\u6cd5 (Kanban Method) \u7684\u5b9a\u7fa9\u6709\u6240\u4e0d\u6e05\u695a\uff0c\u9019\u908a\u5f37\u70c8\u5efa\u8b70\u770b\u4e00\u4e0b \u8996\u89ba\u5316\u767d\u677f, Proto-Kanban, Kanban \u50bb\u50bb\u5206\u4e0d\u6e05\u695a? - David Ko\uff0c\u5982\u540c\u5167\u6587\u6240\u8ff0\uff0c\u53ea\u8981\u6c92\u6709\u7167\u8457David J Anderson \u6240\u63d0\u51fa\u7684\u4ee5\u4e0b\u770b\u677f\u65b9\u6cd5\u5be6\u8e10\u8d70\uff0c\u5176\u5be6\u90fd\u4e0d\u7b97\u771f<code>\u770b\u677f\u65b9\u6cd5</code></p> <ul> <li>\u8996\u89ba\u5316 (Visualize)</li> <li>\u9650\u5236\u540c\u6642\u5de5\u4f5c\u6578\u91cf (Limit Work In Progress, WIP)</li> <li>\u7ba1\u7406\u5de5\u4f5c\u6d41\u7a0b (Manage flow)</li> <li>\u70ba\u6d41\u7a0b\u8a02\u5b9a\u660e\u78ba\u7684\u65b9\u91dd (Make policies explicit)</li> <li>\u5be6\u73fe\u53cd\u994b\u8ff4\u5708 (Implement feedback loops)</li> <li>\u5229\u7528\u6a21\u578b\u548c\u79d1\u5b78\u65b9\u6cd5\u4f86\u5354\u540c\u5f0f\u6539\u9032, \u5be6\u9a57\u6027\u6f14\u9032(Improve collaboratively, evolve experimentally)</li> </ul>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#-","title":"\u6211\u4f7f\u7528\u7684\u65b9\u5f0f - \u5c0f\u98db\u6a5f\u7248\u8996\u89ba\u5316\u767d\u677f","text":"<p>\u5c0d\u7684\uff0c\u57fa\u65bc\u5c0d\u65bc\u770b\u677f\u65b9\u5f0f\u7684\u898f\u7bc4\uff0c\u6211\u6c92\u6709\u5b8c\u5168\u63a1\u7d0d\u8a72\u5be6\u8e10\uff0c\u4f46\u5f9e\u4e2d\u9084\u662f\u6709\u64f7\u53d6\u51fa 3 \u500b\u6838\u5fc3\u6982\u5ff5\uff0c\u5f9e\u4e2d\u6539\u6210\u5c6c\u65bc<code>\u5c0f\u98db\u6a5f\u7248\u8996\u89ba\u5316\u770b\u677f</code>\u7684\u6a23\u5b50</p> <ul> <li>\u8996\u89ba\u5316 (Visualize)</li> <li>\u7ba1\u7406\u5de5\u4f5c\u6d41\u7a0b (Manage flow)</li> <li>\u70ba\u6d41\u7a0b\u8a02\u5b9a\u660e\u78ba\u7684\u65b9\u91dd (Make policies explicit)</li> </ul> <p>\u5de5\u5177\u9078\u64c7\u662f\u63a1\u7528 Trello\uff0c\u4e3b\u8981\u662f\u7c21\u55ae\u3001\u5feb\u901f\u548c\u8de8\u5e73\u53f0\uff0c\u7576\u7136\u9078\u64c7\u4e86\u597d\u5de5\u5177\u4e0d\u4ee3\u8868\u5c08\u6848\u5c31\u80fd\u8dd1\u5f97\u597d\uff0c\u53ea\u662f\u65b9\u4fbf\u6211\u81ea\u5df1\u4f7f\u7528\u800c\u5df2\uff0cTrello \u548c\u770b\u677f\u65b9\u6cd5\u7684\u95dc\u4fc2\u662f? - David Ko \u4e00\u6587\u7d50\u8a9e\u4e0d\u932f\uff0c\u4f46\u6211\u662f\u81ea\u5df1\u4f7f\u7528\uff0c\u4e0d\u662f\u8ddf\u5718\u968a\u4f7f\u7528\u5c31\u662f\u4e86 XD</p> <p>\u5de5\u5177\u4e0d\u6703\u8b93\u4f60\u5718\u968a\u6539\u5584, \u552f\u6709\u5718\u968a\u5177\u5099\u6539\u5584\u80fd\u529b, \u5de5\u5177\u624d\u80fd\u6539\u5584\u5718\u968a</p> <p>\u53ef\u80fd\u6709\u4eba\u6703\u60f3\u63a8\u6211\u7528\u77fd\u8c37\u771f\u9999\u7684 Notion\uff0c\u6211\u4e2d\u9593\u6709\u5169\u500b\u6708\u63db\u6210\u4f7f\u7528 Notion\uff0c\u4f46\u4f7f\u7528\u9ad4\u9a57\u76f8\u7576\u5dee\uff0c\u7db2\u9801\u958b\u555f\u53cd\u61c9\u592a\u6162\u3001\u6709\u9ede\u8907\u96dc\uff0c\u6700\u91cd\u8981\u662f\u4e0d\u80fd\u96e2\u7dda\uff0c\u6211\u5c31\u679c\u65b7\u63db\u56de Trello\uff0c\u53e6\u56e0\u81ea\u5df1\u7684\u7b46\u8a18\u5df2\u7d93\u6709\u53f0\u7063\u5718\u968a\u51fa\u54c1\u7684 HackMD \u53ca HappenApps \u51fa\u54c1\u7684 Quiver \u5728\u4f7f\u7528\uff0c\u6211\u5c31\u6c92\u6709\u6301\u7e8c\u4f7f\u7528 Notion \u7684\u7406\u7531\u4e86</p> <p>\u8a2d\u8a08\u4e0a\uff0c\u56e0\u70ba\u9019\u8077\u696d\u5c0d\u65bc\u6642\u9593\u76f8\u7576\u8981\u6c42\uff0c\u6240\u4ee5\u8996\u89ba\u5316\u767d\u677f\u8a2d\u8a08\u662f\u4ee5<code>\u6642\u9593</code>\u4f5c\u70ba\u5206\u9694\u9032\u884c\u6d41\u6c34\u7dda\u8a2d\u8a08\uff0c\u7bc4\u4f8b\u7db2\u5740\u5728\u6b64 Trello Template - \u5c0f\u98db\u6a5f\u7248\u8996\u89ba\u5316\u770b\u677f</p> <p></p> <p>\u6e05\u55ae\u5f9e\u5de6\u81f3\u53f3: 1. Backlog per month\uff1a\u672c\u6708\u6536\u5230\u7684\u4efb\u4f55\u4ee3\u8fa6\u4e8b\u9805\u6216\u8981\u6c42\u90fd\u5beb\u5728\u88e1\u9762 2. Todo per Week\uff1a\u9019\u9031\u8981\u8655\u7406\u7684\u5f85\u8fa6\u4e8b\u9805 3. Do it per Day\uff1a\u4eca\u5929\u8981\u8655\u7406\u7684\u5f85\u8fa6\u4e8b\u9805 4. Ready to go\uff1a\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805\uff0c\u4f46\u9084\u6c92\u57f7\u884c 5. Tracking\uff1a\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805\uff0c\u4f46\u9084\u6703\u6709\u5ef6\u4f38\u9700\u8655\u7406\u4e4b\u9805\u76ee 6. Done - Week 1\uff1a\u7b2c\u4e00\u9031\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805 7. Done - Week 2\uff1a\u7b2c\u4e8c\u9031\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805 8. Done - Week 3\uff1a\u7b2c\u4e09\u9031\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805 9. Done - Week 4\uff1a\u7b2c\u56db\u9031\u5df2\u8655\u7406\u5b8c\u7684\u4e8b\u9805 10. Discard\uff1a\u653e\u68c4\u8655\u7406\u7684\u5f85\u8fa6\u4e8b\u9805</p> <p>\u95dc\u65bc\u5361\u7247\u6392\u5e8f\u65b9\u5f0f\uff0c\u63a1\u7528\u827e\u68ee\u8c6a\u77e9\u9663 (Eisenhower Matrix) \u65b9\u5f0f\uff0c\u6642\u9593\u5148\u6c7a\uff0c\u6545\u512a\u5148\u8655\u7406\u9806\u5e8f\u7531\u4e0a\u81f3\u4e0b\uff1a</p> <p></p> <ol> <li>\u7dca\u6025\u4e14\u91cd\u8981 (Urgent, Important)\uff1a\u4e00\u5b9a\u6703\u5217\u5728\u4e0a\u53bb\u767d\u677f\u4e0a\uff0c\u7576\u524d\u512a\u5148\u8655\u7406\u9806\u5e8f\u6700\u9ad8</li> <li>\u7dca\u6025\u4f46\u4e0d\u91cd\u8981(Urgent, Not Important)\uff1a\u4e00\u5b9a\u6703\u5217\u4e0a\u53bb\u767d\u677f\u4e0a</li> <li>\u4e0d\u6025\u4f46\u91cd\u8981 (Not Urgent, Important)\uff1a\u4e00\u5b9a\u6703\u5217\u4e0a\u53bb\u767d\u677f\u4e0a\uff0c\u7576\u524d\u512a\u5148\u8655\u7406\u9806\u5e8f\u6700\u4f4e</li> <li>\u4e0d\u6025\u4f46\u4e0d\u91cd\u8981 (Not Urgent, Not important)\uff1a\u4e0d\u5217\uff0c\u9760\u7de3\u5206</li> </ol> <p>\u81f3\u65bc\u5361\u7247\u5167\u5bb9\u7684\u64b0\u5beb\u65b9\u5f0f\u5247\u70ba</p> <ul> <li>\u62ac\u982d (Title)\uff1a\u4e00\u5b9a\u662f <code>\u57f7\u884c\u5c0d\u8c61</code> \u548c <code>\u8981\u5e79\u9ebb</code> \u4e0d\u6703\u6709\u5176\u4ed6\u591a\u9918\u7684\u63cf\u8ff0</li> <li>\u622a\u6b62\u65e5\u671f (Due Date)\uff1a\u8981\u5f9e Backlog \u88e1\u9762\u62c9\u51fa\u4f86\uff0c\u4e00\u5b9a\u8981\u4e0a\u622a\u6b62\u6642\u9593</li> <li>\u63cf\u8ff0 (Description)\uff1a\u7522\u51fa\u7269\uff0c\u53ef\u4ee5\u662f\u7c21\u5831\u7db2\u5740\u3001\u7db2\u5740\u3001\u6587\u5b57\u7d50\u8ad6</li> <li>\u5f85\u8fa6\u6e05\u55ae (CheckList)\uff1a\u770b\u8907\u96dc\u5ea6\uff0c\u6709\u6642\u5019\u6703\u7528</li> <li>\u8a55\u8ad6 (Comment)\uff1a\u4ea4\u8ac7\u5f8c\u96a8\u624b\u7b46\u8a18\u6216\u8005\u662f\u96dc\u8cc7\u6599\u90fd\u53ef\u4ee5\u5f80\u88e1\u9762\u585e</li> </ul> <p>\u800c\u6a19\u7c64 (Label) \u6211\u5c31\u6bd4\u8f03\u5c11\u7528\u4e86\uff0c\u6c92\u7279\u5225\u60f3\u5230\u600e\u9ebc\u7528\uff0c\u800c\u514d\u8cbb\u7248\u7684 Trello \u53ef\u4ee5\u9078\u4e00\u500b <code>Power Ups</code> \u4f7f\u7528\uff0c\u9019\u908a\u662f\u7528 <code>Custom Fields</code>\uff0c\u53ef\u4ee5\u81ea\u5df1\u52a0\u6b04\u4f4d</p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#_4","title":"\u9577\u671f\u4f7f\u7528\u4e0b\u4f86\u7684\u7f3a\u9ede?","text":"<p>\u6211\u9019\u500b\u8a2d\u8a08\u4f7f\u7528\u5927\u6982\u4e09\u5e74\u591a\u4e86\uff0c\u7576\u4e2d\u7684\u7f3a\u9ede\u5176\u5be6\u4e5f\u883b\u660e\u986f\u7684\uff0c\u524d 3 \u6709\u611f\u5982\u4e0b\uff1a</p> <ul> <li>\u5c0d\u65bc\u81ea\u8eab\u7684\u5de5\u4f5c\u91cf\u7121\u6cd5\u4ee5\u6578\u5b57\u91cf\u5316\uff0c\u6240\u4ee5\u5de5\u4f5c\u751f\u6d3b\u5e73\u8861 (Work\u2013life balance) \u5947\u5dee\u7121\u6bd4 XD</li> <li>\u50c5\u80fd\u55ae\u4eba\u4f7f\u7528\uff0c\u53ea\u6709\u6211\u81ea\u5df1\u770b\u5f97\u61c2\u5728\u5e79\u561b</li> <li>\u4e0d\u9069\u5408\u7528\u5728\u8dd1\u4e00\u500b\u4e2d\u9577\u671f\u5c08\u6848\uff0c\u6216\u9700\u8981\u5b9a\u671f\u8fed\u4ee3\u4ea4\u4ed8\u6771\u897f\u7684\u4e8b\u60c5\uff0c\u6211\u7684\u7406\u89e3\u662f\u6539\u8d70 Scrum \u5be6\u8e10\u6bd4\u8f03\u9069\u5408\uff0c\u7562\u7adf\u9700\u8981\u8ddf\u5176\u4ed6\u4eba\u5354\u4f5c</li> </ul> <p>\u96d6\u7136\u6211\u77e5\u9053\u6709\u9019\u4e9b\u7f3a\u9ede\uff0c\u4f46\u9019\u500b\u81ea\u6211\u8a2d\u8a08\u53ef\u4ee5\u641e\u5b9a\u6211\u5c07\u8fd1\u516b\u4e5d\u6210\u4ee5\u4e0a\u7684\u5de5\u4f5c\u578b\u614b\uff0c\u6211\u5c31\u61f6\u5f97\u505a\u6210 100% \u7684\u6a23\u5b50</p> <p>\u4f46\u5982\u679c\u5718\u968a\u8981\u4e00\u8d77\u653e\u5728\u540c\u4e00\u500b\u677f\u4e0a\u7ba1\u7406\u7684\u8a71\uff0c\u9084\u662f\u5148\u5f9e Agile \u6700\u4f73\u5be6\u8e10\u4e2d\uff0c\u5148\u884c\u9078\u51fa\u53ef\u884c\u7684\u505a\u6cd5\u5f8c\uff0c\u96a8\u8457\u57f7\u884c\u6642\u9593\u8d8a\u4e45\uff0c\u6162\u6162\u5730\u6dec\u7149\u51fa\u81ea\u5bb6\u5718\u968a\u7684\u8d70\u6cd5\u662f\u6bd4\u8f03\u6709\u898f\u7ae0\u7684\u4f5c\u6cd5</p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#red-hat","title":"Red Hat \u958b\u6e90\u654f\u6377\u8edf\u9ad4\u5c08\u6848\u7d93\u9a57\u5206\u4eab?","text":"<p>\u4ee5\u4e0b\u90fd\u6709\u516c\u958b\u7684\u8cc7\u8a0a\u53ef\u4ee5\u88ab Google \u5230\uff0c\u53ea\u662f\u8981\u77e5\u9053\u95dc\u9375\u5b57\u800c\u5df2 XD</p> <p>\u5de5\u5177\u9078\u64c7\u4e0a\uff0c\u76ee\u524d\u5e38\u898b\u8d70 Kanban \u6216\u985e\u4f3c\u770b\u677f (\u6975\u96e3\u5728\u5ee3\u5927\u793e\u7fa4\u5c08\u6848\u4e0a WIP = =) \u7684\u4f5c\u6cd5\uff0c\u6211\u770b\u5230\u7684\u90fd\u662f\u653e\u5728 Trello \u6bd4\u8f03\u591a\uff0c\u800c\u8dd1 Scrum \u7684\u65b9\u5f0f\u5247\u662f\u8dd1\u5728 Jira \u8edf\u9ad4\u70ba\u4e3b\u7684\u4f5c\u6cd5\u5c45\u591a\uff0c\u5c11\u6578\u8dd1 Kanban \u4e5f\u6703\u653e\u5728 Jira \u4e0a\u57f7\u884c\u5c31\u662f\u4e86</p> <p>\u654f\u6377\u65b9\u6cd5\u9078\u64c7\u4e0a\uff0cRed Hat \u8edf\u9ad4\u5c08\u6848\u7ba1\u7406\u7121\u8ad6\u662f\u4e0a\u4e2d\u4e0b\u6e38\u5927\u591a\u6578\u90fd\u662f <code>Scrum</code> \u5c45\u591a\uff0c\u6211\u7684\u89c0\u5bdf\u662f\u883b\u6a19\u6e96\u7684 Scrum \u8dd1\u6cd5\uff0c\u81f3\u65bc\u8207 Kanban \u5dee\u7570\u53ef\u4ee5\u770b\u770b Kanban board \u548c Scrum Board \u4e0d\u540c\u4e4b\u8655 - David Ko</p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#_5","title":"\u7d50\u8a9e","text":"<p>\u773e\u91cc\u5c0b\u4ed6\u5343\u767e\u5ea6\uff0c\u9a40\u7136\u56de\u9996\uff0c\u90a3\u59b9\u537b\u5728\u71c8\u706b\u95cc\u73ca\u8655</p> <p>\u5c0d\uff0c\u6c92\u932f\uff0c\u6211\u5c31\u662f\u6c92\u6709\u9075\u7167\u6700\u4f73\u5be6\u8e10\uff0c\u4f46\u5f04\u51fa\u4e00\u5957\u81ea\u5df1\u904b\u884c\u7684\u5f88\u958b\u5fc3\u7684\u6a21\u5f0f\uff0c\u5de5\u5177\u5728\u624b\uff0c\u63ee\u7051\u5728\u6211\u3002\u6211\u500b\u4eba\u4e26\u4e0d\u662f\u5f85\u5728\u8edf\u9ad4\u958b\u767c\u5718\u968a\uff0c\u800c\u662f\u696d\u52d9\u5718\u968a\uff0c\u6240\u4ee5\u4f7f\u7528\u654f\u6377\u65b9\u5f0f\u6703\u6709\u5225\u65bc\u73fe\u5728\u5927\u591a\u4e3b\u6d41\u8edf\u9ad4\u958b\u767c\u7684\u8a0e\u8ad6\u60c5\u5883\uff0c\u5404\u4f4d\u5728\u601d\u8003\u7684\u6642\u5019\u8981\u7559\u610f\u4e00\u4e0b</p>","tags":["agile","personal"]},{"location":"20200401-personal-agile.html#references","title":"References","text":"<ul> <li>\u539f\u4f86\u6211\u4ee5\u70ba\u7684\u770b\u677f\u6839\u672c\u4e0d\u662f\u770b\u677f\u2026 - Oberon Lai</li> <li>\u904b\u7528\u500b\u4eba\u770b\u677f\u505a\u6642\u9593\u7ba1\u7406 - Ruddy</li> <li>Trello \u548c\u770b\u677f\u65b9\u6cd5\u7684\u95dc\u4fc2\u662f? - David Ko</li> <li>\u8996\u89ba\u5316\u767d\u677f, Proto-Kanban, Kanban \u50bb\u50bb\u5206\u4e0d\u6e05\u695a? - David Ko</li> <li>DavidKo Learning Journey</li> <li>\u770b\u677f\u65b9\u6cd5\u4ecb\u7d39\uff088\uff09\uff1a\u9020\u7269\u5c31\u662f\u9020\u4eba - Teddy</li> <li>Kanban: Successful Evolutionary Change for Your Technology Business (English)</li> <li>[\u5de5\u4f5c\u6548\u7387] \u6c7a\u7b56\u65b9\u6cd5: \u827e\u68ee\u8c6a\u77e9\u9663(Eisenhower Matrix)</li> <li>Trello Template - \u5c0f\u98db\u6a5f\u7248\u8996\u89ba\u5316\u770b\u677f</li> <li>Kanban board \u548c Scrum Board \u4e0d\u540c\u4e4b\u8655 - David Ko</li> </ul>","tags":["agile","personal"]},{"location":"20200403-openshift-with-coreos-part-2.html","title":"\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 2","text":"<p>\u4e0a\u500b\u6708\u5beb\u4e86\u4e00\u7bc7\u611b\u7684\u8d70\u99ac\u770b\u82b1 \u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 1\uff0c\u7e7c\u7e8c\u901b\u4e0b\u53bb</p> <p>\u7b2c\u4e8c\u5929\u6bd4\u8f03\u504f\u5411\u662f Red Hat OpenShift Infrastrcuture \u9664\u932f\u5c64\u9762\u7684\u9592\u901b\uff0c\u6709\u4e9b Kubernetes \u61c9\u8a72\u662f\u4e0d\u80fd\u76f4\u63a5\u5957\u7528\u7684\uff0c\u8b6c\u5982\u50cf\u662f <code>oc adm</code>\u3001<code>oc debug</code> \u9019\u985e\u7684\u6307\u4ee4\uff0c\u4f46\u662f\u6211\u8a18\u5f97\u65b0\u7248\u7684 Kubernetes \u597d\u50cf\u6709 <code>kubectl debug</code> \u7684\u6307\u4ee4\u53ef\u4ee5\u7528\u4e86\uff0c\u4f46\u4e0d\u77e5\u9053\u6548\u679c\u662f\u4e0d\u662f\u4e00\u6a23\u7684</p> <p>\u53e6\u5916\u958b\u982d\u6211\u6c92\u6897\u5716\u4e86\uff0c\u6545\u9644\u4e0a\u4e00\u500b\u6211\u89ba\u5f97\u883b\u4e0d\u932f\u7684\u5f71\u7247 Deploying a Windows Server 2019 virtual machine using OpenShift Virtualization</p> <p>{% youtube Kx110kqoHo0 %}</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u4e8c\u5929","text":"","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#openshift-log","title":"\u900f\u904e OpenShift \u986f\u793a\u5404\u7bc0\u9ede\u4e0a\u7684\u7279\u5b9a\u670d\u52d9 Log","text":"<p>Red Hat OpenShift 4 \u4e4b\u5f8c\u7684\u670d\u52d9\uff0c\u653e\u5728 Red Hat CoreOS (\u5f8c\u9762\u7c21\u7a31 RHCOS) \u88e1\u9762\u904b\u884c\u7684\u670d\u52d9\uff0c\u7d55\u5927\u90e8\u5206\u90fd\u662f\u90fd\u662f\u4ee5\u5bb9\u5668 (Container) \u7684\u65b9\u5f0f\u904b\u884c\uff0c\u4f46\u9084\u662f\u6709 18 \u500b\u670d\u52d9\u662f\u900f\u904e <code>systemd</code> \u904b\u884c\u7684\uff0c\u4e0b\u9762\u5217\u8209\u670d\u52d9\u4e14\u6a19\u6ce8\u5c0d\u7dad\u904b\u4e0a\u6bd4\u8f03\u91cd\u8981\u7684\u670d\u52d9</p> <pre><code>$ oc debug node/compute-0\nStarting pod/compute-0-debug ...\nTo use host binaries, run `chroot /host`\n\nPod IP: 10.0.97.4\nIf you don't see a command prompt, try pressing enter.\nsh-4.2# chroot /host\nsh-4.4# systemctl list-units --type=service --state=running\n\nUNIT                     LOAD   ACTIVE SUB     DESCRIPTION\nauditd.service           loaded active running Security Auditing Service\nchronyd.service          loaded active running NTP client/server\ncrio.service             loaded active running Open Container Initiative Daemon\ndbus.service             loaded active running D-Bus System Message Bus\ngetty@tty1.service       loaded active running Getty on tty1\nirqbalance.service       loaded active running irqbalance daemon\nkubelet.service          loaded active running Kubernetes Kubelet\nNetworkManager.service   loaded active running Network Manager\npolkit.service           loaded active running Authorization Manager\nrpc-statd.service        loaded active running NFS status monitor for NFSv2/3 locking.\nrpcbind.service          loaded active running RPC Bind\nsshd.service             loaded active running OpenSSH server daemon\nsssd.service             loaded active running System Security Services Daemon\nsystemd-journald.service loaded active running Journal Service\nsystemd-logind.service   loaded active running Login Service\nsystemd-udevd.service    loaded active running udev Kernel Device Manager\nvgauthd.service          loaded active running VGAuth Service for open-vm-tools\nvmtoolsd.service         loaded active running Service for virtual machines hosted on VMware\n\nLOAD   = Reflects whether the unit definition was properly loaded.\nACTIVE = The high-level unit activation state, i.e. generalization of SUB.\nSUB    = The low-level unit activation state, values depend on unit type.\n\n18 loaded units listed. Pass --all to see loaded but inactive units, too.\nTo show all installed unit files use 'systemctl list-unit-files'.\n</code></pre> <p>\u9019\u908a\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u56e0\u70ba RHCOS \u5167\u5efa\u9084\u662f\u6709 <code>systemd-journald</code>\uff0c\u6240\u4ee5\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528 <code>oc debug</code> \u9023\u9032\u53bb\u7bc0\u9ede\u5f8c\uff0c\u4e0b <code>journalctl</code> \u9032\u884c\u89c0\u5bdf Log \u7684\u884c\u70ba\uff0c\u4f46...\u53ea\u662f\u8981\u770b\u500b Log \u9019\u4e9b\u6b65\u9a5f\u592a\u9ebb\u7169\u4e86\uff0c\u6240\u4ee5 OpenShift \u6709\u6574\u4e86\u4e00\u500b\u6307\u4ee4\u53eb\u505a <code>oc adm node-logs</code></p> <p>\u6240\u4ee5\u770b Log \u53ef\u4ee5\u9019\u6a23\u7528</p> <pre><code># Example:\n# oc adm node-logs -u &lt;service&gt; &lt;node-ip&gt;\n# oc adm node-logs &lt;node-ip&gt; &lt;log-name&gt; --path=kube-apiserver/&lt;log-name&gt;\n\n# Show sshd logs from specific node\n$ oc adm node-logs -u sshd compute-0\n\n# Show crio logs from all master nodes\n$ oc adm node-logs -u crio --role master\n\n# Show ALL logs from specific node\n$ oc adm node-logs compute-0\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#pod","title":"\u61c9\u7528\u7a0b\u5f0f\u4e4b Pod \u6545\u969c\u6392\u9664","text":"<p>\u6709\u6642\u5019\u904b\u884c\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u4f46\u555f\u52d5\u5931\u6557 (Failing)\uff0c\u800c\u4e14\u5bb9\u5668\u4e5f\u88ab\u7d42\u6b62\u6389 (Terminating)\uff0c\u4f9d\u64da <code>Pod Restart Policy</code> \u6703\u5617\u8a66\u7e7c\u7e8c\u91cd\u65b0\u555f\u52d5\u3002\u5982\u679c\u9019\u7a2e\u72c0\u6cc1\u4e00\u76f4\u6301\u7e8c\u767c\u751f\u7684\u8a71\uff0c\u5247\u90e8\u7f72\u5247\u70ba\u5931\u6557\u7684\u3002OpenShift \u6703\u5c07 Pod \u7684\u72c0\u614b (Status) \u6703\u6a19\u8a3b\u70ba <code>CrashLoopBackOff</code> \u4f86\u8868\u793a</p> <p>\u800c\u70ba\u4e86\u61c9\u5c0d\u9019\u7a2e\u9700\u8981\u6df1\u5165\u9032\u53bb\u4e86\u89e3\u70ba\u4ec0\u9ebc\u6703\u7522\u751f <code>CrashLoopBackOff</code> \u7684\u539f\u56e0\uff0c\u6240\u4ee5 OpenShift \u65bc 3.x \u7248\u7684\u6642\u5019\u5c31\u652f\u63f4\u4e86\u4e00\u500b\u8d85\u597d\u7528\u7684\u6307\u4ee4 <code>oc debug</code>\uff0c\u900f\u904e\u8a72\u6307\u4ee4\uff0c\u8907\u88fd (Clone) \u51fa\u4e00\u500b Pod \u51fa\u4f86\u5f8c\uff0c\u5247\u6703\u81ea\u52d5\u8986\u84cb\u4e00\u500b Shell \u9032\u53bb\u7576\u4f5c\u9032\u5165\u9ede (Entrypoint)</p> <pre><code>$ oc get pods\n\nNAME               READY     STATUS      RESTARTS   AGE\nwelcome-1-deploy   0/1       Completed   0          1m\nwelcome-1-hh7h8    1/1       Running     0          0s\n\n$ oc get dc\nNAME        REVISION    DESIRED     CURRNET     TRIGGERED BY\nwelcome     1           1           1           config,image(welcome:latest)\n\n# Debug a pod\n$ oc debug pod/welcome-1-hh7h8\n\n# See the pod that would be created to debug\n$ oc debug pod/welcome-1-hh7h8 -o yaml\n\n# Debug a currently running deployment by creating a new pod\n$ oc debug dc/welcome\n$ oc debug dc/welcome --as-root\n$ oc debug dc/welcome --as-user=10000\n</code></pre> <p>\u8981\u7559\u610f\u7684\u4e8b\u60c5\u662f\uff0c\u5728\u9019\u500b Debug \u72c0\u614b\u7684 Pod \u64cd\u4f5c\u6703\u6709\u4ee5\u4e0b\u7684\u9650\u5236\u60c5\u6cc1\u767c\u751f</p> <ul> <li>\u7121\u6cd5\u900f\u904e\u670d\u52d9\u540d\u7a31\u5f9e\u4efb\u4f55 Pod \u9023\u63a5\u5230\u88e1\u9762</li> <li>\u7121\u6cd5 <code>oc expose route</code> \u51fa\u53bb</li> <li>Readiness / Liveness probe \u7121\u6cd5\u6b63\u5e38\u4f7f\u7528</li> </ul>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#dns-dns-operator","title":"\u5167\u90e8\u670d\u52d9 DNS \u89e3\u6790 - DNS Operator","text":"<p>\u7bc0\u9304\u6b64 OpenShift 4.3 - DNS Operator in OpenShift Container Platform \u5167\u5bb9\uff0c\u9810\u8a2d OpenShift 4 \u7684\u5167\u90e8 DNS \u662f\u63a1\u7528 <code>CoreDNS</code>\uff0c\u5b89\u88dd\u662f\u900f\u904e Operator Framework \u9032\u884c\u7dad\u904b\u4f7f\u7528</p> <pre><code># Every new OpenShift Container Platform installation has a \"dns.operator\" named \"default\".\n$ oc describe dns.operator/default\n\nName: default\n...\nAPI Version:  operator.openshift.io/v1\nKind:         DNS\n...\nSpec:\nStatus:\n  Cluster Domain:  cluster.local\n  Cluster IP:      172.30.0.10\n...\n</code></pre> <p>CoreDNS \u4e3b\u8981\u8655\u7406 OpenShift \u5167\u90e8\u670d\u52d9\u7684\u540d\u7a31\u89e3\u6790\uff0c\u5305\u542b\u4ee5\u4e0b 4 \u985e:</p> <ol> <li>cluster.local</li> <li><code>&lt;project&gt;</code>.cluster.local</li> <li><code>&lt;service&gt;</code>.<code>&lt;project&gt;</code>.cluster.local</li> <li><code>&lt;pod&gt;</code>.<code>&lt;project&gt;</code>.cluster.local</li> </ol>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#-cluster-network-operator","title":"\u4e86\u89e3\u7576\u4e0b\u7db2\u8def\u8cc7\u8a0a - Cluster Network Operator","text":"<p>\u901a\u5e38\u4f86\u8aaa\uff0c\u5efa\u7acb OpenShift \u9700\u8981\u4e09\u6bb5\u7db2\u6bb5\uff0c\u800c\u6240\u6709 IP \u7db2\u6bb5\u90fd\u4e0d\u80fd\u91cd\u8907\uff0c\u5206\u5225\u662f\u4e0b\u5217:</p> <ol> <li>Node Subnet\uff1a\u7d66\u5be6\u9ad4\u4e3b\u6a5f\u7528\u7684 IP</li> <li>Service Subnet\uff1a\u7d66 Kubernetes Service \u4f7f\u7528\u7684 IP\uff0c\u5c0d\u7167\u8a2d\u5b9a\u6a94\u540d\u5b57\u70ba <code>serviceNetwork</code></li> <li>Pod Subnet\uff1aPod \u5be6\u969b\u4e0a\u6703\u62ff\u5230\u7684 IP\uff0c\u5c0d\u7167\u8a2d\u5b9a\u6a94\u540d\u5b57\u70ba <code>clusterNetwork</code></li> </ol> <p>\u5982\u679c\u60f3\u8981\u78ba\u8a8d\u7576\u524d\u7684\u7db2\u8def\u8a2d\u5b9a\u8cc7\u8a0a\uff0c\u53ef\u4ee5\u53c3\u8003\u4e0b\u9762\u4f5c\u6cd5</p> <pre><code>$ oc get Network.config.openshift.io cluster -oyaml\n\napiVersion: config.openshift.io/v1\nkind: Network\n...\nspec:\n  clusterNetwork:\n  - cidr: 10.128.0.0/14\n    hostPrefix: 23\n  externalIP:\n    policy: {}\n  networkType: OpenshiftSDN\n  serviceNetwork:\n  - 172.30.0.0/16\n...\n</code></pre> <p>\u6309\u7167\u4e0a\u8ff0\u8f38\u51fa\uff0c\u53ef\u4ee5\u4e86\u89e3\u5230\u4ee5\u4e0b\u5e7e\u4ef6\u4e8b 1. clusterNetwork \u4e5f\u5c31\u662f Pod \u5be6\u969b\u4e0a\u80fd\u4f7f\u7528\u7684 IP \u70ba 10.128.0.0/14\uff0c\u5171 <code>262142</code> \u500b Pod IP 2. networkType \u4e5f\u5c31\u662f CNI Plugin \u7684\u540d\u7a31\uff0c\u9019\u908a\u662f\u4f7f\u7528\u539f\u751f\u7684 <code>OpenShift SDN</code> 3. serviceNetwork \u4e5f\u5c31\u662f Kubernetes Service \u53ef\u4ee5\u4f7f\u7528\u7684 IP \u70ba 172.30.0.0/16\uff0c\u5171\u53ef\u4ee5\u958b\u555f <code>65534</code> \u500b Service IP 4. hostPrefix \u6bd4\u8f03\u96e3\u7406\u89e3\uff0c\u4e3b\u8981\u662f\u4ee3\u8868<code>\u6bcf\u4e00\u500b\u7bc0\u9ede (Node) \u6240\u80fd\u62ff\u5230\u7684 Pod IP \u70ba\u591a\u5c11</code>\uff0c\u4f8b\u5982\u9019\u908a\u662f <code>/23</code>\uff0c\u6240\u4ee5\u6bcf\u500b\u7bc0\u9ede\u53ef\u4ee5\u904b\u884c <code>510</code> \u500b Pod IP \u7684 Pod\uff0c\u82e5\u6539\u6210 <code>/22</code>\uff0c\u5247\u6bcf\u500b\u7bc0\u9ede\u53ef\u904b\u884c\u7d04 <code>1000</code> \u5de6\u53f3\u7684 Pod\u3002\u6709\u4e9b\u4eba\u6703\u554f\u5920\u4e0d\u5920\u7528\uff0c\u5176\u5be6\u5c31\u9810\u8a2d OpenShift 4.3 - Recommended host practices \u4e0a\uff0c\u4e00\u500b\u7bc0\u9ede\u7684\u4e0a\u9650\u662f\u8dd1 <code>kubeletConfig.maxPods: 250</code>\uff0c\u6700\u9ad8 250\uff0c\u6240\u4ee5\u649e\u4e0d\u5230\u5929\u82b1\u677f</p> <p>\u540c\u4e00\u6642\u9593\u4e5f\u53ef\u4ee5\u900f\u904e <code>oc get hostsubnet</code> \u7372\u5f97\u6bcf\u4e00\u500b\u7bc0\u9ede\u6240\u4f7f\u7528\u5230\u7684\u7db2\u6bb5</p> <pre><code>$ oc get hostsubnet\nNAME              HOST              HOST IP     SUBNET          EGRESS CIDRS   EGRESS IPS\ncompute-0         compute-0         10.0.97.4   10.131.0.0/23\ncompute-1         compute-1         10.0.97.5   10.128.2.0/23\ncontrol-plane-0   control-plane-0   10.0.97.1   10.129.0.0/23\ncontrol-plane-1   control-plane-1   10.0.97.2   10.128.0.0/23\ncontrol-plane-2   control-plane-2   10.0.97.3   10.130.0.0/23\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#_2","title":"\u7d50\u8a9e","text":"<p>\u6211\u77e5\u9053\u5beb\u7684\u883b\u4e82\u7684\uff0c\u5c31\u7576\u7b46\u8a18\u908a\u7814\u7a76\u908a\u7d00\u9304</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200403-openshift-with-coreos-part-2.html#references","title":"References","text":"<ul> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 1</li> <li>How do I debug an application that fails to start up?</li> <li>Configuring how pods behave after restart</li> <li>DNS Operator in OpenShift Container Platform</li> <li>OpenShift 4.3 - Recommended host practices</li> </ul>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html","title":"\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 3","text":"<p>\u627f\u8972\u611b\u7684\u8d70\u99ac\u770b\u82b1\u7cfb\u5217\u7684\u4e82\u5beb\u4e82\u7d00\u9304\u512a\u826f\u50b3\u7d71\uff0c\u7e7c\u7e8c\u8a18\u9304\u64cd\u4f5c\uff0c\u6709\u8208\u8da3\u60f3\u8981\u770b\u524d\u9762\u7684\u6587\u7ae0\u53ef\u4ee5\u53c3\u8003\u9019\u5169\u908a</p> <ul> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 1 - Phil Huang</li> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 2 - Phil Huang</li> </ul> <p>\u7b2c\u4e09\u5929\u8981\u4f86\u64cd\u4f5c\u7684\u662f 1. \u5be6\u88dd Kubernetes NFS-Client Provisioner 2. \u5347\u7d1a OpenShift 4.y.z 3. \u6b63\u78ba\u532f\u51fa YAML \u65b9\u5f0f</p> <p>\u53e6\u5916\u6211\u4f9d\u7136\u6c92\u6897\u5716\uff0c\u6240\u4ee5\u958b\u5834 Po \u500b\u5f71\u7247 <code>Installing OpenShift to Red Hat Virtualization using full-stack automation</code>\uff0c\u73fe\u5728 <code>libvirt</code> \u9ad4\u7cfb\u5e73\u53f0\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>node scaling</code> \u7684\u80fd\u529b\u4e86\uff0c\u5f71\u7247\u4e09\u5206\u9418\uff0cOpenShift 4.4 \u4e4b\u5f8c\u5c31\u6703\u958b\u59cb\u652f\u63f4\u4e86</p> <p>{% youtube uFypQRWEKqo %}</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u4e09\u5929","text":"","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#kubernetes-nfs-client-provisioner","title":"\u5be6\u88dd Kubernetes NFS-Client Provisioner","text":"<p>\u6211\u5011\u5c07\u5229\u7528\u5df2\u7d93\u6e96\u5099\u597d\u7684 NFS Server \u7d66 OpenShift \u4f5c\u70ba\u6301\u4e45\u5132\u5b58 (Persistent Storage) \u7684\u5f8c\u7aef\uff0c\u4e26\u4e14\u63d0\u4f9b<code>\u52d5\u614b\u6301\u4e45\u5132\u5b58 (Dynamic PV)</code> \u7684\u80fd\u529b\uff0c\u5982\u679c\u4e0d\u662f\u5f88\u6e05\u695a Dynamic PV \u7684\u6982\u5ff5\uff0c\u53ef\u4ee5\u53c3\u8003\u4ee5\u524d\u5beb\u7684\u6295\u5f71\u7247 20190218_OpenShift Storage \u67b6\u69cb\u601d\u8003 - Phil Huang - p10</p> <p>\u9019\u908a\u6211\u5df2\u7d93\u6e96\u5099\u597d\u7531 <code>Synology DS916+</code> \u63d0\u4f9b\u7684 NFS Server\uff0c\u4f60\u4e5f\u53ef\u4ee5\u7528 RHEL \u5b89\u88dd\u597d NFS \u7684\u670d\u52d9\u4f86\u4f5c\u66ff\u4ee3\uff0c\u8cc7\u8a0a\u5982\u4e0b\uff1a</p> <ol> <li>NFS Server FQDN: <code>farm.pichuang.local</code></li> <li>Shared Directory: <code>/volume1/ocp_nfs</code></li> </ol> <p>\u9019\u908a\u56e0\u70ba\u53ea\u662f\u7c21\u55ae\u6e2c\u8a66\u628a <code>NFS-Client Provisioner</code> \u76f8\u95dc\u7684\u9a45\u52d5\u7a0b\u5f0f\u653e\u5728 Project <code>default</code>\uff0c\u7576\u7136\u6bd4\u8f03\u597d\u7684\u8a2d\u8a08\u662f\u53e6\u5916\u958b\u4e00\u500b Project \u4f5c\u70ba\u653e\u7f6e\u9a45\u52d5\u7684\u96c6\u6563\u5730\uff0c\u53ea\u662f\u8981\u7559\u610f RBAC \u8981\u53e6\u5916\u505a\u4fee\u6539</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#_2","title":"\u6e96\u5099\u968e\u6bb5","text":"<p><code>``bash bastion.ocp4.internal $ git clone https://github.com/kubernetes-incubator/external-storage $ cd ./external-storage/nfs-client $ NAMESPACE=</code>default` # By default, nfs-client provisioner will install in project default $ sed -i'' \"s/namespace:.*/namespace: $NAMESPACE/g\" ./deploy/rbac.yaml $ oc create -f deploy/rbac.yaml $ oc adm policy add-scc-to-user hostmount-anyuid system:serviceaccount:$NAMESPACE:nfs-client-provisioner <pre><code>#### \u90e8\u7f72 Deployment\n\n```yaml deploy/deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nfs-client-provisioner\n  labels:\n    app: nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          # In diconnected environment, please pull the image before installing\n          image: quay.io/external_storage/nfs-client-provisioner:latest\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: fuseim.pri/ifs\n            # Replace NFS Server and PATH\n            - name: NFS_SERVER\n              value: farm.pichuang.local\n            - name: NFS_PATH\n              value: /volume1/ocp_nfs\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            # Replace NFS Server and PATH\n            server: farm.pichuang.local\n            path: /volume1/ocp_nfs\n</code></pre></p> <p>\u9019\u908a\u63d0\u4f9b <code>git diff</code> \u7684\u5dee\u7570\uff0c\u6bd4\u8f03\u80fd\u4e86\u89e3\u9700\u8981\u4fee\u6539\u7684\u5730\u65b9 </p> <p>```bash bastion.ocp4.internal $ oc create -f deploy/deployment.yaml deployment.apps/nfs-client-provisioner created</p> <p>$ oc get pod NAME                                      READY   STATUS    RESTARTS   AGE nfs-client-provisioner-7df5d4f459-4lrnx   1/1     Running   0          73m <pre><code>#### \u90e8\u7f72 StorageClass\n\n```yaml deploy/class.yaml\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: managed-nfs-storage # or choose another name, the name will be applied by Dynamic PV\nprovisioner: fuseim.pri/ifs # or choose another name, must match deployment's env PROVISIONER_NAME'\nparameters:\n  archiveOnDelete: \"false\"\n</code></pre></p> <p>```bash bastion.ocp4.internal $ oc create -f deploy/class.yaml storageclass.storage.k8s.io/managed-nfs-storage created <pre><code>#### \u9a57\u8b49 Dynamic PV \u80fd\u529b\n\n```bash\n#\n# Pre Check\n#\n$ oc get pv,pvc\nNo resources found in default namespace.\n\n#\n# Create PVC\n#\n$ cat deploy/test-claim.yaml\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: test-claim\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"managed-nfs-storage\"\nspec:\n  accessModes:\n    - ReadWriteMany\n  resources:\n    requests:\n      storage: 1Mi\n\n$ oc create -f deploy/test-claim.yaml\npersistentvolumeclaim/test-claim created\n\n#\n# Create Pod\n#\n# Goal:\n# 1. Tocuh a new file - SUCCESS in /mnt\n# 2. Mount pv - nfs-pvc\n#\n$ cat deploy/test-pod.yaml\nkind: Pod\napiVersion: v1\nmetadata:\n  name: test-pod\nspec:\n  containers:\n  - name: test-pod\n    image: gcr.io/google_containers/busybox:1.24\n    command:\n      - \"/bin/sh\"\n    args:\n      - \"-c\"\n      - \"touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1\"\n    volumeMounts:\n      - name: nfs-pvc\n        mountPath: \"/mnt\"\n  restartPolicy: \"Never\"\n  volumes:\n    - name: nfs-pvc\n      persistentVolumeClaim:\n        claimName: test-claim\n\n$ oc create -f deploy/test-pod.yaml\npod/test-pod created\n\n#\n# Post Check\n#\n$ oc get pv,pvc\nNAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                STORAGECLASS          REASON   AGE\npersistentvolume/pvc-719adae1-8fa4-4058-ae48-d9da1c5e7873   1Mi        RWX            Delete           Bound    default/test-claim   managed-nfs-storage            3m6s\n\nNAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS          AGE\npersistentvolumeclaim/test-claim   Bound    pvc-719adae1-8fa4-4058-ae48-d9da1c5e7873   1Mi        RWX            managed-nfs-storage   3m6s\n</code></pre></p> <p>\u5982\u679c\u9019\u6642\u5019\u5207\u5230 NFS \u7684\u76ee\u9304\u88e1\u9762\u7684\u8a71\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u8a72\u6a94\u6848\u4e86</p> <p></p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#openshift-4yz","title":"\u5347\u7d1a OpenShift 4.y.z","text":"","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#cluster-version-operator-cvo","title":"Cluster Version Operator, CVO","text":"<p>\u73fe\u5728 OpenShift 4 \u7684\u5347\u7d1a\u5df2\u7d93\u662f\u6539\u7531\u4ee5 Operator Framework \u70ba\u57fa\u790e\u5be6\u4f5c <code>Cluster Version Operator</code> \u51fa\u4f86\uff0c\u4e3b\u8981\u80fd\u529b\u5c31\u662f\u63d0\u4f9bOpenShift \u7dda\u4e0a\u66f4\u65b0\u6a5f\u5236 (Over The Air, OTA)\uff0c</p> <p></p> <p>\u524d\u9663\u5b50 Red Hat \u91cb\u51fa\u4e86\u4e00\u500b\u89e3\u91cb\u8a72 OTA \u6a5f\u5236\u7684\u5f71\u7247\uff0c\u53ef\u4ee5\u53c3\u8003 Red Hat OpenShift: Cluster Upgrades and Application Operator Updates</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#channel","title":"Channel \u7684\u9078\u64c7","text":"<p>\u53e6\u57fa\u65bc Updating a cluster within a minor version from the web console - OpenShift 4.3 \u6240\u8ff0\uff0c\u9810\u8a2d\u7684 <code>upgrade channels and release</code> \u6703\u6709 3 \u7a2e\u7ba1\u9053\u985e\u578b(\u4f9d\u7a69\u5b9a\u5ea6\u6392\u5e8f):</p> <ol> <li>stable-4.y.z: \u767c\u884c\u7248\u672c (GA)\uff0c\u6700\u7a69\u5b9a\u7684\u7248\u672c\uff0c\u63d0\u4f9b\u5177\u6709 Red Hat OpenShift SRE Team \u7684\u9577\u671f\u6280\u8853\u652f\u63f4\u4e0b\u7684\u66f4\u65b0</li> <li>fast-4.y.z: \u9810\u767c\u884c\u7248\u672c (pre GA)\uff0c\u767c\u5e03\u4e00\u6bb5\u6642\u9593\u5f8c\uff0c\u6703\u767c\u5e03\u81f3 <code>stable-4.y.z</code></li> <li>candidate-4.y.z: \u5019\u9078\u7248\u672c (RC)\uff0c</li> </ol> <p>Red Hat \u6280\u8853\u5718\u968a\u6b63\u5f0f\u652f\u63f4\u7684\u662f <code>stable-4.y.z</code> \u53ca <code>fast-4.y.z</code>\uff0c\u4e0d\u5305\u542b <code>candidate 4.y.z</code>\uff0c\u4e00\u822c\u6c92\u4ec0\u9ebc\u7279\u5225\u9700\u8981\uff0c\u7576\u7136\u662f\u4ee5 <code>stable-4.y.z</code> \u70ba\u512a\u5148\u9078\u9805</p> <p>\u4e0b\u9762\u63d0\u4f9b\u4e00\u4e0b\u5177\u9ad4\u5347\u7d1a\u62c6\u89e3\u6b65\u9a5f\uff0c\u76f8\u7576...\u7c21\u55ae\uff0c\u4e00\u5806\u66f4\u65b0\u52d5\u4f5c\u90fd\u88ab <code>Cluster Version Operator</code> \u505a\u6389\u4e86\uff0c\u9664\u4e86\u4ee5\u4e0b\u7684 CLI \u64cd\u4f5c\u4ee5\u5916\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>Web Console</code> \u9032\u884c\u66f4\u65b0\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 OpenShift 4 Over the air updates</p> <pre><code># Simple View\n$ oc get clusterversion\nNAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS\nversion   4.3.5     True        False         25d     Cluster version is 4.3.5\n\n# Rich View\n$ oc get clusterversion -o json|jq \".items[0].spec\"\n{\n  \"channel\": \"stable-4.3\",\n  \"clusterID\": \"9d18a202-2a8a-4258-86fb-4319e20c8080\",\n  \"desiredUpdate\": {\n    \"force\": false,\n    \"image\": \"quay.io/openshift-release-dev/ocp-release@sha256:f0fada3c8216dc17affdd3375ff845b838ef9f3d67787d3d42a88dcd0f328eea\",\n    \"version\": \"4.3.9\"\n  },\n  \"upstream\": \"https://api.openshift.com/api/upgrades_info/v1/graph\"\n}\n\n# Check current version and available upgrade inforamtion\n$ oc adm upgrade\nCluster version is 4.3.5\n\nUpdates:\n\nVERSION IMAGE\n4.3.8   quay.io/openshift-release-dev/ocp-release@sha256:a414f6308db72f88e9d2e95018f0cc4db71c6b12b2ec0f44587488f0a16efc42\n4.3.9   quay.io/openshift-release-dev/ocp-release@sha256:f0fada3c8216dc17affdd3375ff845b838ef9f3d67787d3d42a88dcd0f328eea\n\n# Upgrade to specific version\n$ oc adm upgrade --to=4.3.9\nUpdating to 4.3.9\n\n# Waiting... The installation time should be over 1 hr\n$ watch -n 30 oc get clusterversion\nNAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS\nversion   4.3.5     True        True          4s      Working towards 4.3.9: downloading update\n\n# If you see any information mention\n# Unable to apply 4.y.z: the cluster operator &lt;Operator Name&gt; has not yet successfully rolled out\n# Solution: Just Wait or use oc describe clusterversion\n\n$ oc get clusterversion\nNAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS\nversion   4.3.9     True        False         49s     Cluster version is 4.3.9\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#openshift-4","title":"\u7372\u5f97 OpenShift 4 \u7248\u672c\u5347\u7d1a\u8def\u7dda\u5716","text":"<p>\u5efa\u8b70\u627e\u500b\u53ef\u4ee5\u958b\u5716\u6a94\u7684\u7b46\u96fb\u57f7\u884c\uff0c</p> <pre><code># Mac User\n# brew install graphviz jq\n\n# RHEL User\n$ yum install -y graphviz jq\n$ wget https://raw.githubusercontent.com/openshift/cincinnati/master/hack/graph.sh\n$ chmox +x graph.sh\n$ curl -sH 'Accept:application/json' 'https://api.openshift.com/api/upgrades_info/v1/graph?channel=stable-4.3' | ./graph.sh | dot -Tsvg &gt; graph.svg\n</code></pre> <p>\u627e\u500b\u700f\u89bd\u5668\u958b\u555f <code>graph.svg</code> \u5c31\u770b\u5230\u7576\u524d <code>stable-4.3</code> \u7684\u5347\u7d1a\u8def\u7dda\u5716</p> <p></p> <p>\u6700\u8fd1\u767c\u73fe\u6709\u4eba\u91cb\u51fa\u4e00\u500b OCP 4 Upgrade Path Checker \u7684\u5de5\u5177</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#yaml","title":"\u6b63\u78ba\u532f\u51fa YAML \u65b9\u5f0f","text":"<p>\u4e0a\u6e38 Kubernetes \u5c07\u65bc 1.18 \u7248\u672c\u4e4b\u5f8c\uff0c\u8981\u5ee2\u6b62 <code>--export</code> \u7684\u53c3\u6578\uff0c\u5efa\u8b70\u76f4\u63a5\u4f7f\u7528 <code>-o, --output=''</code> \u8f38\u51fa\u5c0d\u61c9\u7684\u683c\u5f0f</p> <p>-o, --output='': Output format. One of: json|yaml|wide|name|custom-columns=...|custom-columns-file=...|go-template=...|go-template-file=...|jsonpath=...|jsonpath-file=...</p> <pre><code># Format\n# oc get &lt;object kind&gt;/&lt;object name&gt; -o yaml\n\n$ oc get pvc/image-registry-pvc -o yaml\n$ oc get pvc/image-registry-pvc -o yaml &gt; image-registry-pvc.yaml\n</code></pre>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#_3","title":"\u7d50\u8a9e","text":"<p>\u5018\u82e5\u4f60\u9700\u8981\u5728 OpenShift \u88e1\u9762\u958b\u8d77 NFS Server \u7684\u670d\u52d9\uff0c\u800c\u4e0d\u662f\u55ae\u55ae\u4f7f\u7528 NFS Client \u7684\u8a71\uff0c\u53ef\u4ee5\u53c3\u8003 kubernetes-incubator/external-storage/nfs \u88e1\u9762\u7684\u64cd\u4f5c\u9032\u884c\u8a2d\u5b9a\uff0c\u53ea\u662f\u6211\u89ba\u5f97\u67b6\u69cb\u4e0a\u9019\u6a23\u4f7f\u7528\u597d\u50cf\u6c92\u4ec0\u9ebc\u7279\u5225\u7684\u512a\u52e2\uff0c\u50c5\u4f9b\u53c3\u8003\u800c\u5df2\u3002</p> <p>\u53e6\u525b\u4ecb\u7d39\u7684 <code>NFS-Client Provisioner</code> \u5176\u5be6\u4e0d\u5728 Red Hat OpenShift \u6b63\u5f0f\u652f\u63f4\u7684\u529f\u80fd\u4e4b\u4e00\uff0c\u4f46\u6280\u8853\u53ef\u7528\uff0c\u5018\u82e5\u4f7f\u7528\u76f8\u8f03\u7a69\u5b9a\u7684\u7b2c\u4e09\u65b9 NFS Client Provisioner\uff0c\u5247\u53ef\u4ee5\u53c3\u8003 NetApp Trident CSI \uff0c\u4f46\u5c31\u662f\u4e00\u5b9a\u8981\u642d\u8457 NetApp Appliance \u4f7f\u7528\u5c31\u662f\u4e86</p>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200412-openshift-with-coreos-part-3.html#references","title":"References","text":"<ul> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 1 - Phil Huang</li> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 2 - Phil Huang</li> <li>20190218_OpenShift Storage \u67b6\u69cb\u601d\u8003 - Phil Huang</li> <li>[Kubernetes] \u8a2d\u5b9a StorageClass (\u4ee5 NFS \u70ba\u4f8b) - \u5c0f\u4fe1\u8c6c\u7684\u539f\u59cb\u90e8\u843d</li> <li>Red Hat OpenShift: Cluster Upgrades and Application Operator Updates</li> <li>Updating a cluster within a minor version from the web console - OpenShift 4.3</li> <li>OpenShift 4 Over the air updates</li> <li>KB3660871: <code>oc export</code> is deprecated, use <code>oc get --export</code></li> <li>kubernetes-incubator/external-storage/nfs</li> <li>kubernetes-incubator/external-storage/nfs-client</li> </ul>","tags":["openshift4","openshift","container","coreos"]},{"location":"20200413-openshift4-network-traffic-overview.html","title":"Red Hat OpenShift v4 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u6d41","text":"<p>\u53bb\u5e74 2019/04 \u7684\u6642\u5019\u6709\u91cb\u653e\u51fa Red Hat OpenShift v3.11 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u63a2\u8a0e - Phil Huang \u4e00\u6587\uff0c\u904e\u4e86\u4e00\u5e74\u5f8c\uff0cRed Hat OpenShift 4 \u51fa\u4e86\uff0c\u90a3\u5169\u500b\u4e0d\u540c\u5927\u7248\u672c\u7684\u7db2\u8def\u8a2d\u8a08\u6709\u4ec0\u9ebc\u6a23\u5b50\u5dee\u7570\u5462?</p> <p>{% youtube DMb4L92Z7z8 %}</p>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#red-hat-openshift-4","title":"Red Hat OpenShift 4 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u6d41","text":"<p>\u9996\u5148\u5148\u4f86\u5f35\u91dd\u5c0d v4 \u7684\u67b6\u69cb\u5716</p> <p></p> <p>\u4ee5 Red Hat OpenShift \u70ba\u6838\u5fc3\u8996\u89d2\uff0c\u53ef\u4ee5\u5206\u70ba\u4e09\u6bb5\u7db2\u8def\u6d41</p> <ol> <li>\u5317\u5411\u7db2\u8def\u6d41 Ingress Traffic</li> <li>\u6771\u897f\u5411\u7db2\u8def\u6d41</li> <li>\u5357\u5411\u7db2\u8def\u6d41 Egress Traffic</li> </ol> <p>\u53e6\u5916\uff0c\u4ee5\u4e0a\u9019\u4e9b\u6d41\u91cf\uff0c\u5be6\u969b\u4e0a\u90fd\u662f\u900f\u904e\u6bcf\u4e00\u53f0\u7bc0\u9ede\u4e0a\u7684 <code>Node IP</code> \u9032\u884c\u6e9d\u901a\u7684\uff0c\u4e5f\u5c31\u662f\u4f60\u53ea\u9700\u8981\u63d0\u4f9b\u9019\u4e9b\u7bc0\u9ede<code>\u4e00\u500b IP</code> \u5373\u53ef\u4f7f\u7528\uff0c\u610f\u6307<code>\u4e0d\u9700\u8981\u6307\u6d3e\u591a\u7db2\u5361\u65bc\u55ae\u4e00\u7bc0\u9ede\u4e0a</code>\uff0c\u90a3\u5177\u9ad4\u662f\u54ea\u500b IP \u5462? \u4e3b\u8981\u662f\u770b <code>INTERNAL-IP</code> \u90a3\u500b\u6b04\u4f4d\u7684 IP</p> <pre><code>$ oc get nodes -o wide\nNAME              STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                                                       KERNEL-VERSION                CONTAINER-RUNTIME\ncompute-0         Ready    worker   26d   v1.16.2   10.0.97.4     10.0.97.4     Red Hat Enterprise Linux CoreOS 43.81.202003230848.0 (Ootpa)   4.18.0-147.5.1.el8_1.x86_64   cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8\ncompute-1         Ready    worker   26d   v1.16.2   10.0.97.5     10.0.97.5     Red Hat Enterprise Linux CoreOS 43.81.202003230848.0 (Ootpa)   4.18.0-147.5.1.el8_1.x86_64   cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8\ncontrol-plane-0   Ready    master   26d   v1.16.2   10.0.97.1     10.0.97.1     Red Hat Enterprise Linux CoreOS 43.81.202003230848.0 (Ootpa)   4.18.0-147.5.1.el8_1.x86_64   cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8\ncontrol-plane-1   Ready    master   26d   v1.16.2   10.0.97.2     10.0.97.2     Red Hat Enterprise Linux CoreOS 43.81.202003230848.0 (Ootpa)   4.18.0-147.5.1.el8_1.x86_64   cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8\ncontrol-plane-2   Ready    master   26d   v1.16.2   10.0.97.3     10.0.97.3     Red Hat Enterprise Linux CoreOS 43.81.202003230848.0 (Ootpa)   4.18.0-147.5.1.el8_1.x86_64   cri-o://1.16.3-28.dev.rhaos4.3.git9aad8e4.el8\n</code></pre>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#ingress-traffic","title":"\u5317\u5411: Ingress Traffic","text":"<p>Ingress \u4e3b\u8981\u7684\u76ee\u7684\u5c31\u662f\u8b93\u5916\u90e8\u4f7f\u7528\u8005\u53ef\u4ee5\u900f\u904e Ingress Controller \u4ee5\u63a5\u89f8\u5230 Kubernestes \u88e1\u9762\u7684 Service\uff0c\u800c\u5728 Red Hat OpenShift \u88e1\u9762\u7684\u8853\u8a9e\u5247\u662f\u4f7f\u7528 Router \u4f86\u505a\u95e1\u8ff0</p> <p>\u96a8\u8457\u5404\u5f0f\u5404\u6a23\u7684\u670d\u52d9\u90fd\u5728 OpenShift 4 \u4e0a\u90fd\u88ab\u5be6\u4f5c\u6210 Operator Framework\uff0c\u7576\u7136\u9023 Ingress Controller \u4e5f\u4e0d\u4f8b\u5916\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003Configuring ingress cluster traffic overview - OpenShift 4.3</p> <p>\u5f9e\u5916\u90e8\u9023\u5230\u5230 OpenShift \u4e0a Service \u7684\u65b9\u5f0f\u4e3b\u8981\u6709 4 \u7a2e\u65b9\u5f0f</p> <ol> <li>\u4f7f\u7528 OpenShift Router</li> <li>\u4f7f\u7528 Service Type: LoadBalancer</li> <li>\u4f7f\u7528 externalIngressIP</li> <li>\u4f7f\u7528 nodePort</li> </ol> <p>\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 \u5f9e Red Hat OpenShift \u5916\u90e8\u8a2a\u554f Services \u6216 Pods</p>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#east-west-traffic","title":"\u6771\u897f\u5411: East-West Traffic","text":"<p>\u5728 Red Hat OpenShift \u5e73\u53f0\u5e95\u4e0b\uff0c\u7121\u8ad6\u662f\u8981\u8de8 Pod / Service / Host \u9032\u884c\u6a6b\u5411\u7684\u6e9d\u901a\uff0c\u90fd\u662f\u9700\u8981\u6709 CNI (Cotainer Network Interface) \u7684\u5be6\u8e10\u624d\u80fd\u5c07\u4e0d\u540c\u4e3b\u6a5f\u4e4b\u9593\u7684\u9023\u7dda\u5efa\u7acb\u8d77\u4f86\u3002CNI \u672c\u8eab\u662f\u4e00\u5957\u6a19\u6e96\uff0c\u5be6\u4f5c\u4e0a\u5c31\u6703\u6709\u767e\u82b1\u9f4a\u653e\u7684\u5c08\u6848\u53ef\u4f9b\u4f7f\u7528\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 20190817 Container Bare Metal for Networking</p> <p></p> <p>\u9810\u8a2d\u5b89\u88dd\u4e0b\uff0c<code>Multus CNI</code> \u6703\u88ab\u5b89\u88dd\u5728 OpenShift 4 \u88e1\u9762\uff0c\u7576\u7136\u4e5f\u53ef\u4ee5\u4e0d\u5b89\u88dd\u628a\u5b83\u95dc\u6389\uff0c\u8acb\u53c3\u8003 KB4850181: How to install OpenShift 4 without Multus in place</p> <p>\u800c\u539f\u751f\u5fc5\u9808\u5b89\u88dd\u7684 OpenShift SDN CNI \u4e3b\u8981\u6709 2 \u500b\u53ef\u4ee5\u4f7f\u7528:</p> <ol> <li>OpenShiftSDN (\u9810\u8a2d)</li> <li>OVNKubernetes (4.5 GA)</li> </ol> <p>\u5176\u4ed6\u7b2c\u4e09\u65b9\u4f9b\u61c9\u5546\u7684 CNI Plugin \u5c31\u4e0d\u7d30\u5217\u4e86</p> <p>\u800c\u5982\u679c\u6709\u9700\u8981\u5be6\u8e10 Multiple Networks \u5247\u53ef\u4ee5\u9078\u64c7 5 \u7a2e CNI Plugin \u4e4b\u4e00\u639b\u8f09</p> <ol> <li>bridge</li> <li>host-device</li> <li>macvlan</li> <li>ipvlan</li> <li>SR-IOV</li> </ol>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#openshift-311","title":"\u8207 OpenShift 3.11 \u7684\u7db2\u8def\u5dee\u7570","text":"<ol> <li>\u65bc 4 \u4ee3\uff0cWeb Console \u7531 <code>Infra Node</code> \u4e0a\u7684 <code>OpenShift Router</code> \u63d0\u4f9b\uff0c\u800c\u4e0d\u662f\u900f\u904e <code>Master Node</code> \u63d0\u4f9b</li> <li>\u65bc 4 \u4ee3\uff0cOpenShift Router \u7684\u529f\u80fd\uff0c\u653e\u7f6e\u5728 <code>openshift-ingress-operator</code>\uff0c\u800c\u4e0d\u662f\u653e\u7f6e\u5728 <code>default</code></li> <li>\u65bc 4 \u4ee3\uff0cOpenShift CNI \u63d0\u4f9b <code>OpenShiftSDN</code> \u53ca <code>OVNKubernetes</code> \u548c\u9810\u8a2d\u63d0\u4f9b <code>multus</code> \u63d0\u4f9b Pod \u591a\u7db2\u5361\u80fd\u529b</li> </ol>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#openshift-4","title":"\u5be6\u52d9\u4e0a\u5728 OpenShift 4 \u7684\u7db2\u8def\u8a2d\u5b9a","text":"<p>\u5be6\u969b\u4e0a\u5c0d\u61c9\u5230 Red Hat OpenShift 4 \u7684\u8a2d\u5b9a\u6a94 install-config.yaml</p> <p><code>yaml install-config.yaml apiVersion: v1 baseDomain: example.com ...omit... networking:   clusterNetwork:   - cidr: 10.128.0.0/14     hostPrefix: 23   networkType: OpenShiftSDN   serviceNetwork:   - 172.30.0.0/16 ...omit...</code></p> <p>\u5be6\u969b\u4e0a\uff0c\u9700\u8981\u8a2d\u5b9a 3 \u5927\u6bb5\u7db2\u8def\uff0c</p> <ol> <li>Node Subnet: \u4e3b\u8981\u7d66<code>\u5317\u5411</code>\u6216<code>\u5357\u5411</code>\u6e9d\u901a\u7528</li> <li>Service Subnet: \u4e3b\u8981\u7d66<code>\u6771\u897f\u5411</code>\u7db2\u8def\u6d41\u7528</li> <li>Pod Subnet: Kubernetes Pod \u5be6\u969b\u4e0a\u62ff\u5230\u7684 IP\uff0c\u6e9d\u901a\u4e3b\u8981\u90fd\u662f\u4f7f\u7528 <code>Service Subnet</code> \u9032\u884c\u6e9d\u901a</li> </ol> <p>\u5176\u4ed6\u8a73\u7d30\u53c3\u6578\u89e3\u91cb\u8acb\u770b \u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 2 - Cluster Network Operator</p>","tags":["openshift4"]},{"location":"20200413-openshift4-network-traffic-overview.html#references","title":"References","text":"<ul> <li>Red Hat OpenShift v3.11 \u6771\u897f\u5357\u5317\u5411\u7db2\u8def\u63a2\u8a0e - Phil Huang</li> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 2 - Cluster Network Operator</li> <li>Sample install-config.yaml file for bare metal - OpenShift 4.3</li> <li>20190817 Container Bare Metal for Networking</li> <li>KB4850181: How to install OpenShift 4 without Multus in place</li> <li>Understanding multiple networks - OpenShift 4.3</li> <li>About Single Root I/O Virtualization (SR-IOV) hardware networks</li> <li>Configuring ingress cluster traffic overview - OpenShift 4.3</li> <li>\u5f9e Red Hat OpenShift \u5916\u90e8\u8a2a\u554f Services \u6216 Pods</li> </ul>","tags":["openshift4"]},{"location":"20200423-deadman.html","title":"\u7cfb\u7d71\u5de5\u7a0b\u5e2b\u5fc5\u5099\u76e3\u63a7\u5c0f\u5de5\u5177 deadman","text":"<p>\u4eca\u5929\u8981\u4f86\u5206\u4eab\u4e00\u500b\u9577\u671f\u4ee5\u4f86\u85cf\u5728\u6211\u5fc3\u4e2d\u7684\u5c0f\u5de5\u5177\uff0c\u4ee5\u524d\u641e\u7db2\u8def\u51fa\u570b\u505a\u8edf\u9ad4\u5b9a\u7fa9\u7db2\u8def (Software Defined Networking, SDN) \u76f8\u95dc\u7684 PoC\uff0c\u56e0\u70ba\u6642\u9593\u975e\u5e38\u77ed\uff0c\u50c5\u50c5\u53ea\u6709\u4e00\u9031\uff0c\u6240\u4ee5\u51fa\u9580\u524d\u8981\u6e2c\u8a66\u3001\u6e96\u5099\u5de5\u5177\u9700\u8981\u76f8\u7576\u9f4a\u5099\uff0c\u800c\u4e14\u73fe\u5834\u72c0\u6cc1\u795e\u591a\uff0c\u5c24\u5176\u662f\u865b\u64ec\u7db2\u8def\u53ca\u5be6\u9ad4\u7db2\u8def\u4e4b\u5ef6\u4f38\u7d9c\u5408\u6027\u554f\u984c\uff0c\u9047\u5230\u554f\u984c\u6642\u6703\u4e0d\u77e5\u9053\u8981\u76f8\u4fe1\u54ea\u500b\u9ede\uff0c\u9700\u8981\u53cd\u8986\u4e00\u76f4\u78ba\u8a8d\u3002\u800c\u6211\u9375\u76e4\u4e0a\u7684 <code>p</code>\u3001<code>i</code>\u3001<code>n</code>\u3001<code>g</code> \u52a0\u6578\u5b57\u9375\u5df2\u7d93\u88ab\u6211\u6253\u721b\u4e86\uff0c\u70ba\u4e86\u5404\u4f4d\u7684\u9375\u76e4\u548c\u624b\u6307\u8457\u60f3\uff0c\u4eca\u5929\u8981\u4f86\u4ecb\u7d39\u4e00\u500b\u7531\u65e5\u672c Interop Tokyo \u767c\u5c55\u51fa\u4f86\u7684\u4e00\u500b\u8d85\u597d\u7528\u5c0f\u5de5\u5177 <code>deadman</code></p> <p></p>","tags":["networking"]},{"location":"20200423-deadman.html#shownet","title":"Shownet \u662f\u4ec0\u9ebc?","text":"<p>I know it works because I saw it at Interop.</p> <p>\u622a\u81f3\u65bc\u5b98\u7db2 What is Shownet?\uff0c\u81ea Interop Tokyo \u65bc 1994 \u5e74\u6210\u7acb\u4ee5\u4f86\uff0cShownet \u4e00\u76f4\u90fd\u662f\u6bcf\u5e74\u5ea6\u5c55\u793a\u7db2\u8def\u6280\u8853\u7684\u4e00\u500b\u91cd\u8981\u6d3b\u52d5\uff0c\u9019\u500b\u6d3b\u52d5\u79c9\u6301\u8457\u6211\u8981<code>\u89aa\u773c</code>\u770b\u5230\u4ed6\u771f\u7684\u80fd\u8ddf\u5176\u4ed6\u5ee0\u5546\u7684\u8a2d\u5099\u806f\u901a\u624d\u7b97\u6578\u70ba\u5951\u6a5f\uff0c\u4e00\u8def\u5c07\u7576\u5e74\u5ea6\u6700\u524d\u885b\u7684\u7db2\u8def\u6280\u8853\u6574\u5408\u5efa\u7f6e\u6e2c\u8a66\u76f4\u81f3\u73fe\u5728\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u5728\u4ed6\u5011\u7684 Slideshare \u4e0a\u627e\u5230\u6b77\u5e74\u4f86\u7684\u5e74\u5ea6\u7db2\u8def\u62d3\u6a38\u5716\u3002\u9019\u908a\u7279\u5225\u628a 1994 \u5e74\u8ddf\u6700\u8fd1 2019 \u7684\u62d3\u58a3\u5716\u62ff\u51fa\u4f86\u6bd4\u8f03\u4e00\u4e0b\uff0c\u5c31\u6703\u767c\u73fe\u771f\u7684\u662f\u6b72\u6708\u5982\u68ad XD</p> <ul> <li>ShowNet 1994 \u5e74\u62d3\u58a3\u5716</li> <li>ShowNet 2019 \u5e74\u62d3\u58a3\u5716</li> </ul>","tags":["networking"]},{"location":"20200423-deadman.html#_1","title":"\u5e55\u5f8c\u82b1\u7d6e = \u809d + \u8840 + \u6dda + \u9752\u6625","text":"<p>\u9019\u908a\u653e\u4e00\u4e0b\u4ed6\u5011\u5e74\u5ea6\u7684\u7d00\u9304\u7247 XD \u5404\u4f4d\u6709\u5728\u5f04\u73fe\u5834\u7684\u5de5\u7a0b\u5e2b\u4e00\u5b9a\u5f88\u6709\u65e2\u8996\u611f</p> <p>2018 \u5e74\u7684\u5e55\u5f8c\u82b1\u7d6e</p> <p>2017 \u5e74\u7684\u5e55\u5f8c\u82b1\u7d6e</p>","tags":["networking"]},{"location":"20200423-deadman.html#_2","title":"\u52d5\u54e1\u898f\u6a21","text":"<p>\u5206\u4eab\u4e00\u4e0b\u65bc Shownet 2019 \u6642\u7684\u4eba\u529b\u7269\u8cc7\u898f\u6a21\uff0c\u5df2\u7d93\u4f86\u5230\u7d04 <code>2000</code> \u53f0\u7684\u8a2d\u5099\u548c\u4e00\u5834\u6703\u8b70\u52d5\u54e1 <code>447</code> \u540d\u4eba\u54e1\u7684\u898f\u6a21\u4e86</p> <p></p>","tags":["networking"]},{"location":"20200423-deadman.html#deadman_1","title":"Deadman \u4ecb\u7d39","text":"<p>deadman is a curses-based host status checking application using ping</p> <p>deadman \u7576\u521d\u662f\u70ba\u4e86 Interop Tokyo ShowNet \u6d3b\u52d5\u800c\u5beb\u7684\uff0c\u672c\u8eab\u6c92\u4ec0\u9ebc\u4f7f\u7528\u5230\u7279\u6b8a\u529f\u80fd\uff0c\u4e3b\u8981\u662f\u7528 ICMP \u5354\u8b70 + \u6301\u7e8c\u57f7\u884c\u70ba\u4e3b\uff0c\u4ee5\u4e0b 3 \u9ede\u662f\u4ed6\u4e3b\u8981\u80fd\u529b</p> <ul> <li>\u89c0\u6e2c\u7576\u524d\u7db2\u8def\u72c0\u614b</li> <li>\u672c\u6a5f -&gt; \u591a\u9ede\u89c0\u6e2c</li> <li>\u958b\u7bb1\u5373\u7528\u76e3\u63a7</li> </ul> <p>\u9019\u500b\u5c0f\u5de5\u5177\u6700\u5927\u7684\u512a\u52e2\u5c31\u662f\u8b93\u4f60\u5c11\u6253\u597d\u5e7e\u6b21 ping \u53ca\u5f8c\u9762\u7684\u90a3\u4e00\u4e32 IP\uff0c\u9019\u662f\u500b\u5f88\u7c21\u55ae\uff0c\u4f46\u537b\u5f88\u91cd\u8981\u7684\u5c0f\u4e8b</p>","tags":["networking"]},{"location":"20200423-deadman.html#_3","title":"\u74b0\u5883\u8cc7\u8a0a","text":"<ul> <li>Red Hat Enterprise Linux 7.7</li> <li>Python 3.6 (supported by Red Hat)</li> <li>deadman 20.01.08</li> </ul>","tags":["networking"]},{"location":"20200423-deadman.html#deadman_2","title":"\u5b89\u88dd deadman","text":"<p>\u8d85\u7c21\u55ae\uff0c\u7cfb\u7d71\u9810\u8a2d\u6709 Python3 \u5373\u53ef</p> <pre><code>$ git clone https://github.com/upa/deadman\n$ cd deadman\n$ ./deadman deadman.conf\n</code></pre> <p>\u82e5\u4f60\u662f RHEL \u7684\u7528\u6236\u7684\u8a71\uff0c\u56e0\u70ba RHEL 7/8 \u9810\u8a2d\u8981\u4f7f\u7528 <code>scl</code> \u4f86\u9032\u884c python \u74b0\u5883\u5207\u63db\uff0c\u8b1b\u7c21\u55ae\u9ede\u5c31\u662f\u5b98\u65b9\u652f\u63f4\u985e\u4f3c\u65bc <code>virtualenv</code> \u7684\u4f5c\u6cd5\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u591a\u4e0b\u9762 2 \u500b\u6b65\u9a5f</p> <pre><code>$ yum install rh-python36 -y\n$ scl enable rh-python36 bash\n</code></pre>","tags":["networking"]},{"location":"20200423-deadman.html#demo","title":"Demo","text":"","tags":["networking"]},{"location":"20200423-deadman.html#_4","title":"\u63a8\u85a6\u5be6\u8e10\u65b9\u5f0f","text":"<p>\u7b2c\u4e00\u9ede\uff0c\u5982\u679c\u4f60\u6709\u4ed4\u7d30\u770b\u6307\u4ee4\u7684\u8a71\uff0c\u5176\u5be6\u90a3\u500b <code>deadman.conf</code> \u53ef\u4ee5\u63db\u6210\u5225\u7684\u540d\u5b57\uff0c\u610f\u601d\u662f\u8aaa\u4f60\u53ef\u4ee5\u4f9d\u64da\u4e0d\u540c\u74b0\u5883\u5beb\u51fa\u4e0d\u4e00\u6a23\u7684 IP \u76e3\u6e2c\u8868\uff0c\u642d\u914d <code>git</code> \u53ef\u4ee5\u9032\u884c\u7248\u63a7</p> <p>\u7136\u5f8c\uff0c\u7b2c\u4e8c\u9ede\u662f\u52d9\u5fc5\u642d\u914d\u7d42\u7aef\u6a5f\u591a\u5de5\u7ba1\u7406\u795e\u5668 <code>tmux</code> \u53ca\u88e1\u9762\u7684\u9810\u8a2d\u529f\u80fd\u9032\u884c\u5206\u5272\u8996\u7a97\uff0c\u53ef\u4ee5\u8fc5\u901f\u5efa\u7acb\u4e00\u500b\u66ab\u6642\u4f7f\u7528\u7684\u76e3\u6e2c\u7cfb\u7d71\uff0c\u8fc5\u901f\u4e86\u89e3\u7576\u524d\u76e3\u63a7\u9ede\u7684\u7db2\u8def\u72c0\u614b</p> <p></p> <p>\u4f60\u5982\u679c\u662f\u505a\u7db2\u8def\u76f8\u95dc\u6216\u7cfb\u7d71\u5efa\u7f6e\u76f8\u95dc\u7684\uff0c\u90fd\u76f8\u7576\u597d\u7528\u554a~</p>","tags":["networking"]},{"location":"20200423-deadman.html#_5","title":"\u5f8c\u8a71","text":"<p>Shownet \u662f\u5148\u524d\u8077\u6daf\u4e2d\u6709\u9ede\u5c0f\u5c0f\u7684\u907a\u61be\uff0c\u6c92\u6709\u6a5f\u6703\u53ef\u4ee5\u73fe\u5834\u53c3\u8207\u6216\u89c0\u8cde\u4ed6\u5011\u7684\u71b1\u60c5\u548c\u76f8\u95dc\u6280\u8853\uff0c\u5e0c\u671b\u4ee5\u5f8c\u6709\u6a5f\u6703\u9084\u662f\u53ef\u4ee5\u6478\u6478\u770b</p> <p>\u7136\u5f8c\u5927\u5bb6\u8acb\u4e0d\u8981\u541d\u55c7\u7d66\u9019\u500b\u5c08\u6848 <code>star</code> \u4ee5\u8cc7\u9f13\u52f5\uff0c\u771f\u7684\u662f\u883b\u597d\u7528\u7684\u6771\u897f</p>","tags":["networking"]},{"location":"20200423-deadman.html#appendix","title":"Appendix","text":"","tags":["networking"]},{"location":"20200423-deadman.html#smokeping","title":"\u9577\u671f\u76e3\u63a7\u958b\u6e90\u5c08\u6848 Smokeping","text":"<p>\u5982\u679c\u4f60\u662f\u4e00\u4f4d SRE\uff0c\u60f3\u8981\u6709\u9577\u671f\u76e3\u63a7\u7d00\u9304\u53ca\u5716\u8868\u986f\u793a\u7684\u8a71\uff0cSmokeping \u662f\u500b\u4e0d\u932f\u7684\u8001\u724c\u9078\u64c7\uff0c\u6709 RRDtool \u5e6b\u5fd9\u756b\u5716 / MRTG \u53ef\u4ee5\u7528\uff0c\u5982\u4e0b\u5716</p> <p></p> <p>\u5176\u4ed6\u5546\u696d\u65b9\u6848\u5c31\u5f97\u8981\u81ea\u5df1\u5c0b\u627e\u4e86</p>","tags":["networking"]},{"location":"20200423-deadman.html#references","title":"References","text":"<ul> <li>Facebook - Shownet Interop Tokyo</li> <li>Slide - Interop Tokyo ShowNet NOC Team</li> <li>smokeping</li> <li>ICMP \u5354\u5b9a</li> <li>\u3082\u306f\u3084\u5b9f\u5c55\u793a\u306f\u65e5\u672c\u3060\u3051--Interop Tokyo 2019\u306eShowNet</li> </ul>","tags":["networking"]},{"location":"20200426-openshift-with-coreos-part-4.html","title":"Red Hat OpenShift \u5b98\u65b9\u652f\u63f4 Helm 3 \u5566!","text":"<p>\u627f\u8972\u4e0a\u7bc7 \u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 3 \u7cbe\u795e\uff0c\u7e7c\u7e8c\u5beb\u4e00\u9ede\u6771\u897f\uff0c\u4f46\u56e0\u672c\u9031\u592a\u5fd9\u4e86\uff0c\u53ea\u8b1b\u4e00\u500b\u5927\u5bb6\u90fd\u5f88\u95dc\u6ce8\u7684 Kubernetes \u5957\u4ef6\u7ba1\u7406\u7a0b\u5f0f - <code>Helm 3</code> \u5167\u5bb9</p> <p></p>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u56db\u5929","text":"","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#helm","title":"Helm \u7562\u696d\u5566!","text":"<p>\u65bc 2020/04/30 \u6642\uff0cCloud Native Computing Foundation Announces Helm Graduation\uff0cHelm \u5f9e CNCF \u57fa\u91d1\u6703\u7562\u696d\u5566!\u5b83\u662f CNCF \u7b2c 10 \u500b\u6b63\u5f0f\u7562\u696d\u7684\u5c08\u6848\uff0c\u56e0\u70ba\u5b83\u5145\u5206\u5c55\u73fe\u51fa\u4f7f\u7528\u8005\u5ee3\u6cdb\u5730\u63a1\u7528\u3001\u958b\u653e\u7684\u5c08\u6848\u6cbb\u7406\u4ee5\u53ca\u5c0d CNCF \u793e\u5340\u53ef\u6301\u7e8c\u6027\u5305\u5bb9\u7684\u5805\u5b9a\u627f\u8afe</p>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#helm-3","title":"\u4f7f\u7528 Helm 3","text":"<p>The package manager for Kubernetes</p> <p>Red Hat OpenShift 4 \u7d42\u65bc\u652f\u63f4\u4e86 Helm 3\uff0c\u6240\u4ee5\u76ee\u524d\u5171\u6709 2 \u7a2e\u5957\u4ef6\u7ba1\u7406\u65b9\u5f0f\u53ef\u4ee5\u505a\u9078\u64c7\u4f7f\u7528:</p> <ol> <li>Operator Framework</li> <li>Helm 3</li> </ol> <p>\u5169\u8005\u7684\u80fd\u529b\u5dee\u7570\u5982\u4e0b</p> Helm 3 Operator Framework <code>\u5957\u4ef6\u5316</code> Y Y <code>App \u5b89\u88dd\u80fd\u529b</code> Y Y <code>App \u66f4\u65b0\u80fd\u529b</code> Y Y App \u81ea\u52d5\u5099\u4efd\u548c\u9084\u539f X Y \u5de5\u4f5c\u8ca0\u8f09\u5206\u6790\u548c\u7d00\u9304 X Y App \u5c64\u7d1a\u81ea\u52d5\u5316\u64f4\u7e2e\u5bb9 X Y \u81ea\u52d5\u6700\u4f73\u5316 X Y <p>\u81f3\u65bc\u8981\u7528\u54ea\u4e00\u500b...\u563f\u563f \u8981\u770b\u4f60\u7684\u89d2\u8272\u662f\u4ec0\u9ebc\uff0c\u9019\u908a\u5c31\u4e0d\u63d0\u592a\u591a\u4e86</p>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#helm-3_1","title":"\u5b89\u88dd Helm 3","text":"<p>\u56e0\u70ba helm 3 \u4e4b\u5f8c\u79fb\u9664\u4e86\u539f\u5148 v2 \u7684 Tiller \u89d2\u8272\uff0c\u55ae\u7d14\u50c5\u4f7f\u7528 helm \u4f86\u9032\u884c\u64cd\u4f5c\uff0c\u6240\u4ee5\u5b89\u88dd\u904e\u7a0b\u5176\u5be6\u76f8\u7576\u7c21\u55ae\uff0c\u4e0d\u9700\u8981\u78b0\u5230 OpenShift \u5c31\u53ef\u4ee5\u641e\u5b9a\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 CNCF\u767c\u5e03Kubernetes\u61c9\u7528\u7a0b\u5f0f\u7ba1\u7406\u5de5\u5177Helm 3 - IThome \u4e00\u6587</p> <p>```bash bastion.ocp4.internal $ wget https://mirror.openshift.com/pub/openshift-v4/clients/helm/3.1.1/helm-linux-amd64 $ chmod +x helm-linux-amd64 $ mv helm-linux-amd64 /usr/local/bin/helm</p> <p>$ helm version version.BuildInfo{Version:\"v3.1+unreleased\", GitCommit:\"7ebdbb86fca32c77f2fce166f7f9e58ebf7e9946\", GitTreeState:\"clean\", GoVersion:\"go1.13.4\"} <pre><code>#### \u4f7f\u7528\u5916\u90e8\u532f\u5165 helm charts\n\n\u7576\u4f60\u6709\u7db2\u8def\u53ef\u4ee5\u9023\u7684\u6642\u5019\uff0c\u9019\u500b\u662f\u883b\u5e38\u898b\u7684\u7528\u6cd5\uff0c\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\u4f7f\u7528\u904e\u7a0b\n\n```bash\n# \u4f7f\u7528 Helm Stable Charts\n$ helm repo add helm-stable-charts https://kubernetes-charts.storage.googleapis.com/\n\"helm-stable-charts\" has been added to your repositories\n\n# \u4f7f\u7528 Helm Incubartor Charts\n$ helm repo add helm-incubator-charts https://kubernetes-charts-incubator.storage.googleapis.com\n\"helm-incubator-charts\" has been added to your repositories\n\n# Update charts from these repos\n$ helm repo update\nHang tight while we grab the latest from your chart repositories...\n...Successfully got an update from the \"helm-incubator-charts\" chart repository\n...Successfully got an update from the \"helm-stable-charts\" chart repository\nUpdate Complete. \u2388 Happy Helming!\u2388\n\n# Search charts\n# helm search repo &lt;name&gt;\n$ helm search repo mysql\nNAME                                            CHART VERSION   APP VERSION   DESCRIPTION\nhelm-incubator-charts/mysqlha                   2.0.0           5.7.13        MySQL cluster with a single master and zero or ...\nhelm-stable-charts/mysql                        1.6.3           5.7.28        Fast, reliable, scalable, and easy to use open-...\nhelm-stable-charts/mysqldump                    2.6.0           2.4.1         A Helm chart to help backup MySQL databases usi...\nhelm-stable-charts/prometheus-mysql-exporter    0.5.2           v0.11.0       A Helm chart for prometheus mysql exporter with...\nhelm-stable-charts/percona                      1.2.1           5.7.26        free, fully compatible, enhanced, open source d...\nhelm-stable-charts/percona-xtradb-cluster       1.0.3           5.7.19        free, fully compatible, enhanced, open source d...\nhelm-stable-charts/phpmyadmin                   4.3.5           5.0.1         DEPRECATED phpMyAdmin is an mysql administratio...\nhelm-stable-charts/gcloud-sqlproxy              0.6.1           1.11          DEPRECATED Google Cloud SQL Proxy\nhelm-stable-charts/mariadb                      7.3.14          10.3.22       DEPRECATED Fast, reliable, scalable, and easy t...\n\n# Inspect mysql\n# helm inspect all|chart|values|readme &lt;name&gt;\n$ helm inspect chart helm-stable-charts/mysql\napiVersion: v1\nappVersion: 5.7.28\ndescription: Fast, reliable, scalable, and easy to use open-source relational database\n  system.\nhome: https://www.mysql.com/\nicon: https://www.mysql.com/common/logos/logo-mysql-170x115.png\nkeywords:\n- mysql\n- database\n- sql\nmaintainers:\n- email: o.with@sportradar.com\n  name: olemarkus\n- email: viglesias@google.com\n  name: viglesiasce\nname: mysql\nsources:\n- https://github.com/kubernetes/charts\n- https://github.com/docker-library/mysql\nversion: 1.6.3\n\n# Create a new project - test-mariadb\n$ oc new-project test-mysql\nNow using project \"test-mysql\" on server \"https://api.ocp4.internal:6443\".\n\n# Install charts - mysql\n$ helm install mysql-dev helm-stable-charts/mysql\nNAME: mysql-dev\nLAST DEPLOYED: Sun Apr 26 18:27:10 2020\nNAMESPACE: test-mysql\nSTATUS: deployed\nREVISION: 1\nNOTES:\nMySQL can be accessed via port 3306 on the following DNS name from within your cluster:\nmysql-dev.test-mysql.svc.cluster.local\n\nTo get your root password run:\n\n    MYSQL_ROOT_PASSWORD=$(kubectl get secret --namespace test-mysql mysql-dev -o jsonpath=\"{.data.mysql-root-password}\" | base64 --decode; echo)\n\nTo connect to your database:\n\n1. Run an Ubuntu pod that you can use as a client:\n\n    kubectl run -i --tty ubuntu --image=ubuntu:16.04 --restart=Never -- bash -il\n\n2. Install the mysql client:\n\n    $ apt-get update &amp;&amp; apt-get install mysql-client -y\n\n3. Connect using the mysql cli, then provide your password:\n    $ mysql -h mysql-dev -p\n\nTo connect to your database directly from outside the K8s cluster:\n    MYSQL_HOST=127.0.0.1\n    MYSQL_PORT=3306\n\n    # Execute the following command to route the connection:\n    kubectl port-forward svc/mysql-dev 3306\n\n    mysql -h ${MYSQL_HOST} -P${MYSQL_PORT} -u root -p${MYSQL_ROOT_PASSWORD}\n\n# Check Charts list\n$ helm list\nNAME            NAMESPACE       REVISION        UPDATED                                       STATUS          CHART           APP VERSION\nmysql-dev       test-mysql      1               2020-04-26 18:27:10.979294793 +0800 CST       deployed        mysql-1.6.3     5.7.28\n\n# Check Mysql server is ready\n$ oc get all\nNAME                            READY   STATUS    RESTARTS   AGE\npod/mysql-dev-d8b597f5f-b2nxn   1/1     Running   0          31s\n\nNAME                TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\nservice/mysql-dev   ClusterIP   172.30.4.152   &lt;none&gt;        3306/TCP   31s\n\nNAME                        READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/mysql-dev   1/1     1            1           31s\n\nNAME                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps/mysql-dev-d8b597f5f   1         1         1       31s\n\n# Uninstall charts and project\n$ helm uninstall mysql-dev\nrelease \"mysql-dev\" uninstalled\n\n$ oc delete project test-mysql\nproject.project.openshift.io \"test-mysql\" deleted\n</code></pre></p>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#helm-charts","title":"\u4f7f\u7528\u81ea\u884c\u4e0b\u8f09 helm charts","text":"<p>\u73fe\u5be6\u662f\uff0c\u4e00\u7968\u74b0\u5883\u90fd\u4e0d\u7d66\u9023\u7db2\u8def\uff0c\u6240\u4ee5\u81ea\u7136\u4e5f\u6c92\u6709\u4ec0\u9ebc <code>helm repo</code> \u53ef\u4ee5\u7528\uff0c\u6240\u4ee5\u8981\u5927\u90e8\u5206\u61c9\u8a72\u90fd\u6703\u6539\u7528\u9019\u500b\u4f5c\u6cd5\uff0c\u6574\u9ad4\u6838\u5fc3\u9084\u662f\u5728\u5982\u4f55\u96e2\u7dda\u64cd\u4f5c <code>GitOps</code> \u53ca\u4f7f\u7528\u96e2\u7dda <code>Container Registry</code> \u8eab\u4e0a</p> <pre><code># Example: IBM/helm101\n$ git clone https://github.com/IBM/helm101\n\n# Create a new project - test-mariadb\n$ oc new-project test-my-first-helm-chart\nNow using project \"test-my-first-helm-chart\" on server \"https://api.ocp4.internal:6443\".\n\n# Install guestbook using helm 3\n$ cd helm101/charts\n$ helm install guestbook-demo ./guestbook/ --namespace test-my-first-helm-chart\n\n# Check Charts list\n$ helm list\nNAME            NAMESPACE                       REVISION        UPDATED                                       STATUS          CHART                 APP VERSION\nguestbook-demo  test-my-first-helm-chart        1               2020-04-26 18:45:34.084900528 +0800 CST       deployed        guestbook-0.2.0\n\n# Check Guestbook server is ready\n$ oc get all\nNAME                                  READY   STATUS    RESTARTS   AGE\npod/guestbook-demo-67f5b45d45-kscnt   1/1     Running   0          2m39s\npod/guestbook-demo-67f5b45d45-tv4dr   1/1     Running   0          2m39s\npod/redis-master-68857cd57c-7m585     1/1     Running   0          2m39s\npod/redis-slave-bbd8d8545-6nwh5       1/1     Running   0          2m39s\npod/redis-slave-bbd8d8545-xgkmb       1/1     Running   0          2m39s\n\nNAME                     TYPE           CLUSTER-IP       EXTERNAL-IP\n PORT(S)          AGE\nservice/guestbook-demo   LoadBalancer   172.30.216.24    &lt;pending&gt;\n 3000:32765/TCP   2m39s\nservice/redis-master     ClusterIP      172.30.64.237    &lt;none&gt;\n 6379/TCP         2m39s\nservice/redis-slave      ClusterIP      172.30.143.221   &lt;none&gt;\n 6379/TCP         2m39s\n\nNAME                             READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/guestbook-demo   2/2     2            2           2m39s\ndeployment.apps/redis-master     1/1     1            1           2m39s\ndeployment.apps/redis-slave      2/2     2            2           2m39s\n\nNAME                                        DESIRED   CURRENT   READY\n  AGE\nreplicaset.apps/guestbook-demo-67f5b45d45   2         2         2\n  2m39s\nreplicaset.apps/redis-master-68857cd57c     1         1         1\n  2m39s\nreplicaset.apps/redis-slave-bbd8d8545       2         2         2\n  2m39s\n\n# Uninstall charts and project\n$ helm uninstall guestbook-demo\nrelease \"guestbook-demo\" uninstalled\n\n$ oc delete project test-my-first-helm-chart\nproject.project.openshift.io \"test-my-first-helm-chart\" deleted\n</code></pre>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#_2","title":"\u74b0\u5883\u8cc7\u8a0a","text":"<ul> <li>Red Hat OpenShift 4.3.13 (Kubernetes v1.16.2)</li> <li>Red Hat Enterprise Linux 7.7 as bastion server</li> <li>helm v3.1+unreleased</li> </ul>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#appendix","title":"Appendix","text":"","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#_3","title":"\u5ef6\u4f38\u95b1\u8b80","text":"<ul> <li>\u521d\u63a2\u4e91\u539f\u751f\u5e94\u7528\u7ba1\u7406\uff08\u4e00\uff09: Helm \u4e0e App Hub</li> <li>\u521d\u63a2\u4e91\u539f\u751f\u5e94\u7528\u7ba1\u7406\uff08\u4e8c\uff09: \u4e3a\u4ec0\u4e48\u4f60\u5fc5\u987b\u5c3d\u5feb\u8f6c\u5411 Helm v3</li> <li>\u4e91\u539f\u751f\u751f\u6001\u5468\u62a5 Vol. 19 | Helm \u63a8\u8350\u7528\u6237\u8f6c\u5411 V3</li> </ul>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#_4","title":"\u7d50\u8a9e","text":"<p>\u6211\u89ba\u5f97 Red Hat \u5b98\u65b9\u958b\u59cb\u652f\u63f4\u662f\u5c0d\u7684\uff0c\u525b\u597d Helm 3 \u5f8c\u5c0d\u5e95\u5c64\u9032\u884c\u4e86\u5927\u6539\u9020\uff0c\u539f\u5148\u7684\u8cc7\u5b89\u554f\u984c\u9664\u4e86\u79fb\u9664 Tiller \u4ee5\u5916\uff0c\u4e5f\u540c\u6642\u900f\u904e OpenShift \u9810\u8a2d\u76f8\u8f03\u56b4\u82db RBAC \u4f86\u505a\u5230\u6bd4\u8f03\u597d\u7684\u4fdd\u8b77\uff0c\u7b97\u662f\u4e00\u500b\u5404\u5f97\u5176\u6240\u7684\u4f7f\u7528\u65b9\u5f0f</p>","tags":["openshift4","openshift","helm"]},{"location":"20200426-openshift-with-coreos-part-4.html#references","title":"References","text":"<ul> <li>CNCF\u767c\u5e03Kubernetes\u61c9\u7528\u7a0b\u5f0f\u7ba1\u7406\u5de5\u5177Helm 3 - IThome</li> <li>helm/charts - GitHub</li> <li>IBM/helm101 - GitHub</li> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 3</li> <li>helm</li> <li>Cloud Native Computing Foundation Announces Helm Graduation</li> </ul>","tags":["openshift4","openshift","helm"]},{"location":"20200427-openshift-with-coreos-part-5.html","title":"\u7576\u5b89\u88dd\u5b8c Red Hat OpenShift \u4e4b\u5f8c...","text":"<p>\u5982\u679c\u6709\u670b\u53cb\u525b\u5f04\u597d OpenShift 4 \u53ef\u80fd\u5c0d\u65bc\u5f88\u591a\u9810\u8a2d\u6a5f\u5236\u611f\u5230\u6709\u9ede\u72d0\u7591\uff0c\u9019\u7bc7\u6587\u7ae0\u5c31\u662f\u8981\u4f86\u89e3\u91cb\uff0c\u5b89\u88dd\u5b8c OpenShift 4 \u5f8c\uff0c\u6700\u91cd\u8981\u7684\u5c0f\u4e8b - \u5e33\u865f\u6b0a\u9650\u8a8d\u8b49 (Authentication)</p> <p>Red Hat OpenShift \u7684\u6b0a\u9650\u8a8d\u8b49\u4e00\u5982\u7e7c\u5f80\u90fd\u662f\u63a1\u7528\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (Role Based Access Control, RBAC)\uff0c\u9019\u908a\u5c31\u8981\u4f86\u6e96\u5099\u958b\u59cb\u52d9\u5be6\u4e00\u9ede\u7684\u64cd\u4f5c\uff0c\u672c\u6587\u5148\u5f9e\u7c21\u55ae\u7684\u628a\u9810\u8a2d\u5e33\u865f\u7f6e\u63db\u958b\u59cb\u505a\u8d77</p> <p></p> <p>\u5716\u7247\u51fa\u8655: \u3010\u6700\u7d42\u5e7b\u60f37\uff1a\u91cd\u88fd\u7248\u30114K\u96fb\u5f71\u526a\u8f2f\u7248(\u5f8c\u7bc7) - \u96f6\u6536\u96c6\u3001\u96fb\u5f71\u5f0f\u904b\u93e1\u3001\u5b8c\u6574\u5287\u60c5 - PS4 Pro\u589e\u5f37\u6a21\u5f0f - Final Fantasy VII: REMAKE - \u592a\u7a7a\u6230\u58eb7- Semenix\u51fa\u54c1</p> <p>\u8a71\u8aaa\u5927\u5bb6\u4e5f\u53ef\u4ee5\u591a\u591a\u652f\u6301\u4e00\u4e0b Semenix Gaming -  \u5927\u5927\u7684\u5f71\u7247\uff0c\u6211\u7684\u5716\u7247\u90fd\u662f\u622a\u4ed6\u7684\u983b\u9053\uff0c\u9304\u7684\u5f71\u7247\u76f8\u7576\u6709\u6c34\u6e96\uff0c\u6700\u8fd1\u90fd\u5728\u770b\u5b83\u7684\u5f71\u7247\u7576\u4f5c\u81ea\u5df1\u6709\u5728\u6253\u592a\u4e03 Q_Q</p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u4e94\u5929","text":"<p>\u9810\u8a2d\u525b\u88dd\u5b8c OpenShift 4\uff0c\u61c9\u8a72\u90fd\u6703\u62ff\u5230 3 \u500b\u8cc7\u8a0a</p> <ul> <li>Web Console: https://console-openshift-console.apps.ocp4.internal/dashboards</li> <li>Username: <code>kubeadmin</code></li> <li>Password: <code>XXXX-XXXX-XXXX-XXXX</code></li> </ul> <p>\u4f46\u56e0\u70ba\u9810\u8a2d\u5e33\u865f\u5c0e\u81f4\u7684\u8cc7\u5b89\u8b70\u984c\uff0c\u9019\u500b\u9810\u8a2d\u7684 <code>kubeadmin</code> \u53ca <code>XXXX-XXXX-XXXX-XXXX</code> \u4e0d\u5efa\u8b70\u6301\u7e8c\u4f7f\u7528\uff0c\u5efa\u8b70\u662f\u63db\u6210\u5225\u7684\u5e33\u865f\u66ff\u63db\u5b83\u65e2\u6709\u7684\u89d2\u8272 <code>cluster-admin</code>\uff0c\u8a73\u8acb\u53ef\u53c3\u8003 Removing the kubeadmin user - OpenShift 4.3</p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#htpasswd-identity-provider","title":"\u6e96\u5099 HTPasswd Identity Provider","text":"<p>\u9810\u8a08\u5c07 <code>kubeadmin</code> \u7f6e\u63db\u6210 <code>ocproot</code>\uff0c\u6b0a\u9650\u4e5f\u8981\u4e00\u4f75\u79fb\u8f49\uff0c\u5c07\u900f\u904e <code>HTPasswd Identity Porvider</code> \u7684\u65b9\u5f0f\u5c07\u5e33\u865f\u8a2d\u5b9a\u597d</p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#oauth","title":"\u8a2d\u5b9a OAuth \u8cc7\u6e90","text":"<p>\u9019\u908a\u5148\u958b\u555f\u4e00\u500b\u6a94\u6848 <code>oauth.yaml</code>\uff0c\u65b0\u589e <code>identityProvider</code> \u540d\u5b57\u70ba <code>local_htpasswd_provider</code>\uff0c\u5f62\u5f0f\u70ba <code>HTPasswd</code>\uff0c\u5e33\u865f\u5bc6\u78bc\u5c0d\u7167\u8868\u653e\u5728 <code>local-htpasswd-secret</code> \u88e1\u9762\u3002</p> <p>\u7576\u4e2d\u7684 <code>local-htpasswd-secret</code> \u5c07\u4e4b\u5f8c\u518d\u65b0\u589e\uff0c\u6240\u4ee5\u4e0d\u7528\u9019\u6642\u5019\u5148\u6e96\u5099</p> <p>```yaml oauth.yaml apiVersion: config.openshift.io/v1 kind: OAuth metadata:   name: cluster spec:   identityProviders:   - name: local_htpasswd_provider     challenge: true     login: true     mappingMethod: claim     type: HTPasswd     htpasswd:       fileData:         name: local-htpasswd-secret <pre><code>```bash\n# Update OAuth CRD\n$ oc apply -f oauth.yaml\noauth.config.openshift.io/cluster configured\n\n# Check\n$ oc describe oauth cluster\n\n# Update in the future if needed\n$ oc get oauth cluster -o yaml &gt; oauth.yaml\n</code></pre></p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#-ocproot","title":"\u8a2d\u5b9a\u65b0\u7684\u6700\u9ad8\u6b0a\u9650\u5e33\u865f - ocproot","text":"<p>\u9019\u908a\u5c0d\u7167\u904e\u5f80 Linux \u64cd\u4f5c\u7cfb\u7d71\u7684\u7fd2\u6163\uff0c\u6211\u81ea\u884c\u53d6\u540d <code>ocproot</code>\uff0c\u5982\u679c\u4f60\u60f3\u8981\u53d6\u5225\u7684\u4e5f\u53ef\u4ee5\uff0c\u8acb\u81ea\u884c\u4fee\u6539\u6c92\u554f\u984c</p> <ol> <li>\u78ba\u4fdd\u4f60\u6709 <code>htpasswd</code> \u53ef\u4ee5\u4f7f\u7528</li> </ol> <pre><code># Make sure you have htpasswd\n$ sudo yum install httpd-tools -y\n</code></pre> <ol> <li>\u65b0\u589e <code>local-htpasswd-secret</code> \u6a94\u6848\uff0c\u65b0\u589e <code>ocproot/ocproot</code> \u9032\u53bb</li> </ol> <pre><code># Create\n$ htpasswd -c -B -b localuser-htpasswd ocproot ocproot\nAdding password for user ocproot\n\n$ cat localuser-htpasswd\nocproot:$2y$05$pMTSySH/qa.gTcom9q/Pd.WHoI8VMIpCHWgc9d7cnQuIbRuuPeMia\n\n# Update if needed\n# $ htpasswd -b localuser-htpasswd ocproot ocproot\n\n# Remove if needed\n# $ htpasswd -D localuser-htpasswd ocproot ocproot\n</code></pre> <ol> <li>\u65b0\u589e <code>HTpasswd</code> \u9032\u53bb\u5230 OpenShift \u88e1\u9762</li> </ol> <pre><code>$ oc create secret generic local-htpasswd-secret --from-file htpasswd=/root/user/localuser-htpasswd -n openshift-config\nsecret/local-htpasswd-secret created\n</code></pre> <ol> <li>\u65b0\u589e\u53e2\u96c6\u6700\u9ad8\u6b0a\u9650 <code>cluster-admin</code> \u7d66 <code>ocproot</code></li> </ol> <pre><code>$ oc adm policy add-cluster-role-to-user cluster-admin ocproot\nclusterrole.rbac.authorization.k8s.io/cluster-admin added: \"ocproot\"\n</code></pre> <ol> <li>\u6e2c\u8a66 <code>ocproot</code> <pre><code>$ oc login -u ocproot\noc login -u ocproot\nAuthentication required for https://api.ocp4.internal:6443 (openshift)\nUsername: ocproot\nPassword:\nLogin successful.\n\n$ oc whoami\nocproot\n\n$ oc get users\nNAME      UID                                    FULL NAME   IDENTITIES\nocproot   3635b015-3664-4836-a5a0-2aff1100d99c               local_htpasswd_provider:ocproot\n</code></pre></li> </ol> <p></p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#kubeadmin","title":"\u79fb\u9664 <code>kubeadmin</code> \u5e33\u865f","text":"<p>\u6839\u64da Removing the kubeadmin user - OpenShift 4.3 \u4f86\u79fb\u9664\u9810\u8a2d\u5e33\u865f <code>kubeadmin</code>\uff0c\u52d9\u5fc5\u8981\u8a18\u5f97\uff0c\u4f60\u7684\u96c6\u7fa4\u88e1\u9762\u4e00\u5b9a\u8981\u6709</p> <ul> <li>\u4e00\u500b\u4ee5\u4e0a\u7684 <code>Identity Provider</code>\uff0c\u4e00\u822c\u90fd\u662f\u7528 <code>HTpasswd</code></li> <li>\u4e00\u500b\u4ee5\u4e0a\u7684\u5e33\u865f\u5177\u5099 <code>cluster-admin</code> \u7684\u6b0a\u9650</li> </ul> <p>\u4e0d\u7136\u4f60\u6703\u767b\u4e0d\u9032\u53bb\u96c6\u7fa4 = =\uff0c\u9019\u662f\u4e0d\u53ef\u9006\u7684\u6307\u4ee4</p> <pre><code># Remove it\n$ oc delete secrets kubeadmin -n kube-system\n</code></pre>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#_2","title":"\u4fee\u6539\u81ea\u52d5\u767b\u51fa\u6642\u9593","text":"<p>\u6839\u64da Configuring the internal OAuth server - OpenShift 4.3\uff0c\u8ddf OpenShift 3 \u4e00\u6a23\uff0c\u90fd\u662f\u8981\u4fee\u6539 <code>accessTokenMaxAgeSeconds</code> \u503c\uff0c\u9810\u8a2d\u6642\u9593\u61c9\u8a72\u662f <code>86400</code>\uff0c\u4e5f\u5c31\u662f 24 \u5c0f\u6642\u5f8c\u767b\u51fa\uff0c\u56e0\u70ba\u592a\u9577\u4e86\uff0c\u6240\u4ee5\u6539\u70ba <code>3600</code>\uff0c\u4e5f\u5c31\u662f\u767b\u5165 1 \u5c0f\u6642\u5f8c\u81ea\u52d5\u767b\u51fa</p> <p>```yaml oauth.yaml apiVersion: config.openshift.io/v1 kind: OAuth metadata:   name: cluster spec:   identityProviders:   - name: local_htpasswd_provider     challenge: true     login: true     mappingMethod: claim     type: HTPasswd     htpasswd:       fileData:         name: local-htpasswd-secret   tokenConfig:     accessTokenMaxAgeSeconds: 3600 <pre><code>\u5982\u540c\u4fee\u6539 OAuth \u3127\u6a23\uff0c\u57f7\u884c\u4e0b\u5217\u64cd\u4f5c\u5373\u53ef\n\n```bash\n# Update OAuth CRD\n$ oc apply -f oauth.yaml\noauth.config.openshift.io/cluster configured\n\n# Check\n$ oc describe oauth cluster\n</code></pre></p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#_3","title":"\u7d50\u8a9e","text":"<p>\u505a\u5b8c\u4e0a\u9762\u7684\u6b65\u9a5f\uff0c\u53ea\u662f\u525b\u525b\u597d\u6e96\u5099\u958b\u59cb\u4ee5\u6b63\u78ba\u4e14\u5b89\u5168\u7684\u59ff\u52e2\u64cd\u4f5c OpenShift 4\uff0c\u4e0b\u4e00\u7bc7\u6703\u63d0\u5230\u66f4\u8907\u96dc\u7684 Users/Groups/Projects \u7684 RBAC \u63a7\u5236\u64cd\u4f5c</p> <p>\u5c0d \u6211\u77e5\u9053\u4f60\u7684\u8840\u689d\u5c31\u8ddf\u4e0b\u5716\u3127\u6a23</p> <p></p>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#appendix","title":"Appendix","text":"","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#q-error-x509-certificate-signed-by-unknown-authority","title":"Q: \u767b\u5165\u6642\uff0c\u9047\u5230 <code>error: x509: certificate signed by unknown authority</code>","text":"<pre><code>$ oc login -u ocproot --insecure-skip-tls-verify=true\nerror: x509: certificate signed by unknown authority\n</code></pre> <p>\u9019\u554f\u984c\u662f\u56e0\u70ba\u9810\u8a2d\u662f\u81ea\u7c3d\u6191\u8b49 (Self-Signed)\uff0c\u7cfb\u7d71\u6c92\u6709\u5b89\u88dd\u9019\u5f35\u81ea\u7c3d\u7684 CA \uff0c\u6240\u4ee5\u8981\u7279\u5225\u62c9\u51fa\u4f86\u5b89\u88dd\u5728\u7cfb\u7d71\u6216\u8005\u662f\u5728\u4f60\u7684\u7b46\u96fb\u4e0a</p> <pre><code>$ oc project openshift-authentication\n\n# Same content\n$ oc get pods\nNAME                               READY   STATUS    RESTARTS   AGE\noauth-openshift-74fbdf999f-6kpnn   1/1     Running   0          10m\noauth-openshift-74fbdf999f-787cm   1/1     Running   0          10m\n\n# Pick one and copy the cert to outside\n$ oc rsh oauth-openshift-74fbdf999f-6kpnn cat /run/secrets/kubernetes.io/serviceaccount/ca.crt &gt; ocp4-ingress-ca.crt\n\n# It work on RHEL 7.7\n$ cp ocp4-ingress-ca.crt /etc/pki/ca-trust/source/anchors/\n$ update-ca-trust extract\n\n# Verify Cert is working\n$ openssl verify ocp4-ingress-ca.crt\nocp4-ingress-ca.crt: OK\n</code></pre>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#systemadmin","title":"\u5207\u63db\u56de <code>system:admin</code>","text":"<pre><code>$ oc whoami\nocproot\n$ oc config use-context admin\nSwitched to context \"admin\".\n$ oc whoami\nsystem:admin\n</code></pre>","tags":["openshift4","openshift"]},{"location":"20200427-openshift-with-coreos-part-5.html#references","title":"References","text":"<ul> <li>KB1519813: How to install a CA certificate on Red Hat Enterprise Linux 6 and later</li> <li>Removing the kubeadmin user - OpenShift 4.3</li> <li>OpenShift 4\u4e4b\u8bbe\u7f6e\u7528\u6237/\u7ec4\u5bf9\u9879\u76ee\u7684\u8bbf\u95ee\u6743\u9650</li> <li>OpenShift 4 \u4e4b\u589e\u52a0\u7ba1\u7406\u5458\u7528\u6237</li> <li>Configuring the internal OAuth server - OpenShift 4.3</li> </ul>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html","title":"Red Hat OpenShift RBAC \u6700\u5c0f\u6b0a\u9650\u5be6\u8e10","text":"<p>\u7e7c\u4e0a\u4e00\u7bc7\u6e96\u5099\u597d\u4e86\u57fa\u790e\u7684 OpenShift 4 \u8d85\u7d1a\u7ba1\u7406\u54e1 <code>ocproot</code> \u8a2d\u5b9a\u5f8c\uff0c\u63a5\u4e0b\u4f86\u5c31\u662f\u6bd4\u8f03\u91dd\u5c0d Project/Namespace \u4f86\u9032\u884c\u6bd4\u8f03\u7d30\u5fae\u7684 RBAC \u8a2d\u5b9a\uff0c\u76e1\u53ef\u80fd\u8b93 User \u6216 Group \u9069\u7528\u65bc<code>\u6700\u5c0f\u6b0a\u9650\u539f\u5247</code></p> <p></p>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u516d\u5929","text":"","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#openshift-project","title":"\u5e38\u898b OpenShift Project \u6b0a\u9650\u6307\u6d3e","text":"<p>OpenShift \u57fa\u672c\u4e0a\u6703\u6709 Users/Groups/Projects \u53ef\u4ee5\u9032\u884c\u7ba1\u7406\uff0c\u4ee5\u4e0b\u53c3\u8003 OpenShift 4\u4e4b\u8bbe\u7f6e\u7528\u6237/\u7ec4\u5bf9\u9879\u76ee\u7684\u8bbf\u95ee\u6743\u9650 \u7684\u6587\u7ae0\u4f86\u5be6\u4f5c</p> <p>\u91dd\u5c0d\u5c08\u6848 <code>project-cicd</code>\u3001<code>project-uat</code> \u4e4b RBAC \u6b0a\u9650\u5206\u914d\u5982\u5716\u793a</p> <p></p> <ul> <li>Users</li> <li>Administrators<ul> <li>admin1/admin1</li> <li>admin2/admin2</li> </ul> </li> <li>Developers<ul> <li>developer1/developer1</li> <li>developer2/developer2</li> </ul> </li> <li>Testers<ul> <li>tester1/tester1</li> <li>tester2/tester2</li> </ul> </li> <li>Groups</li> <li>admin-group: \u5c0d\u65bc <code>project-cicd</code> \u53ca <code>project-uat</code>\uff0c\u5177\u5099\u6700\u9ad8\u6b0a\u9650</li> <li>developer-group: \u5c0d\u65bc <code>project-cicd</code> \u5c08\u6848\u5177\u5099\u8a2d\u5b9a\u6b0a\u9650\uff0c\u5c0d <code>project-uat</code> \u50c5\u6709\u67e5\u770b\u6b0a\u9650</li> <li>tester-group: \u5c0d\u65bc <code>project-uat</code> \u5c08\u6848\u5177\u5099\u8a2d\u5b9a\u6b0a\u9650\uff0c\u5c0d <code>project-cicd</code> \u50c5\u6709\u67e5\u770b\u6b0a\u9650</li> <li>Projects</li> <li>project-cicd: \u958b\u767c\u7528\u74b0\u5883</li> <li> <p>project-uat: UAT \u74b0\u5883</p> </li> <li> <p>\u5982\u679c\u6c92\u5b58\u7684\u8a71\uff0c\u6488\u51fa\u65e2\u6709\u74b0\u5883 <code>htpasswd</code> \u6a94\u6848 <pre><code>$ oc get secret local-htpasswd-secret  -ojsonpath={.data.htpasswd} -n openshift-config | base64 -d | tee localuser-htpasswd\n</code></pre></p> </li> <li> <p>\u65b0\u589e 6 \u500b\u597d\u6f22\u9032 <code>localuser-htpasswd</code> <pre><code># \u7ba1\u7406\u4eba\u54e1 admin1\u3001admin2 \u7686\u5177\u5099 project-cicd\u3001project-uat \u6700\u9ad8\u6b0a\u9650\n$ htpasswd -b localuser-htpasswd admin1 admin1\n$ htpasswd -b localuser-htpasswd admin2 admin2\n\n# \u958b\u767c\u4eba\u54e1 developer1 \u8a2d\u5b9a\u55ae\u4e00\u5c08\u6848 project-cicd \u6b0a\u9650 \u4e14 \u6aa2\u8996\u55ae\u4e00\u5c08\u6848 project-uat \u6b0a\u9650\n$ htpasswd -b localuser-htpasswd developer1 developer1\n\n# \u958b\u767c\u4eba\u54e1 developer2 \u8a2d\u5b9a\u55ae\u4e00\u5c08\u6848 project-cicd \u6b0a\u9650 \u4e14 \u6aa2\u8996\u55ae\u4e00\u5c08\u6848 project-uat \u6b0a\u9650\n$ htpasswd -b localuser-htpasswd developer2 developer2\n\n# \u6e2c\u8a66\u4eba\u54e1 tester1 \u8a2d\u5b9a\u55ae\u4e00\u5c08\u6848 project-uat \u6b0a\u9650 \u4e14 \u6aa2\u8996\u55ae\u4e00\u5c08\u6848 project-cicd \u6b0a\u9650\n$ htpasswd -b localuser-htpasswd tester1 tester1\n\n# \u6e2c\u8a66\u4eba\u54e1 tester2 \u8a2d\u5b9a\u55ae\u4e00\u5c08\u6848 project-uat \u6b0a\u9650 \u4e14 \u6aa2\u8996\u55ae\u4e00\u5c08\u6848 project-cicd \u6b0a\u9650\n$ htpasswd -b localuser-htpasswd tester2 tester2\n</code></pre></p> </li> <li> <p>\u6aa2\u67e5 localuser-htpasswd <pre><code># Show all user mapping\n$ cat localuser-htpasswd\nocproot:$2y$05$pMTSySH/qa.gTcom9q/Pd.WHoI8VMIpCHWgc9d7cnQuIbRuuPeMia\ndeveloper1:$apr1$f7fpvHKb$X.MnMay0USf0.SOg/4hm6.\ndeveloper2:$apr1$FtL.4QEj$lQgfnYB42klWq5.BYnUxx0\ntester1:$apr1$AuGDNNK/$U9Y0ytnT3qrakKat6jYkD1\ntester2:$apr1$z1H./q7P$cvi62jxjmDOyMHQ/Gsx6R0\nadmin1:$apr1$tUyAimmD$uXc2my4xMGitt/hekx6SH/\nadmin2:$apr1$rbFALSqT$6emskSJsH8LD0ptM5eXlK1\n</code></pre></p> </li> <li> <p>\u66f4\u65b0\u65e2\u6709\u7684 <code>local-htpasswd-secret</code> <pre><code>$ oc create secret generic local-htpasswd-secret --from-file htpasswd=/root/user/localuser-htpasswd --dry-run -o yaml -n openshift-config | oc replace -f -\nsecret/local-htpasswd-secret replaced\n</code></pre></p> </li> </ul>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#_2","title":"\u7ba1\u7406\u8cc7\u6e90\u53ca\u8ce6\u4e88\u6b0a\u9650","text":"<p>OpenShfit \u9810\u8a2d\u6b0a\u9650\u63a7\u5236\u80fd\u505a\u5230 3 \u7a2e\u5c64\u7d1a\uff0c\u5206\u5225\u662f\uff1a 1. \u6307\u5b9a Roles \u7d66 user \u6216 groups   - role-to-user   - role-to-group 2. \u6307\u5b9a Cluster Roles \u7d66 users \u6216 groups   - cluster-role-to-user   - cluster-role-to-group 3. \u6307\u5b9a SCC (Security Context Constraints) \u4f86\u7ba1\u7406 Pods \u548c Containers \u7d66 users \u6216 groups   - scc-to-user   - scc-to-group</p> <p>\u5982\u679c\u60f3\u8981\u67e5\u8a62\u6709\u4ec0\u9ebc Role \u53ef\u4ee5\u4f7f\u7528\u7684\u8a71\uff0c\u53ef\u4ee5\u7528 <code>oc get clusterrole.rbac</code> \u6488\uff0c\u76f8\u7576\u591a\u8a18\u5f97\u8981 filter \u4e00\u4e0b</p> <pre><code># Create Projects\n$ oc new-project project-cicd\n$ oc new-project project-uat\n\n# Create groups\n$ oc adm groups new admin-group\n$ oc adm groups new developer-group\n$ oc adm groups new tester-group\n\n# Assgin Users and Groups\n$ oc adm groups add-users admin-group admin1 admin2\ngroup.user.openshift.io/admin-group added: [\"admin1\" \"admin2\"]\n\n$ oc adm groups add-users developer-group developer1 developer2\ngroup.user.openshift.io/developer-group added: [\"developer1\" \"developer2\"]\n\n$ oc adm groups add-users tester-group tester1 tester2\ngroup.user.openshift.io/tester-group added: [\"tester1\" \"tester2\"]\n\n# Assgin Role to Group within Project\n# For admin-group\n$ oc adm policy add-role-to-group admin admin-group -n project-cicd\n$ oc adm policy add-role-to-group admin admin-group -n project-uat\n\n# For developer-group\n$ oc adm policy add-role-to-group edit developer-group -n project-cicd\n$ oc adm policy add-role-to-group view developer-group -n project-uat\n\n# For tester-group\n$ oc adm policy add-role-to-group edit tester-group -n project-cicd\n$ oc adm policy add-role-to-group view tester-group -n project-uat\n</code></pre>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#appendix","title":"Appendix","text":"","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#rbac","title":"\u4e86\u89e3 RBAC \u89d2\u8272\u6b0a\u9650","text":"<p>\u4f9d\u7167 OpenShift \u9810\u8a2d RBAC \u89d2\u8272\u5b9a\u7fa9\uff0c\u6211\u5011\u65b0\u589e\u4ee5\u4e0b\u5e33\u865f\u9032\u53bb\u89c0\u6e2c\uff0c\u4e26\u4e14\u505a\u500b\u57fa\u672c\u6b78\u7d0d   - cluster-admin-user/cluster-admin   - cluster-status-user/cluster-status   - admin-user/admin   - basic-user/basic-user   - self-provisioner-user/self-provisioner   - edit-user/edit   - view-user/view</p> <ol> <li> <p>\u65b0\u589e\u5e33\u865f <pre><code># cluster-admin\uff0c\u985e\u540c\u65bc Linux root \u5728 OpenShift \u4e2d\u7684\u8d85\u7d1a\u7ba1\u7406\u54e1\u89d2\u8272\n$ htpasswd -b localuser-htpasswd cluster-admin-user cluster-admin\n\n# cluster-status\uff0c\u53ef\u4ee5\u7372\u53d6\u57fa\u672c\u7684 Cluster \u8cc7\u8a0a\n$ htpasswd -b localuser-htpasswd cluster-status-user cluster-status\n\n# admin\uff0c\u5c08\u6848\u7ba1\u7406\u8005\uff0c\u53ef\u4ee5\u67e5\u770b\u4fee\u6539\u5c08\u6848\u4e2d\u4efb\u4f55\u8cc7\u8a0a\n$ htpasswd -b localuser-htpasswd admin-user admin\n\n# basic-user\uff0c\u53ef\u4ee5\u6aa2\u8996\u5c08\u6848\u4e2d\u4efb\u4f55\u8cc7\u8a0a\n$ htpasswd -b localuser-htpasswd basic-user basic-user\n\n# self-provisioner\uff0c\u53ef\u4ee5\u81ea\u5df1\u958b\u5c08\u6848\n$ htpasswd -b localuser-htpasswd self-provisioner-user self-provisioner\n\n# edit\uff0c\u53ef\u4ee5\u4fee\u6539\u8cc7\u6e90\uff0c\u4f46\u4e0d\u80fd\u770b\u4e14\u4fee\u6539 Role \u7d81\u5b9a\n$ htpasswd -b localuser-htpasswd edit-user edit\n\n# view\uff0c\u53ea\u80fd\u6aa2\u8996\u8cc7\u6e90\uff0c\u4f46\u4e0d\u80fd\u9032\u884c\u4efb\u4f55\u4fee\u6539\n$ htpasswd -b localuser-htpasswd view-user view\n</code></pre></p> </li> <li> <p>\u66f4\u65b0\u65e2\u6709\u7684 <code>local-htpasswd-secret</code> <pre><code>$ oc create secret generic local-htpasswd-secret --from-file htpasswd=/root/user/localuser-htpasswd --dry-run -o yaml -n openshift-config | oc replace -f -\nsecret/local-htpasswd-secret replaced\n</code></pre></p> </li> <li> <p>\u5404\u500b\u986f\u793a User \u72c0\u614b <pre><code># https://docs.openshift.com/container-platform/4.3/authentication/using-rbac.html#default-roles_using-rbac\n\n# Cluster Level\n# \u5e38\u7528\u65bc\u96c6\u7fa4\u7ba1\u7406\u54e1\uff0c\u985e\u540c\u65bc Linux root \u7684\u5b58\u5728\n$ oc adm policy add-cluster-role-to-user cluster-admin cluster-admin-user\n$ oc describe clusterrole.rbac.authorization.k8s.io/cluster-admin\n\n$ oc adm policy add-cluster-role-to-user cluster-status cluster-status-user\n$ oc describe clusterrole.rbac cluster-status\n\n# Project Level\n# \u5e38\u7528\u65bc\u6307\u5b9a Project \u5177\u5099 administrator \u6b0a\u9650\n$ oc adm policy add-role-to-user admin admin-user\n$ oc describe clusterrole.rbac admin\n\n# \u5e38\u7528\u65bc\u6307\u5b9a Project \u5177\u5099 edit \u6b0a\u9650\uff0c\u4f8b\u5982\u958b\u767c\u4eba\u54e1\n$ oc adm policy add-role-to-user edit edit-user\n$ oc describe clusterrole.rbac edit\n\n# \u5e38\u7528\u65bc\u6307\u5b9a Project \u5177\u5099 view \u6b0a\u9650\uff0c\u4f8b\u5982\u975e\u958b\u767c\uff0c\u4f46\u5177\u5c08\u6848\u76f8\u95dc\u6027\u4e4b\u4eba\u54e1\n$ oc adm policy add-role-to-user view view-user\n$ oc describe clusterrole.rbac view\n\n# Misc\n# \u904a\u5ba2\u5e33\u865f\n$ oc adm policy add-role-to-user basic-user basic-user\n$ oc describe clusterrole.rbac basic-user\n\n$ oc adm policy add-role-to-user self-provisioner self-provisioner-user\n$ oc describe clusterrole.rbac self-provisioner\n</code></pre></p> </li> </ol>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#_3","title":"\u5f8c\u8a71","text":"<p>\u4f9d\u64da Introduction To Ethical Hacking \u4e2d\u7684\u5b89\u5168 (Security), \u529f\u80fd (Functionality) \u548c\u65b9\u4fbf (Usability) \u5927\u4e09\u89d2</p> <p></p> <p>\u9019\u500b\u5927\u4e09\u89d2\u662f\u4ee3\u8868\uff0c\u82e5\u4f60\u662f\u8981\u7cfb\u7d71\uff0c\u6bd4\u8f03\u5b89\u5168\u53ca\u5177\u5099\u5b8c\u6574\u529f\u80fd\uff0c\u90a3\u5c31\u4e0d\u53ef\u80fd\u6703\u5f88\u65b9\u4fbf\u4f7f\u7528\uff0c\u53cd\u4e4b\uff0c\u5982\u679c\u8981\u5b89\u5168\u53c8\u8981\u65b9\u4fbf\u4f7f\u7528\uff0c\u90a3\u529f\u80fd\u5c31\u4e0d\u6703\u591a\u3002\u800c OpenShift \u770b\u8d77\u4f86\u662f\u6bd4\u8f03\u504f\u5411\u5b89\u5168\u548c\u529f\u80fd\u9019\u908a\uff0c\u6240\u4ee5\u4e0d\u719f\u6089\u57fa\u672c\u64cd\u4f5c\u7684\u8a71\uff0c\u6703\u89ba\u5f97\u6709\u9ede\u7384\uff0c\u4f60\u6709\u6c92\u6709\u89ba\u5f97\u9019\u500b\u8ddf\u7576\u5e74\u5b78 Linux \u4f5c\u696d\u7cfb\u7d71\u975e\u5e38\u50cf\u5462\uff1f</p>","tags":["openshift4","openshift"]},{"location":"20200502-openshift-with-coreos-part-6.html#references","title":"References","text":"<ul> <li>Using RBAC - OpenShift 4.3</li> <li>OpenShift 4\u4e4b\u8bbe\u7f6e\u7528\u6237/\u7ec4\u5bf9\u9879\u76ee\u7684\u8bbf\u95ee\u6743\u9650</li> <li>OpenShift 4\u4e4b\u8bbf\u95ee\u6743\u9650\u5206\u7ea7\u6388\u6743</li> <li>OpenShift 4 Hands-on Lab (9) \u7528\u6237\u8eab\u4efd\u8ba4\u8bc1\u548c\u8d44\u6e90\u8bbf\u95ee\u9650\u5236</li> <li>\u611b\u7684\u8d70\u99ac\u770b\u82b1 Red Hat CoreOS \u8207 Red Hat OpenShift Part 5</li> <li>Introduction To Ethical Hacking</li> </ul>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html","title":"Red Hat OpenShift Pod \u8207 Container \u7684\u611b\u6068\u60c5\u4ec7","text":"<p>\u9019\u5e7e\u5929\u6709\u4f4d\u5ba2\u6236\u554f\u4e86\u4e00\u500b\u5f88\u4e0d\u932f\u7684\u554f\u984c</p> <p>\u5982\u679c\u5728 1 \u500b Pod \u88e1\u9762\uff0c\u6709 2 \u500b Containers \u7684\u72c0\u6cc1\u4e0b\uff0cOpenShift \u8a72\u5982\u4f55\u91dd\u5c0d\u7279\u5b9a\u7684 Container \u9032\u884c\u64cd\u4f5c?</p> <p>\u6309\u7167 Kuberentes \u7684\u8a2d\u8a08\uff0cKubernetes \u6700\u5c0f\u55ae\u4f4d\u662f Pod\uff0c\u800c\u4e0d\u662f Container\uff0c\u7136\u800c 1 \u500b Pod\uff0c\u53ef\u4ee5\u6709 1 \u500b\u6216\u591a\u500b\u7684 Container \u88ab\u5305\u542b\u5728\u88e1\u9762\uff0c\u5716\u793a\u53ef\u4ee5\u53c3\u8003 20190817 Container Bare Metal for Networking\uff0c\u4f46\u5be6\u969b\u4e0a\u9047\u5230\u591a\u500b Container \u88ab\u5305\u542b\u5728 1 \u500b Pods \u7684\u6642\u5019\uff0c\u5728 OpenShift \u88e1\u9762\u662f\u600e\u9ebc\u64cd\u4f5c\u7684\u5462? \u79c9\u6301\u8457\u672c\u4eba\u9075\u5faa\u5ba2\u6236\u9a45\u52d5\u670d\u52d9 (Customer Driven Service)\uff0c\u7279\u5225\u5beb\u4e00\u7bc7\u8a18\u9304</p> <p>\u56e0\u70ba\u6700\u8fd1\u592a\u7d2f\uff0c\u61f6\u5f97\u60f3\u6897\u5716\uff0c\u6240\u4ee5\u9644\u4e0a\u4e00\u500b\u8fd1\u671f\u6211\u89ba\u5f97\u76f8\u7576\u4e0d\u932f\u7684 Demo\uff0c\u5728 OpenShift \u88e1\u9762\u958b Windows Server 2019 \u8d77\u4f86\u505a\u4f7f\u7528</p> <p>{% youtube Kx110kqoHo0 %}</p>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#_1","title":"\u8d70\u99ac\u770b\u82b1\u4e4b\u65c5: \u7b2c\u4e03\u5929","text":"","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#pods-container","title":"\u986f\u793a\u4e00\u500b Pods \u88e1\u9762\u6240\u5305\u542b\u7684 Container","text":"<p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c\u5176\u5be6\u5167\u5efa\u7684 <code>api-resources</code> \u4e26\u6c92\u6709\u5305\u542b\u4e00\u500b\u985e\u578b\u662f <code>container</code>\uff0c\u6240\u4ee5\u5982\u679c\u8981\u77e5\u9053\u4e00\u500b Pod \u88e1\u9762\u6709\u5305\u542b\u591a\u5c11\u500b Container \u80fd\u7528\u4e0b\u5217 2 \u500b\u65b9\u5f0f\u627e</p> <ol> <li> <p>\u900f\u904e oc \u6307\u4ee4 filter \u51fa\u4f86 <pre><code># \u5148\u7372\u5f97\u5230 Pod \u6e05\u55ae\uff0c\u9019\u908a\u9078\u64c7 productpage-v1-597b74b4c-x2pgk\n$ oc get pods\n\nNAME                             READY   STATUS    RESTARTS   AGE\ndetails-v1-6657b8bdf-mm4r4       2/2     Running   0          34m\nproductpage-v1-597b74b4c-x2pgk   2/2     Running   0          34m\nratings-v1-66cddbfb8f-wvpbz      2/2     Running   0          34m\nreviews-v1-6788566f98-slm9q      2/2     Running   0          34m\nreviews-v2-7c4bffdcc4-6wmg2      2/2     Running   0          34m\nreviews-v3-69b6d8786-rbhw5       2/2     Running   0          34m\n\n# oc get pods &lt;PDO NAME&gt; -o jsonpath='{.spec.containers[*].name}'\n$ oc get pods productpage-v1-597b74b4c-x2pgk -o jsonpath='{.spec.containers[*].name}'\n\nproductpage istio-proxy\n</code></pre></p> </li> <li> <p>\u900f\u904e OpenShift Web Console</p> </li> </ol> <p>\u9019\u500b\u505a\u6cd5\u662f\u76f4\u63a5\u900f\u904e\u76f8\u7576\u597d\u7528\u7684 Web Console \u76f4\u63a5\u89c0\u5bdf\uff0c\u76f4\u89c0\u65b9\u4fbf</p> <p></p>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#container","title":"\u767b\u5165\u5176\u4e2d\u4e00\u500b Container \u88e1\u9762","text":"<p>\u4e00\u6a23\u4e5f\u662f 2 \u7a2e\u65b9\u5f0f</p> <ol> <li>\u900f\u904e oc rsh \u6307\u4ee4</li> </ol> <p>Red Hat OpenShift \u6709\u4e00\u500b\u5167\u5efa\u7684\u6307\u4ee4\u53ef\u4ee5\u505a\u5230 - <code>oc rsh</code></p> <p>oc rsh = Open a remote shell session to a container</p> <p>\u4e00\u822c\u72c0\u6cc1\u4e0b\uff0c<code>oc rsh &lt;PDO NAME&gt;</code> \u90fd\u662f\u76f4\u63a5\u9023\u5230<code>\u7b2c\u4e00\u500b</code> Container\uff0c\u5982\u679c\u8981\u9078\u64c7\u88e1\u9762\u7684\u7b2c\u4e8c\u500b\uff0c\u66f4\u751a\u81f3\u662f\u7b2c\u4e09\u500b\u7684\u5bb9\u5668\uff0c\u5247\u9700\u8981\u7279\u5225\u591a\u4e00\u500b <code>--container</code> \u6307\u5b9a\uff0c\u66f4\u591a\u5167\u5bb9\u53ef\u4ee5\u76f4\u63a5\u53c3\u8003 <code>oc rsh -h</code></p> <pre><code># Open a shell session on the container named 'index' inside a pod\n# oc rsh -c &lt;CONTAINER NAME&gt; pod/&lt;PDO NAME&gt;\n$ oc rsh -c istio-proxy pod/productpage-v1-597b74b4c-x2pgk\n\nsh-4.4$ ls\nbin   dev  home  lib64       media  opt   root  sbin  sys  usr\nboot  etc  lib   lost+found  mnt    proc  run   srv   tmp  var\n\n$ oc rsh -c productpage pod/productpage-v1-597b74b4c-x2pgk\n\n$ ls\n__pycache__       productpage.py    static      stdout.log  test_productpage.py\nmicroservice.log  requirements.txt  stderr.log  templates\n</code></pre> <p>\u597d\u6211\u77e5\u9053\u5404\u4f4d\u4e00\u5b9a\u770b\u4e0d\u61c2\uff0c\u4e0b\u9762\u6709\u622a\u5716</p> <p></p> <ol> <li>\u900f\u904e OpenShift Web Console</li> </ol> <p>\u76f8\u7576\u76f4\u89c0\u5c31\u662f\u76f4\u63a5\u5c0d Web Console \u64cd\u4f5c\uff0c\u5982\u4e0b\u5716\u793a\u8868\u73fe</p> <p></p>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#container_1","title":"\u91dd\u5c0d\u5176\u4e2d\u4e00\u500b Container \u9664\u932f","text":"<p>\u53ea\u6709\u4e00\u500b\u4f5c\u6cd5\uff0c\u900f\u904e Red Hat OpenShift \u5167\u5efa\u7684\u6307\u4ee4 - <code>oc debug</code></p> <p>oc debug = Launch a command shell to debug a running application</p> <p>\u4e00\u822c\u72c0\u6cc1\u4e0b\uff0c\u5982\u540c <code>oc rsh</code>\uff0c\u4f7f\u7528 <code>oc debug</code> \u6642\uff0c\u90fd\u662f\u76f4\u63a5\u9023\u5230<code>\u7b2c\u4e00\u500b</code> Container\uff0c\u5982\u679c\u8981\u9078\u64c7\u88e1\u9762\u7684\u7b2c\u4e8c\u500b\uff0c\u66f4\u751a\u81f3\u662f\u7b2c\u4e09\u500b\u7684\u5bb9\u5668\uff0c\u5247\u9700\u8981\u7279\u5225\u591a\u4e00\u500b <code>--container</code> \u6307\u5b9a\uff0c\u66f4\u591a\u5167\u5bb9\u53ef\u4ee5\u76f4\u63a5\u53c3\u8003 <code>oc debug -h</code></p> <pre><code>$ oc debug -c istio-proxy pod/productpage-v1-597b74b4c-x2pgk\n\nStarting pod/productpage-v1-597b74b4c-x2pgk-debug ...\nPod IP: 10.128.2.27\nIf you dont see a command prompt, try pressing enter.\n\nsh-4.4$ ls\nbin   dev  home  lib64       media  opt   root  sbin  sys  usr\nboot  etc  lib   lost+found  mnt    proc  run   srv   tmp  var\nsh-4.4$\n\n$ oc debug -c productpage pod/productpage-v1-597b74b4c-x2pgk\nStarting pod/productpage-v1-597b74b4c-x2pgk-debug ...\nPod IP: 10.128.2.28\nIf you dont see a command prompt, try pressing enter.\n\n$ ls\n__pycache__       productpage.py    static     test_productpage.py\nmicroservice.log  requirements.txt  templates\n$\n</code></pre> <p>\u4e00\u6a23\u6211\u77e5\u9053\u5404\u4f4d\u9084\u662f\u770b\u4e0d\u61c2\uff0c\u622a\u5716\u5982\u4e0b</p> <p></p>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#_2","title":"\u5f8c\u8a71","text":"<p>\u5982\u679c\u6709\u4ed4\u7d30\u770b\u5167\u5bb9\u7684\u8a71\uff0c\u5176\u5be6\u6211\u7684\u64cd\u4f5c\u74b0\u5883\u5c31\u662f\u5efa\u597d\u4e00\u500b bookinfo \u4e4b\u5f8c\uff0cService Mesh \u81ea\u52d5\u6ce8\u5165 (inject) Sidecard \u9032\u53bb\u5230\u6bcf\u4e00\u500b Pod\uff0c\u6240\u4ee5\u624d\u6703\u6709 1 \u500b Pod \u6703\u6709 2 \u500b Container \u7684\u73fe\u8c61\u767c\u751f\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u500b\u4eba\u7d93\u9a57\u9084\u6709\u5982\u679c\u9700\u8981\u6574\u5408\u7db2\u8def\u5ee0\u5546\u6240\u63d0\u4f9b\u7684 CNI Plugin\uff0c\u4e5f\u6709\u6a5f\u6703\u6703\u9047\u5230\u9019\u7a2e\u7b49\u7d1a\u7684\u64cd\u4f5c</p> <p>\u7d50\u8ad6\u4e0a\u4f86\u8aaa\uff0c\u96d6\u7136 Kubernetes \u6700\u5c0f\u55ae\u4f4d\u662f Pod\uff0c\u4e00\u822c\u64cd\u4f5c\u7684\u5c64\u7d1a\u90fd\u662f\u5728\u9019\u500b\u5c64\u7d1a\uff0c\u4f46\u82e5\u60f3\u5728 OpenShift \u4e0a\u91dd\u5c0d\u7279\u5b9a\u7684 Container \u9032\u884c\u6307\u4ee4\u64cd\u4f5c\u3001\u9664\u932f\uff0c\u90fd\u9084\u662f\u53ef\u4ee5\u5f88\u8f15\u9b06\u5730\u8fa6\u5230\uff0c\u4e5f\u76f8\u7576\u7684\u76f4\u89ba</p> <p>\u6700\u5f8c\uff0c\u8acb\u5927\u5bb6\u591a\u591a\u8a02\u95b1 Red Hat \u670d\u52d9\u3001\u5206\u4eab\u958b\u6e90\u6280\u8853\u53ca\u958b\u555f\u6280\u8853\u53cb\u5584\u597d\u74b0\u5883\uff0c\u6211\u5011\u5b85\u5b85\u5011\u5c31\u9760\u5404\u4f4d\u5ba2\u6236\u990a\u4e86 XD</p>","tags":["openshift4","openshift"]},{"location":"20200521-openshift-with-coreos-part-7.html#references","title":"References","text":"<ul> <li>20190817 Container Bare Metal for Networking</li> </ul>","tags":["openshift4","openshift"]},{"location":"20200528-openshift-etcd-operator-1.html","title":"Red Hat OpenShift 4 \u7684 etcd \u4e4b\u5e7e\u500b\u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u4e8b\u4e4b\u4e00","text":"<p>\u6253\u5f9e OpenShift 4 \u4e4b\u5f8c\uff0cetcd \u7684\u5b89\u88dd\u8b8a\u6210\u662f\u900f\u904e <code>etcd-operator</code> \u4f86\u9032\u884c\u5b89\u88dd\u7684\uff0c\u9810\u8a2d\u72c0\u6cc1\u4e0b\u4e00\u6b21\u6703\u5efa\u7acb 3 \u500b etcd instances\uff0c\u7136\u5f8c\u628a\u4ed6\u5011\u5f04\u6210\u4e00\u500b etcd cluster\uff0c\u672c\u6587\u6703\u8a18\u9304\u4e00\u4e9b\u95dc\u65bc OpenShift \u8ddf etcd \u4e4b\u9593\u7684\u4e00\u4e9b\u64cd\u4f5c\u8a18\u9304</p> <p></p>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#oc-etcd","title":"\u900f\u904e oc \u6aa2\u67e5 etcd \u72c0\u614b","text":"<p>\u6838\u5fc3\u4e2d\u7684\u6838\u5fc3\uff0c\u6b63\u5e38\u72c0\u614b\u4e0b\u4e00\u5b9a\u662f\u8981\u597d\u7684\uff0c\u5b83\u7684\u7a69\u5b9a\u6027\u6703\u76f4\u63a5\u95dc\u806f\u5230 etcd \u53e2\u96c6\u7684\u7a69\u5b9a\u6027\uff0c\u5169\u9ede\u4e4b\u9593\u5efa\u8b70\u9808\u4f4e\u65bc <code>&gt;100ms</code></p> <pre><code>$ oc get pods -n openshift-etcd -o wide | grep etcd\n\netcd-control-plane-0                3/3     Running     0          2d3h   10.0.97.1     control-plane-0   &lt;none&gt;           &lt;none&gt;\netcd-control-plane-1                3/3     Running     0          2d3h   10.0.97.2     control-plane-1   &lt;none&gt;           &lt;none&gt;\netcd-control-plane-2                3/3     Running     0          2d3h   10.0.97.3     control-plane-2   &lt;none&gt;           &lt;none&gt;\n</code></pre>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#etcd","title":"\u6aa2\u67e5 etcd \u53e2\u96c6\u72c0\u614b","text":"<p>\u63a1\u7528\u8ddf\u524d\u4e00\u7bc7\u4ecb\u7d39\u7684\u65b9\u6cd5 Red Hat OpenShift Pod \u8207 Container \u7684\u611b\u6068\u60c5\u4ec7 \u9032\u884c <code>etcdctl</code> \u7684\u57fa\u790e\u64cd\u4f5c</p> <pre><code>$ oc rsh -n openshift-etcd etcd-control-plane-0\nDefaulting container name to etcdctl.\nUse 'oc describe pod/etcd-control-plane-0 -n openshift-etcd' to see all of the containers in this pod.\n\nsh-4.2# etcdctl version\netcdctl version: 3.3.18\nAPI version: 3.3\n\nsh-4.2# etcdctl endpoint status -w table\n+------------------------+------------------+---------+---------+-----------+-----------+------------+\n|        ENDPOINT        |        ID        | VERSION | DB SIZE | IS LEADER | RAFT TERM | RAFT INDEX |\n+------------------------+------------------+---------+---------+-----------+-----------+------------+\n| https://10.0.97.1:2379 | 8e7cdeadd4c04bd3 |  3.3.18 |  168 MB |      true |       109 |   35522525 |\n| https://10.0.97.2:2379 | 65124c220e1d1efa |  3.3.18 |  168 MB |     false |       109 |   35522525 |\n| https://10.0.97.3:2379 | 23675b8f347a5bea |  3.3.18 |  168 MB |     false |       109 |   35522525 |\n+------------------------+------------------+---------+---------+-----------+-----------+------------+\n\nsh-4.2# etcdctl endpoint health -w table\n+------------------------+--------+-------------+-------+\n|        ENDPOINT        | HEALTH |    TOOK     | ERROR |\n+------------------------+--------+-------------+-------+\n| https://10.0.97.3:2379 |   true |  12.52718ms |       |\n| https://10.0.97.2:2379 |   true | 16.830977ms |       |\n| https://10.0.97.1:2379 |   true | 21.484222ms |       |\n+------------------------+--------+-------------+-------+\n\nsh-4.2# etcdctl member list -w table\n+------------------+---------+-----------------+------------------------+------------------------+\n|        ID        | STATUS  |      NAME       |       PEER ADDRS       |      CLIENT ADDRS      |\n+------------------+---------+-----------------+------------------------+------------------------+\n| 23675b8f347a5bea | started | control-plane-2 | https://10.0.97.3:2380 | https://10.0.97.3:2379 |\n| 65124c220e1d1efa | started | control-plane-1 | https://10.0.97.2:2380 | https://10.0.97.2:2379 |\n| 8e7cdeadd4c04bd3 | started | control-plane-0 | https://10.0.97.1:2380 | https://10.0.97.1:2379 |\n+------------------+---------+-----------------+------------------------+------------------------+\n</code></pre>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#etcdctl","title":"\u4f7f\u7528 etcdctl \u539f\u751f\u6548\u80fd\u6aa2\u67e5","text":"<p>\u627f\u4e0a\uff0c\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 etcdctl \u505a\u4e00\u500b 60 \u79d2\u7684\u6aa2\u6e2c\uff0c <pre><code>sh-4.2# etcdctl check perf -w table\n 60 / 60 Boooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo! 100.00%1m0s\nPASS: Throughput is 150 writes/s\nPASS: Slowest request took 0.134647s\nPASS: Stddev is 0.003738s\nPASS\n</code></pre></p>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#_1","title":"\u95dc\u65bc\u9810\u8a2d\u53c3\u6578","text":"<p>\u900f\u904e <code>oc describe pod/etcd-control-plane-0 -n openshift-etcd</code> \u53ef\u77e5\uff0c</p> <ol> <li>ETCD \u9078\u8209\u8d85\u6642\u9810\u8a2d\u6642\u9593 (ETCD_ELECTION_TIMEOUT): 1000ms</li> <li>ETCD \u5fc3\u8df3\u9593\u9694\u9810\u8a2d\u6642\u9593 (ETCD_HEARTBEAT_INTERVAL): 100ms</li> </ol> <p>etcd \u7684\u5206\u6563\u5f0f\u4e00\u81f4\u6027\u5354\u5b9a\u4ef0\u8cf4\u4e0a\u8ff0 2 \u500b\u53c3\u6578\u4f86\u4fdd\u8b49\u7bc0\u9ede\u4e4b\u9593\u80fd\u5920\u5728\u90e8\u5206\u7bc0\u9ede\u65b7\u7dda\u7684\u72c0\u6cc1\u4e0b\u4f9d\u7136\u80fd\u5920\u6b63\u78ba\u8655\u7406 Leader Node \u7684\u9078\u8209\u3002</p> <p>\u4f9d\u64da etcd - tuning \u53ca\u500b\u4eba\u7d93\u9a57\u53ef\u77e5\uff0c<code>ETCD_HEARTBEAT_INTERVAL</code>\uff0c\u5373\u7531 Leader \u7bc0\u9ede\u901a\u77e5\u5176\u4ed6\u7bc0\u9ede <code>\u5b83\u9084\u662f Leader</code> \u7684\u983b\u7387\uff0c\u5efa\u8b70\u8a2d\u5b9a\u70ba 2 \u500b\u7bc0\u9ede\u4e4b\u9593 RTT \u6700\u5927\u503c\u6642\u9593 * 1 ~ 1.5 \u500d\uff0c\u82e5\u8a72\u503c\u8a2d\u5b9a\u592a\u77ed\uff0cetcd \u6703\u767c\u9001\u7121\u7528\u7684\u5fc3\u8df3\u78ba\u8a8d\u8a0a\u606f\uff0c\u53cd\u800c\u589e\u52a0 CPU / Network / Disk \u7121\u8b02\u7684\u8cc7\u6e90\u6d88\u8017\uff1b\u82e5\u8a72\u503c\u8a2d\u5b9a\u592a\u9577\uff0c\u5c31\u6703\u5c0e\u81f4\u76e3\u63a7\u7bc0\u9ede\u7570\u5e38\u6642\u9593\u904e\u9577\uff0c\u6703\u6709\u91cd\u65b0\u9078\u8209\u7684\u4e8b\u60c5\u767c\u751f\u3002\u5224\u65b7 RTT \u7684\u6700\u7c21\u55ae\u65b9\u5f0f\u5c31\u662f\u4f7f\u7528 ping\uff0c\u5982\u4e0b</p> <pre><code># \u767b\u5165\u7bc0\u9ede\n$ oc debug node/control-plane-0\nStarting pod/control-plane-0-debug ...\nTo use host binaries, run `chroot /host`\nPod IP: 10.0.97.1\nIf you dont see a command prompt, try pressing enter.\nsh-4.2# chroot /host\nsh-4.4# ping 10.0.97.5 -c60\nPING 10.0.97.5 (10.0.97.5) 56(84) bytes of data.\n64 bytes from 10.0.97.5: icmp_seq=1 ttl=64 time=0.191 ms\n64 bytes from 10.0.97.5: icmp_seq=2 ttl=64 time=0.151 ms\n64 bytes from 10.0.97.5: icmp_seq=3 ttl=64 time=0.213 ms\n...omit...\n64 bytes from 10.0.97.5: icmp_seq=59 ttl=64 time=0.142 ms\n64 bytes from 10.0.97.5: icmp_seq=60 ttl=64 time=0.204 ms\n\n--- 10.0.97.5 ping statistics ---\n60 packets transmitted, 60 received, 0% packet loss, time 59000ms\nrtt min/avg/max/mdev = 0.112/0.212/0.435/0.054 ms\n</code></pre> <p>\u5982\u4e0a\u9762\u6578\u5b57\u8868\u73fe\uff0cRTT \u6e2c\u8a66\u51fa\u4f86\u662f <code>0.435ms</code>\uff0c\u9060\u4f4e\u65bc\u9810\u8a2d\u503c <code>100ms</code>\uff0c\u6240\u4ee5\u5c31\u4e0d\u7528\u7279\u5225\u6539</p> <p><code>ETCD_ELECTION_TIMEOUT</code>\uff0c\u5247\u662f\u8868\u793a\u5982\u679c\u7bc0\u9ede\u7b49\u5f85\u591a\u4e45\u6c92\u6536\u5230 Leader \u7684\u5fc3\u8df3\u78ba\u8a8d\u7684\u8a71\uff0c\u5c31\u6703\u958b\u59cb\u5617\u8a66\u53bb\u7af6\u9078 Leader \u7684\u4f4d\u5b50\uff0c\u5efa\u8b70\u8a2d\u5b9a\u70ba 2 \u500b\u7bc0\u9ede\u4e4b\u9593 RTT \u6700\u5927\u503c\u6642\u9593 * 10\uff0c\u4ee5\u61c9\u5c0d\u7db2\u8def\u8b8a\u5316\uff0c\u6545\u5982\u679c\u539f\u6709 RTT \u70ba 100ms \u7684\u8a71\uff0c\u5247\u9078\u8209\u8d85\u6642\u8a2d\u5b9a\u5247\u70ba 1000ms\u3002</p> <p>\u53e6\u5916\u9078\u8209\u8d85\u6642\u5efa\u8b70\u4e0a\u9650\u503c\u70ba 50,000 ms\uff0c\u5fc3\u8df3\u9593\u9694\u4e0a\u9650\u503c\u70ba 5,000 ms</p>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#etcd-database","title":"\u5099\u4efd etcd database","text":"<pre><code>$ ssh core@control-plane-1 -i ~/.ssh/id_rsa_ocp4_vcenter.pub\n\nLast login: Wed May 27 16:49:17 2020 from 10.0.97.100\n\n# Backup\n[core@control-plane-1 ~]$ sudo -E /usr/local/bin/cluster-backup.sh ./assets/backup\n385e44c057e47b6fe0b02d534dc4cb452056d33f9174271d1ecced45bc317e50\netcdctl version: 3.3.18\nAPI version: 3.3\nfound latest kube-apiserver-pod: /etc/kubernetes/static-pod-resources/kube-apiserver-pod-131\nfound latest kube-controller-manager-pod: /etc/kubernetes/static-pod-resources/kube-controller-manager-pod-13\nfound latest kube-scheduler-pod: /etc/kubernetes/static-pod-resources/kube-scheduler-pod-17\nfound latest etcd-pod: /etc/kubernetes/static-pod-resources/etcd-pod-139\nSnapshot saved at ./assets/backup/snapshot_2020-05-27_165016.db\nsnapshot db and kube resources are successfully saved to ./assets/backup\n\n# Check\n[core@control-plane-1 ~]$ cd ./assets/backup/\n[core@control-plane-1 backup]$ ls\nsnapshot_2020-05-27_165016.db  static_kuberesources_2020-05-27_165016.tar.gz\n\n# Copy to outside\n[core@control-plane-1 backup]$ scp snapshot_2020-05-27_165016.db static_kuberesources_2020-05-27_165016.tar.gz root@bastion.ocp4.internal:~/\nsnapshot_2020-05-27_165016.db                                                                                                             100%  171MB 135.1MB/s   00:01\nstatic_kuberesources_2020-05-27_165016.tar.gz                                                                                             100%   64KB  56.1MB/s   00:00\n</code></pre> <p>\u6709\u5716\u6709\u771f\u76f8</p> <p></p>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#_2","title":"\u5f8c\u8a71","text":"<p>\u4e0b\u56de\u5f85\u7e8c</p>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200528-openshift-etcd-operator-1.html#references","title":"References","text":"<ul> <li>Red Hat OpenShift Pod \u8207 Container \u7684\u611b\u6068\u60c5\u4ec7</li> <li>etcdctl \u5e38\u7528\u547d\u4ee4</li> <li>etcd - tuning</li> <li>Backing up etcd</li> <li>Replacing an unhealthy etcd member</li> </ul>","tags":["openshift4","openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html","title":"Red Hat OpenShift 4 \u7684 etcd \u4e4b\u5e7e\u500b\u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u4e8b\u4e4b\u4e8c","text":"<p>\u627f\u8972\u4e0a\u6587 Red Hat OpenShift 4 \u7684 etcd \u4e4b\u5e7e\u500b\u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u4e8b\u4e4b\u4e00\uff0c\u7e7c\u7e8c\u91dd\u5c0d\u786c\u789f\u7684\u90e8\u5206\u9032\u884c\u8abf\u6574\uff0c\u7562\u7adf etcd \u5c0d\u786c\u789f IOPS \u76f8\u7576\u8981\u6c42\uff0c\u5efa\u8b70\u7528 SSD \u6bd4\u8f03\u597d</p> <p>\u6c92\u610f\u5916\u7684\uff0c\u958b\u5834\u5206\u4eab\u500b Deploying OpenShift 4.4 to VMware vSphere 7\uff0c\u6574\u9ad4\u4e0a\u6bd4\u8f03\u91cd\u8981\u7684\u662f\u5229\u7528 VMware vSphere 7 \u88e1\u9762\u7684 DRS (Dynamic Resource Scheduler) \u53ca NSX-T \u7684\u90e8\u5206\uff0c\u4e4b\u5f8c\u6709\u6a5f\u6703\u518d\u8aaa</p> <p>{% youtube PdyNQXpYknI %}</p>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#etcd","title":"etcd \u7bc0\u9ede\u786c\u789f\u8abf\u6559","text":"<p>ionice: set or get process I/O scheduling class and priority</p> <p>\u9019\u908a\u4f7f\u7528 ionice (1) - Linux Man Pages \u4f86\u5b8c\u6210\u9019\u4ef6\u4e8b\uff0c\u525b\u597d CoreOS \u5167\u5efa\u6709\u652f\u63f4\u9019\u500b\u6307\u4ee4 XD\uff0c\u5dee\u9ede\u5c31\u8981\u5305\u4e00\u500b Container \u800c\u4e14\u8981\u883b\u9ad8\u7684\u6b0a\u9650 (\u9700\u8981 root) \u53bb\u5b9a\u671f\u57f7\u884c\u4e86</p>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#before","title":"Before","text":"<pre><code>[core@control-plane-2 ~]$ pgrep etcd\n740369\n740441\n\n[core@control-plane-2 ~]$ ps uax |grep 740369\nroot      740369  7.6  8.4 9672968 1382392 ?     Ssl  17:05   4:25 etcd --initial-advertise-peer-urls=https://10.0.97.3:2380 --cert-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.crt --key-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.key --trusted-ca-file=/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt --client-cert-auth=true --peer-cert-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt --peer-key-file=/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key --peer-trusted-ca-file=/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt --peer-client-cert-auth=true --advertise-client-urls=https://10.0.97.3:2379 --listen-client-urls=https://0.0.0.0:2379 --listen-peer-urls=https://0.0.0.0:2380 --listen-metrics-urls=https://0.0.0.0:9978\ncore      901685  0.0  0.0  12760  1076 pts/0    S+   18:03   0:00 grep --color=auto 740369\n\n[core@control-plane-2 ~]$ ps uax |grep 740441\nroot      740441  0.9  0.1 124764 25288 ?        Ssl  17:05   0:32 etcd grpc-proxy start --endpoints https://10.0.97.3:9978 --metrics-addr https://0.0.0.0:9979 --listen-addr 127.0.0.1:9977 --key /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key --key-file /etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.key --cert /etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt --cert-file /etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.crt --cacert /etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt --trusted-ca-file /etc/kubernetes/static-pod-certs/configmaps/etcd-metrics-proxy-serving-ca/ca-bundle.crt\ncore      902165  0.0  0.0  12760  1060 pts/0    S+   18:03   0:00 grep --color=auto 740441\n\n# Get priority and class\n[core@control-plane-2 ~]$ sudo ionice -p 740369 740441\nnone: prio 4\nnone: prio 0\n</code></pre>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#tuning","title":"Tuning","text":"<p>\u6211\u5011\u53ef\u4ee5\u76f4\u63a5\u767b\u5165 CoreOS \u5f8c\u4e0b <code>ionice</code> \u5c0d\u7279\u5b9a PID \u548c\u786c\u789f\u8655\u7406\u6b0a\u9650\u62c9\u9ad8\uff0c\u53ef\u4ee5\u642d\u914d ansible \u4f86\u91dd\u5c0d master node \u57f7\u884c</p> <p><pre><code># Set priority and class\n[core@control-plane-2 ~]$ sudo ionice -c2 -n0 -p `pgrep etcd`\n</code></pre>   - <code>-c2</code>: best-effort   - <code>-n0</code>: the highest priority level</p>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#after","title":"After","text":"<pre><code>[core@control-plane-2 ~]$ pgrep etcd\n740369\n740441\n\n[core@control-plane-2 ~]$ sudo ionice -p 740369 740441\nbest-effort: prio 0\nbest-effort: prio 0\n</code></pre>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#_1","title":"\u5f8c\u8a71","text":"<p>\u6069...\u53cd\u6b63\u88dd etcd \u7684\u90a3\u500b\u7bc0\u9ede\u4e4b\u786c\u789f\u9078\u7528\u9ad8 IOPS\uff0c\u4f8b\u5982\u7528 SSD\uff0c\u6548\u7387\u548c\u7a69\u5b9a\u6027\u6703\u63d0\u5347\u4e0d\u5c11</p>","tags":["openshift4","openshift","etcd"]},{"location":"20200529-openshift-etcd-operator-2.html#references","title":"References","text":"<ul> <li>ionice (1) - Linux Man Pages</li> <li>etcd - tuning</li> <li>machineconfig</li> <li>etcd \u6027\u80fd\u6d4b\u8bd5\u4e0e\u8c03\u4f18</li> <li>Running background tasks on nodes automatically with daemonsets</li> <li>Tuning etcd for Large Installations - Rancher</li> <li>Red Hat OpenShift 4 \u7684 etcd \u4e4b\u5e7e\u500b\u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u4e8b\u4e4b\u4e00</li> <li>etcd - hardware</li> <li>Deploying OpenShift 4.4 to VMware vSphere 7</li> </ul>","tags":["openshift4","openshift","etcd"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html","title":"Kubernetes \u90e8\u7f72\u5728\u865b\u6a5f\u597d\u9084\u662f\u88f8\u6a5f\u597d?","text":"<p>\u9019\u5e7e\u9031\u5e38\u88ab\u554f\u5230\u4e00\u500b\u554f\u984c</p> <p>\u4ee5\u6280\u8853\u89c0\u9ede\u4f86\u770b\uff0c\u8acb\u554f\u5bb9\u5668 (Container) \u6216\u8005\u662f\u5bb9\u5668\u5e73\u53f0 (Kubernetes) \u6bd4\u8f03\u9069\u5408\u90e8\u7f72\u5728\u865b\u64ec\u74b0\u5883 (VM) \u4e2d\u9084\u662f\u88f8\u6a5f\u74b0\u5883\u4e2d (Bare Metal)?</p> <p></p> <p>\u5176\u5be6\u9019\u500b\u554f\u984c\u5728\u5341\u5e74\u524d\u865b\u64ec\u6a5f\u6280\u8853\u525b\u51fa\u4f86\u7684\u6642\u5019\uff0c\u4e5f\u883b\u591a\u4eba\u505a\u904e\u67b6\u69cb\u53ca\u6027\u80fd\u6bd4\u8f03\uff0c\u6642\u5149\u5feb\u8f49\u5230\u73fe\u5728\u7684\u5e74\u4ee3\uff0c\u4f86\u5230\u5bb9\u5668\u7684\u4e16\u4ee3\uff0c\u76f8\u540c\u7684\u554f\u984c\u4e5f\u88ab\u62ff\u51fa\u4f86\u8a0e\u8ad6\uff0c\u672c\u7bc7\u5c31\u662f\u8981\u7279\u5225\u8b1b\u8ff0\u4e00\u4e0b\u95dc\u65bc\u9019\u4e9b\u67b6\u69cb\u4e0a\u7684\u6bd4\u8f03\u5206\u6790\u3001\u4f7f\u7528\u5f71\u97ff\u53ca\u5efa\u8b70\u63a1\u7528\u7684\u7b56\u7565\u4f5c\u6cd5\u5efa\u8b70\uff0c\u9019\u7bc7\u6703\u63a1\u7528\u6bd4\u8f03\u4e2d\u7acb\u7684\u89d2\u5ea6\u95e1\u8ff0\uff0c\u5982\u679c\u6709\u89c0\u9ede\u592a\u504f\u9817\u7684\u5730\u65b9\uff0c\u53ef\u4ee5\u79c1\u4e0b\u8ddf\u6211\u8aaa\u53ca\u63d0\u4f9b\u4fee\u6539\u5efa\u8b70</p> <p>\u4e0d\u514d\u4fd7\u7684\u6211\u9084\u662f\u8981\u4f86\u8b1b\u4e00\u4e0b\u672c\u6b21\u65b0\u767c\u73fe\uff0c\u4e09\u500b\u611f\u89ba\u4e0d\u6703\u540c\u6846\u7684\u516c\u53f8 Microsoft + Red Hat + HPE \u4e00\u8d77\u51fa\u4e86\u672c\u67b6\u69cb\u66f8 HPE Reference Architecture for delivering insight across all your data with Microsoft SQL Server 2019 Big Data Clusters \u6211\u89ba\u5f97\u5be6\u5728\u592a\u7384\u4e86 XD \u5206\u4eab\u7d66\u5927\u5bb6</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#4","title":"4 \u500b\u5148\u5099\u5c0f\u77e5\u8b58","text":"<p>\u5728\u8a0e\u8ad6\u67b6\u69cb\u4e0a\u7684\u512a\u52a3\u4e4b\u524d\uff0c\u8981\u5148\u8ddf\u5404\u4f4d\u6e05\u695a\u5730\u89e3\u91cb\u9019\u4e9b\u67b6\u69cb\u7684\u5be6\u969b\u9577\u76f8\u662f\u6709\u54ea\u4e00\u4e9b</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#containers-are-linux","title":"Containers are Linux","text":"<p>A linux container is nothing more than a process that runs on Linux</p> <p></p> <p>\u4e00\u958b\u59cb\u8981\u5148\u5c0d\u5bb9\u5668 (Container) \u9032\u884c\u540d\u8a5e\u8aaa\u660e\uff0c\u5176\u5be6\u9019\u500b\u5bb9\u5668\u9019\u500b\u6280\u8853\u6c92\u4ec0\u9ebc\u7279\u5225\u7684\u9ed1\u9b54\u6cd5\uff0c\u4e5f\u4e0d\u662f\u76f8\u7576\u524d\u885b\u7684\u6771\u897f\uff0c\u6280\u8853\u672c\u8cea\u4e0a\u5c31\u662f\u4e00\u500b\u6216\u591a\u500b Linux Process \u7684\u5448\u73fe\uff0c\u662f\u7684\uff01\u4f60\u904e\u5f80\u4f7f\u7528\u7684 chroot / LXC / Jail \u7686\u5c6c\u9019\u985e\uff0c\u6240\u4ee5\u4f60\u904e\u5f80\u80fd\u5c0d Linux Process \u9032\u884c\u4e00\u4e9b\u6df1\u5ea6\u63a7\u5236\u7684\u65b9\u5f0f\uff0c\u8b6c\u5982\u50cf\u662f secomp\u3001cgroups\u3001selinux \u7b49\u64cd\u4f5c\uff0c\u90fd\u80fd\u5728 Container \u88e1\u9762\u5448\u73fe\uff0c\u66f4\u751a\u81f3\u662f\u5e38\u898b\u7684 Linux Performance Obsevability Tools \u6548\u80fd\u91cf\u6e2c\u5de5\u5177\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\uff0c\u5be6\u52d9\u4e0a\u53ef\u4ee5\u53c3\u8003 nicolaka/netshoot - a Docker + Kubernetes network trouble-shooting swiss-army container</p> <p>\u57fa\u65bc\u4ee5\u4e0a\u7684\u7406\u7531\uff0c\u6240\u4ee5\u6709\u6642\u5019\u4f60\u6703\u770b\u5230\u4e0b\u5217\u5e7e\u7a2e\u8aaa\u6cd5</p> <ul> <li>Container Security is Linux Security</li> <li>Container Performance is Linux Performance</li> <li>Container Reliability is Linux Reliability</li> </ul> <p></p> <p>\u7d50\u8ad6\u5c31\u662f\uff0c\u4f60\u7684\u5bb9\u5668\u7a69\u4e0d\u7a69\u5b9a\u3001\u5b89\u4e0d\u5b89\u5168\u8ddf\u4f60\u6240\u4f7f\u7528\u7684\u4f5c\u696d\u7cfb\u7d71\u5176\u5be6\u662f\u6709 100% \u7684\u95dc\u4fc2</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#kubernetes-is-a-container-orchestration-platform","title":"Kubernetes is a Container Orchestration Platform","text":"<p>Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications.</p> <p>\u5f9e What is Kubernetes? \u53ef\u77e5\uff0c\u61c9\u7528\u7a0b\u5f0f\u900f\u904e\u5bb9\u5668\u90e8\u7f72\u65b9\u5f0f\u6240\u5e36\u4f86\u7684\u512a\u52e2\uff0c\u5177\u5099\u8f15\u91cf\u7d1a\u8cc7\u6e90\u9694\u96e2\u65b9\u5f0f\u3001\u53ef\u5171\u7528\u4f5c\u696d\u7cfb\u7d71\u53ca\u8cc7\u6e90\u53ef\u9ad8\u6548\u7387\u53ca\u5bc6\u96c6\u4f7f\u7528\u7b49\u773e\u591a\u597d\u8655\uff0c\u4f46\u7576\u6211\u7684 Container \u6578\u91cf\u4e00\u591a\uff0c\u670d\u52d9\u8b8a\u5f97\u66f4\u5927\u66f4\u591a\u7684\u6642\u5019\uff0c\u8ab0\u80fd\u8ca0\u8cac\u5e6b\u9019\u4e9b Container \u627e\u5230\u4e00\u500b\u9069\u5408\u7684\u5730\u65b9\u904b\u884c\u3001\u6301\u7e8c\u7684\u76e3\u63a7\u53ca\u6545\u969c\u8655\u7406? \u6240\u4ee5\u9019\u6642\u5019\u4f60\u6703\u9700\u8981\u4e00\u500b<code>\u8ca0\u8cac\u7ba1\u7406\u5bb9\u5668\u904b\u884c\u7684\u63a7\u5236\u5e73\u53f0</code>\uff0c\u4e5f\u5c31\u662f\u73fe\u4eca\u6700\u71b1\u9580\u7684 Kubernetes\u3002</p> <p>Kubernetes \u5bb9\u5668\u5e73\u53f0\u5167\u5efa\u591a\u7a2e\u5354\u52a9\u7ba1\u7406\u5bb9\u5668\u7684\u6a5f\u5236\uff0c\u5305\u542b\u4f46\u4e0d\u9650\u65bc\uff1a</p> <ol> <li>\u5167\u90e8\u670d\u52d9\u767c\u73fe\u548c\u8ca0\u8f09\u5747\u8861</li> <li>\u63d0\u51fa\u7d71\u4e00\u4e14\u6a19\u6e96\u7684\u8072\u660e\u5f0f (Declarative) API\uff1a\u9019\u9ede\u61c9\u8a72\u662f Kubernetes \u8a95\u751f\u5f8c\uff0c\u5c0d\u65bc\u6574\u500b IT \u754c\u6700\u5927\u7684\u5f71\u97ff\u4e86\uff0c\u6709\u8208\u8da3\u60f3\u4e86\u89e3\u66f4\u591a\u7684\u53ef\u4ee5\u53c3\u8003\u6b64\u6587 \u4e91\u539f\u751f\u65f6\u4ee3\uff0c Kubernetes \u591a\u96c6\u7fa4\u67b6\u6784\u521d\u63a2\uff0c\u9019\u7bc7\u771f\u7684\u5beb\u5f97\u4e0d\u932f</li> <li>\u5167\u5efa\u81ea\u6211\u4fee\u5fa9\u5bb9\u5668\u80fd\u529b\uff1a\u627f\u4e0a\uff0cKubernetes \u4e2d\u7684\u8072\u660e\u5f0f API \u5176\u5be6\u5c31\u662f\u6307\u5b9a\u8a72\u53e2\u96c6\u6240\u671f\u671b\u7684\u904b\u884c\u72c0\u614b\uff0c\u6240\u4ee5\u51fa\u73fe\u4efb\u4f55\u4e0d\u4e00\u81f4\u7684\u72c0\u614b\u7684\u6642\u5019\uff0cKubernetes \u53ef\u4ee5\u81ea\u884c\u900f\u904e\u6307\u5b9a\u7684 YAML \u6587\u4ef6\u63cf\u8ff0\uff0c\u4f86\u9032\u884c\u72c0\u614b\u9077\u79fb\uff0c\u4f5c\u51fa\u5408\u9069\u65bc\u7576\u4e0b\u74b0\u5883\u7684\u64cd\u4f5c</li> <li>\u6613\u65bc\u8cc7\u6e90\u6a6b\u5411\u64f4\u5145\uff1a\u4ee5 Kubernetes \u7684\u89d2\u5ea6\u9032\u884c\u7684\u5bb9\u5668\u7de8\u6392\uff0c\u5df2\u7d93\u5c07\u4e0a\u5c64\u670d\u52d9\u8ddf\u5e95\u5c64\u57fa\u790e\u8a2d\u65bd\u812b\u96e2\u639b\u9264\uff0cIT \u4eba\u54e1\u50c5\u9700\u95dc\u5fc3 Kuerbernets \u6240\u6e96\u5099\u7684\u8cc7\u6e90\u5920\u4e0d\u5920\u4e0a\u5c64\u670d\u52d9\u4f7f\u7528\uff0c\u9032\u800c\u5f62\u6210\u4e00\u500b\u8cc7\u6e90\u6c60 (Resource Pool) \u7684\u89c0\u5ff5\uff0c\u5305\u542b CPU Pool / Memory Pool / Storage Pool</li> <li>\u53ef\u8de8\u88f8\u6a5f\u3001\u865b\u64ec\u74b0\u5883\u3001\u516c\u79c1\u6709\u96f2\u4e0a\u4f7f\u7528\uff1a\u5176\u5be6\u9019\u500b\u771f\u6b63\u7684\u7406\u7531\u662f\u56e0\u70ba\u4f5c\u696d\u7cfb\u7d71\u7684\u95dc\u4fc2\uff0c\u56e0\u70ba Kubernetes \u7684\u904b\u4f5c\u662f\u57fa\u65bc\u5728\u4f5c\u696d\u7cfb\u7d71\u4e4b\u4e0a\uff0c\u6240\u4ee5\u53ea\u8981\u78ba\u4fdd\u80fd\u5728\u4f5c\u696d\u7cfb\u7d71\u80fd\u5728\u4efb\u4e00\u74b0\u5883\u555f\u52d5\u5373\u53ef\u4f7f\u7528</li> </ol> <p>\u800c\u8981\u8b93 Kubernetes \u63a7\u5236\u5e73\u53f0\u6709\u9019\u4e9b\u80fd\u529b\u5fc5\u7136\u6703\u9700\u8981\u53e6\u5916\u5b89\u88dd\u4e00\u4e9b\u6240\u9700\u8981\u7684\u8edf\u9ad4\uff0c\u8b6c\u5982\u8aaa\u6bcf\u4e00\u500b Worker \u5fc5\u7136\u6703\u9700\u8981\u5b89\u88dd\u7684\u4f5c\u696d\u7cfb\u7d71\u3001kubelet\u3001CNI \u7db2\u8def\u5957\u4ef6\u7b49\u4e00\u4e9b\u5e38\u99d0\u8edf\u9ad4\uff0c\u6240\u4ee5\u4e00\u822c\u4f86\u8b1b\u6700\u7d42\u80fd\u4f9b\u61c9\u7528\u7a0b\u5f0f\u6240\u4f7f\u7528\u7684\u8cc7\u6e90\u4e0d\u5168\u7136\u662f\u7b49\u540c\u65bc\u5916\u9762\u7684\u898f\u683c\uff0c\u6240\u4ee5\u91dd\u5c0d Kubernetes \u5e73\u53f0\u5efa\u7f6e\u624d\u6703\u6709\u4e00\u7a2e\u8da8\u52e2\u662f<code>\u4f5c\u696d\u7cfb\u7d71\u76e1\u91cf\u7cbe\u7c21\u5230\u50c5\u9700\u53ef\u4ee5\u4e58\u8f09\u5bb9\u5668\u904b\u4f5c\u5373\u53ef\uff0c\u5176\u4ed6\u591a\u9918\u7684\u90fd\u53ef\u4ee5\u62ff\u6389\uff0c\u4ee5\u9054\u5230\u6700\u5927\u8cc7\u6e90\u5229\u7528\u7387</code>\uff0c\u9032\u800c\u8a95\u751f\u5404\u5f0f\u5404\u6a23\u7684<code>\u5bb9\u5668\u4f5c\u696d\u7cfb\u7d71 (Container OS)</code> \u4f9b\u5927\u5bb6\u9078\u64c7\u4f7f\u7528</p> <p>\u82e5\u60f3\u8981\u4e86\u89e3 CPU \u548c Memory \u7684\u8cc7\u6e90\u914d\u7f6e\u65b9\u5f0f\u53ef\u4ee5\u53c3\u8003\u5716\u6587\u4e26\u8302\u7684 Allocatable memory and CPU in Kubernetes Nodes - learnk8s</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#container-pod-kubernetes","title":"Container \u8ddf Pod \u8ddf Kubernetes \u7684\u95dc\u4fc2","text":"<p>\u9996\u5148\u662f\uff0cPod \u8ddf Kubernetes</p> <p>Pods are the smallest deployable units in Kubernetes</p> <p>\u5728 Kubernetes \u7684\u4e16\u754c\u88e1\uff0c\u6700\u5c0f\u8abf\u5ea6\u55ae\u4f4d\u662f <code>Pod</code>\uff0c\u800c\u4e0d\u662f Container\uff0c\u9019\u9ede\u76f8\u7576\u91cd\u8981\uff0c\u6240\u4ee5\u6211\u5011\u6240\u77e5\u9053\u7684\u8cc7\u6e90\u8abf\u5ea6\u53ca\u61c9\u7528\u7a0b\u5f0f\u8907\u88fd\uff0c\u5168\u90e8\u90fd\u662f\u4ee5 Pod \u70ba\u89d2\u5ea6\u601d\u8003\u800c\u4e0d\u662f\u4ee5\u55ae\u3127 Container \u70ba\u4e3b\uff0c\u90a3\u6709\u4eba\u5c31\u6703\u554f\u90a3 Container \u8ddf Pods \u7684\u95dc\u4fc2\u53c8\u662f\u4ec0\u9ebc?</p> <p>A Pod is a group of one of more containers with shared storage and network</p> <p>\u5728 Kubernetes \u6240\u5b9a\u7fa9\u6700\u5c0f\u55ae\u4f4d <code>Pod</code> \u7576\u4e2d\uff0c\u53ef\u4ee5<code>\u5b58\u5728 1 \u500b\u6216\u591a\u500b</code>\u7684 Container \u904b\u884c\u5728\u5176\u4e2d\uff0c\u4e26\u4e14\u5171\u901a\u5206\u4eab\u540c\u4e00\u500b Linux Namespace \u6240\u63d0\u4f9b\u7684\u8cc7\u6e90\uff0c\u53ea\u8981\u5728\u540c\u4e00\u500b Pod \u88e1\u9762\u5167\uff0cContainer \u4e92\u76f8\u7684\u8cc7\u6e90\u7686\u53ef\u4ee5\u88ab\u5b58\u53d6\uff0c\u7136\u800c\u9019\u4e9b Container \u624d\u662f\u5be6\u969b\u4e0a\u5305\u88dd\u61c9\u7528\u7a0b\u5f0f\u5f8c\u6240\u5448\u73fe\u7684\u6a23\u614b\uff0c\u904b\u884c\u7684\u74b0\u5883\u6beb\u4e0d\u61f7\u7591\u5730\u5c31\u662f\u8dd1\u5728\u4f5c\u696d\u7cfb\u7d71\u4e0a\u9762</p> <p>\u6709\u4e9b\u4eba\u6703\u5f88\u597d\u5947\u70ba\u4ec0\u9ebc\u5f88\u591a\u6642\u5019\u90fd\u6703\u628a Pod \u8ddf Container \u6df7\u5728\u4e00\u8d77\u63cf\u8ff0\u5462? \u9019\u662f\u56e0\u70ba\u7d55\u5927\u90e8\u5206\u7684\u5be6\u4f5c\uff0c\u4e00\u500b Pod \u88e1\u9762\u50c5\u6703\u653e\u7f6e\u4e00\u500b Container \u5728\u88e1\u9762\uff0c\u6240\u4ee5\u624d\u6703\u6709\u9019\u7a2e\u932f\u89ba\u7522\u751f</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#kubernetes_1","title":"Kubernetes \u8cc7\u6e90\u4f30\u7b97\u65b9\u5f0f","text":"<p>\u6839\u64da Managing Resources for Containers - Kubernetes\uff0c\u4f60\u6703\u77e5\u9053\u5176\u6240\u5b9a\u7fa9\u7684 Resource Type \u4e3b\u8981\u6709\u4e0b\u5217\u5169\u500b\uff1a</p> <ol> <li>CPU</li> <li>Memory</li> </ol> <p>One cpu, in Kubernetes, is equivalent to 1 vCPU/Core for cloud providers and 1 hyperthread on bare-metal Intel processors.</p> <p>\u524d\u8005 CPU \u7684\u63db\u7b97\u65b9\u5f0f\uff0c\u5c31\u662f <code>1 CPU = 1 Core = 1,000 millicores = 1,000m</code>\uff0c\u662f\u63a1\u7528<code>\u7d55\u5c0d\u6578\u91cf</code>\u4f86\u9032\u884c\u8a08\u7b97\uff0cKubernetes \u8981\u6c42 0.1 Core \u5c31\u662f\u9700\u8981\u5b8c\u5b8c\u6574\u6574\u7684 0.1 Core\uff0c\u7121\u8ad6\u5e95\u4e0b CPU \u662f Single Core\u3001Dual-Core\u300132 Core \u6a5f\u5668\uff0c\u9084\u662f\u900f\u904e CPU Overcommitment \u8abf\u6574\u5f8c\uff0c\u4e14 Kubernetes \u8a08\u7b97\u8cc7\u6e90\u6642\u4e5f\u7121\u8996\u6642\u8108\u983b\u7387 (clock rate) \u7684\u5dee\u7570\uff0c\u4e0b\u5217\u7279\u5225\u5217\u8209\u51fa\u6240\u6709\u8ddf Kubernetes 1 CPU \u6240\u7b49\u50f9\u7684\u8cc7\u6e90\u6e05\u55ae\uff0c\u7136\u800c\u4e00\u822c\u505a CPU \u8cc7\u6e90\u8a08\u7b97\u7684\u6642\u5019\u90fd\u6703\u4ee5 vCPU \u89d2\u5ea6\u9032\u884c\u8a08\u7b97</p> 1 Kubernetes CPU is equivalent to 1 Hyperthread on a bare-metal Intel processor with Hyperthreading 1 vSphere CPU 1 IBM vCPU 1 Azure vCore 1 GCP Core 1 AWS vCPU 1 Non-HT CPU <p>\u5f8c\u8005 Memory \u7684\u8a08\u7b97\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e8c\u9032\u4f4d\u8868\u793a\u6216\u8005\u662f\u5341\u9032\u4f4d\u8868\u793a\uff0c\u4f8b\u5982\u4e0b\u5217 3 \u500b\u6578\u503c\u662f\u7b49\u50f9\u95dc\u4fc2\uff1a</p> <p>128974848 = 123 Mi (power of 2) = 129 M (power of 10)</p> <p>\u53e6\u5916\u5b83\u4e5f\u662f\u63a1\u7528<code>\u7d55\u5c0d\u6578\u91cf</code>\u4f86\u9032\u884c\u8a08\u7b97\uff0c\u7121\u8ad6\u4f60\u5e95\u4e0b\u662f\u5be6\u9ad4\u8a18\u61b6\u9ad4\u9084\u662f\u865b\u64ec\u8a18\u61b6\u9ad4\uff0c\u6216\u8005\u662f\u6709\u7d93 VMM \u5e73\u53f0\u6240\u63d0\u4f9b\u7684 Memory overcommitment \u80fd\u529b\u64f4\u5f35\u5f8c\u7684\u6578\u5b57\uff0c\u4e00\u822c\u5f88\u5c11\u9047\u5230\u9019\u985e\u554f\u984c\u662f\u56e0\u70ba\u5927\u591a\u6578\u7684\u4eba\u7684\u8a18\u61b6\u9ad4\u7528\u6cd5\u90fd\u662f 1:1 \u9032\u884c\u4f7f\u7528\uff0c\u7136\u800c\u505a Memory \u8cc7\u6e90\u8a08\u7b97\u7684\u6642\u5019\uff0c\u5efa\u8b70\u90fd\u4ee5 vRAM \u89d2\u5ea6\u9032\u884c\u8a08\u7b97</p> 1 Kubernetes memory is equivalent to 1 physical RAM 1 virtual RAM","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_1","title":"\u5bb9\u5668\u90e8\u7f72\u5728\u865b\u64ec\u74b0\u5883\u597d\u9084\u662f\u5be6\u9ad4\u74b0\u5883\u597d?","text":"<p>\u82e5\u4f60\u6709\u8a8d\u771f\u628a\u4e0a\u9762\u7684 4 \u500b\u5148\u5099\u5c0f\u77e5\u8b58\u770b\u5b8c\u4e4b\u5f8c\uff0c\u7406\u61c9\u6703\u6709\u4e0b\u5217\u7d50\u8ad6</p> <ol> <li>\u5bb9\u5668\u5fc5\u7136\u6703\u904b\u884c\u65bc\u4f5c\u696d\u7cfb\u7d71\u4e4b\u4e0a</li> <li>Kubernetes \u7684\u904b\u884c\u662f\u5efa\u7acb\u65bc\u4f5c\u696d\u7cfb\u7d71\u4e4b\u4e0a\uff0c\u5176\u672c\u8eab\u9084\u662f\u9700\u8981\u6d88\u8017\u4e00\u5b9a\u7684\u8cc7\u6e90\u904b\u4f5c</li> <li>Kubernetes \u5c0d\u65bc\u8cc7\u6e90\u7684\u5229\u7528\u662f\u7121\u8996\u865b\u64ec\u74b0\u5883\u3001\u5be6\u9ad4\u74b0\u5883</li> </ol> <p>\u9996\u5148\u5148\u628a\u6240\u6709\u5e38\u898b\u74b0\u5883\u67b6\u69cb\u64fa\u5728\u4e00\u8d77\uff0c\u5305\u542b\u4e0b\u5217 4 \u7a2e\uff1a</p> <p></p> <ol> <li>Bare Metal</li> <li><code>Container on Bare Metal</code></li> <li>VM on Bare Metal</li> <li><code>Container on VM on Bare Metal</code></li> </ol> <p>\u7576\u4e2d 2\u3001Container on Bare Metal \u8ddf 4\u3001Container on VM on Bare Metal \u662f\u672c\u6587\u9700\u8981\u8a0e\u8ad6\u7684\u67b6\u69cb\uff0c\u4e00\u822c\u9700\u8981\u8003\u91cf\u5bb9\u5668\u662f\u5426\u8981\u4e0d\u8981\u653e\u5728\u865b\u64ec\u74b0\u5883\u548c\u5be6\u9ad4\u74b0\u5883\uff0c\u6703\u6709\u4ee5\u4e0b 5 \u5927\u8003\u91cf\u9ede</p> <ol> <li>\u7ba1\u7406\u6027</li> <li>\u8cc7\u6e90\u9694\u96e2\u6027</li> <li>\u904b\u7b97\u6548\u80fd</li> <li>\u662f\u5426\u5177\u5099\u7279\u6b8a\u786c\u9ad4</li> <li>\u6574\u9ad4\u64c1\u6709\u6210\u672c</li> </ol>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_2","title":"\u7ba1\u7406\u6027","text":"<p>\u5982\u679c\u4f60\u662f\u865b\u64ec\u6a5f\u74b0\u5883\u4f7f\u7528\u70ba\u4e3b\u7684\u7dad\u904b\u4eba\u54e1\uff0c\u5c31\u89d2\u5ea6\u4e0a\u4f86\u8aaa\uff0cKubernetes \u5c31\u662f\u4e00\u7fa4 VM \u6240\u7d44\u6210\u7684\uff0c\u6240\u4ee5\u65e2\u6709\u7684 VM \u7ba1\u7406\u65b9\u5f0f\u6216\u529f\u80fd\u9084\u662f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u8b6c\u5982\u8aaa Overcommitment\u3001Snapshot\u3001\u865b\u64ec\u7db2\u8def\u5361\u65b0\u4fee\u522a\u3001Migration\uff0c\u4f46\u9019\u4e9b\u529f\u80fd\u5c0d\u65bc Kubernetes \u672c\u8eab\u904b\u4f5c\u4f86\u8b1b\u4e26\u4e0d\u662f\u5fc5\u8981\u7684\u9078\u9805\uff0c\u6b78\u5c6c\u65bc\u6280\u8853\u53ef\u4ee5\u5be6\u73fe\u4f46\u4e26\u4e0d\u662f\u5fc5\u8981\u7684\u985e\u5225\uff0c\u6bd4\u8f03\u5e38\u898b\u7684\u8a0e\u8ad6\u5c31\u662f\u5728 VM Migration \u80fd\u529b\u9700\u8981\u8207\u5426\uff0c\u4ee5 Kubernetes \u4f86\u8b1b\uff0c\u900f\u904e\u5167\u5efa\u7684 Self Healing \u6216\u8005\u662f Node Selector \u7684\u505a\u6cd5\uff0c\u53ef\u4ee5\u8f15\u6613\u7684\u8fa6\u5230\u8de8\u7bc0\u9ede\u904b\u884c\u76f8\u540c\u7a0b\u5f0f\u7684\u9700\u6c42</p> <p>\u5018\u82e5\u662f\u4ee5\u88f8\u6a5f\u74b0\u5883\u70ba\u4e3b\u7684\u7dad\u904b\u4eba\u54e1\uff0c\u56e0\u70ba\u88f8\u6a5f\u4e0a\u9762\u76f4\u63a5\u5957\u7528\u4f5c\u696d\u7cfb\u7d71\uff0c\u53ef\u4ee5\u76f8\u7576\u7121\u8166\u5730\u52a0\u5165\u5168\u6a5f\u8cc7\u6e90\u8f49\u63db\u6210 Worker Node \u63d0\u4f9b\u7d66 Kubernetes \u52a0\u5165\u7576\u4e2d\u7684\u8a08\u7b97\u8cc7\u6e90\u6c60\u5167\u4f7f\u7528\uff0c\u4e14\u6240\u6709\u7ba1\u7406\u64cd\u4f5c\u7686\u7531 Kubernetes \u63a7\u5236\u7bc0\u9ede\u7d71\u4e00\u7ba1\u7406\uff0c\u76f8\u5c0d\u4f86\u8aaa\u6e1b\u5c11\u4e86\u6240\u9700\u7ba1\u7406\u7684\u5c64\u6578\uff0c\u53ef\u4ee5\u900f\u904e\u8f03\u5c11\u7684\u786c\u9ad4\u4f86\u904b\u884c\u76f8\u540c\u6578\u91cf\u7684\u5bb9\u5668</p> <p>\u7d50\u8ad6\u662f\uff0c\u5982\u679c\u4f60\u60f3\u8981\u6cbf\u7528\u65e2\u6709\u865b\u64ec\u74b0\u5883\u7684\u7ba1\u7406\u512a\u52e2\uff0c\u800c\u4e0d\u8003\u616e\u512a\u5148\u4f7f\u7528 Kubernetes \u5167\u5efa\u7ba1\u7406\u6a5f\u5236\uff0c\u90e8\u7f72\u5bb9\u5668\u81f3\u865b\u64ec\u74b0\u5883\u662f\u6bd4\u8f03\u597d\u7684\u9078\u64c7\uff1b\u53cd\u4e4b\uff0c\u4f60\u60f3\u8981\u5b8c\u5168\u4f7f\u7528 Kubernetes \u5167\u5efa\u6240\u5e36\u4f86\u7684\u7ba1\u7406\u6a5f\u5236\uff0c\u90e8\u7f72\u5bb9\u5668\u81f3\u88f8\u6a5f\u74b0\u5883\u662f\u6700\u4f73\u9078</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_3","title":"\u8cc7\u6e90\u9694\u96e2\u6027","text":"<p>\u7121\u8ad6\u662f VM \u53ca Container \u5176\u5be6\u7686\u6709\u63d0\u4f9b\u8cc7\u6e90\u9694\u96e2\u80fd\u529b\u7d66\u61c9\u7528\u7a0b\u5f0f\uff0c\u53ea\u662f\u6280\u8853\u89d2\u5ea6\u4e0d\u4e00\u6a23\u3002</p> <p>\u82e5\u662f\u4ee5\u88f8\u6a5f\u74b0\u5883\u4f86\u8aaa\uff0c\u56e0\u70ba\u6574\u53f0\u6a5f\u5668\u8cc7\u6e90\u53ca\u63a7\u5236\u6b0a\u90fd\u4ea4\u7d66\u4e86 Host OS\uff0c\u6240\u4ee5\u4f5c\u696d\u7cfb\u7d71\u7684\u5b89\u5168\u6027\u6703\u76f4\u63a5\u5f71\u97ff\u5230\u5e95\u5c64\u786c\u9ad4\u7684\u5b89\u5168\u6027\u8207\u5426\uff0c\u540c\u6642\u518d\u642d\u914d\u4e0a Container \u672c\u8eab\u81ea\u5e36\u7684\u8cc7\u6e90\u9694\u96e2\u547d\u540d\u7a7a\u9593 - Linux Namespaces \u53ca\u5176\u76f8\u95dc\u7684\u63a7\u5236\u80fd\u529b seccomp\u3001selinux\u3001cgroups \u7b49\u63d0\u4f9b <code>Linux Process \u7d1a\u5225</code>\u4e4b\u8f15\u91cf\u7d1a\u8cc7\u6e90\u9694\u96e2</p> <p>\u4ee5\u865b\u64ec\u74b0\u5883 VMM Type 1 \u7684\u67b6\u69cb\u70ba\u4e3b\uff0c\u865b\u64ec\u6a5f\u5177\u5099\u5b8c\u6574\u7684\u4f5c\u696d\u7cfb\u7d71\uff0c\u5305\u542b\u8a18\u61b6\u9ad4\u7ba1\u7406\u548c\u865b\u64ec\u8a2d\u5099\u9a45\u52d5\u7a0b\u5f0f\uff0c\u4e3b\u8981\u65bc<code>\u865b\u64ec\u6a5f\u7d1a\u5225</code>\u63d0\u4f9b\u9694\u96e2\u80fd\u529b\uff0c\u4e26\u70ba Guest OS \u63d0\u4f9b\u64ec\u771f\u8cc7\u6e90\uff0c\u53ef\u4ee5\u963b\u6b62\u865b\u64ec\u6a5f\u57f7\u884c\u53ef\u80fd\u640d\u5bb3\u4e3b\u6a5f\u5e73\u53f0\u5b8c\u6574\u6027\u7684\u6307\u4ee4\uff0c\u9019\u7a2e\u67b6\u69cb\u60f3\u7576\u7136\u800c\u662f\u5c0d\u4e3b\u6a5f\u8cc7\u6e90\u9700\u8981\u6709\u8f03\u5927\u7684\u8981\u6c42\uff0c\u4f86\u9032\u884c\u5168\u865b\u64ec\u5316\u7684\u4fdd\u8b77\uff0c\u540c\u6642\u9593\u4e5f\u63a1\u7528\u4e86 Container \u672c\u8eab\u6240\u5e36\u4f86\u7684\u8cc7\u6e90\u9694\u96e2\u80fd\u529b\uff0c\u505a\u5230\u96d9\u91cd\u9694\u96e2</p> <p></p> <p>\u7d50\u8ad6\u662f\uff0c\u5018\u82e5\u4f60\u55ae\u53f0\u8a2d\u5099\u6709\u9700\u8981\u8ddf\u5225\u7684\u55ae\u4f4d\u5171\u7528\u5de5\u4f5c\u8ca0\u8f09\u4e14\u4f5c\u70ba\u4e0d\u540c\u7528\u9014\u7684\u8a71\uff0c\u4e14\u4e26\u975e\u662f\u53ef\u4ee5\u900f\u904e\u8f15\u91cf\u7d1a\u9694\u96e2\u80fd\u529b\u53ef\u4ee5\u8fa6\u5230\u7684\u8cc7\u6e90\u9694\u96e2\uff0c\u90a3\u4f7f\u7528\u865b\u64ec\u74b0\u5883\u662f\u6bd4\u8f03\u597d\u7684\u9078\u64c7\uff0c\u53cd\u4e4b\uff0c\u4f60\u662f\u5c08\u9580\u60f3\u8981\u63d0\u4f9b\u67d0\u500b\u670d\u52d9\u6216\u67d0\u500b\u90e8\u9580\uff0c\u4e26\u672a\u6709\u5171\u7528\u5176\u4ed6\u5de5\u4f5c\u8986\u8f09\u8b70\u984c\u7684\u8a71\uff0c\u88f8\u6a5f\u74b0\u5883\u57fa\u672c\u4e0a\u662f\u6700\u4f73\u9078\u64c7</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_4","title":"\u904b\u7b97\u6548\u80fd","text":"<p>Performance: Native &gt; Container &gt; VM</p> <p>\u5176\u5be6\u9019\u500b\u4e0d\u7528\u7279\u5225\u8a0e\u8ad6\u4e5f\u53ef\u4ee5\u7406\u89e3\u5230\uff0c\u88f8\u6a5f\u6574\u9ad4\u6548\u80fd\u6703\u6bd4\u865b\u64ec\u74b0\u5883\u597d\uff0c\u7562\u7adf\u88f8\u6a5f\u5168\u90e8\u7684\u8cc7\u6e90\u90fd\u62ff\u4f86\u4f7f\u7528\uff0c\u91dd\u5c0d\u7db2\u8def\u7684\u90e8\u5206\uff0c\u9019\u7bc7\u6587\u7ae0 Kubernetes on Bare Metal: When Low Network Latency is Key\uff0c\u8868\u660e Network Latency \u5dee\u8ddd\u662f 3 \u500d\u5de6\u53f3\uff0cCPU \u5229\u7528\u7387\u5dee\u8ddd\u5927\u6982\u662f 10% - 15% \u5de6\u53f3</p> <p>\u6709\u4eba\u6703\u554f\u8aaa\u4e00\u822c\u7684 Kubernetes \u58d3\u529b\u6e2c\u8a66\u5e73\u6642\u90fd\u662f\u5728\u4ec0\u9ebc\u74b0\u5883\u58d3\u7684? \u7b54\u6848\u662f\u4e3b\u8981\u662f\u5728\u4e09\u5927\u516c\u6709\u96f2\u4e0a\u7684\u74b0\u5883\uff0c\u56e0\u70ba\u8a08\u7b97\u8cc7\u6e90\u516c\u6709\u96f2\u90fd\u6e96\u5099\u597d\u4e86\uff0c\u4e3b\u8981\u6e2c\u8a66\u4e5f\u6703\u4ee5\u9019\u4e9b\u516c\u6709\u96f2\u7684\u74b0\u5883\u70ba\u4e3b\uff0c\u6709\u8da3\u7684\u4e8b\u60c5\u662f\u4e09\u5927\u96f2\u6240\u63d0\u4f9b\u7684\u74b0\u5883\u96d6\u7136\u90fd\u662f\u76f8\u540c\u7684\u91cf\u7d1a\u7684 CPU / Memory\uff0c\u4f46\u7aef\u770b\u6e2c\u8a66\u7684\u6642\u5019\u6703\u6709\u6548\u80fd\u4e0a\u7684\u986f\u8457\u5dee\u7570</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_5","title":"\u5177\u5099\u7279\u6b8a\u786c\u9ad4","text":"<p>\u5018\u82e5\u4f60\u662f\u9700\u8981\u904b\u884c GPU / SR-IOV NIC \u6216\u8005\u662f\u5176\u4ed6\u9700\u8981\u9ad8\u6027\u80fd\u904b\u7b97\u6216\u5c0d\u5be6\u9ad4\u7db2\u5361\u6709\u7279\u6b8a\u8981\u6c42\u7684\uff0c\u5efa\u8b70\u4e00\u5f8b\u5c31\u662f\u9078\u64c7\u88f8\u6a5f\u90e8\u7f72\u8def\u7dda\u4e86\uff0c\u96d6\u7136\u865b\u64ec\u74b0\u5883\u53ef\u4ee5\u900f\u904e PCI Passthough \u9032\u884c\u7a7f\u900f\u4f7f\u7528\uff0c\u4f46\u73fe\u884c\u65bc Kubernetes \u7684\u4f7f\u7528\u4e0a\u5927\u591a\u9084\u662f\u76f4\u63a5\u88f8\u6a5f\u74b0\u5883\u4f7f\u7528\uff0c\u9664\u4e86\u7ba1\u7406\u65b9\u4fbf\u4ee5\u5916\uff0c\u5176\u6b21\u7684\u539f\u56e0\u662f\u901a\u5e38\u6703\u88dd\u8f09\u7279\u6b8a\u786c\u9ad4\uff0c\u6240\u9700\u8981\u7684\u8a08\u7b97\u8cc7\u6e90\u4e5f\u662f\u76f8\u7576\u5927\u7684\uff0c\u5927\u90e8\u5206\u5e38\u898b\u65bc\u91ab\u7642\u3001\u88fd\u9020\u3001\u96fb\u4fe1\u7b49\u5c0d\u8a08\u7b97\u9700\u6c42\u76f8\u5c0d\u5927\u7684\u9818\u57df</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#tco","title":"\u6574\u9ad4\u64c1\u6709\u6210\u672c (TCO)","text":"<p>\u5f9e Five Reasons You Should Run Containers on Bare Metal, not Virtual Machines \u501f\u5716</p> <p></p> <p>\u4f3a\u670d\u5668\u6240\u80fd\u63d0\u4f9b\u7684\u8cc7\u6e90\u4e0a\u9650\u5c31\u662f\u5b8c\u5168\u4f9d\u64da\u786c\u9ad4\u898f\u683c\u6240\u63d0\u4f9b\u7684\uff0c\u4e26\u4e0d\u6703\u591a\u4e5f\u4e0d\u6703\u5c11</p> <p>\u65bc\u865b\u64ec\u74b0\u5883\u4e2d\uff0c\u9700\u8981\u5148\u6263\u9664\u6389 Host OS + \u904b\u884c VMM Hypervisor Type 1 \u6240\u9700\u8cc7\u6e90 + Guest OS \u9019\u4e09\u5927\u8a08\u7b97\u8cc7\u6e90\u4e4b\u5f8c\uff0c\u5269\u4e0b\u7684\u624d\u662f\u53ef\u7528\u8a08\u7b97\u8cc7\u6e90\uff0c\u6309\u7167 Best Practices for Red Hat OpenShift on the VMware SDDC - VMware \u6240\u8ff0\uff0c\u7d04\u7565\u6703\u9700\u8981\u5148<code>\u4fdd\u7559 15%</code>\u7684\u8cc7\u6e90\u4f9b\u865b\u64ec\u74b0\u5883\u5e73\u53f0\u4f7f\u7528\uff1b\u800c\u65bc\u88f8\u6a5f\u74b0\u5883\u4e2d\uff0c\u5247\u50c5\u9700\u6263\u9664\u6389 Host OS \u7684\u904b\u4f5c\u8cc7\u6e90\u5373\u53ef\uff0c\u53ef\u4ee5\u7528\u6700\u5927\u5e45\u5ea6\u53ef\u7528\u8a08\u7b97\u8cc7\u6e90\u53bb\u904b\u884c\u670d\u52d9\uff0c\u6b63\u5e38\u72c0\u6cc1\u4e4b\u4e0b\uff0c\u6bcf\u53f0\u4f3a\u670d\u5668\u80fd\u904b\u884c\u7684\u5bb9\u5668\u6578\u91cf\uff0c\u88f8\u6a5f\u74b0\u5883\u6703\u6bd4\u865b\u64ec\u74b0\u5883\u4f86\u7684\u9084\u8981\u9ad8\uff0c\u4e5f\u610f\u5473\u8457\u66f4\u9ad8\u7684\u5229\u7528\u7387\u3001\u66f4\u4f4e\u7684\u529f\u8017\u548c\u66f4\u4f4e\u7684\u6210\u672c\u3001\u8fd1\u4e00\u6b65\u964d\u4f4e\u7ba1\u7406\u8cbb\u7528</p> <p>\u57fa\u65bc\u865b\u64ec\u74b0\u5883\u7684\u5bb9\u5668\u90e8\u7f72\u4e0a\uff0c\u6700\u591a\u7684\u6210\u672c\u8003\u616e\u56e0\u7d20\u662f\u865b\u64ec\u5316\u8edf\u9ad4\u6240\u9644\u5e36\u7684\u6210\u672c\u8cbb\u7528\uff0c\u7a31\u4f5c vTAX\uff0c\u901a\u5e38\u90e8\u7f72\u4e0a\u6703\u9023\u5e36\u7522\u751f\u70ba\u6578\u53ef\u89c0\u7684\u8cbb\u7528\uff0c\u9032\u800c\u589e\u52a0\u7e3d\u9ad4\u64c1\u6709\u6210\u672c</p> <p>\u7d50\u8ad6\u662f\uff0c\u5018\u82e5\u4f60\u60f3\u8981\u6709\u6700\u9ad8\u7684 C/P \u503c\u7684\u8a71\uff0c\u5e95\u5c64\u786c\u9ad4\u5b8c\u5168\u63d0\u4f9b\u7d66\u5bb9\u5668\u904b\u884c\u7684\u8a71\uff0c\u88f8\u6a5f\u74b0\u5883\u90e8\u7f72\u662f\u6700\u4f73\u9078\u9805\uff0c\u5176\u6b21\u624d\u662f\u865b\u64ec\u74b0\u5883\u70ba\u4e3b</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#_6","title":"\u7d50\u8a9e","text":"<p>\u6700\u8fd1\u883b\u591a\u516c\u53f8\u90fd\u5728\u63a8\u5ee3 Kubernetes on Bare Metal \u7684\u67b6\u69cb\uff0c\u4f86\u7372\u5f97\u7684\u8cc7\u6e90\u6700\u5927\u4f7f\u7528\u6548\u7387\u3001\u6700\u4f4e TCO\u3001\u6700\u597d\u6548\u80fd\u3001\u7ba1\u7406\u55ae\u7d14\u7b49\u597d\u8655\uff0c\u5018\u82e5\u4eca\u5929\u6709\u8003\u616e\u8981\u5efa\u7acb\u4e00\u500b\u57fa\u65bc Kubernetes \u70ba\u4e3b\u7684\u79c1\u6709\u96f2\u670d\u52d9\uff0c\u90a3\u7684\u78ba\u662f\u4e00\u500b\u883b\u597d\u7684\u9078\u64c7\uff1b\u5018\u82e5\u662f\u8981\u8ddf\u65e2\u6709\u7684\u74b0\u5883\u6df7\u7528\u6216\u8005\u662f\u56e0\u65e2\u6709\u7ba1\u7406\u9700\u6c42\u7b49\u56e0\u7d20\uff0c\u5247\u53ef\u4ee5\u8003\u616e\u4ee5 VM \u70ba\u4e3b\u7684 Kubernetes \u670d\u52d9\uff1b\u7576\u7136\u9084\u6709\u4e00\u7a2e\u9078\u64c7\u662f<code>\u6df7\u7528</code>\uff0c\u6211\u500b\u4eba\u662f\u6bd4\u8f03\u63a8\u5d07\u9019\u7a2e\u67b6\u69cb\uff0c\u4f9d\u64da\u60c5\u5883\u4e0d\u540c\u63d0\u4f9b\u4e0d\u540c\u8cc7\u6e90\uff0c\u76e1\u53ef\u80fd\u7684\u6709\u6548\u5229\u7528\u5404\u67b6\u69cb\u7684\u512a\u52e2\u622a\u9577\u88dc\u77ed</p> <p></p> <p>\u73fe\u5be6\u751f\u6d3b\u4e2d\uff0c\u5927\u90e8\u5206\u7684\u4eba\u9084\u662f\u6703\u8a62\u554f\u8aaa\uff0cVMware \u8ddf Kubernetes \u7684\u67b6\u69cb\u5dee\u7570\u662f\u4ec0\u9ebc\uff0c\u6211\u89ba\u5f97 VMware \u9019\u7bc7\u6bd4\u8f03\u6587\u7ae0\u5beb\u5f97\u4e0d\u932f Kubernetes Introduction for VMware Users \u2013 Part 1: The Theory</p>","tags":["kubernetes"]},{"location":"20200713-bm-and-vm-container-deployment-consideration.html#references","title":"References","text":"<ul> <li>Bare-metal vs. VM container deployment considerations</li> <li>Five Reasons You Should Run Containers on Bare Metal, not Virtual Machines</li> <li>Container vs VM: When and Why? - Gene</li> <li>Which is Better for Containers, Bare Metal or Virtual Machines?</li> <li>Comparison Between Bare-metal, Container and VM using Tensorflow Image Classification Benchmarks for Deep Learning Cloud Platform - Paper</li> <li>Comparison Between Bare-metal, Container and VM using Tensorflow Image Classification Benchmarks for Deep Learning Cloud Platform - Slide</li> <li>Containers are Linux</li> <li>What is the difference between a process, a container, and a VM?</li> <li>nicolaka/netshoot - GitHub</li> <li>What is Kubernetes?</li> <li>\u4e91\u539f\u751f\u65f6\u4ee3\uff0c Kubernetes \u591a\u96c6\u7fa4\u67b6\u6784\u521d\u63a2</li> <li>Kubernetes Introduction for VMware Users \u2013 Part 1: The Theory</li> <li>Managing Resources for Containers - Kubernetes</li> <li>Allocatable memory and CPU in Kubernetes Nodes - learnk8s</li> <li>HPE Reference Architecture for delivering insight across all your data with Microsoft SQL Server 2019 Big Data Clusters</li> <li>Best Practices for Red Hat OpenShift on the VMware SDDC - VMware</li> <li>Kubernetes on Bare Metal: When Low Network Latency is Key</li> <li>Dell EMC Ready Stack for Red Hat OpenShift Container Platform 4.3</li> </ul>","tags":["kubernetes"]},{"location":"20200828-kubectl-view-allocations.html","title":"\u5982\u4f55\u689d\u5217\u51fa\u55ae\u4e00 Namespace \u5167\u7684 Kubernetes \u8a08\u7b97\u8cc7\u6e90?","text":"<p>\u6700\u8fd1\u9019\u4e00\u500b\u6708\u51fa\u4e86\u4e00\u4e9b\u4e8b\uff0c\u5c0e\u81f4\u592a\u4e45\u6c92\u5beb\u5ee2\u6587\u3002\u6700\u8fd1\u6709\u500b\u9700\u6c42\u9700\u8981<code>\u9006\u5411</code>\u7814\u7a76\u51fa Red Hat OpenShift 4 \u539f\u751f\u5b89\u88dd\u5f8c\uff0c\u5b83\u9810\u8a2d\u5b89\u88dd\u4e00\u5806\u7684 Namespace (\u5728 OpenShift \u7a31\u4f5c Project\uff0c\u4f46\u5728\u9019\u908a\u53ef\u4ee5\u8996\u70ba\u4e00\u6a23)\uff0c\u5404\u81ea\u7684 CPU / Memory / Storage \u8cc7\u6e90\u6d88\u8017\u591a\u5c11\uff0c\u8eab\u70ba\u4e00\u4f4d\u8a08\u7b97\u8cc7\u6e90\u7cbe\u7b97\u5e2b\uff0c\u6240\u4ee5\u5c31\u6709\u4e86\u4e0b\u9762\u9019\u7bc7\u7684\u7d00\u9304</p> <p>\u672c\u6708\u7121\u5fc3\u529b\uff0c\u7121\u6897\u5716\u5448\u73fe</p>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#_1","title":"\u70ba\u4ec0\u9ebc\u8981\u9019\u6a23\u505a?","text":"<p>\u9019\u4ef6\u4e8b\u8ddf Kubernetes \u8a08\u7b97\u8cc7\u6e90\u4f30\u7b97\u6709\u95dc\u4fc2\uff0c\u57fa\u65bc\u524d\u4e00\u7bc7\u6240\u63d0\u5230\u7684 <code>Kubernetes \u8cc7\u6e90\u4f30\u7b97\u65b9\u5f0f</code>\uff0c\u82e5\u628a\u5be6\u6a5f\u6216\u865b\u6a5f\u7684\u5b8c\u6574\u53ef\u7528\u8cc7\u6e90\u7576\u4f5c\u4e00\u500b\u73bb\u7483\u676f\u4f86\u770b\uff0c\u82e5\u6709\u670d\u52d9\u9700\u8981\u4f7f\u7528 Kubernetes \u8a08\u7b97\u8cc7\u6e90\u7684\u8a71\uff0c\u5247\u8996\u70ba\u5f80\u73bb\u7483\u676f\u5012\u6c34\u9032\u53bb\uff0c\u7576\u6c34\u4f4d\u6eff\u7684\u6642\u5019\uff0c\u5c31\u4ee3\u8868\u8a72\u5be6\u6a5f\u6216\u865b\u6a5f\u4e0d\u80fd\u5728\u64fa\u653e\u5176\u4ed6\u7684\u670d\u52d9\u4e86\uff0c\u7576\u6c34\u4f4d\u6bd4\u8f03\u4f4e\u7684\u6642\u5019\uff0c\u5247\u4ee3\u8868\u53ef\u4ee5\u8f03\u6709\u9918\u88d5\u653e\u7f6e\u5176\u4ed6\u670d\u52d9\u5728\u88e1\u9762</p> <p></p>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#kubectl-view-allocations","title":"Kubectl-view-allocations","text":"<p>\u9019\u908a\u8981\u63a8\u85a6 davidB/kubectl-view-allocations \u9019\u500b\u5c08\u6848\uff0c\u76f8\u7576\u597d\u7528\uff0c\u4e4b\u524d\u9084\u6c92\u627e\u5230\u9019\u500b\u5c08\u6848\u4e4b\u524d\uff0c\u6211\u90fd\u662f\u7528 <code>jsonpath</code> \u6162\u6162\u722c\uff0c\u4f46\u6211\u89ba\u5f97\u4e0d\u50c5\u6307\u4ee4\u76f8\u7576\u9577 (\u5982\u4e0b\u6307\u4ee4)\uff0c\u800c\u4e14\u8f38\u51fa\u7d50\u679c\u4e0d\u660e\u78ba\uff0c\u52a0\u4e0a\u5f88\u96e3\u95b1\u8b80\uff0c\u6240\u4ee5\u624d\u53c8\u53e6\u5916\u627e\u4e86\u4e00\u4e0b\u9019\u500b\u5c08\u6848\u4f86\u7528\u7528</p> <pre><code>oc get pods -o=jsonpath=\"{range .items[]}{range .spec.containers[]} {.name} CPU_Requests:{.resources.requests.cpu} CPU_Limites:{.resources.limits.cpu} Memory_Requests:{.resources.requests.memory} Memory_Limites:{.resources.limits.memory} {'\\n'}{end}{'\\n'}{end}\" | column -t\n</code></pre>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#kubectl-view-allocations_1","title":"\u8d85\u7c21\u55ae\u5b89\u88dd Kubectl-view-allocations","text":"<pre><code>curl https://raw.githubusercontent.com/davidB/kubectl-view-allocations/master/scripts/getLatest.sh | bash\nsudo mv kubectl-view-allocations /usr/local/bin\nkubectl-view-allocations -V\n</code></pre>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#use-cases","title":"Use Cases","text":"","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#namespace","title":"\u689d\u5217 Namespace \u5167\u8cc7\u6e90","text":"<p>\u8b6c\u5982\u8aaa\u6211\u60f3\u8981\u67e5 <code>openshift-etcd</code> \u88e1\u9762\u7684\u8cc7\u6e90\u9810\u8a2d\u6d88\u8017\u5982\u4f55\uff0c\u53ef\u4ee5\u7528\u4e0b\u5217\u6307\u4ee4\u8fa6\u5230</p> <pre><code>kubectl-view-allocations -n openshift-etcd\n</code></pre> <p></p>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#_2","title":"\u6982\u89c0\u4e86\u89e3\u5404\u7bc0\u9ede\u8cc7\u6e90","text":"<p>\u985e\u540c\u65bc <code>oc adm top node</code></p> <pre><code>kubectl-view-allocations -r cpu -g node\nkubectl-view-allocations -r memory -g node\n</code></pre> <p></p>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#_3","title":"\u8a73\u7d30\u4e86\u89e3\u5404\u7bc0\u9ede\u8cc7\u6e90","text":"<p>\u7576\u4f60\u60f3\u8981\u4e86\u89e3\u4f60\u7684 master node \u4e0a\u9762\u5230\u5e95\u90fd\u653e\u4e86\u4ec0\u9ebc\u7897\u7cd5\u7684\u6771\u897f\uff0c\u9019\u500b\u9084\u883b\u597d\u7528\u7684...</p> <pre><code>kubectl-view-allocations -r cpu\nkubectl-view-allocations -r memory\n</code></pre> <p></p>","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#appendix","title":"Appendix","text":"","tags":["kubernetes","openshift4"]},{"location":"20200828-kubectl-view-allocations.html#environment-information","title":"Environment Information","text":"<ul> <li>Red Hat OpenShift 4.4.0</li> <li>Kubernetes v1.18.3</li> </ul>","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html","title":"Kubernetes API \u670d\u52d9\u53ca\u8ddf\u5404\u7d44\u4ef6\u7684\u4ea4\u4e92\u95dc\u4fc2","text":"<p>\u524d\u9663\u5b50\u5ba2\u6236\u90a3\u908a\u6709\u500b\u554f\u984c\u9700\u8981\u5148\u4e86\u89e3 Kubernetes \u5f9e\u90e8\u7f72 Deployment \u5230\u5be6\u969b\u4e0a\u8ddf\u9019\u4e9b\u4e3b\u8981\u7d44\u4ef6\u6e9d\u901a\u7684\u6d41\u7a0b\uff0c\u4e0d\u7136\u5f88\u96e3\u9032\u884c Troubleshooting (a.k.a. \u89c0\u843d\u9670)\u3002\u5e78\u597d\u672c\u6b21\u7814\u7a76\u6709 3 \u4f4d\u5927\u5927\u7684\u4e00\u8d77\u53c3\u8207 Max\u3001\u5730\u74dc\u3001\u559c\u5fb7\uff0c\u6700\u7d42\u627e\u5230\u4e86\u4e00\u500b\u8ddf\u73fe\u8c61\u6beb\u7121\u95dc\u4fc2\u7684\u6839\u672c\u554f\u984c =_=\uff0c\u4f46\u56e0\u70ba\u904e\u7a0b\u7b97\u883b\u96e3\u5f97\u7684\uff0c\u7279\u5225\u8a18\u9304\u4e0b\u4f86\u7d66\u5927\u5bb6\u53c3\u8003\u53c3\u8003</p> <p>\u7167\u4f8b\u8b1b\u500b\u96dc\u4e8b\uff0cRed Hat OpenShift 4.6 (\u7b49\u540c Kubernetes 1.19) \u8981\u51fa\u5566\uff01\u9019\u662f\u4e00\u500b\u53ef\u4ee5\u4e00\u8def\u7528\u5230 <code>2022 \u5e74 3 \u6708</code> \u7684\u7248\u672c\uff0c\u5404\u4f4d Infra \u4e0d\u7528\u5728\u70ba\u4e86\u66f4\u65b0\u548c\u5347\u7d1a\u843d\u6dda\u4e86 Q_Q\uff0c\u6709\u8208\u8da3\u8005\u53ef\u4ee5\u53c3\u8003 What's New in OpenShift Container Platform 4.6</p> <p></p> <p>\u6309\u7167\u6211\u500b\u4eba\u5c0d\u65bc Kubernetes \u5167\u90e8\u6e9d\u901a\u7406\u89e3\uff0c\u7d04\u7565\u5206\u70ba\u4e0b\u5217 11 \u500b\u6e9d\u901a\u6b65\u9a5f\uff0c\u7576\u7136\u6211\u77e5\u9053\u518d\u66f4\u7d30\u5206\u7684\u8a71\uff0c\u9084\u53ef\u4ee5\u5206\u66f4\u591a\u6b65\u9a5f\u51fa\u4f86\uff0c\u4f46\u6211\u9019\u5716\u50c5\u91dd\u5c0d Container \u6700\u7d42\u80fd\u904b\u884c\u70ba\u4e3b\u622a\u6b62</p> <p></p> <p>\u5982\u679c\u6709\u6642\u5019\u9047\u5230\u4e00\u4e9b\u4e0d\u53ef\u77e5\u7684\u795e\u7955\u73fe\u8c61\uff0c\u53ef\u4ee5\u601d\u8003\u4e00\u4e0b\u6574\u500b\u7cfb\u7d71\uff0c\u662f\u4f4d\u5728\u54ea\u4e00\u5c64\u5361\u4f4f</p>","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html#kubernetes-deployment","title":"Kubernetes Deployment \u5206\u89e3\u52d5\u4f5c\u8b1b\u89e3","text":"<ol> <li>\u4f7f\u7528\u8005\u81ea\u884c\u64b0\u5beb\u597d\u6216\u900f\u904e\u5225\u4eba\u5f04\u597d\u7684 Kubernetes YAML Generator \u7522\u751f Kubernetes Deployment YAML \u6a94\u6848\uff0c\u4e14\u901a\u8fc7 Kubernetes API \u8bbf\u95ee\u96c6\u7fa4\u4e00\u6587\u6240\u5217\u7684\u65b9\u5f0f\uff1akubectl / RESTful API / client-go / kubernetes-client/python \u7b49\u65b9\u5f0f\u767c\u9001\u5230 Kubernetes API Server \u5ba3\u544a\u9032\u884c\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u3002\u9019\u500b\u968e\u6bb5 Kubernetes API Server \u6703\u9032\u884c\u4f9d\u5e8f\u662f Authentication\u3001Authorization\u3001Admission Control \u7b49\u9a57\u8b49\u548c\u6aa2\u67e5\u8a9e\u6cd5\uff0c\u8a73\u7d30\u904e\u7a0b\u53ef\u53c3\u8003 Chapter 17. Admission Control and Authorization\u3002\u5982\u679c\u90fd\u6c92\u6709\u554f\u984c\u7684\u8a71\uff0c\u5c07\u6703\u5132\u5b58 Deployment Object \u81f3 etcd cluster</li> <li>\u76ee\u524d\u70ba\u6b62\uff0cPod \u9084\u6c92\u88ab\u555f\u52d5\u8d77\u4f86\uff0c\u4f46 Controller Manager \u5df2\u7d93\u6536\u5230\u4f86\u81ea Kubernetes API Server \u7684\u8981\u6c42</li> <li>Controller Manager \u6703\u53bb\u6aa2\u67e5\u662f\u5426\u6709\u6578\u91cf\u6b63\u78ba\u7684\u526f\u672c (Replicas) \u4e14\u5c0d\u61c9\u6b63\u78ba\u9700\u6c42\u7684 Pod \u5df2\u7d93\u5728\u904b\u884c</li> <li>\u5982\u679c\u6c92\u6709\u6b63\u78ba\u6578\u91cf\u7684\u526f\u672c\u6b63\u5728\u904b\u884c\uff0c\u5247\u6703\u767c\u9001\u57fa\u65bc Pod Spec \u7684\u8981\u6c42\u5230 Kubernetes API Server \u8acb\u6c42\u5efa\u7acb\u5c0d\u61c9\u6578\u91cf\u7684 Pod \u8d77\u4f86</li> <li>Kubernetes API Server \u5beb\u5165\u548c\u8b80\u53d6\u4e4b\u524d\uff0c\u6703\u5148\u7d93\u904e\u5169\u95dc Admission \u548c Validation\uff0c\u524d\u8005 Admission \u900f\u904e\u78ba\u8a8d\u53e2\u96c6\u5168\u57df\u8a2d\u5b9a\u4f86\u6aa2\u67e5\u662f\u5426\u53ef\u4ee5\u65b0\u589e\u6216\u66f4\u65b0 Object\uff0c\u4e26\u53ef\u80fd\u4f9d\u64da\u53e2\u96c6\u8a2d\u5b9a\u63d0\u4f9b\u9810\u8a2d\u503c\uff0c\u5f8c\u8005 Validation \u5247\u662f\u5728\u65b0\u589e\u6216\u66f4\u65b0\u904e\u7a0b\u4e2d\uff0c\u4f86\u6aa2\u67e5\u50b3\u5165\u7684 Object \u662f\u5426\u5408\u6cd5\uff0c\u53ca\u662f\u5426\u50c5\u5305\u542b\u6709\u6548\u53c3\u6578\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 Kubernetes Deep Dive: API Server \u2013 Part 2</li> <li>Kubernetes API Server \u6301\u7e8c\u6703\u5c0d etcd \u6240\u5b58\u653e\u7684 Kuberentes Object \u9032\u884c\u66f4\u65b0\u6216\u79fb\u9664\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 Kubernetes Deep Dive: API Server \u2013 Part 2</li> <li>\u96d6\u7136 etcd \u5167\u90e8\u5df2\u7d93\u5b58\u6709 Pod \u7684\u8cc7\u8a0a\uff0c\u4f46\u4e0d\u904e\u50c5\u50c5\u662f\u4e00\u689d\u7d00\u9304\u800c\u5df2\uff0c\u73fe\u5be6\u72c0\u6cc1\u662f\u9084\u6c92\u6709\u5206\u914d\u5230 Worker Node \u4e0a\u3002\u9019\u6642\u5019 Kubernetes API Server \u6703\u901a\u77e5 Kubernetes Scheduler\uff1a\u76ee\u524d\u6709\u65b0\u589e Pod \u7684\u9700\u6c42\uff0c\u4e26\u4e14\u9084\u6c92\u6709 Worker Node \u53ef\u4ee5\u904b\u884c\u5b83</li> <li>Kubernetes Scheduler \u6703\u901a\u904e\u7a0b\u5f0f\u6aa2\u67e5\u73fe\u884c\u8cc7\u6e90\u4f7f\u7528\u72c0\u6cc1\u4ee5\u53ca\u73fe\u6709\u7684 Pod \u7684\u5206\u914d\uff0c\u7136\u5f8c\u53bb\u8a08\u7b97\u51fa\u6700\u9069\u5408\u64fa\u653e\u6bcf\u3127\u500b\u65b0 Pod \u7684 Worker Node \u4f4d\u7f6e\u3002\u7576\u6c7a\u5b9a\u51fa\u4f86\u4e4b\u5f8c\uff0cKubernetes Scheduler \u5c07\u6703\u8a2d\u5b9a\u6bcf\u4e00\u500b Pod \u88e1\u9762\u7684 <code>spec.nodeName</code>\uff0c\u5c07\u5176\u8f49\u63db\u6210 Worker Node \u540d\u7a31 \uff0c\u4e26\u5c07\u6700\u7d42\u6c7a\u5b9a\u901a\u77e5\u81f3 Kubernetes API Server \u9032\u884c\u66f4\u65b0\u8acb\u6c42</li> <li>\u76f4\u81f3\u672c\u6b65\u9a5f\u70ba\u6b62\uff0cPod \u5df2\u7d93\u77e5\u9053\u5b83\u61c9\u8a72\u8981\u5728\u54ea\u4e00\u500b Worker Node \u4e0a\u9762\u904b\u884c\uff0c\u4f46\u5c07\u901a\u77e5\u4f4d\u65bc\u9700\u88ab\u5206\u914d\u7684 Worker Node \u4e0a\u7684 kubelet\uff0c\u4e26\u6307\u793a\u9019\u4e9b\u4f86\u81ea\u65bc Kubernetes API Server \u7684\u65b0\u589e Pod \u8acb\u6c42\u90fd\u61c9\u8a72\u8981\u88ab Kubelet \u88ab\u9075\u7167\u57f7\u884c\u3002\u7136\u800c\uff0c\u8a72 Worker Node \u7bc0\u9ede\u4e0a\u7684 Kubelet \u5c07\u6aa2\u67e5\u81ea\u8eab\u662f\u5426\u5df2\u7d93\u5c07\u8981\u904b\u884c\u7684 Pod \u904b\u884c\u8d77\u4f86\u3002</li> <li>\u4e00\u4f46 Kubelet \u78ba\u5b9a Pod \u61c9\u8a72\u8981\u904b\u884c\u65bc\u8a72\u7bc0\u9ede\u4e0a\u4e4b\u5f8c\uff0c\u5c31\u6703\u547c\u53eb High-Level Contianer Runtime (\u5982: Docker\u3001Containerd\u3001CRI-O \u7b49) \u5df2\u555f\u52d5\u5bb9\u5668 (Container)\u3002\u7576\u4e00\u5207\u90fd\u6e96\u5099\u597d\u4e4b\u5f8c\uff0ckubelet \u6703\u5c07\u5176\u72c0\u614b\u5831\u544a\u56de\u50b3\u81f3 Kubernetes API Server</li> <li>\u63a5\u4e0b\u4f86\u5c31\u662f\u4f9d\u64da Pod Lifecycle - Kubernetes \u6240\u8ff0\uff0c\u5efa\u7acb infra (pause) container \u5f8c\uff0c\u958b\u59cb\u5c07Pod Spec \u6240\u8981\u6c42\u7684 Container \u4e00\u500b\u4e00\u500b\u62c9\u53d6\u4e26\u4e14\u555f\u52d5\uff0c\u4e26\u4e14\u8207 Kube-proxy \u5354\u4f5c\u5c07\u670d\u52d9\u8f49\u767c\u51fa\u53bb</li> </ol>","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html#qa","title":"Q&amp;A","text":"","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html#high-level-container-runtime-low-level-container-runtime","title":"High-Level Container Runtime \u8ddf Low-Level Container Runtime \u5dee\u7570\u662f\u5565?","text":"<p>Low-Level Container Runtime \u4e3b\u8981\u5c08\u8077\u904b\u884c\u5bb9\u5668\u6216\u5176\u7279\u5b9a\u74b0\u5883\uff0c\u5be6\u969b\u5c08\u6848\u5982\uff0c\u5e38\u898b\u65bc\u5404\u5927\u5c08\u6848\u7684 runc \u6216\u8005\u662f crun\u3001runv \u7b49\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 opencontainers / runtime-spec - implementations.md</p> <p>High-Level Container Runtime \u4e3b\u8981\u8ca0\u8cac\u7ba1\u7406\u5404\u5f0f\u5bb9\u5668\u6620\u50cf\u6a94\u4ee5\u53ca\u8ca0\u8cac\u8ddf Low-Level Container Runtime \u7ba1\u7406\u8ddf\u6e9d\u901a\uff0c\u672c\u8eab\u4e0d\u8655\u7406\u5be6\u969b\u904b\u884c\u5bb9\u5668\u7684\u4e8b\u60c5\uff0c\u4e00\u822c\u90fd\u6703\u6709\u4e00\u500b Daemon \u548c API \u53ef\u4ee5\u53bb\u76e3\u63a7\u5e95\u5c64\u72c0\u614b\uff0c\u8b6c\u5982\u8aaa OpenShift 4 \u4e4b\u5f8c\u6240\u4f7f\u7528\u7684 CRI-O \u6216\u8005\u662f\u66f4\u591a\u4eba\u6bd4\u8f03\u77e5\u9053 Dockerd \u8ddf\u88ab\u62c6\u5206\u51fa\u4f86\u7684 containerd \u90fd\u540c\u5c6c\u9019\u985e</p>","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html#_1","title":"\u6587\u5f8c\u611f\u8b1d","text":"<p>\u611f\u8b1d\u5730\u74dc\u3001Davy \u5169\u4f4d\u5927\u5927\u7684\u534a\u591c\u5354\u52a9\u548c\u6beb\u4e0d\u77e5\u60c5\u7167\u7247\u88ab\u6211\u62ff\u4f86\u7528\u7684 hwchiu</p>","tags":["kubernetes","openshift4"]},{"location":"20201009-kubernetes-api-communication.html#references","title":"References","text":"<ul> <li>Kubernetes deep dive: API Server - part 1</li> <li>Introduction to Kubernetes API - the way to understand the concept of Kubernetes Operators.</li> <li>Kubernetes Deep Dive: API Server \u2013 Part 2</li> <li>Kubernetes YAML Generator - Powered by Octopus.</li> <li>\u901a\u8fc7 Kubernetes API \u8bbf\u95ee\u96c6\u7fa4</li> <li>kubernetes/client-go</li> <li>kubernetes-client/python</li> <li>Chapter 17. Admission Control and Authorization</li> <li>Kubernetes Deep Dive: API Server \u2013 Part 2</li> <li>Podman: Managing pods and containers in a local container runtime</li> <li>Pod Lifecycle - Kubernetes</li> <li>What's New in OpenShift Container Platform 4.6</li> <li>opencontainers / runtime-spec - implementations.md</li> </ul>","tags":["kubernetes","openshift4"]},{"location":"20201231-2020-personal-review.html","title":"2020 \u5e74\u5ea6\u500b\u4eba\u56de\u9867","text":"<p>\u53c8\u4e00\u500b\u5b8c\u6574\u7684\u65e5\u66c6\u5e74\u904e\u4e86\uff0c\u4f86\u500b\u5e74\u5ea6\u56de\u9867\u7d00\u9304</p> <p>\u96d6\u7136 2020 \u5e74\u662f\u6df1\u53d7\u75ab\u60c5\u6ecb\u64fe\u7684\u4e00\u5e74\uff0c\u611f\u89ba\u61c9\u8a72\u5565\u4e8b\u90fd\u6c92\u505a\uff0c\u4f46\u900f\u904e\u56de\u9867\uff0c\u767c\u73fe\u6211\u9084\u505a\u4e86\u4e0d\u5c11\u4e8b\u60c5...</p>","tags":["misc","annual"]},{"location":"20201231-2020-personal-review.html#2020_1","title":"2020 \u56de\u9867","text":"<ol> <li>\u5728\u672c\u5e74\u5ea6\u6700\u5f8c\u4e00\u5929\u53bb\u571f\u57ce\u7576\u8b49\u5a5a\u4eba\uff0c\u6211\u4ee5\u70ba\u7d50\u5a5a\u8981\u627e\u8b49\u5a5a\u4eba\u662f\u5e38\u8b58 = =</li> <li>\u6b63\u5f0f\u5de5\u4f5c\u7e3d\u5e74\u8cc7\u4f86\u5230 4y 6m \u4e86\uff0c\u4f46\u6211\u89ba\u5f97\u597d\u50cf\u5de5\u4f5c\u5f88\u4e45\u4e86...</li> <li>\u5728Red Hat \u7cbe\u795e\u6642\u5149\u5c4b\u5ea6\u904e 2y 8m \u4e86</li> <li>2020 \u5e74\u5ea6\u6f14\u8b1b 19 \u5834\uff0c\u5b8c\u6210\u5e74\u5ea6\u5169\u5cb8\u4e09\u5730\u6f14\u8b1b\u5168\u6210\u5c31\uff0c\u5305\u542b 2 \u5834\u9999\u6e2f\u53ca\u4e2d\u570b\u793e\u7fa4\u9060\u7aef\u6f14\u8b1b\uff0c\u6574\u9ad4\u6bd4 2019 \u5e74\u9084\u589e\u52a0 6 \u5834</li> <li>2020 \u5e74\u5ea6\u6587\u7ae0 35 \u7bc7\uff0c\u6bd4 2019 \u5e74\u9084\u589e\u52a0 6 \u7bc7\uff0c\u4f46\u6db5\u84cb\u6280\u8853\u5ee3\u5ea6\u660e\u986f\u4e0d\u8db3 QQ</li> <li>\u624e\u624e\u5be6\u5be6\u5730\u6e1b\u80a5 20 \u516c\u65a4\uff0c\u6bd4\u53bb\u5e74\u9810\u8a2d\u76ee\u6a19 1 \u516c\u65a4\u9084\u591a\u5b8c\u6210 19 \u516c\u65a4\uff0c\u5149\u662f\u9019\u4e00\u689d\u6210\u5c31\u61c9\u8a72\u53ef\u4ee5\u6709\u6548\u8b49\u660e\u672c\u4eba\u505a\u4e8b\u76f8\u7576\u5177\u5099\u5f37\u5927\u610f\u5fd7\u529b\u548c\u57f7\u884c\u529b XD</li> <li>\u5448\u4e0a\uff0c\u5e38\u8a00\u9053 \uff1a\u9069\u5ea6\u5065\u8eab\u5438\u5f15\u7570\u6027\uff0c\u904e\u5ea6\u5065\u8eab\u5438\u5f15\u540c\u6027\uff0c\u672c\u5e74\u5ea6\u7d2f\u7a4d\u88ab 5 \u500b\u4e0d\u8a8d\u8b58\u7537\u6027\u642d\u8a15\u53ca 0 \u500b\u4e0d\u8a8d\u8b58\u5973\u6027\u642d\u8a15\u7d00\u9304</li> <li>\u62ff\u4e86\u4e00\u500b Red Hat APAC Office of Technology Team BU Advocates \u5b98\u65b9\u6210\u5c31\u56de\u4f86\uff0c\u96d6\u7136\u8ddf\u6211\u76ee\u6a19\u9084\u6709\u6bb5\u5dee\u8ddd</li> <li>\u6191\u4e00\u5634\u4e4b\u529b\uff0c\u4e00\u5e74\u5167\u8acb\u4e86 1+N \u500b\u4eba\u9032 Red Hat\uff0c\u56e0\u70ba\u6211\u6015\u88ab\u5176\u4ed6\u5ee0\u5546\u6293\u53bb\u570d\u6bc6\uff0c\u6240\u4ee5\u4e0d\u8b1b\u6578\u5b57\u4e86</li> <li>\u56e0\u70ba\u75ab\u60c5\u95dc\u4fc2\uff0c\u5275\u4e0b\u9023\u7e8c 1 \u500b\u6708\u6c92\u6709\u9032\u8fa6\u516c\u5ba4\u7d00\u9304\uff0c\u4f46\u6211\u5c45\u5bb6\u8a2d\u5099 (\u96d9\u87a2\u5e55\u3001BenQ \u6aaf\u71c8\u3001\u4eba\u9ad4\u5de5\u5b78\u96fb\u8166\u6905\u3001\u5347\u964d\u684c) \u6bd4\u8f03\u597d\uff0c\u52a0\u4e0a\u6c92\u4eba\u5435\u6211\uff08\u6216\u6211\u6c92\u4eba\u53ef\u4ee5\u53bb\u5435\uff09\uff0c\u6240\u4ee5\u8655\u7406\u516c\u4e8b\u6548\u7387\u5c45\u7136\u9084\u6bd4\u8f03\u9ad8</li> <li>2020 \u4e0b\u534a\u5e74\u56e0\u70ba\u67d0\u4e9b\u539f\u56e0\u5ea6\u904e\u4eba\u751f\u6709\u8a18\u61b6\u4ee5\u4f86\u6700\u6df7\u6c8c 3 \u500b\u6708\uff0c\u611f\u8b1d\u9019\u6bb5\u6642\u9593\u966a\u6211\u5ea6\u904e\u6df7\u6c8c\u4e0d\u660e\u72c0\u614b\u7684\u670b\u53cb\u5011\u548c\u524d\u8f29\uff0c\u6709\u4f60\u5011\u771f\u597d QQ</li> <li>\u4eca\u5e74\u6c92\u5931\u6200 1 \u6b21\uff0c\u4e5f\u5931\u6200 1 \u6b21</li> <li>\u62cd\u4e86\u4eba\u751f\u7b2c 1 \u6b21\u7684\u897f\u88dd\u6c99\u9f8d\u7167</li> <li>\u5e74\u5ea6\u653e\u5927\u5047\u53bb\u58be\u4e01\u5b78\u4e86\u6f5b\u6c34\uff0c\u4e00\u6b21\u8003\u5230 3 \u5f35\u6f5b\u6c34\u8b49\u7167\uff0c\u5305\u542b PADI Open Water Driver\u3001PADI Advanced Open Water Driver\u3001PADI \u9ad8\u6c27</li> <li>\u9023\u7e8c\u9060\u7aef\u4e0a\u8ab2 2 \u9031\uff0c\u7136\u5f8c\u4e5f\u5728\u540c\u6642\u9023\u7e8c\u6d41\u611f 2 \u6b21\uff0c\u5dee\u9ede\u4ee5\u70ba\u4e2d\u5927\u6a19\u8981\u9032\u5927\u91ab\u9662</li> <li>\u8cb7\u4e86\u4eba\u751f\u7b2c 1 \u96bb\u6a5f\u68b0\u9336 Hamilton Murph\uff0c\u672c\u4eba\u662f\u8afe\u862d\u96fb\u5f71\u7c89</li> <li>\u53bb\u77e5\u540d\u7684 Gallup \u6e2c\u8a55\u4e86\u4e00\u4e0b\u500b\u4eba\u7279\u8cea\uff0c\u7372\u5f97\u500b\u4eba\u524d 5 \u5927\u4e3b\u8981\u5929\u8ce6\uff1a\u6230\u7565\u3001\u5b8c\u7f8e\u3001\u6210\u5c31\u3001\u601d\u7dad\u3001\u7a4d\u6975\uff0c\u4f3c\u4e4e\u4eba\u8cc7\u754c\u6bd4\u8f03\u77e5\u9053\u9019\u500b\u6240\u4ee3\u8868\u7684\u610f\u7fa9</li> <li>\u69ae\u7372\"\u627e\u6b7b\u738b\"\u7a31\u865f</li> <li>\u7372\u5f97 GitHub \u7d66\u7684 1 \u500b\u5c0f\u52db\u7ae0 Arctic Code Vault Contributor\uff0c\u6240\u4ee5\u5317\u6975\u7684\u67d0\u500b\u571f\u5730\u6709\u6211\u7684...\u907a\u8de1\uff1f</li> <li>\u4ee5 2020/12/31 \u7576\u65e5\u7d00\u9304\u70ba\u6b62\uff0c2020 \u5e74\u8ca2\u737b\u4e86 9 \u500b GitHub Repository</li> <li>\u7b2c\u4e00\u6b21\u7576\u5be9\u7a3f\u8005\uff0c\u9084\u662f\u672c\u9577\u9054 460 \u9801\u7684\u82f1\u6587\u66f8 Packt - The Kubernetes Workshop</li> </ol>","tags":["misc","annual"]},{"location":"20201231-2020-personal-review.html#2021","title":"2021 \u5c55\u671b","text":"<ol> <li>\u6d3b\u4e0b\u53bb!!! \u7121\u8ad6\u662f\u5de5\u4f5c\u9084\u662f\u751f\u547d</li> <li>\u6311\u6230 1 \u5834\u570b\u5916\u793e\u7fa4\u6f14\u8b1b</li> <li>\u7626\u9019\u9ebc\u591a\uff0c\u53c3\u52a0\u500b\u5065\u7f8e\u6bd4\u8cfd\u4e0d\u70ba\u904e\u5427</li> <li>\u591a\u589e\u52a0\u5ee3\u5ea6\u5beb\u9ede\u6280\u8853\u6587\u7ae0\uff0c\u660e\u5e74\u6311\u6230\u500b Windows \u8ddf\u516c\u6709\u96f2\u7cfb\u5217\u7684\u597d\u4e86</li> <li>\u5e0c\u671b\u623f\u50f9\u80fd\u964d\u4e0b\u53bb\u8b93\u6211\u8cb7\u500b\u5b85\u7aa9 QQ</li> <li>\u8a72\u5beb 1 \u672c\u66f8\u4e86</li> </ol>","tags":["misc","annual"]},{"location":"20201231-2020-personal-review.html#_1","title":"\u7d50\u8a9e","text":"<p>\u6574\u9ad4\u6642\u9593\u5206\u914d\u4e0a\uff0c\u4eca\u5e74\u6574\u9ad4\u611f\u89ba\u662f\u89ba\u5f97\u5c08\u696d\u6280\u8853\u7565\u5fae\u4e0b\u964d\uff0c\u4f46\u591a\u51fa\u7684\u6642\u9593\u8b93\u8eab\u9ad4\u8b8a\u5f97\u8d85\u7d1a\u5065\u5eb7\uff0c\u6c92\u56e0\u70ba\u75ab\u60c5\u7684\u95dc\u4fc2\u5c0e\u81f4\u81ea\u5df1\u7684\u751f\u6d3b\u88f9\u8db3\u4e0d\u524d\uff0c\u52c9\u5f37\u53ef\u4ee5\u63a5\u53d7</p> <p>\u6574\u9ad4 $$ \u5206\u914d\u4e0a\uff0c\u56e0\u70ba\u75ab\u60c5\u7684\u95dc\u4fc2\u5c0e\u81f4\u4e00\u5806\u4e8b\u60c5\u90fd\u5728\u5bb6\u88e1\u505a\uff0c\u4e5f\u52a0\u5f37\u4e86\u4e00\u4e9b\u500b\u4eba\u80fd\u529b (\u82f1\u6587\u3001\u5065\u8eab\u3001\u98f2\u98df) \u63d0\u5347\u7684\u6559\u80b2\u8a13\u7df4\uff0c\u6bd4\u53bb\u5e74\u751f\u6d3b\u66f4\u82b1\u9322 = =</p> <p>\u6574\u9ad4\u904b\u6c23\u4e0a\uff0c\u4eca\u5e74\u5b78\u5230\uff0c\u5f80\u5f8c\u6709\u4efb\u4f55\u4eba\u751f\u96e3\u984c\uff0c\u90fd\u53bb\u53f0\u5317\u884c\u5929\u5bae\u6536\u500b\u9a5a\uff0c\u7136\u5f8c\u62bd\u500b\u7c64\uff0c\u5feb\u901f\u8abf\u6574\u4e00\u4e0b\u5fc3\u614b\u883b\u6709\u6548\u679c\u7684\uff0c\u4eca\u5e74\u4eba\u751f\u6700\u6df7\u6c8c\u7684\u72c0\u614b\u4e0b\uff0c\u62bd\u5230\u4e86\u4e00\u500b\u5927\u5409\u548c\u4e0a\u5409\u7684\u7c64\uff0c\u9084\u883b\u7a69\u7684</p> <p>\u4e0b\u5716\u61c9\u8a72\u662f\u672c\u5e74\u5ea6\u4ee3\u8868\u4e4b\u4f5c\u4e86</p> <p></p>","tags":["misc","annual"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html","title":"\u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7","text":"<p>\u4eca\u5e74 2021 \u5c0f\u5f1f\u4e0a\u534a\u5e74\u904e\u5ea6\u5fd9\u788c\uff0c\u52a0\u4e0a\u63db\u7403\u968a\u6253\u7403\uff0c\u518d\u52a0\u4e0a\u6709\u9ede\u9047\u5230\u4e2d\u5e74\u5371\u6a5f\uff0c\u5c0e\u81f4\u767c\u5ee2\u6587\u91cf\u5927\u5e45\u4e0b\u964d\uff0c\u8acb\u5927\u5bb6\u591a\u591a\u64d4\u5f85</p> <p>\u5730\u4e0a\u722c\u7684\u6211\uff1a\u7b97 Kubernetes Sizing \u597d\u7d2f\uff0c\u6211\u90fd\u4ee5\u70ba\u6211\u6539\u884c\u6210\u70ba Excel \u67b6\u69cb\u5e2b\u4e86\u5462 \u5929\u4e0a\u98db\u7684\u5b78\u9577\uff1a\u96f2\u539f\u751f\u670d\u52d9\u5230\u5e95\u662f\u8981 Sizing \u4ec0\u9ebc =_= ? \u4e0d\u5920\u4e0d\u5c31\u7d66\u4ed6\u52a0\u4e0b\u53bb\u5c31\u5c0d\u4e86? \u5730\u4e0a\u722c\u7684\u6211\uff1a\u6211\u5011\u662f\u5730\u7aef...Q_Q \u5929\u4e0a\u98db\u7684\u5b78\u9577\uff1a\u6069...\u4f60\u4fdd\u91cd</p>","tags":["kubernetes"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html#_1","title":"\u7cfb\u5217\u6587\u524d\u8a00","text":"<p>\u65e9\u5728\u672c\u7bc7\u958b\u59cb\uff0c\u5176\u5be6\u65e9\u5728\u5148\u524d Learnk8s Kubernetes Instance Calculator \u5df2\u7d93\u6709\u63a8\u51fa\u904e\u4e00\u500b\u883b\u597d\u770b\u7684\u7db2\u9801\u8cc7\u6e90\u8a08\u7b97\u6a5f\u4f9b\u5927\u5bb6\u53c3\u8003\uff0c\u4f46\u9019\u500b\u7684\u554f\u984c\u662f\u4ed6\u6c92\u6709\u8003\u91cf\u5230\u591a\u500b Kubernetes Namespace \u90e8\u7f72\u7684\u72c0\u6cc1\uff0c\u7562\u7adf\u4e0d\u53ef\u80fd\u6bcf\u4e00\u500b Pod \u7684\u8cc7\u6e90\u90fd\u9577\u4e00\u6a23\u3002\u5176\u6b21\uff0c\u5730\u7aef\u8ddf\u96f2\u7aef\u4e0d\u4e00\u6a23\uff0c\u524d\u8005\u63a1\u8cfc\u786c\u9ad4\u9700\u8981\u4e8b\u5148\u6e96\u5099\uff0c\u5f8c\u8005\u5247\u5177\u5099<code>\u6709\u9650\u7684\u7121\u9650\u8cc7\u6e90</code>\u53ef\u4f9b\u4f7f\u7528\uff0c\u6240\u4ee5\u53ea\u8981\u524d\u8005\u4e00\u500b\u4f30\u4e0d\u6e96\u5c31\u6703\u51fa\u4e8b\u3002\u4f46\u8eab\u70ba\u4e00\u540d Ops \u4eba\u54e1\uff0c\u6211\u53c8\u61c9\u8a72\u8981\u5982\u4f55\u8acb App \u4eba\u54e1\u63d0\u4f9b\u6578\u5b57\u7d66\u4f60\u4f5c\u70ba\u53c3\u8003\uff1f</p> <p>\u6240\u4ee5\u70ba\u4e86\u5ee3\u5927\u7684\u9109\u6c11\uff0c\u6211\u63d0\u4f9b\u9810\u4f30\u8cc7\u6e90\u8cc7\u6e90\u4f5c\u6cd5\uff0c\u5927\u6982\u53ef\u4ee5\u89e3\u6c7a<code>\u516b\u6210\u5de6\u53f3</code>\u7684\u72c0\u6cc1 (\u5176\u4ed6\u5169\u6210\u72c0\u6cc1\uff0c\u8acb\u6d3d\u696d\u52d9\u627e\u6211\u53bb\u5e6b\u5fd9\u7b97 XD)\u3002\u6545\u4ee5\u70ba\u4e86\u8981\u7ba1\u7406\u597d\u591a\u500b Kubernetes \u53e2\u96c6\u9700\u6c42\u4e4b\u4e0b\uff0c\u9700\u8981\u5728\u6bcf\u4e00\u500b Kubernetes \u6240\u90e8\u7f72\u7684\u7a0b\u5f0f\u8cc7\u6e90 Tanzu Mission Control Extension Manager \u7684\u9019\u652f\u7a0b\u5f0f\u4f5c\u70ba\u4f30\u7b97\u7bc4\u4f8b</p> <p>\u4e3b\u8981\u5206\u70ba\u5169\u500b\u65b9\u5411\u593e\u64ca\u6293\u8cc7\u6e90</p> <ol> <li>Top-Down\uff1a\u4ee5 App \u89d2\u5ea6\u51fa\u767c\u7684 Kubernetes Application \u8cc7\u6e90\u4f30\u7b97</li> <li>Bottom-Up\uff1a\u4ee5 Ops \u89d2\u5ea6\u51fa\u767c\u7684 Hardware (or Cloud Provider) \u8cc7\u6e90\u4f30\u7b97</li> </ol>","tags":["kubernetes"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html#app-kubernetes-application","title":"\u4ee5 App \u89d2\u5ea6\u51fa\u767c\u7684 Kubernetes Application \u8cc7\u6e90\u4f30\u7b97","text":"<p>\u60f3\u554f\u554f\u5927\u5bb6\u4e00\u500b Kubernetes \u8981\u90e8\u7f72\u4e00\u500b Application \u6703\u9700\u8981\u4ec0\u9ebc\u6771\u897f? \u662f\u7684\uff0c\u4f60\u9700\u8981\u53bb\u63cf\u8ff0\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u8cc7\u6e90\u548c\u76f8\u95dc\u8cc7\u8a0a\uff0c\u4e26\u4e14\u90e8\u7f72\u5728\u7279\u5b9a\u7684 Kubernetes Namespace\uff0c\u5982 <code>vmware-system-tmc</code>\uff0c\u6240\u4ee5\u8eab\u70ba\u4e00\u500b App \u4eba\u54e1\u7684\u76ee\u6a19\u5c31\u662f\u628a <code>\u57fa\u65bc namespace \u70ba\u4e3b\u7684\u5167\u90e8\u6240\u9700\u8cc7\u6e90\u689d\u5217\u51fa\u4f86</code>\uff0c\u64f7\u53d6 Tanzu Mission Control Extension Manager L880-L957 \u5167\u5bb9\uff0c\u5982\u4e0b</p> <pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  annotations:\n    tmc.cloud.vmware.com/orphan-resource: \"true\"\n  labels:\n    app: extension-manager\n    control-plane: extension-manager\n    controller-tools.k8s.io: \"1.0\"\n    tmc-extension: \"true\"\n    tmc-extension-name: extension-manager\n    tmc.cloud.vmware.com/managed: \"true\"\n  name: extension-manager\n  namespace: 'vmware-system-tmc'\nspec:\n  minReadySeconds: 30\n  progressDeadlineSeconds: 600\n  replicas: 1\n  selector:\n    matchLabels:\n      control-plane: extension-manager\n      controller-tools.k8s.io: \"1.0\"\n      tmc-extension: \"true\"\n  strategy:\n    rollingUpdate:\n      maxSurge: 100%\n  template:\n    metadata:\n      labels:\n        control-plane: extension-manager\n        controller-tools.k8s.io: \"1.0\"\n        tmc-extension: \"true\"\n        tmc-extension-name: extension-manager\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values:\n                - linux\n            - matchExpressions:\n              - key: beta.kubernetes.io/os\n                operator: In\n                values:\n                - linux\n      containers:\n      - command:\n        - /usr/local/bin/manager\n        env:\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        image: 'extensions.vmware-cloud.tmc.cloud.vmware.com/extensions/extension-manager/extension-manager@sha256:'\n        imagePullPolicy: Always\n        name: extension-manager\n        ports:\n        - containerPort: 9876\n          name: webhook-server\n          protocol: TCP\n        resources:\n          limits:\n            cpu: 100m\n            memory: 256Mi\n          requests:\n            cpu: 100m\n            memory: 128Mi\n        securityContext:\n          runAsGroup: 1000\n          runAsUser: 10000\n      serviceAccountName: extension-manager\n      tolerations:\n      - operator: Exists\n</code></pre> <p>\u5c0d\u65bc Kubernetes Application \u8cc7\u6e90\u4f30\u7b97\u4f60\u61c9\u8a72\u8981\u95dc\u5fc3\u4ee5\u4e0b\u5e7e\u500b\u9ede</p> <ol> <li>kind \u7684\u985e\u578b\uff1a\u4e3b\u8981\u5148\u4ee5\u53ef\u6db5\u84cb\u5927\u90e8\u5206\u90e8\u7f72\u5834\u666f\u70ba\u4e3b\uff0c\u5e38\u898b\u6709 3 \u5927 Kind\uff0cDeployment\u3001StatefulSet\u3001DaemonSet\uff0c\u5982\u672c\u7bc4\u4f8b\u70ba\u4f8b <code>kind: Deployment</code></li> <li>spec.replicas \u7684\u6578\u5b57\uff1a\u4e3b\u8981\u662f\u8981\u78ba\u8a8d\u5f85\u6703\u4e0b\u9762\u7684 CPU / Memory \u662f\u8981\u4e58\u4e0a\u591a\u5c11\uff0c\u5e38\u898b\u61c9\u8a72\u90fd\u662f\u4ee5 <code>1</code> \u70ba\u4e3b\uff0c\u81f3\u65bc\u70ba\u4ec0\u9ebc\u53ef\u53c3\u95b1\u6211\u65bc \u4e4b\u524d\u5728 Microsoft DevDays 2021 \u6f14\u8b1b\u7684\u5167\u5bb9\uff0c\u5982\u679c\u5fae\u670d\u52d9\u80fd\u5920 Scale-Out \u7684\u8a71\uff0c\u5c31\u662f <code>2</code> \u6216\u4ee5\u4e0a\u7684\u6578\u5b57</li> <li>\u6bcf\u4e00\u500b Pod \u6240\u9700\u8981\u7684 CPU \u548c Memory \u8cc7\u6e90\uff1a\u4e3b\u8981\u662f\u78ba\u5b9a\u4e00\u500b Container \u6240\u9700\u8981\u7684 CPU \u53ca Memory \u7684\u4e0a\u4e0b\u9650\uff0c\u8981\u7559\u610f <code>1 \u500b Pod \u88e1\u9762\u6703\u6709 1 \u500b\u6216\u591a\u500b Containers</code>\uff0c\u53ef\u8a73\u95b1\u4e4b\u524d\u5728 HKOSCon 2020 \u6f14\u8b1b\u5167\u5bb9 <pre><code>        resources:\n          limits:\n            cpu: 100m\n            memory: 256Mi\n          requests:\n            cpu: 100m\n            memory: 128Mi\n</code></pre></li> <li>Storage \u7684\u9078\u578b\uff1a\u4e3b\u8981\u662f\u8981\u78ba\u5b9a\u662f\u8981\u900f\u904e hostPath \u809a\u5b50\u7684\u786c\u789f\u9084\u662f\u4f7f\u7528 PV/PVC \u63a1\u7528\u57fa\u65bc CSI \u4ecb\u9762\u7684\u5916\u639b\u5132\u5b58\u670d\u52d9\uff0c\u5e38\u7528\u5354\u5b9a\u5982 NFS\u3001iSCSI \u53ca FC \u7b49\uff0c\u9019\u500b\u4e3b\u8981\u90fd\u662f\u4ee5\u670d\u52d9\u5c0d\u65bc IOPS \u6216\u5176\u7279\u6027\u7684\u8003\u91cf\u70ba\u63a1\u7528\u6a19\u7684\uff0c\u4f46\u672c\u6587\u4e0d\u6df1\u5165\u63a2\u7a76</li> </ol> <p>\u6240\u4ee5\u628a\u4e0a\u9762\u7684\u8cc7\u8a0a\u6536\u96c6\u8d77\u4f86\uff0c\u6703\u5f97\u5230\u4e0b\u9762\u9019\u5f35\u8868</p> <p></p> <p>\u4f46\u5be6\u969b\u4e0a\u4f60\u586b\u5b8c\uff0c\u6703\u6ce8\u610f\u5230\u4e00\u4e9b\u4e8b\u60c5</p> <ol> <li>\u9019\u6a23\u7e3d\u8cc7\u6e90\u662f\u5c0d\u7684\u55ce?</li> <li>\u6709\u4e9b\u6b04\u4f4d\u6c92\u586b\u7684\u600e\u9ebc\u8fa6?</li> </ol> <p>\u56de\u61c9\u7b2c\u4e00\u984c\uff0c\u4e00\u5b9a\u4e0d\u5c0d\uff0c\u56e0\u70ba\u4f60\u770b <code>Replicas</code> \u6709\u4e9b\u662f 2\uff0c\u6240\u4ee5\u5be6\u969b\u4e0a\u4f60\u61c9\u8a72\u8981\u628a\u5de6\u908a\u7684\u8cc7\u6e90\u5168\u90e8\u4e58\u4e0a <code>Replicas</code> \u6578\u5b57\uff0c\u8eab\u70ba\u4e00\u500b App \u5718\u968a\u4f60\u61c9\u8a72\u6703\u5f97\u5230\u4e0b\u9762\u9019\u5f35\u8868</p> <p></p> <p>\u9019\u6642\u5019\u4f60\u628a\u5168\u90e8\u7684\u8cc7\u8a0a\u6488\u51fa\u4f86\uff0c\u53ef\u4ee5\u7372\u5f97\u5230 <code>\u5927\u7d04</code>\u9019\u652f\u6574\u500b\u7a0b\u5f0f\u518d\u600e\u9ebc\u8dd1\uff0c\u9802\u591a <code>vmware-system-tmc</code> \u9019\u500b namesapce\uff0c\u5c31\u662f\u5403\u6389 <code>4700m</code> CPU \u8ddf <code>6382M</code> Memory\uff0c\u81f3\u65bc\u5c0d\u65bc Kubernetes \u8a08\u7b97\u55ae\u4f4d\u4e0d\u719f\u7684\u53ef\u4ee5\u53c3\u8003 Kubernetes Managing Resources for Containers\uff0c\u53e6\u9644\u4e0a Google Sheet \u53c3\u8003\u6587\u4ef6</p> <p>\u56de\u61c9\u7b2c\u4e8c\u984c\uff0c\u5448\u4e0a\uff0c\u5982\u679c\u4f60\u6c92\u5beb\u8cc7\u6e90\uff0c\u9019\u4e0d\u662f\u4ee3\u8868\u4ed6\u904b\u4f5c\u4e0d\u7528\u8cc7\u6e90\uff0c\u662f\u4ee3\u8868\u9019\u4efd Yaml \u6c92\u6709\u5b9a\u7fa9 limits / requests \u5169\u500b\u6578\u5b57\u53bb\u9650\u5236\u4ed6\u7684\u8cc7\u6e90\u4f7f\u7528\uff0c\u800c\u662f\u6703\u7528 BestEffort \u7684\u65b9\u5f0f\u904b\u884c\u3002\u5728\u9019\u500b\u72c0\u6cc1\u4e0b\uff0c\u5982\u679c\u771f\u7684\u5beb\u4e0d\u51fa\u4f86\uff0c\u771f\u7684\u662f\u53ea\u80fd\u6191\u7d93\u9a57\u5148\u4f30\u4e00\u500b\u6578\u5b57\u7d66 requests \u78ba\u4fdd\u4e0d\u6703\u7206\u70b8\uff0c\u518d\u4f86\u7528 Metrics \u670d\u52d9\uff0c\u5982\u81ea\u5efa Prometheus\u3001\u6216 SaaS \u670d\u52d9 Tanzu Observability \u9577\u671f\u89c0\u6e2c\u8abf\u6574\u6578\u5b57\u70ba\u6bd4\u8f03\u52d9\u5be6\u7684\u4f5c\u6cd5\u3002\u5018\u82e5\u4f60\u5982\u679c\u9078\u7528\u7684\u7a0b\u5f0f\u662f Java JVM \u6216\u8005\u662f\u81ea\u5e36\u7a0b\u5f0f\u8a9e\u8a00\u865b\u64ec\u6a5f\uff0c\u6703\u76f8\u7576\u597d\u4f30\u7b97\uff0c\u4f46\u672c\u6587\u4e0d\u6df1\u5165\u63a2\u7a76</p> <p>\u90a3\u984d\u5916\u554f\u984c\u4f86\u4e86\uff0c\u5982\u679c\u6211\u5728\u8cc7\u6e90\u88e1\u9762\u586b 0 \u7684\u8a71\u6703\u600e\u6a23?</p>","tags":["kubernetes"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html#0","title":"\u95dc\u65bc 0 \u7684\u90a3\u4e9b\u4e8b","text":"<p>\u5148\u8b1b\u7d50\u8ad6\uff0c\u5efa\u8b70\u9084\u662f\u8981\u8a2d\u5b9a limits \u8ddf requests \u7684\u503c\u4e0a\u53bb\uff0c\u6700\u5c11\u4e5f\u8981\u6709 limits</p> <p>\u7576\u8cc7\u6e90\u771f\u5fc3\u4e0d\u8db3\u7684\u6642\u5019\uff0c\u5247 Kubernetes \u5247\u6709\u5167\u5efa\u652f\u63f4 QoS \u670d\u52d9\u7ba1\u7406\u80fd\u529b\uff0c\u4e14\u652f\u63f4\u4f5c\u696d\u7cfb\u7d71\u7b49\u7d1a\u7684 OOM \u63a7\u5236\uff0c\u6700\u5c0f\u8a08\u7b97\u55ae\u4f4d\u70ba Pod\u3002<code>\u4e00\u822c\u4f86\u8aaa\uff0c\u4f30\u7b97\u8a08\u7b97\u8cc7\u6e90 limits \u6bd4\u8f03\u91cd\u8981\uff0c\u5be6\u969b\u4e0a\u904b\u884c\u8abf\u5ea6\u5247\u662f requests \u6bd4\u8f03\u91cd\u8981</code></p> <p>Kubernetes \u6703\u958b\u59cb\u4f9d\u64da QoS \u4e09\u7a2e\u7b49\u7d1a\uff08\u7531\u6700\u9ad8\u5230\u6700\u4f4e\u512a\u5148\u6b0a\u6392\u5e8f\uff09\uff1aGuranted &gt; Bursatable &gt; BestEffort \u9032\u884c\u6b0a\u91cd\u6392\u5e8f\uff0c\u901a\u5e38\u6703\u767c\u751f OOM (Out-of-Memory) \u4e5f\u90fd\u662f\u56e0\u70ba\u649e\u5230\u8cc7\u6e90\u4e0d\u8db3\uff0c\u7136\u5f8c\u512a\u5148\u6b0a\u91cd\u53c8\u4f4e\uff0c\u5c31\u88ab\u5e79\u6389\u4e86\uff0c\u5e38\u898b\u5982 AI/ML \u5bb9\u5668\u7b49\u6703\u5403\u8cc7\u6e90\u7684\u5bb9\u5668\u670d\u52d9\uff0c\u78ba\u5207\u7684\u8a73\u7d30\u5167\u5bb9\u8acb\u53c3\u95b1 Kubernetes - \u914d\u7f6e Pod \u7684\u670d\u52a1\u8d28\u91cf</p> \u512a\u5148\u6b0a QoS \u985e\u578b \u63cf\u8ff0 1 (highest) Guaranted Pod \u88e1\u9762\u7684\u6bcf\u4e00\u500b Container \u90fd\u8981\u8a2d\u5b9a requests \u7b49\u65bc limits (\u5169\u500b\u503c\u7686\u6709\u8a2d\u5b9a\uff0c\u4e14\u4e0d\u7b49\u65bc 0) 2 Burstable Pod \u88e1\u9762\u7684\u4efb\u4e00\u500b Container \u5177\u6709 requests \u4e0d\u7b49\u65bc limits \u6578\u503c\uff0c\u4e14\u4e0d\u7b26\u5408 Guaranted \u689d\u4ef6 3 (lowest) BestEffort \u6c92\u6709\u8a2d\u5b9a\u4efb\u4f55\u8cc7\u6e90\u8acb\u6c42\u548c\u9650\u5236 <p>\u7576\u7136\u4f60\u770b\u5b8c\u4e0a\u9762\u61c9\u8a72\u6703\u9727\u50bb\u50bb\uff0c\u6240\u4ee5\u8eab\u70ba Excel \u7cbe\u7b97\u5e2b\u7684\u6211\u5e6b\u5927\u5bb6\u6574\u7406\u4e86\u4ee5\u4e0b\u5217\u8209\u4e86\u5df2\u77e5\u7d44\u5408\uff0c\u4f9b\u5927\u5bb6\u53c3\u8003</p> <p></p> <p>\u4f60\u770b\u5b8c\u4e0a\u9762\u7684\u5716\u61c9\u8a72\u6703\u77e5\u9053\u4e00\u500b\u4e8b\u5be6\uff0c<code>0</code> \u5728 Kubernetes \u4f86\u8aaa\u662f\u6709\u610f\u7fa9\u7684\uff0c\u6240\u4ee5\u8cc7\u6e90\u4f30\u7b97\u8acb\u4e0d\u8981\u4e82\u5beb\uff0c\u4ed6\u4e0d\u4ee3\u8868\u7121\u9650\u5927\u8cc7\u6e90\u7684\u610f\u601d...\u5982\u679c\u771f\u7684\u4e0d\u77e5\u9053\u8acb\u7559\u7a7a\uff0c\u800c\u4e0d\u662f\u5beb 0</p>","tags":["kubernetes"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html#app","title":"\u4ee5 App \u89d2\u5ea6\u51fa\u767c\u7684\u5e38\u898b\u8cc7\u6e90\u932f\u4f30\u8aa4\u5340","text":"<p>\u4f60\u662f\u4e0d\u662f\u89ba\u5f97\u5230\u9019\u908a\u5c31\u53ef\u4ee5\u4f30\u7b97\u7d50\u675f\u4e86\uff1f<code>\u5f88\u62b1\u6b49\u6c92\u6709</code>\uff0c\u4f60\u9084\u5c11\u7b97\u904b\u884c Kubernetes \u6240\u9700\u8981\u7684\u670d\u52d9\uff0c\u5982 kubelet\u3001CNI\u3001kube-proxy\u3001OS \u672c\u8eab\u670d\u52d9\u7b49\u7b49\u9019\u4e9b\u4e0d\u5b58\u5728\u65bc kubernetes \u7684\u8cc7\u6e90\u6e05\u55ae\u4e0a\uff0c\u4f46\u5be6\u969b\u4e0a\u662f\u9700\u8981\u9019\u4e9b\u670d\u52d9\u624d\u80fd\u5920\u597d\u597d\u7684\u904b\u884c Kubernetes \u670d\u52d9\uff0c\u90a3\u9019\u662f\u4ec0\u9ebc\u610f\u601d\u5462?</p> <p>\u62ff\u623f\u5b50\u6b0a\u72c0\u6bd4\u55bb\uff0c\u4ee5\u4e0a\u6240\u505a\u7684\u4e8b\u60c5\u90fd\u662f\u5728\u7b97\u5ba4\u5167\u9762\u7a4d\uff08\u5ba2\u5ef3\u3001\u6d74\u5ba4\u3001\u967d\u53f0\uff09\uff0c\u5be6\u969b\u4e0a\u4f60\u9084\u6709\u516c\u8a2d\uff08\u6a13\u68af\u3001\u96fb\u68af\u3001\u5065\u8eab\u623f\uff09\u8981\u7b97\u554a\uff01\u6240\u4ee5\u6700\u7d42\u4f30\u7b97 1 \u500b Kubernetes \u6240\u9700\u8cc7\u6e90\u7684\u7d50\u679c\uff0c\u4e00\u5b9a\u6703\u6bd4 App \u6240\u5beb\u7684\u9084\u8981\u4f86\u5f97\u5927\u4e0a\u4e00\u9ede</p> <p></p> <p>\u800c\u5404\u5927\u5ee0\u5546\u70ba\u4e86\u8981\u964d\u4f4e\u516c\u8a2d\u6bd4\uff0c\u7d1b\u7d1b\u90fd\u63a8\u51fa\u4e86 Container OS \u9032\u884c\u8cc7\u6e90\u548c\u6548\u80fd\u4e0a\u7684\u6700\u4f73\u5316\uff0c\u7562\u7adf\u8ab0\u5e0c\u671b\u62ff\u5230 1 \u500b 4c/8g \u7684 worker \u7bc0\u9ede\uff0c\u628a\u4e00\u5806\u8ddf kubernetes \u6c92\u95dc\u4fc2\u7684\u670d\u52d9\u958b\u8d77\u4f86\u5c31\u5269\u4e0d\u5230\u4e00\u534a\u8cc7\u6e90\u53ef\u4ee5\u7528\uff0c\u4f46\u56e0\u70ba\u5404\u5bb6\u51fa Container OS \u7cfb\u7d71\u90fd\u4e0d\u76e1\u76f8\u540c\uff0c\u6240\u4ee5\u6703\u5f88\u4ef0\u8cf4\u5404\u81ea\u5ee0\u5546\u5de5\u7a0b\u5e2b\u7684\u7cbe\u7b97</p>","tags":["kubernetes"]},{"location":"20211112-how-to-sizing-kubernetes-resource-and-infra-resource.html#_2","title":"\u7d50\u8a9e","text":"<p>\u770b\u5b8c\u4ee5\u4e0a\u7684\u6587\u7ae0\uff0c\u76f8\u4fe1\u5927\u5bb6\u4e00\u5b9a\u6703\u89ba\u5f97\u70ba\u5565\u6211\u8981\u500b Kubernetes \u70ba\u5565\u8981\u641e\u5f97\u9019\u9ebc\u8907\u96dc\uff0c\u6240\u4ee5\u4e0b\u7bc7\u6703\u8b1b\uff0c<code>\u4ee5 Ops \u89d2\u5ea6\u51fa\u767c\u7684 Hardware (or Cloud Provider) \u8cc7\u6e90\u4f30\u7b97</code>\uff0c\u5c31\u662f\u5beb\u4e0d\u51fa\u4f86\u7684\u72c0\u6cc1\u4e0b\u8eab\u70ba Ops \u5230\u5e95\u8a72\u600e\u9ebc\u8fa6\uff1f</p> <p>\u5e0c\u671b\u4eca\u5e74\u80fd\u5beb\u5f97\u51fa\u4f86...\u5e0c\u671b...</p> <p>\u7279\u5225\u611f\u8b1d Gene Kuo \u548c Hwchiu \u5e6b\u5fd9\u6821\u7a3f XD</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html","title":"\u70ba\u4ec0\u9ebc\u6211\u4f48\u7f72\u7684 Kubernetes \u670d\u52d9\u4e0d\u6703\u52d5!? \u500b\u4eba\u9664\u932f\u601d\u8def\u5206\u4eab","text":"<p>\u67d0\u9031\uff0c\u4e0b\u73ed\u524d\u81e8\u6642\u88ab S \u5b78\u59ca\u6293\u53bb\u770b\u4e86\u4e00\u500b Kubernetes \u670d\u52d9\u70ba\u4f55\u4e0d\u6703\u6b63\u5e38\u4f5c\u52d5\uff0c\u6545\u8eab\u70ba\u5b78\u5f1f\u7684\u6211\u51fa\u4e86\u7bc7\u6280\u8853\u6587\u5e0c\u671b\u8a18\u9304\u4e00\u4e0b\u76f8\u95dc\u9664\u932f\u601d\u8def\u7d66\u5404\u4f4d\u53c3\u8003</p> <p>\u53cb\u4eba A\uff1a\u89ba\u5f97\u6bd4\u641e Kubernetes \u9084\u96e3\u7684\u4e8b\u60c5\uff0c\u5927\u6982\u5c31\u662f\u8ac7\u6200\u611b\u9019\u4ef6\u4e8b\u4e86 \u53cb\u4eba B\uff1aKubernetes \u8d77\u78bc\u8ddf\u4ed6\u544a\u767d (a.k.a. \u8072\u660e\u5f0f\u5ba3\u544a, Declarative)\uff0c\u5b83\u6703\u6700\u5927\u6eff\u8db3\u4f60\u671f\u671b\u72c0\u614b (Desired State)\uff0c\u4f46\u8ddf\u59b9\u5b50\u544a\u767d\u53ef\u80fd\u6703\u88ab\u6293\u53bb\u8b66\u5bdf\u5c40\uff0c\u9806\u4fbf\u9001\u4f60\u4e00\u5f35\u8ddf\u9a37\u6cd5 \u53cb\u4eba C\uff1a\u9019\u6a23\u60f3\u60f3 Kubernetes \u597d\u50cf\u9084\u6bd4\u8f03\u548c\u85f9\u53ef\u89aa</p> <p></p> <p>\u9996\u5148\uff0c\u5f88\u4e45\u4ee5\u524d Learnk8s A visual guide on troubleshooting Kubernetes deployments \u6709\u70ba\u4e86\u5ee3\u5927\u53d7\u5230 Kubernetes \u4f48\u7f72(\u837c\u6bd2)\u5931\u6557\u4e4b\u82e6\u7684\u670b\u53cb\u51fa\u4e86\u4e00\u4efd Troubleshooting Kubernetes deployments \u6d41\u7a0b\u5716 \u7c21\u4e2d\u7248 / \u82f1\u6587\u7248\uff0c\u6211\u500b\u4eba\u89ba\u5f97\u5f88\u5177\u5099\u53c3\u8003\u50f9\u503c\uff0c\u5167\u6587\u4e3b\u8981 3 \u5927\u968e\u6bb5\u662f\uff1a</p> <ol> <li>\u78ba\u8a8d Pod \u904b\u4f5c\u6b63\u5e38 (\u7d04\u7565\u4f54\u6bd4 50%)</li> <li>\u78ba\u8a8d Service \u904b\u4f5c\u6b63\u5e38 (\u7d04\u7565\u4f54\u6bd4 25%)</li> <li>\u78ba\u8a8d Ingress \u904b\u4f5c\u6b63\u5e38 (\u7d04\u7565\u4f54\u6bd4 25%)</li> </ol> <p>\u9664\u4e86\u78ba\u8a8d Pod \u904b\u4f5c\u6b63\u5e38\u662f\u6bd4\u8f03\u504f\u5411 App \u958b\u767c\u53ca\u7a0b\u5f0f\u4f48\u7f72\u8b70\u984c\uff0c\u5176\u4ed6\u5169\u500b\u7d55\u5927\u90e8\u5206\u90fd\u8ddf\u7db2\u8def\u812b\u4e0d\u4e86\u592a\u5927\u95dc\u4fc2\uff0c\u6240\u4ee5\u6211\u9019\u908a\u57fa\u65bc\u8a72\u6587\u5c0d\u65bc\u7db2\u8def\u9664\u932f\uff0c\u5305\u542b DNS\u3001IP\u3001HTTP \u6e2c\u8a66\u65b9\u5f0f\u9032\u884c\u4e00\u4e9b\u500b\u4eba\u88dc\u5145\u5efa\u8b70</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#pod","title":"\u9664\u932f\u524d\u7684\u57fa\u790e\u77e5\u8b58: Pod","text":"<p>Pod\uff0c\u662f\u5be6\u969b\u4e0a\u4f60\u7684\u5bb9\u5668\u6620\u50cf\u6a94\u904b\u884c\u5728 Kubernetes \u7684\u6700\u5c0f\u55ae\u4f4d\uff0c\u88e1\u9762\u53ef\u4ee5\u662f 1 \u500b\u6216\u591a\u500b Containers \u5728\u88e1\u9762\uff0c\u800c\u540c\u4e00\u500b Pod \u88e1\u9762\u6703\u5171\u4eab\u540c\u4e00\u500b Linux Namespace \u7684\u8cc7\u6e90\uff0c\u5305\u542b PID / NID \u7b49\u3002\u65bc\u672c\u7bc7\u6587\u7ae0\u5167\u6bd4\u8f03\u91cd\u8981\u7684\u662f\u540c\u4e00\u500b Pod \u88e1\u9762\u7684 Linux Network Namesapce \u7684\u7db2\u8def\u5171\u4eab\u80fd\u529b\uff0c\u610f\u6307\u6bcf 1 \u500b Pod \uff0c\u7121\u8ad6\u6709\u591a\u5c11\u500b Containers \u5728\u88e1\u9762\u904b\u884c\uff0c\u90fd\u6703\u5171\u4eab\u65bc\u8a72 Kubernetes \u53e2\u96c6\u5167\u552f\u4e00\u7684 IP\uff0c\u4e5f\u5c31\u662f <code>Pod IP</code></p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#1-debug-container","title":"\u4e00\u5207\u7684\u8d77\u9ede\uff0c1 \u500b Debug Container","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u5148\u6709\u4e00\u500b\u5df2\u7d93\u5c01\u88dd\u597d<code>\u5177\u5099\u9664\u932f\u5de5\u5177</code>\u7684\u5bb9\u5668\u6620\u50cf\u6a94\uff0c\u5f8c\u9762\u7c21\u7a31 <code>Debug Container</code></p> <p>\u9019\u500b Debug Container \u7684\u4f86\u6e90\uff0c\u4e3b\u8981\u662f 2 \u500b\u4f86\u6e90\uff0c\u5176\u4e00\u662f\u53ef\u4ee5\u662f\u63a1\u7528\u793e\u7fa4\u5584\u5fc3\u4eba\u58eb\u7de8\u8b6f\u597d\u7684\u5bb9\u5668\u6620\u50cf\u6a94\uff0c\u5982 <code>docker.io/nicolaka/netshoot</code>\u7b49\uff0c\u6216\u5176\u4e8c\u662f\u96a8\u81ea\u5bb6\u9700\u6c42\uff0c\u5f9e <code>Base Image</code> \u81ea\u884c\u5b89\u88dd\u3001\u6253\u5305\u5bb9\u5668\u6620\u50cf\u6a94\uff0c\u5982 <code>quay.io/pichuang/debug-container</code> \u7b49\uff0c\u4fdd\u6301\u5bb9\u5668\u6620\u50cf\u6a94\u53ef\u63a7\u3001\u53ef\u81ea\u884c\u7dad\u8b77\u7b49\u597d\u8655</p> <p>\u672c\u6587\u63a1\u7528 <code>docker.io/nicolaka/netshoot</code> \u4f5c\u70ba\u4e3b\u8981 Debug Container \u7684\u57fa\u790e\uff0c\u8a73\u7d30\u5305\u542b\u4e4b\u5de5\u5177\u53ef\u53c3\u8003 nicolaka/netshoot</p> <p>\u628a\u9019\u500b Debug Container \u904b\u884c\u5728 Kubernetes \u4e0a\u5f8c\uff0c\u6703\u4ee5 Kubernetes Pod \u7684\u5f62\u5f0f\u904b\u4f5c\u65bc\u4e0a\uff0c\u6240\u4ee5\u4e5f\u6703\u6709 1 \u500b Pod IP \u53ef\u4ee5\u62ff\u4f86\u8ddf\u5176\u4ed6 Pod \u505a\u4ea4\u53c9\u6bd4\u5c0d\u4f7f\u7528\uff0c\u6240\u4ee5\u8eab\u70ba\u4e00\u500b Kubernetes \u4f7f\u7528\u8005\uff0c\u6709\u4e00\u500b\u597d\u4e0a\u624b\u7684 Debug Container \u662f\u4e00\u500b\u5f88\u5408\u7406\u7684\u4e8b\u60c5</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#debug-container-2","title":"\u904b\u884c Debug Container \u4e4b 2 \u7a2e\u65b9\u5f0f","text":"<p>\u81f3\u65bc\u904b\u884c\u65b9\u5f0f\u662f\u4f7f\u7528 kubectl \u9032\u884c\u64cd\u4f5c\uff0c\u4ee5<code>\u6307\u5b9a namespace \u70ba\u89d2\u5ea6</code>\u51fa\u767c\u9032\u884c\u64cd\u4f5c\uff0c\u4e3b\u8981\u6709\u4e0b\u5217 2 \u7a2e\u4f5c\u6cd5\u4f46\u4e0d\u9650\u65bc\uff1a</p> <ol> <li> <p>\u65bc\u6307\u5b9a Namespace \u57f7\u884c Debug Container <pre><code>#\n# Running debug container within the Kubernetes Namespace on Any Nodes\n#\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n</code></pre></p> </li> <li> <p>\u65bc\u6307\u5b9a Namespace \u548c\u6307\u5b9a Node \u57f7\u884c Debug Container <pre><code>#\n# Running debug container within the Kubernetes Namespace on Specific Node (ex: tkg-worker-1)\n#\n# List of all Kubernetes nodes\n$ kubectl get nodes\nNAME                           STATUS   ROLES                  AGE   VERSION\ntkgm14-control-plane-pv76m     Ready    control-plane,master   38d   v1.21.2+vmware.1\ntkgm14-md-0-66f85bf86b-wfjt7   Ready    &lt;none&gt;                 38d   v1.21.2+vmware.1\n\n$ kubectl run -n default debug-container --rm -i --tty --overrides='{ \"apiVersion\": \"v1\", \"spec\": {\"kubernetes.io/hostname\":\"tkgm14-control-plane-pv76m\"}}' --image docker.io/nicolaka/netshoot -- /bin/bash\n</code></pre></p> </li> </ol> <p>\u6b63\u5e38\u72c0\u6cc1\u4e0b\uff0c\u4f60\u61c9\u8a72\u76f4\u63a5\u4f7f\u7528\u65b9\u6cd5 1 \u5c31\u53ef\u4ee5\u627e\u51fa\u5f88\u591a\u554f\u984c\u4e86\uff0c\u9664\u975e\u4f60\u61f7\u7591\u7279\u5b9a\u7bc0\u9ede\u602a\u602a\u7684\uff0c\u518d\u4f7f\u7528\u65b9\u6cd5 2</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#pod-5-5","title":"\u5f9e Pod \u51fa\u767c\u7684 5 \u7a2e\u6d41\u91cf\u8d70\u6cd5\uff0c5 \u7a2e\u9664\u932f\u65b9\u5411","text":"<p>\u6574\u9ad4\u4e0a\uff0cKubernetes \u5167\u5230\u5916\u7db2\u8def\u6d41\u91cf\uff0c\u7d04\u7565\u53ef\u4ee5\u689d\u5217\u6210\u70ba\u4e0b\u5217 5 \u7a2e\u6d41\u91cf\u8d70\u6cd5\u4f46\u4e0d\u9650\uff1a</p> <ol> <li>Container to Container</li> <li>Pod to Pod in the same nodes</li> <li>Pod to Pod across different nodes</li> <li>Pod to Service</li> <li>Pod to Internet</li> </ol> <p>\u8a73\u7d30\u53ef\u53c3\u8003\u5c0f\u5f1f\u65bc\u9999\u6e2f\u958b\u6e90\u4eba\u5e74\u6703\u4e4b\u5206\u4eab 20200612, How I do troubleshooting on container, more than docker?, HKOSCon 2020</p> <p>\u56e0\u70ba\u5be6\u969b\u4e0a\u6240\u6709\u5be6\u969b\u670d\u52d9\u90fd\u662f\u88ab\u5305\u88dd\u5728 Pod \u88e1\u9762\u904b\u884c\uff0c\u6545\u7576\u9047\u5230\u670d\u52d9\u4e0d\u901a\u6216\u7570\u5e38\u7684\u6642\u5019\uff0c\u60f3\u8981\u5feb\u901f\u9032\u884c\u7db2\u8def\u6d41\u91cf\u9664\u932f\uff0c\u53ef\u4ee5\u4ee5 <code>Pod IP \u89d2\u5ea6\u4e14\u4ee5 Kubernetes Service \u5e38\u898b\u5206\u985e\u70ba\u4e3b</code>\u4e4b 4 \u7a2e\u9664\u932f\u65b9\u5411:</p> <ol> <li>Pod IP to Pod IP</li> <li>Pod IP to ClusterIP</li> <li>Pod IP to NodePort IP</li> <li>Pod IP to LoadBalancer IP (\u96f2\u7aef\u5e38\u898b\uff0c\u6216\u7279\u5b9a LB \u8edf\u9ad4\u6709\u63d0\u4f9b\u6574\u5408\u80fd\u529b\uff0c\u5982 AVI Networks)</li> </ol> <p>\u53e6\u5916\u9084\u6709 1 \u500b Kubernetes Service \u7de8\u5236\u5916\u4f46\u5e38\u898b\u7684 Ingress Controller</p> <ol> <li>Pod IP to Ingress Hosts (\u5730\u7aef\u5e38\u898b\uff0c\u5982 Contour\u3001Nginx)</li> </ol>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#_1","title":"\u6536\u96c6\u9664\u932f\u524d\u4e4b\u5fc5\u8981\u8cc7\u8a0a","text":"<p>\u8981\u958b\u59cb\u4f7f\u7528 Debug Container \u9032\u884c\u9664\u932f\u4e4b\u524d\uff0c\u52d9\u5fc5\u8981\u5148\u6536\u96c6\u597d\u76f8\u95dc\u8cc7\u8a0a <code>kubectl get pods,svc,nodes -owide</code>\uff0c\u4e3b\u8981\u662f\u8981\u6709 IP \u548c\u540d\u5b57\u4e4b\u5176\u76f8\u95dc\u8cc7\u8a0a\uff0c\u5982\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>$ kubectl get pods,svc,nodes,ingress -owide\nNAME                                    READY   STATUS    RESTARTS   AGE   IP            NODE                           NOMINATED NODE   READINESS GATES\npod/tanzu-deployment-5769f6c4df-2fl28   1/1     Running   0          60m   100.96.1.33   tkgm14-md-0-66f85bf86b-wfjt7   &lt;none&gt;           &lt;none&gt;\npod/tanzu-deployment-5769f6c4df-8jj87   1/1     Running   0          60m   100.96.1.35   tkgm14-md-0-66f85bf86b-wfjt7   &lt;none&gt;           &lt;none&gt;\npod/tanzu-deployment-5769f6c4df-nlcg8   1/1     Running   0          60m   100.96.1.34   tkgm14-md-0-66f85bf86b-wfjt7   &lt;none&gt;           &lt;none&gt;\n\nNAME                     TYPE         CLUSTER-IP      EXTERNAL-IP     PORT(S)          AGE   SELECTOR\nservice/kubernetes       ClusterIP    100.64.0.1      &lt;none&gt;          443/TCP          38d   &lt;none&gt;\nservice/tanzu-service    NodePort     100.70.88.107   &lt;none&gt;          3000:30390/TCP   60m   app=tkgm-deployment\nservice/tanzu-lb-service LoadBalancer 100.70.88.108   172.18.30.100   3000:30340/TCP   60m   app=tkgm-deployment\n\nNAME                                STATUS   ROLES                  AGE   VERSION            INTERNAL-IP    EXTERNAL-IP    OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME\nnode/tkgm14-control-plane-pv76m     Ready    control-plane,master   38d   v1.21.2+vmware.1   172.18.30.38   172.18.30.38   Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6\nnode/tkgm14-md-0-66f85bf86b-wfjt7   Ready    &lt;none&gt;                 38d   v1.21.2+vmware.1   172.18.30.39   172.18.30.39   Ubuntu 20.04.2 LTS   5.4.0-77-generic   containerd://1.4.6\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#1-pod-ip-to-pod-ip-traffic","title":"1. Pod IP to Pod IP Traffic","text":"<p>\u4e2d\u7b49\u96e3\u5ea6\u7684\u6e2c\u8a66\uff0c\u5305\u542b Ping / Curl \u90fd\u8981\u80fd\u7372\u5f97\u9810\u671f\u7684\u53cd\u61c9\uff0c\u5982\u679c\u6709\u554f\u984c\u7684\u8a71\uff0c\u53ef\u4ee5\u53c3\u95b1 Learnk8s A visual guide on troubleshooting Kubernetes deployments \u9032\u884c Pod \u5167\u90e8\u904b\u884c\u7684\u554f\u984c\u9664\u932f\uff0c\u9019\u6642\u5019\u4e0b <code>kubectl logs &lt;pod name&gt;</code> \u548c <code>kubectl describe pod &lt;pod name&gt;</code> \u61c9\u8a72\u90fd\u6703\u6709\u4e9b\u86db\u7d72\u99ac\u8de1</p> <pre><code># Run debug container\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n\n# List of Routing Table\nbash-5.1# ip r\ndefault via 100.96.1.1 dev eth0\n100.96.1.0/24 dev eth0 proto kernel scope link src 100.96.1.36\n\n#\n# Ping\n# Test Connectivity\nbash-5.1# ping 100.96.1.35\nbash-5.1# ping 100.96.1.34\nbash-5.1# ping 100.96.1.33\nPING 100.96.1.33 (100.96.1.33) 56(84) bytes of data.\n64 bytes from 100.96.1.33: icmp_seq=1 ttl=64 time=0.875 ms\n\n# Curl web page\nbash-5.1# curl 100.96.1.33:3000\nbash-5.1# curl 100.96.1.34:3000\nbash-5.1# curl 100.96.1.35:3000\nHello World!\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#2-pod-ip-to-clusterip-traffic","title":"2. Pod IP to ClusterIP Traffic","text":"<p>\u6700\u6838\u5fc3\u7684\u6e2c\u8a66\uff0c\u9996\u5148\u4f60\u9700\u8981\u5148\u5c0d Kubernetes Services \u904b\u4f5c\u8981\u6709\u4e00\u5b9a\u7a0b\u5ea6\u7406\u89e3\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 Hwchiu - Kubernetes What Is Service? \u4e00\u6587\uff0c\u5728\u9019\u500b\u968e\u6bb5\u4e3b\u8981\u6e2c\u8a66\u76ee\u6a19\u662f\uff0c\u78ba\u8a8d\u53ef\u4ee5\u900f\u904e Kubernetes Cluster IP \u7372\u5f97 Pod \u7684\u5167\u5bb9</p> <pre><code># Run debug container\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n\n# List of Routing Table\nbash-5.1# ip r\ndefault via 100.96.1.1 dev eth0\n100.96.1.0/24 dev eth0 proto kernel scope link src 100.96.1.37\n\n#\n# DNS Lookup\n# https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/\n#\n# nslookup &lt;service name&gt;.&lt;namespace name&gt;\n# nslookup &lt;service name&gt;.&lt;namespace name&gt;.svc.cluster.local\nbash-5.1# nslookup tanzu-service.default\nbash-5.1# nslookup tanzu-service.default.svc.cluster.local\nServer:     100.64.0.10\nAddress:    100.64.0.10#53\n\nName:   tanzu-service.default.svc.cluster.local\nAddress: 100.70.88.107\n\n#\n# Ping (FAILED)\n# Ping doesn't work with service's cluster IPs like 100.70.88.107, as it is a virtual IP\n# You should be able to ping a specific pod, but no a service.\nbash-5.1# ping 100.70.88.107\nPING 100.70.88.107 (100.70.88.107) 56(84) bytes of data.\n-- Pending --\n\n#\n# Curl\n#\n# curl &lt;service name&gt;.&lt;namespace name&gt;:&lt;svc port&gt;\n# curl &lt;service name&gt;.&lt;namespace name&gt;.svc.cluster.local:&lt;svc port&gt;\n# curl &lt;cluster ip&gt;:&lt;svc port&gt;&gt;\n\n# Curl web page (OK)\nbash-5.1# curl tanzu-service.default:3000\nHello World!\nbash-5.1# curl tanzu-service.default.svc.cluster.local:3000\nHello World!\nbash-5.1# curl 100.70.88.107:3000\nHello World!\n\n# Curl Kubernetes API Service (OK)\nbash-5.1# curl -o /dev/null -s -w \"%{http_code}\\n\" --insecure https://kubernetes.default:443\n403\nbash-5.1# curl -o /dev/null -s -w \"%{http_code}\\n\" --insecure https://kubernetes.default.svc.cluster.local:443\n403\nbash-5.1# curl -o /dev/null -s -w \"%{http_code}\\n\" --insecure https://100.64.0.1:443\n403\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#3-pod-ip-to-nodeport-ip","title":"3. Pod IP to NodePort IP","text":"<p>\u57f7\u884c\u4e00\u6b21 <code>2. Pod IP to Cluster IP</code> \u6e2c\u8a66\u4ee5\u5916\uff0c\u9084\u9700\u8981\u53e6\u5916\u78ba\u8a8d\u5c0d\u5916\u670d\u52d9\u63ed\u9732\u7684\u90e8\u4efd\uff0c\u4e3b\u8981\u4ee5 Node IP \u70ba\u57fa\u790e</p> <pre><code># Run debug container\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n\n# List of Routing Table\nbash-5.1# ip r\ndefault via 100.96.1.1 dev eth0\n100.96.1.0/24 dev eth0 proto kernel scope link src 100.96.1.40\n\n#\n# Ping\n# Test Connectivity\n# Pod IP -&gt; Node IP\n#\nbash-5.1# ping 172.18.30.39\nPING 172.18.30.39 (172.18.30.39) 56(84) bytes of data.\n64 bytes from 172.18.30.39: icmp_seq=1 ttl=64 time=0.463 ms\n\n#\n# Curl\n# curl &lt;node ip&gt;:&lt;node port&gt;\nbash-5.1# curl 172.18.30.39:30390\nHello World!\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#4-pod-ip-to-loadbalancer-ip","title":"4. Pod IP to LoadBalancer IP","text":"<p>\u57f7\u884c\u4e00\u6b21 <code>2. Pod IP to Cluster IP</code> \u6e2c\u8a66\u4ee5\u5916\uff0c\u9084\u9700\u8981\u53e6\u5916\u78ba\u8a8d\u5c0d\u5916\u670d\u52d9\u63ed\u9732\u7684\u90e8\u4efd\uff0c\u4e3b\u8981\u4ee5 Loadbalacner IP \u70ba\u57fa\u790e</p> <pre><code># Run debug container\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n\n# List of Routing Table\nbash-5.1# ip r\ndefault via 100.96.1.1 dev eth0\n100.96.1.0/24 dev eth0 proto kernel scope link src 100.96.1.40\n\n#\n# Ping\n# Test Connectivity\n# Pod IP -&gt; LoadBalancer IP\n#\n\nbash-5.1# ping 172.18.30.100\nPING 172.18.30.100 (172.18.30.100) 56(84) bytes of data.\n64 bytes from 172.18.30.100: icmp_seq=1 ttl=64 time=0.3 ms\n\n#\n# Curl\n# curl &lt;LoadBalancer ip&gt;:&lt;LB port&gt;\nbash-5.1# curl 172.18.30.100:30340\nHello World!\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#5-pod-ip-to-ingress-hosts","title":"5. Pod IP to Ingress Hosts","text":"<p>\u57f7\u884c\u4e00\u6b21 <code>2. Pod IP to Cluster IP</code> \u6e2c\u8a66\u4ee5\u5916\uff0c\u9084\u9700\u8981\u53e6\u5916\u78ba\u8a8d\u5c0d\u5916\u670d\u52d9\u63ed\u9732\u7684\u90e8\u4efd\uff0c\u4e3b\u8981\u4ee5 Ingress Hosts \u70ba\u57fa\u790e</p> <pre><code>#\n$ kubectl get ingress\nNAME                        HOSTS                                                   ADDRESS       PORTS   AGE\nname-virtual-host-ingress   tutum.training.boxboat.io,jwilder.training.boxboat.io   172.17.0.58   80      9m24s\npath-ingress                training.boxboat.io                                     172.17.0.58   80      9m2s\n\n# Run debug container\n$ kubectl run -n default debug-container --rm -i --tty --image docker.io/nicolaka/netshoot -- /bin/bash\n\n# List of Routing Table\nbash-5.1# ip r\ndefault via 100.96.1.1 dev eth0\n100.96.1.0/24 dev eth0 proto kernel scope link src 100.96.1.40\n\n#\n# Ping\n# Test Connectivity\n#\n\nbash-5.1# ping 172.17.0.58\nPING 172.17.0.58 (172.17.0.58) 56(84) bytes of data.\n64 bytes from 172.17.0.58: icmp_seq=1 ttl=63 time=0.706 ms\n\n# Curl\n# curl &lt;HOSTS&gt;:&lt;PORTS&gt;\nbash-5.1# curl training.boxboat.io:80\n</code></pre>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#pod-to-ingress-vs-pod-to-loadbalancer","title":"Pod to Ingress v.s. Pod to LoadBalancer","text":"<p>\u5982\u679c\u4f60\u6709\u4ed4\u7d30\u770b\uff0c\u6703\u767c\u73fe Kubernetes LoadBalacner \u8ddf Kubernetes Ingress \u9664\u932f\u8d77\u4f86\u5957\u8def\u5f88\u50cf\uff0c\u7406\u7531\u662f\u4ed6\u5011\u90fd\u662f\u5be6\u969b\u4e0a\u63a5\u6536\u5230 User Traffic \u6700\u524d\u7dda\u7684\u670d\u52d9\uff0c\u81f3\u65bc\u60f3\u8981\u4e86\u89e3\u5169\u8005\u7db2\u8def\u6d41\u91cf\u5dee\u7570\u53ef\u53c3\u8003 Kubernetes NodePort vs LoadBalancer vs Ingress? When should I use what?\uff0c\u53ca Hwchiu - Introduction to Kubernetes Ingress (Nginx)</p> <p>Kubernetes LoadBalacner \u662f Kubernetes Service \u5176\u4e2d\u4e00\u7a2e\u985e\u578b\uff0c\u5916\u9762\u5fc5\u7136\u6703\u6709\u4e00\u500b\u7368\u7acb\u65bc Kubernetes \u5bb9\u5668\u5e73\u53f0\u5916\u90e8\u7684 External LB \u5b58\u5728 Kubernetes Ingress \u4e26\u4e0d\u662f Kubernetes Service\uff0c\u5b83\u53d7\u5230\u7279\u5b9a Ingress Controller \u7ba1\u7406\uff0c\u5efa\u7acb\u65bc Kubernetes \u5bb9\u5668\u5e73\u53f0\u5167\u90e8</p> <p>\u5982\u679c\u4f60\u6c92\u6709\u4ec0\u9ebc\u7279\u5b9a LB \u53ef\u4ee5\u63d0\u4f9b Kubernetes Service \u547c\u53eb\u4f7f\u7528\u7684\u8a71\uff0c\u90a3\u57fa\u672c\u4e0a\u4f60\u5927\u591a\u6578\u90fd\u662f\u7528 Kubernetes Ingress \u4f5c\u70ba\u4e3b\u8981\u4f7f\u7528\uff0c\u4f46\u5169\u8005\u4e5f\u53ef\u4ee5\u4e26\u7528\u5c31\u662f\u4e86\uff0c\u76e1\u53ef\u80fd\u4e0d\u5728\u540c\u4e00\u500b\u7bc0\u9ede\u4e0a\u5373\u53ef\uff0c\u56e0\u70ba hostNetwork \u6709\u883b\u9ad8\u6a5f\u6703\u6703\u885d Port\uff0c\u5982 80/443 \u7b49</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#_2","title":"\u5e38\u898b\u554f\u984c","text":"","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#q1-deploymentyml-kubernetes-api","title":"Q1: deployment.yml \u88e1\u7684 Kubernetes API \u6539\u7248\u4e86\uff0c\u8a72\u600e\u9ebc\u7121\u7e2b\u5730\u4fee\u6b63","text":"<pre><code>$ kubectl apply -f deployment.yml\nerror: unable to recognize \"deployment.yml\": no matches for kind \"Deployment\" in version \"extensions/v1beta1\"\n</code></pre> <p>A1: 1. \u627e\u5230\u6b63\u78ba\u7684 API \u540d\u5b57 <pre><code>$ kubectl api-resources |grep deployments\ndeployments                       deploy       apps/v1                                              true         Deployment\nmachinedeployments                md           cluster.x-k8s.io/v1alpha3                            true         MachineDeployment\n</code></pre> 2. \u4fee\u6b63 deployment.yaml \u5167\u7684\u6a94\u6848\uff0c\u5f9e <code>apiVersion: extensions/v1beta1</code> \u5230 <code>apiVersion: apps/v1</code>\uff0c\u91cd\u65b0\u57f7\u884c 3. \u6c92\u610f\u5916\u61c9\u8a72\u9084\u6703\u6709\u932f\u8aa4\uff0c\u518d\u6839\u64da\u932f\u8aa4\u8a0a\u606f\uff0c\u9032\u884c\u6b04\u4f4d\u7684\u589e\u522a\u4fee</p>","tags":["kubernetes"]},{"location":"20211129-kubernetes-service-troubleshoot.html#q2-kubernetes-platform-administrator","title":"Q2: \u5982\u679c\u4f60\u662f Kubernetes Platform Administrator \u60f3\u8981\u5c0d\u7279\u5b9a\u7bc0\u9ede\u4e4b\u4f5c\u696d\u7cfb\u7d71\u9664\u932f\u90a3\u8a72\u600e\u9ebc\u8fa6?","text":"<p>A2: \u4f48\u7f72\u7684\u6642\u5019\uff0c\u591a\u4e00\u500b <code>\"hostNetwork\": true</code> \u53c3\u6578\u5373\u53ef</p> <pre><code>$ kubectl run -n default debug-container --rm -i --tty --overrides='{ \"apiVersion\": \"v1\", \"spec\": {\"kubernetes.io/hostname\":\"tkgm14-md-0-66f85bf86b-wfjt7\", \"hostNetwork\": true}}' --image nicolaka/netshoot -- /bin/bash\nbash-5.1# ip a show eth0\n2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000\n    link/ether 00:50:56:9e:85:bb brd ff:ff:ff:ff:ff:ff\n    inet 172.18.30.39/24 brd 172.18.30.255 scope global dynamic eth0\n       valid_lft 1059832sec preferred_lft 1059832sec\n    inet6 fe80::250:56ff:fe9e:85bb/64 scope link\n       valid_lft forever preferred_lft forever\n</code></pre>","tags":["kubernetes"]},{"location":"20211231-2021-personal-review.html","title":"2021 \u5e74\u5ea6\u500b\u4eba\u56de\u9867","text":"<p>\u53c8\u4e00\u500b\u5b8c\u6574\u7684\u65e5\u66c6\u5e74\u904e\u4e86\uff0c\u4f86\u500b\u5e74\u5ea6\u56de\u9867\u7d00\u9304\uff0c\u97f3\u6a02\u8d77\uff01</p> <p>{% youtube PlCbgZxonJs %}</p> <p>\u62dc\u62dc</p> <p>2021 \u9019\u5e74\u53ef\u4ee5\u7528 \"\u6642\u5149\u56de\u6eaf\" \u4f86\u7e3d\u7d50\uff0c\u597d\u50cf\u8ddf\u6211\u5169\u5e74\u524d\u7684\u65e5\u5b50\u6c92\u5565\u4e0d\u4e00\u6a23\u554a...\u7121\u8ad6\u662f\u5de5\u4f5c\u9084\u662f\u611f\u60c5\uff0c\u800c\u4e14\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u96a8\u8457\u5e74\u7d00\u589e\u9577\uff0c\u4f5c\u98a8\u537b\u8d8a\u4f86\u8d8a\u9f9c\uff0c\u660e\u660e\u5927\u5b78\u6642\u4ee3\u5c31\u662f\u8d70\u6d6a\u5b50\u8def\u7dda\u7684\u554a\uff01\u6211\u8a72\u662f\u8981\u4f86\u4fee\u6b63\u4e00\u4e0b\u4eba\u751f\u4e86...</p>","tags":["misc","annual"]},{"location":"20211231-2021-personal-review.html#2021_1","title":"2021 \u56de\u9867","text":"<ol> <li>2021 \u751f\u65e5\u7576\u5929\u96e2\u958b\u4e86 3y2m \u7684 Red Hat \u63db\u7403\u968a\u53bb VMware \u6253\u7403\uff0c\u8a73\u53c3\u8cbc\u6587</li> <li>2021 \u5e74\u5ea6\u6f14\u8b1b 10 \u5834\uff0c\u6574\u9ad4\u6bd4 2020 \u5e74\u964d\u4f4e 9 \u5834\uff0c\u6211\u53ea\u80fd\u8aaa\u524d\u534a\u5e74\u771f\u7684\u662f\u795e\u5fd9\uff0c\u5f8c\u534a\u5e74\u5e95\u624d\u56de\u9b42</li> <li>2021 \u5e74\u5ea6\u6587\u7ae0 3 \u7bc7\uff0c\u6bd4 2020 \u5e74\u5927\u5e45\u964d\u4f4e\u4e86 32 \u7bc7\uff0c\u6211\u53ea\u80fd\u8aaa\u524d\u534a\u5e74\u771f\u7684\u662f\u592a\u5fd9\uff0c\u5f8c\u534a\u5e74\u5e95\u624d\u56de\u9b42</li> <li>2021 \u5e74\u9304\u4e86 23 \u500b YouTube \u5f71\u7247\uff0c\u771f\u6c92\u60f3\u5230\u6211\u9304\u9019\u9ebc\u591a...</li> <li>2021 \u5e74\u958b\u59cb\u8a8d\u771f\u63a5\u89f8\u516c\u6709\u96f2\u4e00\u8d77\u5b78\uff0c\u5305\u542b 3 \u5bb6 Azure, GCP, AWS\uff0c\u6211\u53ea\u80fd\u8aaa\u9019\u5e74\u982d\u6574\u9ad4\u6280\u8853\u767c\u5c55\u5c0d\u5730\u7aef Infra \u6280\u80fd\u70ba\u57fa\u790e\u7684\u5b85\u5b85\u76f8\u7576\u4e0d\u53cb\u5584 = =</li> <li>2021 \u6f14\u8b1b \u96f2\u539f\u751f\u4eba\u624d? \u770b\u5f97\u5230\uff0c\u627e\u4e0d\u5230 4.3k \u4eba\u9ede\u95b1\uff0c\u76f8\u7576\u4ee4\u4eba\u610f\u5916\u5730\uff0c\u6bd4\u53bb\u5e74\u6e1b\u80a5\u7d00\u9304\u6587\u9084\u591a\u4eba\u770b\uff0c\u770b\u8d77\u4f86\u771f\u7684\u662f\u666e\u904d\u5927\u5bb6\u7684\u75db\uff0c\u6709\u6a5f\u6703\u53ef\u4ee5\u5728 2022 \u5e74\u5206\u4eab\u4e00\u4e0b\u6211\u7684\u770b\u6cd5</li> <li>2021 \u4eba\u751f\u7b2c\u4e00\u6b21\u8a8d\u771f\u53bb\u8003 4 \u5f35\u8b49\u7167\uff0c\u5305\u542b\u70ba\u4e86\u77ad\u89e3\u8003\u8a66\u96e3\u5ea6\u7684 CKA / CKAD \u548c\u4e0a\u73ed\u7528\u7684 VCP-DCV 2021 / VCAP-DCV Design 2021</li> <li>2021 \u9ad4\u91cd 80 KG\uff0c\u589e\u52a0 8 KG\uff0c\u4f46\u808c\u8089\u91cf\u6709\u4e0a\u5347\uff0c\u5e74\u7d00\u5230\u4e86\u771f\u7684\u8981\u9760\u5065\u8eab\u4fdd\u6301\u8eab\u5fc3\u9748\u5065\u5eb7</li> <li>2021 \u611f\u60c5 \"\u6709\u7d42\u7121\u59cb\" \u662f\u883b\u597d\u7684\u8a3b\u8173\uff0c\u53ea\u80fd\u63ee\u624b\u8aaa\u62dc\u62dc</li> <li>\u7576\u4e86\u5927\u4f2f\uff0c\u5df2\u77e5\u4f5c\u7528\uff1a\u767c\u7d05\u5305</li> <li>\u56e0\u70ba\u5404\u7a2e\u56e0\u7de3\u969b\u6703\u4e4b\u4e0b\uff0c\u83ab\u540d\u5176\u5999\u53bb\u53c3\u52a0\u5225\u4eba\u5bb6 12/31 \u7684\u5c3e\u7259</li> </ol>","tags":["misc","annual"]},{"location":"20211231-2021-personal-review.html#2022","title":"2022 \u5c55\u671b","text":"<ol> <li>\u4f86\u5427\uff01\u8a72\u662f\u62d3\u5c55\u4ea4\u53cb\u5708\u7684\u6642\u5019\u4e86\uff01\u8981\u53bb\u5c45\u9152\u5c4b\u6216\u9152\u5427\u559d\u7121\u9152\u7cbe\u98f2\u6599\u7684\u8acb\u63ea\u6211\u4e00\u4e0b</li> <li>\u6211\u61c9\u8a72\u8981\u5b78\u9ede\u8ddf IT \u6280\u8853\u7121\u95dc\u7684\u6280\u80fd\u6216\u8208\u8da3\uff0c\u8b6c\u5982\u8aaa\u91e3\u9b5a\u3001\u7a2e\u7530\u3001\u8abf\u9152\u7b49</li> <li>2021 \u6709\u4e00\u7968\u8b8a\u52d5\uff0c\u6240\u4ee5\u5c0e\u81f4\u6709\u4e9b\u91cf\u5316\u6578\u5b57\u76f8\u8f03\u53bb\u5e74\u5f88\u96e3\u770b\uff0c\u660e\u5e74\u6587\u7ae0\u548c\u5f71\u7247\u6703\u591a\u9304\u4e00\u9ede</li> <li>\u5e0c\u671b\u623f\u50f9\u53ef\u4ee5\u6b63\u5e38\u4e00\u9ede\uff0c\u81ea\u5b85\u6253\u5de5\u65cf\u60b2\u6b4c\u5be6\u9304</li> </ol>","tags":["misc","annual"]},{"location":"20211231-2021-personal-review.html#_1","title":"\u7e3d\u7d50","text":"<p>\u672c\u5e74\u5be6\u5728\u6709\u9ede\u904e\u5ea6\u6158\u70c8\uff0c\u6240\u4ee5\u5bb9\u8a31\u6211\u653e\u5728\u5fc3\u4e2d\u597d\u4e86</p>","tags":["misc","annual"]},{"location":"20220216-kubernetes-isolation.html","title":"\u6211\u8981 1 \u5ea7 Kubernetes \u9084\u662f\u8981\u591a\u5ea7 Kubernetes? \u9084\u662f\u90fd\u53ef\u4ee5?","text":"<p>\u66fe\u7d93\u65bc SDN x Cloud Native Meetup #42 OPA + \u55ae\u591a\u53e2\u96c6\u67b6\u69cb\u63a2\u8a0e\u3001\u7c21\u5831 \u5206\u4eab\u904e <code>Kubernetes \u591a\u53e2\u96c6\u53ca\u55ae\u53e2\u96c6\u67b6\u69cb\u9078\u64c7\u63a2\u8a0e</code> \u7684\u984c\u76ee\uff0c\u7576\u4e2d\u6709\u591a\u79df\u6236\u8b70\u984c\u9084\u883b\u53d7\u5230\u95dc\u6ce8\u7684\uff0c\u525b\u597d\u56e0\u70ba\u5de5\u4f5c\u95dc\u4fc2\u4e5f\u6709\u883b\u591a\u5ba2\u6236\u5728\u554f\u76f8\u540c\u7684\u984c\u76ee\uff0c\u9019\u908a\u60f3\u7528\u6587\u5b57\u7684\u65b9\u5f0f\u7d00\u9304\u4e00\u4e0b\uff0c\u4f9b\u5927\u5bb6\u53c3\u8003</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q1-1-kubernetes","title":"Q1: \u4f55\u8b02 1 \u5ea7 Kubernetes?","text":"<p><code>\u53ef\u55ae\u7368\u904b\u884c\u4e4b Kubernetes API \u70ba\u6700\u5c0f\u7ba1\u7406\u55ae\u4f4d</code>\uff0c\u8ddf\u8a72\u5ea7 Kubernetes \u5e95\u4e0b\u6709\u591a\u5c11\u7bc0\u9ede\u5b8c\u5168\u7121\u95dc\uff0c\u7121\u8ad6\u662f Control Plane \u6216 Worker Plane\u3002\u5be6\u52d9\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>kubectl cluster-info</code> \u4f86\u505a\u5224\u65b7</p> <pre><code>$ kubectl cluster-info\nKubernetes control plane is running at https://192.168.100.1:8443\nCoreDNS is running at https://192.168.100.1:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u56e0 Kubernetes \u7684\u8a2d\u8a08\u662f\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u9700\u8981\u8ddf Kubernetes API Server \u9032\u884c\uff0c\u8a72\u670d\u52d9\u9810\u8a2d\u4e00\u5b9a\u6703\u5efa\u7acb\u5728 <code>Control Plane</code> \u4e0a\uff0c\u4e5f\u5c31\u662f <code>https://192.168.100.1:8443</code> \u4f86\u9032\u884c\u6e9d\u901a\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u6709 2 \u500b\u4ee5\u4e0a\u7684 Kubernetes \u53e2\u96c6\uff0c\u52e2\u5fc5\u6703\u7372\u5f97\u5230\u4e0d\u4e00\u6a23\u7684 Kubernetes cluster-info \u8cc7\u8a0a</p> <pre><code># \u4f7f\u7528\u53e2\u96c6 Dev-and-Staging-Cluster\nkubectl config use-c context Dev-and-Staging-Cluster\n\n# Kubernetes \u53e2\u96c6 Dev-and-Staging-Cluster\n$ kubectl cluster-info\nKubernetes control plane is running at https://192.168.100.1:8443\nCoreDNS is running at https://192.168.100.1:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\n# \u5207\u63db\u81f3\u53e2\u96c6 Prod-Cluster\nkubectl config use-context Prod-Cluster\n\n# Kubernetes \u53e2\u96c6 Prod-Cluster\n$ kubectl cluster-info\nKubernetes control plane is running at https://192.168.200.1:8443\nCoreDNS is running at https://192.168.200.1:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n</code></pre> <p>\u5982\u4e0a\u6240\u793a\uff0c\u900f\u904e <code>kubectl config use-context</code> \u53ef\u4ee5\u5207\u63db\u81f3\u5176\u4ed6\u53e2\u96c6\u9032\u884c\u64cd\u4f5c\uff0c\u4f60\u6703\u767c\u73fe\u5230 2 \u500b\u53e2\u96c6\u7684 Control Plane \u7db2\u5740\u662f\u4e0d\u4e00\u6a23\u7684 <code>https://192.168.100.1:8443</code> \u8ddf <code>https://192.168.200.1:8443</code>\uff0c\u9019\u4ee3\u8868\u4f60\u5728\u8ddf\u4e0d\u540c\u7684\u53e2\u96c6\u5728\u9032\u884c\u64cd\u4f5c</p> <p>\u4e0a\u8ff0\u6d41\u7a0b\u82e5\u4f60\u6709\u53bb\u8003\u904e CNCF 3 \u500b\u8003\u8a66</p> <ul> <li>Certified Kubernetes Administrator (CKA)</li> <li>Certified Kubernetes Application Developer (CKAD)</li> <li>Certified Kubernetes Security Specialist (CKS)</li> </ul> <p>\u61c9\u8a72\u6703\u89ba\u5f97\u76f8\u7576\u719f\u6089\uff0c\u56e0\u70ba\u8003\u8a66\u7684\u6642\u5019\u4e5f\u6703\u8981\u4f60\u5207\u4f86\u5207\u53bb\uff0c\u5176\u5be6\u5c31\u662f\u907f\u514d\u4e0d\u540c\u7684\u8003\u984c\u6240\u9700\u7684\u74b0\u5883\u5f71\u97ff\u5230\u5f7c\u6b64\uff0c\u5c6c\u65bc\u5be6\u9ad4\u65b9\u5f0f\u9694\u96e2 Kubernetes \u53e2\u96c6</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q2-kubernetes","title":"Q2: Kubernetes \u591a\u79df\u6236\u9694\u96e2\u67b6\u69cb\u6709\u591a\u5c11\u7a2e\u985e\u578b?","text":"<p>\u532f\u7e3d AKS\u3001EKS\u3001GKE \u4e09\u5bb6\u516c\u6709\u96f2\u7684\u5be6\u8e10\u4f5c\u6cd5\uff0c\u6703\u5340\u5206\u6210 2 \u500b\u65b9\u5411\uff0c</p> <ol> <li>\u4ee5\u908f\u8f2f\u65b9\u5f0f\u9694\u96e2 Kubernetes \u53e2\u96c6\uff0c\u4e5f\u5c31\u662f\u8edf\u591a\u79df\u6236 (Soft Multi-Tenancy)</li> <li>\u4ee5\u5be6\u9ad4\u65b9\u5f0f\u9694\u96e2 Kubernetes \u53e2\u96c6\uff0c\u4e5f\u5c31\u662f\u786c\u591a\u79df\u6236 (Hard Multi-Tenancy)</li> </ol> <p>\u9084\u6709\u4e00\u7a2e\u6bd4\u8f03\u7279\u6b8a\u7684\u786c\u591a\u79df\u6236\uff0c\u50c5\u6703\u51fa\u73fe\u5728 Kubernetes \u5e73\u53f0\u4f9b\u61c9\u5546\u65b9\u7684\u8edf\u9ad4\u67b6\u69cb\u8a2d\u8a08\uff0c\u56e0\u70ba\u6211\u9019\u7bc7\u4e3b\u8981\u662f\u5beb\u7d66\u55ae\u7d14\u7684 Kubernetes \u4f7f\u7528\u8005\u770b\uff0c\u6240\u4ee5\u4e0d\u5217\u5165\u8a0e\u8ad6</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q3-soft-multi-tenancy","title":"Q3: \u8edf\u591a\u79df\u6236 (Soft Multi-Tenancy) \u7684\u908f\u8f2f\u65b9\u5f0f\u9694\u96e2\u624b\u6bb5\u6709\u54ea\u4e00\u4e9b?","text":"<p>\u4e0b\u9762\u5f15\u7528 \u5728 Azure Kubernetes Service (AKS) \u4e2d\u9694\u96e2\u53e2\u96c6\u7684\u6700\u4f73\u505a\u6cd5 \u7684\u793a\u610f\u5716</p> <p></p> <p>\u4ee5\u901a\u904e CNCF Conformance \u70ba\u4e3b\u7684 Kubernetes \u53e2\u96c6\u70ba\u4e3b\uff0c\u908f\u8f2f\u65b9\u5f0f\u9694\u96e2\u624b\u6bb5\u4e3b\u8981\u5340\u5206 4 \u500b\u4f5c\u6cd5</p> <ol> <li>Kubernetes Namespace\uff1a\u55ae\u4e00\u53e2\u96c6\u5167\u90e8\u547d\u540d\u7a7a\u9593\u9694\u96e2</li> <li>Kubernetes Network Policy\uff1a\u55ae\u4e00\u53e2\u96c6\u5167\u90e8\u7db2\u8def\u9694\u96e2</li> <li>Kubernetes RBAC\uff1a\u55ae\u4e00\u53e2\u96c6\u6b0a\u9650\u9694\u96e2</li> <li>Resource Quota\uff1a\u55ae\u4e00\u53e2\u96c6\u5167\u4e4b\u8a08\u7b97\u8cc7\u6e90\u9694\u96e2</li> </ol> <p>\u5be6\u969b\u4e0a\u5c31\u662f\u62ff\u5230 1 \u5ea7 Kubernetes \u53e2\u96c6\u5f8c\uff0c\u91dd\u5c0d\u8a72\u53e2\u96c6\u9032\u884c\u4e0a\u8ff0 4 \u500b\u4f5c\u6cd5\u7684\u908f\u8f2f\u9694\u96e2\u4f86\u9032\u884c\u8cc7\u6e90\u9694\u96e2\uff0c\u4f46\u6700\u5c0f\u64cd\u4f5c\u55ae\u4f4d\u662f <code>Kubernetes Namespace</code> \u70ba\u4e3b\uff0c\u800c\u5e95\u5c64\u8a08\u7b97\u8cc7\u6e90\u5927\u5bb6\u662f\u5171\u7528\u7684\uff0c\u5982\u4e0b\u6240\u5217\uff0c\u6211\u9019\u5ea7 <code>https://192.168.100.1:8443</code> \u53e2\u96c6\u8f44\u4e0b\u7684 Kubernetes Namespace \u53ef\u900f\u904e <code>kubectl create ns &lt;NAME&gt;</code> \u65b0\u589e Namespace\uff0c\u9664\u4e86\u7cfb\u7d71\u5fc5\u8981\u7684 Namespace \u4ee5\u5916\uff0c\u53e6\u5916\u9084\u65b0\u589e\u4e86 3 \u500b\u9762\u5411\u5c08\u6848\u6216\u61c9\u7528\u7684 DevTeam1\u3001DevTeam2\u3001Staging Namespace \u4f9b\u5404\u5225\u670d\u52d9\u4f7f\u7528</p> <pre><code># \u4ee5 Dev and Staging Cluster \u70ba\u4f8b\n$ kubectl cluster-info\nKubernetes control plane is running at https://192.168.100.1:8443\nCoreDNS is running at https://192.168.100.1:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\n$ kubectl get namespace\nNAME                        STATUS   AGE\ndefault                     Active   16h &lt;- Kubernetes \u9810\u8a2d\nDevTeam1                    Active   14s &lt;- \u4f7f\u7528\u8005\u81ea\u5df1\u5efa\u7684\nDevTeam2                    Active   14s &lt;- \u4f7f\u7528\u8005\u81ea\u5df1\u5efa\u7684\nkube-node-lease             Active   16h &lt;- Kubernetes \u9810\u8a2d\nkube-public                 Active   16h &lt;- Kubernetes \u9810\u8a2d\nkube-system                 Active   16h &lt;- Kubernetes \u9810\u8a2d\nlocal-path-storage          Active   16h &lt;- \u7279\u5b9a\u5ee0\u5546\u9810\u8a2d\nStaging                     Active   10s &lt;- \u4f7f\u7528\u8005\u81ea\u5df1\u5efa\u7684\ntanzu-package-repo-global   Active   16h &lt;- \u7279\u5b9a\u5ee0\u5546\u9810\u8a2d\ntanzu-system-ingress        Active   10h &lt;- \u7279\u5b9a\u5ee0\u5546\u9810\u8a2d\ntkg-system                  Active   16h &lt;- \u7279\u5b9a\u5ee0\u5546\u9810\u8a2d\n</code></pre> <p>\u9019\u65b9\u5f0f\u4e5f\u662f\u7d55\u5927\u90e8\u5206\u5728\u5b78 Kubernetes \u7684\u7dad\u904b\u7ba1\u7406\u64cd\u4f5c\u7684\u6642\u5019\uff0c\u8457\u58a8\u6bd4\u8f03\u591a\u7684\u5e38\u898b\u89d2\u5ea6\u53ca\u5e38\u898b\u5b78\u7fd2\u8def\u5f91</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q4-hard-multi-tenancy","title":"Q4: \u786c\u591a\u79df\u6236 (Hard Multi-Tenancy) \u7684\u5be6\u9ad4\u65b9\u5f0f\u9694\u96e2\u624b\u6bb5\u6709\u54ea\u4e00\u4e9b?","text":"<p>\u6069...\u9019\u500b\u5176\u5be6\u6c92\u6709\u4ec0\u9ebc\u8a23\u7ac5\uff0c\u5c31\u662f<code>\u518d\u5efa\u7acb 1 \u5ea7 Kubernetes</code>\u5c31\u597d\uff0c\u6709\u7368\u7acb\u7684 Kubernetes API\u3001\u7368\u7acb\u7684\u8a08\u7b97\u7db2\u8def\u5132\u5b58\u8cc7\u6e90\uff0c\u8edf\u591a\u79df\u6236\u7684\u908f\u8f2f\u65b9\u5f0f\u9694\u96e2\u4e5f\u53ef\u4ee5\u5b8c\u5168\u4f7f\u7528</p> <p></p> <p>\u9810\u671f\u6709\u9019\u9ebc\u591a\u7684 Kubernetes \u53e2\u96c6\u88ab\u90e8\u7f72\u51fa\u4f86\uff0c\u9084\u662f\u8981\u80fd\u5920\u88ab\u7ba1\u7406\uff0c\u4ee5\u73fe\u884c\u5e38\u898b\u7684\u591a\u53e2\u96c6\u7ba1\u7406\u4f5c\u6cd5\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u65bc\u4ee5\u4e0b\uff1a - \u591a\u53e2\u96c6\u7db2\u8def\u898f\u5283\uff0c\u5305\u542b\u5c0d\u5916\u8ca0\u8f09\u5747\u8861\u3001\u8de8\u53e2\u96c6\u7db2\u8def - \u591a\u53e2\u96c6\u7b56\u7565\u7ba1\u7406 - Single Sign On \u55ae\u4e00\u767b\u5165 - \u96c6\u4e2d\u5316\u65e5\u8a8c\u6536\u96c6 - \u96c6\u4e2d\u5316\u8cc7\u6e90\u76e3\u63a7 - ...</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q5","title":"Q5: \u5169\u8005\u53ef\u4e0d\u53ef\u4ee5\u6df7\u7528?","text":"<p>\u53ef\uff0c\u591a\u5efa\u5e7e\u5ea7 Kubernetes \u88e1\u9762\u518d\u7528 Namespace \u7b49\u8edf\u591a\u79df\u6236\u7684\u9694\u96e2\u65b9\u5f0f\u5207\u5272\uff0c\u5982\u5716\u6240\u793a</p> <p></p> <ul> <li>\u8a73\u7d30\u63cf\u8ff0\u5982\u4e0b</li> <li>2 \u5ea7 Kubernetes \u53e2\u96c6\uff0c\u5206\u5225\u70ba Dev and Staging Cluster \u548c Prod Cluster</li> <li>\u7576\u4e2d Dev and Staging Cluster \u53e2\u96c6\u5167\uff0c\u5171\u6709 3 \u500b Kubernets Namespace\uff0c\u5206\u5225\u70ba DevTeam1\u3001DevTeam2\u3001Staging</li> <li>\u7576\u4e2d Prod Cluster \u53e2\u96c6\u5167\uff0c\u5171\u6709 3 \u500b Kubernetes Namespace, \u5206\u5225\u70ba Team1\u3001Team2\u3001Team3</li> </ul>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q6","title":"Q6: \u7528\u69cd\u6642\u6a5f?","text":"<p>\u4e3b\u8981\u5224\u65b7\u9ede\u5c31\u662f <code>Kubernetes API \u53ef\u4e0d\u53ef\u4ee5\u5171\u7528\u548c\u8cc7\u6e90\u9694\u96e2\u6027</code>\u7684\u53d6\u6368\uff0c\u63db\u500b\u89d2\u5ea6\u4f86\u8b1b\uff0c\u5982\u679c\u55ae\u5ea7 Kubernetes \u7206\u70b8\u4e86\uff0c\u4e0a\u9762\u7684\u5c08\u6848\u4f60\u80fd\u5fcd\u53d7\u591a\u5c11\u662f\u639b\u6389\u7684\u72c0\u614b\uff0c\u5982\u679c\u4f60\u4e0d\u80fd\u5fcd\u53d7\uff0c\u62c6\uff0c\u80fd\u5fcd\u53d7\uff0c\u5408</p> <p>\u4e0b\u9762\u8209\u5e7e\u500b\u6211\u500b\u4eba\u9047\u904e\u6703\u5efa\u8b70\u9700\u8981\u5efa\u591a\u5ea7\u7684\u4f8b\u5b50\uff1a</p> <ol> <li>\u4e0d\u540c\u74b0\u5883\u7684\u7db2\u8def\u9694\u96e2\uff0c\u5982 DR / Staging / Dev / Prod //\u6280\u8853\u4e0a\u6c92\u5f97\u8ac7</li> <li>Kubernetes \u5408\u898f\u6027\uff0c\u5982 PCI-DSS\u3001HIPPA \u7b49\u4e0d\u80fd\u65bc\u540c\u4e00\u5ea7 Kubernetes \u6df7\u7528\u5408\u898f\u6aa2\u6e2c //\u6280\u8853\u4e0a\u6c92\u5f97\u8ac7</li> <li>\u4e0d\u540c\u5c08\u6848\u6027\u8cea\uff0c\u5982\u65e2\u6709\u5c0d\u65bc\u8cc7\u8a0a\u7cfb\u7d71\u7684\u6cd5\u898f\u3001\u6838\u5fc3\u7cfb\u7d71\u3001\u4ee5 API Gateway \u70ba\u4e3b\u7684 MASA \u8a2d\u8a08\u3001\u5171\u4eab\u670d\u52d9\u5e73\u53f0 (CI/CD)\u3001GPU \u5206\u4eab\u3001\u6307\u5b9a Kubernetes \u7248\u672c\u7b49 //\u6280\u8853\u4e0a\u53ef\u4ee5\uff0c\u4f46\u6211\u500b\u4eba\u5c0d\u65bc\u7d14\u5730\u7aef\u5ba2\u6236\u7684\u7406\u89e3\u76f8\u7576\u4e0d\u5efa\u8b70</li> <li>\u5e95\u5c64 CPU \u67b6\u69cb\u96c6\u4e0d\u540c\uff0c\u5982 x86_64\u3001ppc \u7b49 //\u6280\u8853\u4e0a\u53ef\u4ee5\uff0c\u4f46\u6211\u500b\u4eba\u5224\u65b7\u76f8\u7576\u4e0d\u5efa\u8b70</li> <li>\u4e0d\u540c\u90e8\u9580\u4e4b\u9593\u6280\u8853\u843d\u5dee / \u6b0a\u9650 / \u5167\u5e33\u5207\u5272\u8b70\u984c\uff0c\u5982\u8ac7\u9322\u4fdd\u8b49\u50b7\u611f\u60c5\u7684\u6642\u5019 //\u6280\u8853\u4e0a\u53ef\u4ee5\uff0c\u4f46\u6211\u500b\u4eba\u5c0d\u65bc\u7d14\u5730\u7aef\u5ba2\u6236\u7684\u7406\u89e3\u76f8\u7576\u4e0d\u5efa\u8b70</li> </ol> <p>\u4e0a\u8ff0\u6709\u4e9b\u8aaa\u6280\u8853\u4e0a\u53ef\u4ee5\u7684\uff0c\u5efa\u8b70\u53ef\u4ee5\u5617\u8a66\u628a\u5c0f\u5f1f\u7684\u62d9\u4f5c \u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7 \u770b\u5b8c\u4e4b\u5f8c\uff0c\u8acb\u6240\u6709\u8981\u4f4f\u5728\u4e00\u8d77\u7684\u670d\u52d9\u4f30\u7b97\u4e00\u4e0b\u8cc7\u6e90\u4f7f\u7528\u91cf\u6709\u8a55\u4f30\u4e0b\u707d\u5bb3\u7206\u70b8\u534a\u5f91 (Blast Radius)\uff0c\u524d\u8005\u8ddf\u9322\u6709\u95dc\uff0c\u5f8c\u8005\u8ddf SLA \u6709\u95dc</p> <p>\u6700\u5f8c\u7d66\u5f35\u6897\u5716</p> <p></p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q7-kubernetes","title":"Q7: \u5982\u679c\u5efa\u591a\u5ea7 Kubernetes \u4e0d\u5c31\u8981\u8017\u8cbb\u5f88\u591a\u8cc7\u6e90?","text":"<p>\u500b\u4eba\u89c0\u9ede\uff0cKubernetes \u8207 Cloud OS \u4e4b\u65bc Linux \u8207 OS \u7684\u76f8\u5c0d\u95dc\u4fc2</p> <p>\u5176\u5be6\u628a Kubernetes \u7576\u4f5c\u4e00\u500b\u96f2\u539f\u751f\u4f5c\u696d\u7cfb\u7d71 (Cloud OS) \u7684\u89d2\u5ea6\u4f86\u770b\uff0c\u61c9\u5c0d\u4e0d\u540c\u7684\u5c08\u6848\u9700\u6c42\uff0c\u5927\u5bb6\u5c0d\u65bc Kubernetes \u7684\u8cc7\u6e90\u5927\u5c0f\u4e5f\u6703\u6709\u6240\u4e0d\u540c\uff0c\u985e\u540c\u65bc\u958b\u767c\u4eba\u54e1\u8981\u5f04\u4e00\u500b\u5c08\u6848\u7e3d\u662f\u8981\u63d0\u51fa\u8aaa\uff0c\u9700\u8981\u4ec0\u9ebc CPU / Memory / Disk / OS \u7528\u54ea\u5bb6\u7684\u8cc7\u6e90\u7533\u8acb\uff0c\u9019\u662f\u5f88\u5408\u7406\u7684\uff0c\u53ea\u662f Kubernetes \u67b6\u69cb\u4e0a\u9700\u8981\u591a\u8003\u91cf\u4e00\u4e9b\u4e8b\u60c5\uff0c\u6240\u4ee5\u4fdd\u6709 Kubernetes \u53e2\u96c6\u8cc7\u6e90\u8abf\u6574\u5f48\u6027\u53ca\u9078\u64c7\u662f\u67b6\u69cb\u4e0a\u9700\u8981\u8003\u91cf\u7684\u5730\u65b9</p> <p>\u6240\u4ee5\u5c0f\u5f1f\u624d\u6703\u63d0\u4ee5 2 \u500b\u65b9\u5411\u7684\u89d2\u5ea6\u4f86\u5354\u52a9\u5927\u5bb6\u53bb\u79d1\u5b78\u5730\u8a55\u4f30\u8cc7\u6e90\uff0c\u800c\u4e0d\u662f\u4e1f\u9ab0\u5b50\u7684\u4f5c\u6cd5\uff0c\u7576\u4e2d\u4e00\u7bc7\u5df2\u7d93\u5beb\u597d\u4e86\uff0c\u53ef\u4ee5\u53c3\u7167\u53c3\u7167</p> <ul> <li>\u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7</li> <li>\u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? Infra \u89d2\u5ea6\u7bc7 //\u9084\u6c92\u52d5\u529b\u5beb\uff0c\u8acb\u67d0\u67d0\u5ba2\u6236\u8d0a\u52a9\u4e00\u4e0b\u52d5\u529b</li> </ul> <p>\u53e6\u5916\u9084\u6709\u4e00\u7bc7\u5927\u6982\u4e5f\u5c31 VMware \u624d\u6709\u8cc7\u683c\u5beb\u7684\u591a\u53e2\u96c6 Kubernetes \u65bc\u865b\u64ec\u5316\u5e73\u53f0\u4e4b\u6548\u80fd\u5831\u544a\u66f8 Performance Best Practices for Kubernetes with VMware Tanzu - Performance Study \u4e5f\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\uff0c\u5beb\u5f97\u76f8\u7576\u9760\u8b5c\u52d9\u5be6</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#q8-kubernetes","title":"Q8: \u5982\u679c\u6211\u5c31\u662f\u50c5\u5efa\u4e00\u5ea7 Kubernetes \u88e1\u9762\u670d\u52d9\u585e\u597d\u585e\u6eff\u53ef\u4e0d\u53ef\u4ee5?","text":"<p>\u53ef\uff0c\u4f46\u8981\u78ba\u4fdd\u5c0d\u65bc <code>Q3: \u8edf\u591a\u79df\u6236\u7684\u908f\u8f2f\u65b9\u5f0f\u9694\u96e2\u624b\u6bb5\u6709\u54ea\u4e00\u4e9b?</code> \u6240\u63d0\u4e4b\u908f\u8f2f\u9694\u96e2\u624b\u6bb5\uff0c\u6240\u6709\u53c3\u8207\u4e4b\u4e0a\u7684\u79df\u6236\u90fd\u8981\u6709\u76f8\u540c\u7684\u8a8d\u77e5\uff0c\u7136\u5f8c\u8a2d\u8a08\u8a72 Kubernetes \u53e2\u96c6\u7684\u67b6\u69cb\u5e2b\uff0c\u52d9\u5fc5\u8981\u76f8\u7576\u719f\u6089\u901a\u76e4\u7684\u7db2\u8def\u67b6\u69cb\uff0c\u7121\u8ad6\u662f Kubernetes \u5167\u90e8\u6216\u8005\u662f\u5916\u90e8</p>","tags":["kubernetes"]},{"location":"20220216-kubernetes-isolation.html#references","title":"References","text":"<ul> <li>EKS Best Practices Guides - Tenant Isolation</li> <li>\u5728 Azure Kubernetes Service (AKS) \u4e2d\u9694\u96e2\u53e2\u96c6\u7684\u6700\u4f73\u505a\u6cd5</li> <li>GKE \u4f01\u4e1a\u7ea7\u591a\u79df\u6237\u6700\u4f73\u505a\u6cd5</li> <li>cncf/k8s-conformance</li> <li>\u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7</li> <li>Performance Best Practices for Kubernetes with VMware Tanzu - Performance Study</li> </ul>","tags":["kubernetes"]},{"location":"20221005-k8s-gracefulrestart-pod.html","title":"\u5be6\u73fe\u4e0d\u505c\u6a5f\u7684 Pod \u66f4\u65b0\u65b9\u5f0f","text":"<p> Source from Learnk8s - Graceful shutdown and zero downtime deployments in Kubernetes</p> <p>\u5982\u679c\u4f60\u6709\u4e00\u500b\u6301\u7e8c\u4e0d\u65b7\u7684\u670d\u52d9\uff0c\u5982 Long-lived TCP connections \u6216\u8005\u662f\u61c9\u7528\u7a0b\u5f0f\u95dc\u9589\u8981\u8dd1\u5f88\u4e45\u7684\uff0c\u9700\u8981 \"Graceful shutdown Pod\" \u7684\u8a71</p> <p>\u4e0d\u6539\u7a0b\u5f0f\u7684\u72c0\u6cc1\u4e0b\uff0c\u6709\u4f60\u53ef\u4ee5\u6709 2 \u500b\u6cbb\u6a19\u4e0d\u6cbb\u672c\u7684\u65b9\u5f0f\u4f86\u9054\u6210\u9019\u4ef6\u4e8b</p> <ul> <li>\u5ef6\u9072 SIGTERM \u7684\u8a0a\u865f\u767c\u9001\uff0cpreStop Hook \u8a2d\u5b9a\u4e45\u4e00\u9ede\u8b93\u4ed6\u7761\u4e00\u4e0b (wait)</li> </ul> preStop_sample<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: lifecycle-demo\nspec:\n  containers:\n  - name: lifecycle-demo-container\n    image: nginx\n    lifecycle:\n      preStop:\n        exec:\n          command: [\"/bin/sh\",\"-c\",\"nginx -s quit; while killall -0 nginx; do sleep 10; done\"] # (1)\n</code></pre> <ol> <li> <p>Sleep for 10 seconds before sending SIGTERM to the main process</p> </li> <li> <p>\u5ef6\u9072 SIGKILL \u7684\u767c\u751f\uff0c\u628a terminationGracePeriodSeconds (default 30s) \u8a2d\u5b9a\u9577\u4e00\u9ede\uff0c\u8b6c\u5982\u4e0b\u9762\u7684\u7bc4\u4f8b</p> </li> </ol> terminationGracePeriodSeconds_sample<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: pods-termination-grace-period-seconds\nspec:\n  containers:\n      image: nginx\n      name: pods-termination-grace-period-seconds\n  terminationGracePeriodSeconds: 3600  # (1)\n</code></pre> <ol> <li>Time to wait before moving from a TERM signal to the pod's main process to a KILL signal.</li> </ol> <p>\u5982\u4f55\u9078\u64c7?</p> <p>\u5982\u679c\u4f60\u7a0b\u5f0f\u95dc\u9589\u6642\u4e0d\u9700\u8981\u8655\u7406\u4efb\u4f55\u72c0\u614b\u6216\u540c\u6b65\u8cc7\u6599\uff0c\u90a3\u5c31\u53ea\u8981\u8a2d\u5b9a preStop \u5c31\u597d\u4e86\uff0c\u5982\u679c\u662f\u90a3\u7a2e\u5df2\u77e5\u7a0b\u5f0f\u95dc\u9589\u5df2\u77e5\u8981\u8dd1\u5f88\u4e45 (&gt;30s) \u7684\u7a0b\u5f0f\uff0c\u5efa\u8b70 preStop \u548c terminationGracePeriodSeconds \u90fd\u8981\u62c9\u9577\u4e00\u9ede\uff0c\u9019\u6a23\u5c31\u80fd\u78ba\u4fdd Pod \u95dc\u9589\u6642\u4e0d\u6703\u6709\u9748\u7570\u73fe\u8c61\u767c\u751f</p> <p>\u6cbb\u672c\u4f5c\u6cd5\u662f: \u7a0b\u5f0f\u6536\u5230 SIGTERM \u8a0a\u865f\u7684\u6642\u5019\uff0c\u7a0b\u5f0f\u8981\u81ea\u5df1\u77e5\u9053\u600e\u9ebc\u95dc\u9589\u670d\u52d9\uff0c\u4e0d\u8981\u8b93\u5e95\u4e0b Kubernetes \u5e6b\u4f60\u786c\u95dc\u6a5f</p>","tags":["kubernetes"]},{"location":"20221005-k8s-gracefulrestart-pod.html#case-study-nginx-ingress-controller","title":"Case Study: Nginx Ingress Controller","text":"<p>\u4e09\u7ba1\u9f4a\u4e0b: \u4f7f\u7528 preStop Hook + SIGTERM + terminationGracePeriodSeconds</p> <p>\u95dc\u65bc preStop \u7684\u8655\u7406\uff0c\u7bc0\u9304 ingress-nginx/deploy/static/provider/cloud/deploy.yaml#L456-L460\uff0c\u9019\u908a\u6703\u53bb\u547c\u53eb waitshutdown \u9019\u500b\u6307\u4ee4\uff0c\u518d\u88e1\u9762\u53bb\u8655\u7406 SIGTERM \u7684\u8a0a\u865f</p> ingress-nginx/deploy/static/provider/cloud/deploy.yaml<pre><code>        lifecycle:\n          preStop:\n            exec:\n              command:\n              - /wait-shutdown\n</code></pre> <p>\u95dc\u65bc terminationGracePeriodSeconds\uff0c\u7bc0\u9304 ingress-nginx/deploy/static/provider/cloud/deploy.yaml#L512</p> ingress-nginx/deploy/static/provider/cloud/deploy.yaml<pre><code>        terminationGracePeriodSeconds: 3600\n</code></pre> <p>\u95dc\u65bc SIGTERM \u7684\u8655\u7406\uff0c\u7bc0\u9304 ingress-nginx/cmd/waitshutdown/main.go#L28-L42</p> ingress-nginx/cmd/waitshutdown/main.go<pre><code>func main() {\n    err := exec.Command(\"bash\", \"-c\", \"pkill -SIGTERM -f nginx-ingress-controller\").Run()\n    if err != nil {\n        klog.ErrorS(err, \"terminating ingress controller\")\n        os.Exit(1)\n    }\n\n    // wait for the NGINX process to terminate\n    timer := time.NewTicker(time.Second * 1)\n    for range timer.C {\n        if !nginx.IsRunning() {\n            timer.Stop()\n            break\n        }\n    }\n</code></pre>","tags":["kubernetes"]},{"location":"20221005-k8s-gracefulrestart-pod.html#references","title":"References","text":"<ul> <li>Rakuten Developer - Zero-Downtime Rolling Deployments in Kubernetes</li> <li>Facebook \u539f\u6587</li> <li>Graceful shutdown and zero downtime deployments in Kubernetes</li> <li>Kubernetes - Container Lifecycle Hooks</li> </ul>","tags":["kubernetes"]},{"location":"20230202-azure-expressroute-cross-region.html","title":"\u6ed1\u9f20\u9ede\u9ede(?)\u4e4b\u8de8\u570b Azure ExpressRoute \u7db2\u8def\u67b6\u69cb","text":"<p>\u6700\u8fd1\u6253\u5de5\u6253\u5230\u96f2\u7aef\u4f86\u4e86\uff0c\u76ee\u524d\u9806\u5229\u6d3b\u904e\u4e86 6 \u500b\u6708\uff0c\u6211\u53ea\u80fd\u8aaa\u6839\u672c\u5929\u5929\u770b\u7db2\u8def\u67b6\u69cb\u8b70\u984c\uff0c\u5982\u679c\u4f60\u662f\u7d14\u96f2\u7aef\u76f4\u63a5\u4f7f\u7528\u7684\uff0c\u5b8c\u5168\u4e0d\u9700\u8981\u8ddf\u5730\u7aef\u7db2\u8def\u63a5\u518d\u4e00\u8d77\u7684\uff0c\u4f60\u662f\u4e0d\u6703\u6709\u6211\u9019\u7a2e\u7169\u60f1\uff0c\u4f46\u5982\u679c\u4f60\u8ddf\u6211\u4e00\u6a23\u770b\u6df7\u5408\u7db2\u8def\u67b6\u69cb (\u5099\u8a3b:\u662f\u5730\u7aef+\u96f2\u7aef\uff0c\u4e0d\u662f\u96f2\u7aef+\u96f2\u7aef) \u7684\u8a71\uff0c\u4f30\u8a08\u4f60\u61c9\u8a72\u8ddf\u6211\u4e00\u6a23\u90fd\u5728\u6ed1\u9f20\u9ede\u9ede\uff0c\u958b\u670d\u52d9\uff0c\u5c0d\u6d41\u91cf</p> <p>\u5206\u4eab\u4e00\u4e0b\u7576\u521d\u958b\u59cb\u770b Azure Networking \u7684\u7b2c\u4e00\u7bc7\u6587\u7ae0\u5c31\u662f\u51fa\u81f3\u65bc Telstra Purple - Hub and Spoke network topology in Azure\uff0c\u5230\u73fe\u5728\u70ba\u6b62\uff0c\u82e5\u662f\u8981\u7528 Azure \u505a\u8de8\u570b\u7db2\u8def\u67b6\u69cb\u53c3\u8003\u6027\u9084\u662f\u975e\u5e38\u9ad8\u7684</p> <p></p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#azure-expressroute-3-1","title":"Azure ExpressRoute 3 \u500b\u95dc\u9375\u7d44\u4ef6 + 1 \u500b\u5fc5\u8981\u52d5\u4f5c","text":"","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#1-expressroute-er-circuit","title":"1. ExpressRoute (ER) Circuit","text":"<p>\u9019\u500b\u53ef\u4ee5\u5148\u900f\u904e Azure Portal \u5148\u628a\u76f8\u95dc\u8a2d\u5b9a\u505a\u597d\uff0c\u5305\u542b ER Provider / Peering Location / Bandwidth / SKU \u7b49\u7b49\uff0c\u4f46\u4e2d\u9593\u63a5\u7dda\u9084\u662f\u9700\u8981\u627e\u5404\u5730\u65b9\u7684 ExpressRoute Provider (ERP) \u63a5\u6d3d\u8655\u7406\uff0c\u4e0b\u9762\u5217\u8209\u53f0\u7063 ExpressRoute Provider \u548c\u80fd Peering Location</p> ER Provider # (1) Peering Location # (2) ChungHwa Telecom Taipei Chief Telecom Taipei / HongKong FarEasTone Taipei <ol> <li>\u63d0\u4f9b ExpressRoute Circuit \u7684 ISP \u696d\u8005</li> <li>ISP \u5c07\u63d0\u4f9b Circuit Connection \u7684 Azure Location</li> </ol> <p>\u901f\u7387 (Bandwidth) \u76ee\u524d\u53ef\u9078 8 \u7a2e\uff0c\u5305\u542b 50Mbp / 100Mbps / 200Mbps / 500Mbps / 1Gbps / 2Gbps / 5Gbps / 10Gbps\uff0c\u76ee\u524d\u9047\u5230\u591a\u534a\u90fd\u5728 100Mbps ~ 1Gbps \u4ee5\u5167\u9078\u64c7\u5c45\u591a</p> <p>SKU \u6709\u5206 3 \u500b\uff0c\u4f46\u5be6\u52d9\u4e0a\u53f0\u7063\u73fe\u5728\u53ea\u6703\u6709 2 \u500b\u53ef\u4ee5\u7528: Standard / Premium\uff0c\u5dee\u7570\u5728\u5982\u679c\u8981\u5f04 ExpressRoute Global Reach \u6216\u9700\u8981\u79c1\u6709\u50b3\u8f38 Microsoft 365 \u5167\u5bb9\u7684\u8a71\u5c31\u5fc5\u9808\u8981\u9078 Premium\uff0c\u5176\u4ed6\u9078 Standard \u5373\u53ef</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#2-expressroute-gateway","title":"2. ExpressRoute Gateway","text":"<p>\u9019\u670d\u52d9\u5176\u5be6\u85cf\u5728 Virtual Network Gateway \u88e1\u9762\uff0c\u8981\u9078 <code>Gateway Type: ExpressRoute</code> \u624d\u80fd\u6b63\u78ba\u4f7f\u7528</p> <p></p> <p>\u81f3\u65bc\u9078\u64c7\u4e0a\u8ddf\u6709\u591a\u5c11\u689d Azure ExpressRoute Circuit \u548c\u52a0\u7e3d\u901f\u7387\u6709\u95dc\u4fc2</p> <p>\u95dc\u65bc Azure ExpressRoute Circuit \u689d\u6578\uff0c\u8b6c\u5982\u8aaa\u65e5\u672c/\u65b0\u52a0\u5761/\u53f0\u7063/\u58a8\u897f\u54e5/\u6377\u514b 5 \u500b\u5730\u65b9\u90fd\u5404\u81ea\u6709 1 \u689d 100Mbps \u7684\u7dda\u8def\uff0c\u82e5\u90fd\u8981\u63a5\u5230\u540c\u4e00\u53f0 ExpressRoute Gateway \u5167\u7684\u8a71\uff0c\u90a3\u9019\u500b ExpressRoute Gateway SKU \u5c31\u8981\u9078\u64c7\u80fd\u652f\u63f4 5 \u500b Circuit Connections \u4ee5\u4e0a</p> <p>\u95dc\u65bc\u52a0\u7e3d\u901f\u7387\uff0c\u8b6c\u5982\u8aaa\u65e5\u672c/\u53f0\u7063/\u58a8\u897f\u54e5\u90fd\u5404\u81ea\u6709 1 \u689d 500Mbps \u7684 Azure ExpressRoute Circuit\uff0c\u82e5\u90fd\u8981\u63a5\u5230\u540c\u4e00\u53f0 ExpressRoute Gateway \u5167\u7684\u8a71\uff0c\u90a3\u9019\u500b ExpressRoute Gateway SKU \u5c31\u8981\u9078\u64c7 1.5Gbps (= 500Mbps * 3) \u4ee5\u4e0a</p> <p>\u901a\u5e38\u6c92\u6709\u7279\u5225\u8907\u96dc\u7684\u7db2\u8def\u8b70\u984c\u7684\u8a71\uff0c\u5404\u5340\u57df\u9078 Standard \u5c31\u53ef\u4ee5\u5c0d\u61c9\u5f88\u591a\u72c0\u6cc1\u4e86\uff0c\u5f8c\u7e8c\u4e5f\u53ef\u4ee5\u539f\u5730\u5347\u7d1a\uff0c\u9700\u91cd\u958b\u7d04\u7565 30 ~ 45 mins\uff0c\u53ef\u4ee5\u7528 S2S VPN \u505a DR \u5207\u63db\uff0c\u78ba\u4fdd\u9023\u7dda\u9806\u66a2</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#3-circuit-connection","title":"3. Circuit Connection","text":"<p>Pen-Pineapple-Apple-Pen</p> <p>\u9019\u500b\u670d\u52d9\u7684\u4efb\u52d9\u5c31\u5c07\u6307\u5b9a\u7684 ExpressRoute Circuit \u548c ExpressRoute Gateway \u63a5\u518d\u4e00\u8d77\uff0c\u9019\u6a23\u5c31\u5b8c\u6210\u4e86 ExpressRoute \u7684\u8a2d\u5b9a\uff0c\u6c92\u6709\u4ec0\u9ebc\u7279\u6b8a\u9808\u6ce8\u610f\u7684\u5730\u65b9</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#4-last-mile","title":"4. Last Mile","text":"<p>Last Mile \u6307\u7684\u662f\u5f9e ISP \u5230 Customer Equipment \u6216 User \u7684\u6700\u5f8c\u4e00\u6bb5\u7db2\u8def</p> <p>ExpressRoute Circuit \u96d6\u7136\u53ef\u4ee5\u76f4\u63a5\u5728 Portal \u4e0a\u958b\u8d77\u4f86\uff0c\u4f46\u5be6\u969b\u4e0a\u662f\u9700\u8981\u8acb ExpressRoute Provider \u5ee0\u5546\u5b8c\u6210 Last Mile \u7684\u754c\u63a5\u64cd\u4f5c\uff0c\u5c0d\u61c9\u5230\u4e0d\u540c\u5ba2\u6236\u7684\u7db2\u8def\u67b6\u69cb\u9700\u6c42\uff0c\u6703\u6709\u4e0d\u540c\u7684\u63a5\u6cd5\u548c\u5be6\u969b\u9700\u6c42\uff0c\u9019\u6bb5\u7684\u8cbb\u7528\u5c31\u662f\u7531 Customer \u5c0d ExpressRoute Provider \u652f\u4ed8\u76f8\u95dc\u8cbb\u7528\uff0c\u4e26\u7121\u6d89\u53ca Azure</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#azure-expressroute_1","title":"Azure ExpressRoute \u8de8\u570b\u7db2\u8def\u67b6\u69cb\u6848\u4f8b","text":"<p>\u4e0b\u9762\u5206\u4eab 4 \u500b\u6211\u5e38\u9047\u5230\u548c\u525b\u597d\u6709\u770b\u5230\u5225\u570b\u505a\u7684\u6a23\u5b50</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#1","title":"1. \u55ae\u5730\u55ae\u5340\u57df","text":"<p>\u4e00\u822c\u7db2\u8def\u4e0a\u6587\u7ae0\u5e38\u898b\u4ecb\u7d39\u67b6\u69cb\u5c31\u662f\u9577\u9019\u6a23\uff0c\u5f9e Taipei \u5730\u7aef\u51fa\u767c\uff0c\u900f\u904e ExpressRoute Provider \u5bb6\u7684\u7db2\u8def\uff0c\u63a5\u5230 Azure \u4efb\u610f Region \u7136\u5f8c\u958b\u59cb\u4f7f\u7528\uff0c\u76f8\u7576\u55ae\u7d14</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#2-provider","title":"2. \u55ae\u5730\u55ae Provider \u96d9\u5340\u57df","text":"<p>\u9019\u500b\u67b6\u69cb\u5206\u70ba\u5169\u500b\u72c0\u6cc1</p> <ol> <li>Azure Region \u4e4b\u9593\u6709 Peering: \u7db2\u8def\u76f4\u63a5 Region to Region\uff0c\u80cc\u5f8c\u8d70 MSBB</li> <li>Azure Region \u4e4b\u9593\u6c92\u6709 Peering: \u6d41\u91cf\u9700\u8981\u8d70\u56de\u5730\u7aef\uff0c\u518d\u900f\u904e\u8def\u7531\u5230\u53e6\u4e00\u500b Region</li> </ol> <p>\u95dc\u65bc Azure Region \u4e4b\u9593\u6709 Peering\uff0c\u82e5\u56e0\u70ba\u60f3\u505a Region DR \u8b6c\u5982\u8aaa \u50cf RISE with SAP Production \u548c DR \u4e4b\u9593\u7684\u7db2\u8def\u6216\u540c\u6642\u53ef\u80fd\u60f3\u8de8\u570b\u4f7f\u7528\u7279\u5b9a Azure Region \u5167\u7684\u670d\u52d9\uff0c\u5c31\u6703\u9019\u6a23\u8a2d\u8a08\uff0c\u9019\u500b\u5e38\u898b</p> <p>\u95dc\u65bc Azure Region \u4e4b\u9593\u6c92\u6709 Peering\uff0c\u82e5\u6709\u670d\u52d9\u6d41\u91cf\u5f37\u5236\u8981\u56de\u5730\u7aef\u8def\u7531\u5728\u4e0a\u5230\u5176\u4ed6 Azure Region\uff0c\u6bd4\u8f03\u5bb9\u6613\u51fa\u73fe\u9019\u67b6\u69cb\uff0c\u8b6c\u5982\u8aaa\u6709\u4e9b\u9632\u706b\u7246\u6216\u5c0d\u5916\u670d\u52d9\u4e00\u5b9a\u8981\u4e0b\u5730\u7aef\u7684\uff0c\u6216\u8005\u662f\u6709\u7279\u6b8a\u539f\u56e0\u5b8c\u5168\u4e0d\u80fd\u4e5f\u4e0d\u7d66 Global VNet Peering (\u8de8 Region \u505a VNet to VNet Peering)\uff0c\u9019\u500b\u5c11\u898b</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#3-provider","title":"3. \u55ae\u5730\u96d9 Provider \u96d9\u5340\u57df","text":"<p>\u5c11\u898b\uff0c\u4e3b\u8981\u64d4\u5fc3\u6015\u55ae\u4e00 ExpressRoute Provider \u6574\u500b\u6d88\u5931\uff0c\u7701\u4e00\u9ede\u4f5c\u6cd5\u6703\u642d S2S VPN \u8d70 2nd ISP \u505a DR \u548c Transit Network \u67b6\u69cb</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#4","title":"4. \u96d9\u5730\u96d9\u5340\u57df (\u63a8\u85a6)","text":"<p>Azure \u8de8\u570b\u7db2\u8def\u50b3\u8f38\u4e00\u5b9a\u6703\u9047\u5230\u7684\u67b6\u69cb\uff0c\u8981\u6ce8\u610f\u53f0\u7063\u8ddf\u7f8e\u570b\u5730\u7aef\u7db2\u8def\u662f\u6709\u76f8\u901a\u7684\uff0c\u7136\u5f8c\u8981\u505a Global Transit Network Architecture</p> <p>\u6700\u5e38\u88ab\u8a0e\u8ad6\u7684\u5c31\u662f\u8981\u4e0d\u8981 ExpressRoute Circuit \u9078\u914d\u555f\u7528 Azure ExpressRoute Global Reach \u501f\u9053 MSBB \u7db2\u8def\uff0c\u7136\u5f8c\u8abf\u4f4e\u6b0a\u91cd\u537b\u4fdd\u6709\u9023\u7dda\u80fd\u529b\uff0c\u4f46\u975e\u4e3b\u8981\u9023\u7dda\u65b9\u5f0f\uff0c\u7136\u5f8c\u8a0e\u8ad6\u5916\u90e8\u7ad9\u9ede\u8981\u4e0d\u8981\u4e0a SD-WAN \u89e3\u6c7a\u65b9\u6848\uff0c\u5982 VMware SD-WAN\u3001Fortinet SD-WAN \u6216\u8005\u662f IPSec Tunnel \u4e00\u689d\u4e00\u689d\u8a2d\u5b9a\u5230 Azure VPN Gateway</p> <p>\u6700\u5f8c\u5c31\u662f\u5404\u7a2e\u6574\u9ad4\u8def\u7531\u6700\u4f73\u5316\u548c\u8cc7\u5b89 Firewall \u7684\u8a0e\u8ad6</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#optimized-routing","title":"\u8def\u7531\u6700\u4f73\u5316 (Optimized routing)","text":"<p>\u5c0d\u65bc\u6709 2 \u689d\u7dda\u8def\u4ee5\u4e0a\u7684\u67b6\u69cb\uff0c\u7121\u8ad6\u662f IPSec Tunnel \u9084\u662f ExpressRoute Circuit\uff0c\u82e5\u60f3\u8981\u63a7\u5236\u8def\u7531\u8d70\u6cd5\u7684\u8a71\uff0c\u4f9d\u5e8f\u6709 4 \u7a2e\u6709\u6548\u505a\u6cd5:</p> <ol> <li>\u65bc\u5730\u7aef\u8def\u7531\u5668\u4e0a Route advertising \u6307\u5b9a\u504f\u597d\u7684 ExpressRoute Circuit</li> <li>\u5c0d\u65bc\u504f\u597d\u7684 Expressroute Circuit \u8a2d\u5b9a\u8f03\u9ad8\u7684\u8def\u7531\u6b0a\u91cd (Connection Weight): \u5efa\u8b70\u8981\u7528\uff0c\u56e0\u70ba\u642d S2S VPN \u4f5c\u70ba\u5099\u4efd\u7dda\u8def\u6642\u5019\uff0c\u5169\u689d\u7dda\u8def\u7b49\u91cd\u6642\uff0c\u6709\u53ef\u80fd\u6062\u5fa9\u4e4b\u5f8c\u6c92\u5207\u56de\u4f86\uff0c\u8a73\u53c3 Suboptimal routing from customer to Microsoft</li> <li>\u5c0d\u65bc\u504f\u597d\u7684 Expressroute Circuit \u8a2d\u5b9a\u8f03\u5c11\u7684 BGP AS Path prepend: \u5176\u5be6\u9019\u53e5\u8a71\u61c9\u8a72\u8981\u8aaa\uff0c\u5c0d\u65bc\u975e\u504f\u597d\u7684\u8981\u8a2d\u5b9a BGP AS Path prepend\uff0c\u8a73\u53c3 Solution: use AS PATH prepending</li> <li>\u65bc\u5730\u7aef\u91dd\u5c0d\u504f\u597d\u7684\u8def\u7531\u5c0d\u7279\u5b9a\u5340\u57df\u7684 BGP Community \u8a2d\u9ad8 Local Preferecne \u6578\u503c\uff0c\u8a73\u53c3 Solution: use BGP Communities</li> </ol>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#qa","title":"Q&amp;A","text":"","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q1-expressroute-provider","title":"Q1: ExpressRoute Provider \u8981\u53bb\u54ea\u88e1\u67e5?","text":"<p>A1: \u9019\u908a\u67e5 ExpressRoute Provider \u5e38\u898b\u5927\u6982\u5c31\u662f Taipei \u7684\u4e09\u5bb6 ISP: ChungHwa Telecom, Chief Telecom, FarEasTone</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q2-azure-expressroute","title":"Q2: \u6280\u8853\u89e3\u91cb\u4e00\u4e0b Azure ExpressRoute","text":"<p>A2: \u5f9e\u5730\u7aef Customer Edge (CE) \u5230 Azure MSEE \u9019\u6bb5\u662f\u8d70 <code>802.1ad (QinQ)</code> \uff0c\u6240\u4ee5\u5be6\u52d9\u4e0a\u9700\u8981\u6e96\u5099\u4e00\u500b VLAN \u7576\u4f5c c-tag \u4f5c\u70ba\u9023\u7dda\u4e4b\u7528\uff0c\u5176\u4ed6\u9023\u7dda\u8a2d\u5b9a Provider \u6703\u8655\u7406\u597d\uff0c\u800c MSEE \u4e4b\u5f8c\u5c31\u662f Microsoft Backbone (MSBB) \u9aa8\u5e79\u7db2\u8def\uff0c\u9019\u500b\u9aa8\u5e79\u7db2\u8def\u662f Microsoft \u81ea\u5df1\u7dad\u8b77\u7684\uff0c\u53ef\u4ee5\u78ba\u4fdd\u9ad8\u53ef\u9760/\u9ad8\u5b89\u5168/\u901f\u5ea6\u5feb/\u4f4e\u5ef6\u9072</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q3-azure-expressroute","title":"Q3: \u767d\u8a71\u6587\u89e3\u91cb\u4e00\u4e0b Azure ExpressRoute","text":"<p>A3: \u5c31\u662f...\u5c08\u7dda/\u9ede\u5c08\uff0c\u53ea\u662f\u662f\u5c08\u9580\u9023\u5230 MSBB \u53bb\u7684</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q4-azure-expressroute-global-reach","title":"Q4: \u767d\u8a71\u6587\u89e3\u91cb\u4e00\u4e0b Azure ExpressRoute Global Reach","text":"<p>A4: \u501f\u9053 Microsoft Backbone (MSBB) \u9aa8\u5e79\u7db2\u8def\u4f86\u50b3\u905e\u8de8\u570b\u7684\u6d41\u91cf\uff0c\u589e\u52a0\u7db2\u8def\u97cc\u6027\uff0c\u53ef\u4ee5\u9078\u9019\u500b</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q5-southeast-asia-pop-expressroute-gateway-southeast-asia-east-asia","title":"Q5: \u82e5\u4e3b\u8981\u670d\u52d9\u5728\u65b0\u52a0\u5761 (Southeast Asia)\uff0c\u4f46\u53bb\u65b0\u52a0\u5761\u7684\u6d41\u91cf\u6703\u5f9e\u9999\u6e2f PoP \u9032\u53bb\uff0c\u90a3\u9019\u6a23 ExpressRoute Gateway \u8981\u9078\u5efa\u7acb\u5728\u65b0\u52a0\u5761 (Southeast Asia) \u9084\u662f\u9999\u6e2f (East Asia)?","text":"<p>A5: ExpressRoute Gateway \u8981\u5efa\u5728\u65b0\u52a0\u5761 (Southeast Asia)\uff0c\u56e0\u70ba\u6d41\u91cf\u5be6\u969b\u4e0b\u8eca\u9ede\u5728\u90a3\uff0c\u5982\u679c\u5efa\u7acb\u5728\u9999\u6e2f (East Asia)\uff0c\u5247\u9084\u9700\u8981\u984d\u5916\u5efa\u7acb Global VNet Peering \u5230\u65b0\u52a0\u5761\u624d\u6709\u8fa6\u6cd5\u9023\u5230\u90a3\u908a\u7684\u670d\u52d9</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q6-azure-expressroute-dr","title":"Q6: Azure ExpressRoute \u7684 DR \u600e\u9ebc\u505a?","text":"<p>A6: \u6bcf\u500b\u7ad9\u9ede\u5efa\u8b70\u90fd\u591a\u914d S2S VPN \u4f5c\u70ba\u5099\u63f4\u6216\u5176\u4ed6\u53ef\u8def\u7531\u7684\u65b9\u5f0f\u4f86\u78ba\u4fdd\u9023\u7dda\uff0c\u8a73\u60c5 Using S2S VPN as a backup for ExpressRoute private peering</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q7-expressroute-vm-latency","title":"Q7: \u6211\u8981\u600e\u9ebc\u77e5\u9053\u7528 ExpressRoute \u5230\u5f9e\u6211\u5bb6\u5230\u7279\u5b9a\u5340\u57df\u7684 VM Latency \u662f\u591a\u5c11?","text":"<p>A7: \u9019\u500b\u9700\u8981 ExpressRoute Provider \u7684\u914d\u5408\uff0c\u56e0\u70ba\u6700\u5f8c\u4e00\u54e9 (Last Mile) \u53ea\u6709\u4ed6\u5011\u77e5\u9053\u5f9e\u4ed6\u5011\u5bb6\u7684\u8def\u7531\u9032 Microsoft PoP \u662f\u591a\u5c11</p> <p>\u4f46\u5982\u679c\u662f\u60f3\u77e5\u9053 Azure Region to Azure Region RTT P50 \u7684\u503c\u5012\u662f\u53ef\u4ee5\u53c3\u8003 Azure network round-trip latency statistics\uff0c\u500b\u4eba\u6709\u4e09\u5730\u5be6\u6e2c\u904e\u76f8\u7576\u6e96</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q8-expressroute","title":"Q8: \u5982\u679c\u6211\u670d\u52d9\u5728\u4e2d\u570b\u5883\u5167\u8981\u600e\u9ebc\u900f\u904e ExpressRoute \u63a5\u5230\u570b\u969b?","text":"<p>A8: \u5e38\u898b\u662f\u628a ExpressRoute \u63a5\u5230 East Asia \u5167\uff0c\u4f46\u9019\u984c\u76ee\u6709\u9ede\u8907\u96dc\u4e0d\u662f\u4e00\u53e5\u8a71\u53ef\u4ee5\u89e3\u6c7a\u7684\uff0c\u5efa\u8b70\u8981\u8a62\u554f\u4e00\u4e0b Azure \u67b6\u69cb\u5e2b</p>","tags":["azure","expressroute"]},{"location":"20230202-azure-expressroute-cross-region.html#q9-azure-cross-region-global-transit-network-architecture","title":"Q9: \u5982\u679c\u6211\u9023 Azure Cross Region \u90fd\u8981\u9023\u5728\u4e00\u8d77\uff0c\u90a3\u6700\u7d42 Global Transit Network Architecture \u6703\u9577\u6210\u600e\u6a23?","text":"<p>A9: \u5efa\u8b70\u63a1\u7528 Azure vWAN\uff0c\u529f\u80fd\u5168\u958b\u7684\u72c0\u6cc1\u4e4b\u4e0b\u6703\u8b8a\u6210\u4e0b\u5716</p> <p></p> <p>\u9019\u5716\u6709\u4e00\u5806\u707d\u5bb3\u60c5\u5883\u53ef\u4ee5\u89e3\u91cb\u8def\u7531\u8b8a\u5316\uff0c\u4e0d\u5728\u672c\u6587\u8a73\u8ff0</p>","tags":["azure","expressroute"]},{"location":"20230203-private-azure-openai-service-ra.html","title":"\u79c1\u6709 Azure OpenAI Serivce \u9810\u60f3\u67b6\u69cb\u898f\u5283","text":"Info <p>\u6b64\u6587\u662f\u5beb\u7d66\u5ee3\u5927\u7684 IT Infra \u80cc\u666f\u7fa4\u773e\u770b\u7684\uff0c\u4e3b\u8981\u662f\u63d0\u4f9b\u843d\u5730\u67b6\u69cb\u8a2d\u8a08\u53c3\u8003\uff0c\u82e5\u4f60\u662f\u60f3\u8981\u77e5\u9053 OpenAI \u600e\u9ebc\u7528\u7684\uff0c\u6b64\u6587\u4e26\u7121\u6d89\u53ca\uff0c\u53ef\u4ee5\u53c3\u8003\u5b98\u65b9\u6587\u4ef6 Azure OpenAI is now generally available</p> <p>2022/11 \u6700\u9a5a\u5687\u5230\u6211\u7684\u4e8b\u60c5\u5c31\u662f ChatGPT \u9019\u670d\u52d9\u7684\u8a95\u751f\uff0c\u7c21\u76f4\u770b\u5230 \u79d1\u6280\u5947\u7570\u9ede \uff0c\u7136\u5f8c\u6c92\u60f3\u5230\u9019\u670d\u52d9\u7684\u6bcd\u516c\u53f8 OpenAI \u5c45\u7136\u662f Microsoft \u6295\u8cc7\u7684\uff0c\u6211\u53ea\u80fd\u8aaa\u771f\u7684\u662f\u53ef\u559c\u53ef\u8cc0\u548c\u611f\u5230\u54c0\u50b7\u3002</p> <p>\u53ef\u559c\u53ef\u8cc0\u662f\u6211\u53ef\u4ee5\u5728\u5f88\u8fd1\u7684\u8ddd\u96e2\u770b\u5230\u9019\u6280\u8853\u5c07\u8981\u5275\u9020\u7684\u6b77\u53f2\uff0c\u611f\u5230\u54c0\u50b7\u662f ChatGPT \u6a39\u7acb\u4e86\u4e00\u500b\u76f8\u7576\u9a5a\u4eba\u7684\u6280\u8853\u5c4f\u969c\uff0c\u90fd\u4e0d\u77e5\u9053\u4ee5\u5f8c\u65b0\u9032\u6216\u83dc\u9ce5\u5de5\u7a0b\u5e2b\u5230\u5e95\u8981\u600e\u9ebc\u8ddf\u9019\u500b\u7af6\u722d\uff0c\u4f46\u5e78\u597d\u82e5\u554f\u4ed6\u505a\u7279\u5225\u9700\u8981\u5c08\u696d\u6027\u554f\u7b54\u7684\u4e8b\u60c5\uff0c\u9019\u670d\u52d9\u76ee\u524d\u6709\u53ef\u80fd\u6703\u56de\u7b54\u932f\u8aa4\u6216\u4e82\u7b54\uff0c\u8b6c\u5982\u8aaa\u554f\u5b83\u7db2\u8def\u9664\u932f\u6216\u8a2d\u8a08\u554f\u984c\u5f8c\uff0c\u770b\u8d77\u4f86\u6211\u9084\u4e0d\u6703\u5931\u696d :&gt;</p> <p>\u4e0b\u5716\u662f\u6a19\u6e96\u5de5\u7a0b\u5e2b\u4f7f\u7528\u7bc4\u4f8b\uff0c\u672c\u4eba\u5c0d\u65bc HTML \u548c CSS \u6beb\u7121\u7406\u89e3\uff0c\u4e5f\u4e0d\u77e5\u9053\u5f9e\u4f55\u6539\uff0c\u7136\u5f8c\u6211\u5c31\u53bb\u554f ChatGPT \u5f8c\uff0c\u5c31\u6539\u597d\u4e86...</p> <p></p>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#azure-openai-service-architecture-pre-design","title":"Azure OpenAI Service Architecture Pre Design","text":"\u8072\u660e <p>\u65bc\u672c\u6587\u64b0\u5beb\u7684\u4eca\u5929 20220203 \u96d6\u8eab\u70ba Microsoft \u54e1\u5de5\uff0c\u4f46\u6211\u4e5f\u9084\u6c92\u6709\u62ff\u5230 Azure OpenAI \u7684\u8a02\u95b1\u6b0a\u9650\uff0c\u6240\u4ee5\u9084\u6c92\u6709\u5be6\u6e2c\u904e\u9019\u67b6\u69cb\uff0c\u6545\u672c\u6587\u662f\u4f9d\u64da\u65e2\u6709 Azure \u6587\u4ef6\u548c\u6211\u5c0d Azure \u7db2\u8def\u7684\u8a8d\u77e5\u63d0\u4f9b\u9810\u60f3\u67b6\u69cb\u7d66\u5404\u4f4d\u53c3\u8003\uff0c\u53cd\u6b63\u5f8c\u7e8c\u53ef\u4ee5\u4fee\u4fee\u6539\u6539</p> <p>\u4e3b\u8981\u662f\u770b\u5230\u5f37\u8005\u6211\u540c\u4e8b Jimmy Liao - Azure OpenAI Part 1: \u521d\u63a2 OpenAI Studio \u9019\u6587\u7ae0\uff0c\u770b\u5230\u88e1\u9762 Azure OpenAI \u5de6\u5074\u7684\u5167\u5bb9\uff0c\u624d\u60f3\u5148\u628a\u7db2\u8def\u67b6\u69cb\u5148\u5beb\u4e00\u5beb\u7d66\u5927\u5bb6\u53c3\u8003\u4e00\u4e0b</p> <p></p> <p>\u76ee\u524d\u9810\u60f3\u79c1\u6709\u67b6\u69cb\u4e0a\u5206\u70ba 2 \u500b\u65b9\u6848</p> <ol> <li>\u751f\u7522\u74b0\u5883\u898f\u5283</li> <li>PoC \u9a57\u8b49\u74b0\u5883\u898f\u5283</li> </ol>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#1-production","title":"\u65b9\u6848 1: Production \u751f\u7522\u79c1\u6709\u74b0\u5883\u898f\u5283","text":"","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#2-poc","title":"\u65b9\u6848 2: PoC \u9a57\u8b49\u79c1\u6709\u74b0\u5883\u898f\u5283","text":"","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#_1","title":"\u9810\u60f3\u79c1\u6709\u67b6\u69cb\u8a73\u89e3","text":"<p>\u6574\u9ad4\u79c1\u6709\u7db2\u8def\u7684\u67b6\u69cb\u95dc\u9375\u6838\u5fc3\u662f Azure Private Endpoint \u548c Azure Private Link \u7684\u4f7f\u7528\uff0c\u6839\u64da\u6b64\u6587 Private-link resource \u6545\u53ef\u63d0\u4f9b\u4ee5\u4e0b\u670d\u52d9 Private Endpoint \u7d66\u79c1\u6709\u9023\u7dda\u4f7f\u7528\uff0c\u6b64\u5916\u9019\u500b\u670d\u52d9\u662f\u5728 Azure Cognitive Services \u5e95\u4e0b\uff0c\u6240\u4ee5\u82e5\u4f60\u6709\u65e2\u6709\u67b6\u69cb\u7684\u8a71\u53ef\u4ee5\u76f4\u63a5\u6cbf\u7528</p> Private-link resource name Resource type Note Azure OpenAI Services Microsoft.CognitiveServices/accounts \u6587\u4ef6\u9084\u6c92\u6709\u51fa\u4f86\uff0c\u4f46\u529f\u80fd\u6709 Azure Key Vault Microsoft.KeyVault/vaults N/A Azure Storage Microsoft.Storage/storageAccounts N/A Azure Monitor Microsoft.insights/privateLinkScopes \u9019\u500b\u662f\u7528 Azure Monitor Private Link Scope (AMPLS) Azure Cognitive Services Microsoft.CognitiveServices/accounts N/A <p>\u95dc\u65bc DNS\uff0c\u5982\u679c\u662f\u5b8c\u5168\u65b0\u5efa\u670d\u52d9\u7684\u8a71\uff0c\u9084\u8981\u6ce8\u610f Azure Private DNS \u89e3\u6790\u554f\u984c\uff0c\u4f46\u9019\u662f\u53e6\u4e00\u584a\u9700\u8981\u984d\u5916\u8a0e\u8ad6\u8655\u7406\uff0c\u89e3\u6cd5\u4e0d\u5916\u4e4e 2 \u7a2e\u5e38\u898b\u4f5c\u6cd5:</p> <ol> <li>Azure Private DNS Resovler: Azure PaaS \u670d\u52d9\uff0c\u672c\u8eab\u6709\u8de8\u570b\u67b6\u69cb\u9700\u6c42\uff0c\u6709 Private DNS Zone \u7ba1\u7406\u9700\u6c42\u76f8\u7576\u63a8\u85a6</li> <li>Customer DNS Forwarder: Azure VM + \u770b\u4f60\u559c\u6b61\u54ea\u5bb6\u7684 DNS\uff0c\u5982 AD / Infoblox / Bind9 \u7b49\uff0c\u505a Forwarder</li> </ol> <p>\u95dc\u65bc\u96f2\u5730\u9023\u7dda\uff0c\u5f9e\u5730\u7aef\u74b0\u5883\u9023\u5230 Azure\uff0c\u4e0d\u5916\u4e4e\u5c31 2 \u7a2e\u5e38\u898b\u505a\u6cd5</p> <ol> <li>Azure ExpressRoute \u5c08\u7dda</li> <li>S2S VPN \u4f7f\u7528 IPSec Tunnel</li> </ol> <p>\u5982\u679c\u53ea\u662f\u521d\u671f\u958b\u555f\u4f86\u8a66\u8a66\u7684\u8a71\uff0cS2S VPN \u80fd\u7528\uff0c\u5f8c\u7e8c\u8a13\u7df4\u8cc7\u6599\u91cf\u5927\u8d77\u4f86\u7684\u8a71\uff0c\u662f\u883b\u63a8\u85a6\u4f7f\u7528 ExpressRoute \u78ba\u4fdd\u9023\u7dda\u7a69\u5b9a\u548c\u4f4e\u5ef6\u9072\uff0c\u8a73\u53c3 \u6ed1\u9f20\u9ede\u9ede\u4e4b\u8de8\u570b Azure ExpressRoute \u7db2\u8def\u67b6\u69cb </p> \u5efa\u8b70\u5b8c\u6574\u670d\u52d9 <p>\u4e0b\u8ff0\u7684 API Management/Application Gateway \u8ddf Azure OpenAI \u80fd\u529b\u63d0\u4f9b\u4e26\u7121\u76f4\u63a5\u95dc\u4fc2\uff0c\u6545\u521d\u671f\u6e2c\u8a66\u53ef\u4ee5\u5148\u4ee5 PoC \u9a57\u8b49\u74b0\u5883\u898f\u5283\u6a23\u677f\u70ba\u4e3b\uff0c\u518d\u5f8c\u7e8c\u52a0\u4e0b\u5217\u670d\u52d9\u4e0a\u53bb\u5b8c\u5584</p> <p>\u6b64\u5916\u95dc\u65bc API \u63a7\u7ba1\u7684\u90e8\u5206\uff0cAzure OpenAI \u6709\u63d0\u4f9b <code>Azure OpenAI Service Swagger API</code> \u4f9b\u7a0b\u5f0f\u547c\u53eb\u4f7f\u7528\uff0c\u5b83\u89d2\u8272\u5982\u540c\u5e38\u898b\u7684 Backend APIs\uff0c\u670d\u52d9\u672c\u8eab\u6c92\u6709\u505a\u4ec0\u9ebc\u7279\u5225\u7684\u4fdd\u8b77\uff0c\u6545\u524d\u9762\u53ef\u4ee5\u4f7f\u7528 API Management \u9032\u884c\u8f49\u63db API \u548c\u7ba1\u5236\uff0c\u800c API Management \u524d\u9762\u9084\u53ef\u4ee5\u7528 Application Gateway \u4fdd\u8b77 API</p> <p></p>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#qa","title":"Q&amp;A","text":"","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#q1-private-endpoint-azure-openai-service","title":"Q1: \u5982\u679c\u6211\u4e0d\u7528\u4e0a\u9762\u4ec0\u9ebc Private Endpoint \u9084\u662f\u6709\u7684\u6c92\u7684\uff0c\u53ef\u4ee5\u7528 Azure OpenAI Service?","text":"<p>A1: \u53ef\u4ee5\uff0c\u5f37\u8005\u6211\u540c\u4e8b Jimmy Liao - Azure OpenAI Part 1: \u521d\u63a2 OpenAI Studio\u6709\u5beb\u7cfb\u5217\u6587\uff0c\u53ef\u4ee5\u76f4\u63a5\u53c3\u8003\u4ed6\u7684\u7cfb\u5217\u6587\u7ae0</p>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#q2-azure-openai-service","title":"Q2: \u73fe\u5728\u7533\u8acb\u4e0d\u5230 Azure OpenAI Service\uff0c\u96e3\u9053\u6211\u5c31\u6c92\u4ec0\u9ebc\u6771\u897f\u53ef\u4ee5\u5148\u8a55\u4f30\u4e86\u55ce?","text":"<p>A2: \u96f2\u5730\u7db2\u8def\u53ef\u4ee5\u5148\u8a0e\u8ad6\u548c\u5148\u62c9\uff0c\u6309\u7167\u6211\u7684\u7406\u89e3\uff0c\u6b63\u5e38\u53f0\u7063\u5ba2\u6236\u8a0e\u8ad6\u5230\u5be6\u969b\u843d\u5730\u8d77\u4f86\u90fd\u6703\u6bd4 Azure OpenAI Service \u63a8\u51fa\u7684\u6642\u9593\u9084\u8981\u4e45\uff0c\u56e0\u70ba\u5b83\u4e0d\u662f\u55ae\u7d14\u6ed1\u9f20\u9ede\u9ede\u5c31\u53ef\u4ee5\u89e3\u6c7a\u7684\u4e8b\u60c5</p> <p></p> <p>\u5176\u6b21\u5c31\u662f\u770b Production \u751f\u7522\u79c1\u6709\u74b0\u5883\u898f\u5283 \u5167\u5bb9\uff0c\u4e86\u89e3\u4e00\u4e0b\u88e1\u9762\u7684\u5167\u5bb9\u500b\u5225\u529f\u80fd</p>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#q3-infra","title":"Q3: \u7121\u95dc\u984c\u76ee\uff0c\u8eab\u70ba\u4e00\u540d Infra \u5de5\u7a0b\u5e2b\uff0c\u5c0d\u65bc\u9019\u500b\u670d\u52d9\u6709\u4ec0\u9ebc\u60f3\u50cf\u529b\u55ce?","text":"<p>A3: \u4fee\u7db2\u8def\uff0c\u4e1f\u7d66\u5b83\u4e00\u5806\u8def\u7531\u8cc7\u8a0a\uff0c\u7136\u5f8c\u8ddf\u6211\u8aaa\u4e00\u4e0b\u5230\u5e95\u54ea\u4e00\u689d\u662f\u64fa\u932f\u7684\u6216\u8005\u662f\u54ea\u88e1\u602a\u602a\u7684</p>","tags":["azure","openai","networking"]},{"location":"20230203-private-azure-openai-service-ra.html#references","title":"References","text":"<ul> <li>Jimmy Liao - Azure OpenAI Part 1: \u521d\u63a2 OpenAI Studio</li> <li>Azure OpenAI is now generally available</li> <li>Conversational Azure OpenAI (ChatGPT) Accelerator</li> </ul>","tags":["azure","openai","networking"]},{"location":"20230209-azure-vm-outbound-methods.html","title":"\u8b93 Azure VM \u5c0d\u5916\u9023\u7dda\u7684\u591a\u7a2e\u82b1\u6a23","text":"<p>\u6216\u8a31\u6709\u4e9b\u8b80\u8005\u77e5\u9053\u5c0f\u5f1f\u4ee5\u524d\u662f\u5c08\u641e\u5730\u7aef Infra \u670d\u52d9\u7684\u67b6\u69cb\u5e2b\uff0c\u8208\u8da3\u5c31\u662f\u5c08\u9580\u770b Networking \u548c\u4ed6\u76f8\u95dc\u9023\u7684\u670d\u52d9\uff0c\u6700\u8fd1\u4f86\u5230\u96f2\u7aef\u4e4b\u5f8c\uff0c\u53ea\u80fd\u8aaa\u96d6\u7136\u770b\u8d77\u4f86\u90fd\u662f\u4e00\u53f0 VM \u9023\u7dda\u51fa\u53bb\u5230 Internet\uff0c\u4f46\u5be6\u969b\u4e0a\u7709\u89d2\u9084\u883b\u591a\u7684...\u5012\u662f\u5982\u679c\u4f60\u662f\u5730\u7aef\u7db2\u8def\u5de5\u7a0b\u5e2b\u7684\u8a71\uff0c\u525b\u63a5\u89f8 Azure \u7db2\u8def\u7684\u8a71\uff0c\u883b\u63a8\u85a6\u57fa\u790e\u5148\u5f9e AZ-700 Designing and Implementing Microsoft Azure Networking Solutions \u958b\u59cb\u8457\u624b\uff0c\u4fdd\u8b49\u4f60\u53ef\u4ee5\u7814\u7a76\u5f88\u4e45</p> <p>\u53e6\u5916\u8981\u7279\u5225\u611f\u6069\u570b\u5916\u7684\u5927\u795e Toni Pasanen \u5beb\u4e86\u4e00\u5806\u6587\u7ae0\u8b93\u6211\u66f4\u6e05\u695a\u77ad\u89e3 Azure Networking \u67b6\u69cb Toni Pasanen - Azure Networking Fundamentals: Internet Access with VM-Specific Public IP \u4e00\u5716\u89e3\u91cb Azure VM \u5c0d\u5916\u7db2\u8def\u9023\u7dda\u65b9\u5f0f\uff0c\u5f37\u70c8\u63a8\u85a6\u7d66\u5927\u5bb6</p> <p></p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#inbound-traffic-outbound-traffic","title":"Inbound Traffic \u548c Outbound Traffic","text":"<p>\u5148\u4e86\u89e3\u4e00\u4e0b\u7528\u8a5e\u5b9a\u7fa9</p> <ul> <li>Inbound Traffic: \u7279\u5b9a Azure VM \u53ef\u4ee5\u63a5\u6536\u4f86\u81ea Internet \u7684\u9023\u7dda\uff0c\u65bc Azure \u5be6\u969b\u4e0a\u7684\u505a\u6cd5\uff0c\u4e0d\u5916\u4e4e DNAT (Destination NAT)\u3001 1 to 1 NAT \u6216\u76f4\u63a5\u5f9e Internet \u8def\u7531\u9032\u4f86</li> <li>Outbound Traffic: \u7279\u5b9a Azure VM \u53ef\u4ee5\u767c\u9001\u9023\u7dda\u5230 Internet\uff0c\u65bc Azure \u5be6\u969b\u4e0a\u7684\u505a\u6cd5\u5c31\u662f SNAT (Source NAT) \u6216\u76f4\u63a5\u8def\u7531\u5230 Internet</li> </ul> <p>\u672c\u6587\u6703\u8457\u91cd\u8a0e\u8ad6 Outbound Traffic \u7684\u72c0\u6cc1</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#azure-public-ip","title":"\u4e86\u89e3 Azure Public IP \u80fd\u5920\u7684\u5206\u914d\u7a2e\u985e","text":"<p>\u4f9d\u64da Public IP addresses - At a glance \u6307\u51fa\uff0c\u82e5\u4f60\u7684 Azure VM Instance \u524d\u9762\u6709 Azure \u670d\u52d9\u4e14\u5177\u6709 Azure Public IP \u7684\u8a71\uff0c\u662f\u5177\u5099\u5f9e VM \u767c\u9001\u9023\u7dda\u5230 Internet \u6216\u9023\u7dda\u9032\u4f86\u7684\u80fd\u529b\uff0c\u4e0b\u5217\u689d\u5217\u5e38\u898b\u670d\u52d9\u4f46\u4e0d\u9650\u65bc:</p> Componets IPv4 Static \u6307\u6d3e IPv4 Dynamic \u6307\u6d3e Azure Firewall Azure NAT Gateway Azure Route Server Azure Bastion Azure Application Gateway  (v2 only)  (v1 only) Azure Virtual Network Gateway Azure Load Balancer (Public) Network Interace Card (Public) <p>\u82e5\u4f60\u60f3\u4e86\u89e3 Azure Public IP Static \u8ddf Dynamic \u7684\u5dee\u7570\uff0c\u53ef\u4ee5\u9ede\u9078\u6b64\u6587\u53c3\u8003 Azure Public IP - SKU\uff0c\u672c\u6587\u4e0d\u8d05\u8ff0</p> <p>\u4f46\u5c31\u4e00\u500b Azure VM \u7684\u89d2\u5ea6\u4f86\u8b1b\uff0c\u4e26\u4e0d\u662f\u4e0a\u8ff0\u7684\u6240\u6709\u670d\u52d9\u90fd\u80fd\u5920\u8b93 VM \u76f4\u63a5\u9023\u7dda\u51fa\u53bb\uff0c\u8b6c\u5982\u8aaa\u4eca\u5929\u4e00\u53f0 RHEL VM \u8981\u9032\u884c <code>dnf update</code> \u4f60\u52e2\u5fc5\u8981\u9023\u7dda\u5230 Red Hat \u7684 Repos \u624d\u80fd\u4e0b\u8f09\uff0c\u6545\u4e0b\u9762\u518d\u5f9e\u4e2d\u6574\u7406\u51fa\u80fd\u5920\u8b93\u4e00\u53f0 VM \u900f\u904e Outbound Traffic \u9023\u7dda\u5230 Internet \u7684\u591a\u7a2e\u9023\u7dda\u65b9\u5f0f</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#outbound-traffic-5","title":"Outbound Traffic \u4e4b 5 \u7a2e\u9023\u7dda\u65b9\u5f0f","text":"<p>\u4f9d\u64da Use Source Network Address Translation (SNAT) for outbound connections \u6307\u51fa\uff0c</p> \u65b9\u6cd5 \u751f\u7522\u74b0\u5883\u7528? \u63a8\u85a6\u7b49\u7d1a? \u9069\u7528 SKU \u4f7f\u7528 Azure Firewall \u900f\u904e SNAT \u9023\u7dda\u5230 Internet \u6975\u4f73 Basic / Standard / Premium \u53ef\u7528 \u4f7f\u7528 Azure NAT Gateway \u900f\u904e SNAT \u9023\u7dda\u5230 Internet \u6975\u4f73 N/A \u4f7f\u7528 Azure Load Balancer (Public) \u900f\u904e Oubound rules \u9023\u7dda\u5230 Internet \u4f73 Stanard \u53ef\u7528\uff0cBasic \u4e0d\u53ef \u76f4\u63a5\u5c07 Public IP \u639b\u5728 NIC \u4e0a\u8b93 VM \u9023\u7dda\u5230 Internet \u4f73 Standard / Basic \u53ef\u7528 \u4ec0\u9ebc\u90fd\u4e0d\u505a\uff0c\u9810\u8a2d\u63a1\u7528 Default Outbound Access IP \u9023\u7dda\u5230 Internet \u5dee N/A <p>\u9996\u5148\u662f\u95dc\u65bc Azure Firewall v.s. Azure NAT Gateway \u7684\u9078\u64c7\uff0c\u56e0\u70ba\u90fd\u53ef\u4ee5\u505a SNAT \u51fa\u53bb\uff0c\u67b6\u69cb\u9078\u64c7\u95dc\u9375\u5728 2 \u500b\u5730\u65b9</p> <ul> <li>\u9023\u7dda\u8981\u4e0d\u8981 Firewall \u4fdd\u8b77? \u9019\u500b\u883b\u76f4\u89ba\u7684\u6211\u5c31\u4e0d\u8b1b\u4e86</li> <li>\u8981\u4e0d\u8981\u505a DNAT? \u56e0\u70ba Azure Firewall \u53ef\u4ee5\u505a DNAT \u548c SNAT\uff0c\u4f46 Azure NAT Gateway \u53ea\u80fd\u505a SNAT\uff0c\u4e0d\u80fd\u4f7f\u7528 DNAT \u7ba1\u7406 Inbound Traffic</li> </ul> <p>\u9019\u908a\u9084\u6709\u4e00\u500b\u6d3e\u751f\u4f5c\u6cd5\u5c31\u662f Azure NAT Gateway with Azure Firewall\uff0c\u4e3b\u8981\u7528 Azure NAT Gateway \u53ef\u652f\u63f4 64,512 SNAT Port \u89e3\u6c7a Azure Firewall SNAT Port \u50c5 2,496 port \u4e0d\u8db3\u554f\u984c\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 Scale Azure Firewall SNAT\uff0c\u672c\u6587\u4e0d\u8d05\u8ff0</p> <p>\u5176\u6b21\u662f Azure NAT Gateway v.s Azure Load Balancer\uff0c\u96d6\u7136\u524d\u8005\u662f\u7528 SNAT \u51fa\u53bb\uff0c\u5f8c\u8005\u662f\u7528 Outbound Policy \u51fa\u53bb\uff0c\u67b6\u69cb\u9078\u64c7\u95dc\u9375\u5728</p> <ul> <li>\u670d\u52d9\u9023\u7dda\u7279\u6027\u9700\u4e0d\u9700\u8981\u5927\u91cf\u7684 Outbound Traffic? \u5982\u679c\u662f\u7684\u8a71\uff0c\u5efa\u8b70\u4f7f\u7528 Azure NAT Gateway\uff0c\u56e0\u70ba\u9019\u670d\u52d9\u5c08\u70ba Outbound Traffic \u8a2d\u8a08\uff0c\u5b8c\u5168\u53d7\u63a7\u4e14\u5177\u6709\u9ad8\u5ea6\u5fa9\u539f\u6027\uff0c\u53ef\u6700\u5927\u5316\u907f\u514d SNAT \u8017\u76e1\u554f\u984c (SNAT Exhaustion Scenarios) \u662f Outbound Traffic \u6700\u4f73\u9078\u64c7</li> </ul> <p>\u81f3\u65bc Azure Load Balancer \u670d\u52d9\u672c\u8eab\u662f\u70ba\u4e86 Inbound Traffic \u800c\u8a2d\u8a08\uff0c\u800c\u975e Outbound Traffic\uff0c\u4f46\u4ed6\u525b\u597d\u5177\u5099 <code>Outbound Policy - Outbound source network address translation (SNAT)</code> \u7684\u7ba1\u7406\u529f\u80fd\uff0c\u6240\u4ee5\u5728\u672c\u6587\u4e2d\u662f\u4e00\u500b\u9078\u9805\uff0c\u6b63\u4e5f\u56e0\u70ba\u5982\u6b64\u6709\u4e00\u500b\u6d3e\u751f\u4f5c\u6cd5\u5c31\u662f Azure NAT Gateway with Azure Load Balancer\uff0c\u4f46 Azure Load Balancer \u8655\u7406 Inbound Traffic\uff0c\u800c Azure NAt Gateway \u8655\u7406 Outbound Traffic\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003 NAT and VM with a standard public load balancer\uff0c\u672c\u6587\u4e0d\u8d05\u8ff0</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#default-outbound-access-ip","title":"\u95dc\u65bc Default outbound access IP !!!???","text":"","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#_1","title":"\u4ec0\u9ebc\u90fd\u4e0d\u505a\u4e5f\u80fd\u9023\u51fa\u53bb!!??","text":"<p>\u662f\uff0c\u4ec0\u9ebc\u90fd\u4e0d\u8a2d\u5b9a\u7684\u72c0\u6cc1\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u9023\u7dda\u51fa\u53bb\uff0c\u57fa\u65bc When is default outbound access provided?\uff0c\u9019\u662f Azure \u5e73\u53f0\u7279\u6027\uff0c\u9019\u500b\u529f\u80fd\u53eb\u505a Default Outbound Access IP\uff0c\u662f\u4e00\u500b\u96b1\u542b (Implicit) \u7684\u8cc7\u6e90\uff0c\u8a72 Public IP \u4e26\u4e0d\u6703 \u986f\u793a\u5728 Azure Portal \u4e0a\uff0c\u4e14\u4e0d\u7b97 Subscription Cost \u7684\u4e00\u74b0\uff0c\u800c\u9019\u500b Default Outbound Access IP \u7684\u7279\u6027\u5982\u4e0b:</p> <ol> <li>\u53ea\u51fa\u4e0d\u9032: \u53ea\u6709 Outbound Traffic \u80fd\u529b\uff0c\u4e0d\u5177\u5099 Inbound Traffic \u80fd\u529b</li> <li>\u50c5\u652f\u63f4 TCP/UDP \u9023\u7dda\uff0c\u4e0d\u652f\u63f4 ICMP: \u6545\u4f60\u53ef\u4ee5\u4e0b\u8f09 package \u4f46\u4e0d\u80fd ping \u51fa\u53bb</li> <li>IP \u6703\u81ea\u5df1\u8b8a\u52d5: \u56e0\u70ba\u9019\u500b IP \u4e0d\u6b78\u5c6c\u5ba2\u6236\u7ba1\u7406\uff0c\u6545\u4e0d\u6703\u901a\u77e5\u66f4\u63db\uff0c\u6545\u5982\u679c\u6709\u4efb\u4f55\u8ddf\u9019\u500b IP \u6709\u95dc\u9023\u7684\u670d\u52d9\uff0c\u6703\u76f4\u63a5\u53d7\u5230\u5f71\u97ff</li> </ol>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#vm-public-ip","title":"\u5982\u4f55\u9a57\u8b49\u6211\u73fe\u5728\u7684 VM \u662f\u4e0d\u662f\u6709\u9019\u7a2e\u96b1\u542b\u7684 Public IP \u8cc7\u6e90?","text":"<p>\u57fa\u65bc How To: \u67e5\u8a62\u53ca\u9a57\u8b49\u81ea\u8eab Public IP \u6240\u5217\uff0c\u56e0\u70ba Default outbound access IP \u4e26\u4e0d\u652f\u63f4 ICMP\uff0c\u6211\u5011\u50c5\u6709 TCP/UDP \u53ef\u7528\uff0c\u6545\u53ef\u4ee5\u63a1\u7528 DNS \u67e5\u8a62\u7684\u65b9\u5f0f\u4f86\u9a57\u8b49</p> command<pre><code>dig myip.opendns.com @resolver1.opendns.com\n</code></pre>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#_2","title":"\u5982\u4f55\u95dc\u9589\u6216\u907f\u514d\u6b64\u72c0\u6cc1?","text":"<p>\u7c21\u55ae\u4f86\u8aaa\u5c31\u662f\u8981\u91dd\u5c0d Outbound Traffic \u505a\u986f\u5f0f (Explicit) \u7684\u8a2d\u5b9a\uff0c\u4e5f\u5c31\u662f\u660e\u986f\u7684\u544a\u8a34 Azure \u8981\u7528\u4ec0\u9ebc\u65b9\u5f0f\u9023\u7dda\u51fa\u53bb</p> <ol> <li>\u8a2d\u5b9a NSG (Network Security Group) \u4f86\u9650\u5236 Outbound Traffic</li> <li>\u63a1\u7528 <code>Outbound Traffic \u4e4b\u591a\u7a2e\u9023\u7dda\u65b9\u5f0f</code> \u7ae0\u7bc0\u6240\u5217\u65b9\u5f0f\u4e4b\u4e00\uff0c\u660e\u78ba\u8868\u793a\u8981\u600e\u9ebc\u4ecb\u63a5\u51fa\u53bb</li> </ol> <p>\u4e0b\u9762\u6703\u91dd\u5c0d\u65b9\u5f0f 1 \u7684 NSG \u4f86\u505a\u5be6\u6e2c\u5b8c\u5168\u95dc\u9589 Outbound Traffic\uff0c\u4e26\u4e14\u9a57\u8b49 VM \u662f\u5426\u80fd\u6b63\u5e38\u904b\u4f5c</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#default-outbound-access-ip_1","title":"\u5982\u4f55\u4f7f\u7528 Default outbound access IP?","text":"<p>\u65bc Create a Virtual Machine \u6642\uff0c\u91dd\u5c0d Networking \u9801\u9762\uff0c\u4f7f\u7528\u4e0b\u5217\u53c3\u6578:</p> \u9078\u9805 \u53c3\u6578 Public IP None NIC network security group None / Basic \u7686\u53ef Load Balancing None <p></p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#default-outbound-access-ip_2","title":"\u5be6\u6e2c Default outbound access IP \u884c\u70ba","text":"","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#lab-1-vm-default-outbound-access-ip-outbound-traffic","title":"Lab 1: \u65b0\u589e VM \u4e14\u4f7f\u7528 Default outbound access IP \u7684 Outbound Traffic","text":"\u9078\u9805 Outbound Traffic Inbound Traffic ICMP TCP UDP HTTP DNS output_without_nsg<pre><code>repairman@black-vm:~$ ping -c 1 www.microsoft.com\nPING e13678.dscb.akamaiedge.net (23.219.5.163) 56(84) bytes of data.\n\n--- e13678.dscb.akamaiedge.net ping statistics ---\n1 packets transmitted, 0 received, 100% packet loss, time 0ms\n\nrepairman@black-vm:~$ nc -zvw3 www.microsoft.com 80\nConnection to www.microsoft.com 80 port [tcp/http] succeeded!\nrepairman@black-vm:~$ nc -zvw3 www.microsoft.com 443\nConnection to www.microsoft.com 443 port [tcp/https] succeeded!\n\n\nrepairman@black-vm:~$ dig myip.opendns.com @resolver1.opendns.com\n\n; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; myip.opendns.com @resolver1.opendns.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20264\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;myip.opendns.com.              IN      A\n\n;; ANSWER SECTION:\nmyip.opendns.com.       0       IN      A       x.x.x.x\n\n;; Query time: 4 msec\n;; SERVER: 208.67.222.222#53(208.67.222.222)\n;; WHEN: Fri Feb 10 02:15:56 UTC 2023\n;; MSG SIZE  rcvd: 61\n\nrepairman@black-vm:~$ curl -s -o /dev/null -I -w \"%{http_code}\" http://www.microsoft.com/\n200\n\nrepairman@black-vm:~$ sudo apt update -y\nHit:1 http://azure.archive.ubuntu.com/ubuntu focal InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu focal-security InRelease [114 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu focal/universe amd64 Packages [8628 kB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu focal/universe Translation-en [5124 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu focal/universe amd64 c-n-f Metadata [265 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu focal/multiverse amd64 Packages [144 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu focal/multiverse Translation-en [104 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu focal/multiverse amd64 c-n-f Metadata [9136 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2377 kB]\n</code></pre> <p>\u904b\u4f5c\u622a\u5716:</p> <p></p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#lab-2-lab1-nsg-nic-outbound-traffic","title":"Lab 2: \u57fa\u65bc Lab1 \u7684\u60c5\u6cc1\u5c07 NSG \u639b\u8f09\u5230 NIC \u7684 Outbound Traffic","text":"<p>\u65b0\u589e\u4e00\u500b NSG \u4e14\u65bc <code>Outbound Security rules</code> \u4e2d\u8a2d\u5b9a</p> Key Value Source Any Source port ranges * Destination Service Tag Destination port ranges Internet Service Custom Protocol Any Action Deny Priority 100 Name DenyInternetOutbound <p>\u53bb\u8986\u84cb\u6389\u9810\u8a2d <code>65001 AllowInternetOutbound</code> \u7684\u898f\u5247</p> <p>\u5728 Lab 1 \u7684\u60c5\u6cc1\u4e0b\uff0c\u5c07\u8a72 NSG \u4e26\u639b\u8f09 (Associate) \u5230\u9019\u500b VM NIC \u4e0a\uff0c\u5247\u6e2c\u8a66\u6548\u679c\u6703\u8b8a\u6210\u5982\u4e0b:</p> \u9078\u9805 Outbound Traffic Inbound Traffic ICMP TCP UDP HTTP DNS output_with_nsg<pre><code>repairman@black-vm:~$ ping -c 1 www.microsoft.com\nPING e13678.dscb.akamaiedge.net (23.220.113.163) 56(84) bytes of data.\n\n--- e13678.dscb.akamaiedge.net ping statistics ---\n1 packets transmitted, 0 received, 100% packet loss, time 0ms\n\n\nrepairman@black-vm:~$ nc -zvw3 www.microsoft.com 80\nnc: connect to www.microsoft.com port 80 (tcp) timed out: Operation now in progress\nnc: connect to www.microsoft.com port 80 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 80 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 80 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 80 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 80 (tcp) failed: Network is unreachable\nrepairman@black-vm:~$ nc -zvw3 www.microsoft.com 443\nnc: connect to www.microsoft.com port 443 (tcp) timed out: Operation now in progress\nnc: connect to www.microsoft.com port 443 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 443 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 443 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 443 (tcp) failed: Network is unreachable\nnc: connect to www.microsoft.com port 443 (tcp) failed: Network is unreachable\n\n\nrepairman@black-vm:~$ dig myip.opendns.com @resolver1.opendns.com\n\n; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; myip.opendns.com @resolver1.opendns.com\n;; global options: +cmd\n;; connection timed out; no servers could be reached\n</code></pre>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#_3","title":"\u5be6\u6e2c\u7e3d\u7d50","text":"<p>\u8981\u9054\u5230\u5c0d Outbound Traffic \u9032\u884c\u56b4\u683c\u63a7\u7ba1\uff0c\u5305\u542b Default outbound access IP \u7684\u7db2\u8def\u884c\u70ba\u4e5f\u5728\u5167\uff0c\u9700\u8981\u505a\u4e0b\u5217\u4e8b\u60c5</p> <ul> <li>\u4f7f\u7528 NSG \u91dd\u5c0d Subnet \u6216 NIC \u9032\u884c\u7d81\u5b9a</li> <li>NSG \u5167\u7684\u8a2d\u5b9a Outbound Security rules \u898f\u5247 <code>DenyAllInternetOutbound</code> \u660e\u78ba\u898f\u7bc4 Outbound \u6d41\u91cf</li> </ul>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#outbound-traffic","title":"\u5982\u4f55\u6b63\u78ba Outbound Traffic \u9023\u7dda\u65b9\u5f0f?","text":"<ul> <li>\u5982\u679c\u4f60\u662f\u6709\u4e00\u5806\u670d\u52d9 (SNAT Port \u5927\u65bc 2,496) \u53ea\u662f\u60f3\u8981\u6709 1 ~ N \u500b\u53d7\u63a7 IP \u9023\u51fa\u5916\u7db2\u7684\u8a71\uff0c\u53ef\u4ee5\u7528 Azure NAT Gateway \u4f86\u505a</li> <li>\u5982\u679c\u4f60\u662f\u6709\u90e8\u5206\u670d\u52d9 (SNAT Port \u5c0f\u65bc 2,496) \u9700\u8981\u9023\u7dda\u51fa\u5916\u7db2\u7684\u8a71\uff0c\u4f46\u6709\u91cd\u5ea6\u8cc7\u5b89\u9700\u6c42\u7684\u8a71\uff0c\u53ef\u4ee5\u7528 Azure Firewall \u4f86\u505a</li> <li>\u5982\u679c\u4f60\u662f\u6709\u4e0a\u8ff0\u5169\u500b\u9700\u6c42\u7684\u7d9c\u5408\u9700\u6c42\uff0c\u53ef\u4ee5\u7528 Azure Firewall + Azure NAT Firewall Gateway \u4f86\u505a</li> <li>\u5982\u679c\u4f60\u53ea\u662f\u55ae\u53f0 VM \u60f3\u51fa\u7db2\u7684\u8a71\uff0c\u76f4\u63a5\u5c07 Public IP \u639b\u5728 NIC \u642d\u914d NSG \u9032\u884c\u7db2\u8def\u63a7\u7ba1\u5373\u53ef</li> <li>\u5982\u679c\u4f60\u8981\u5b8c\u5168\u95dc\u9589 Default outbound access IP \u80fd\u529b\u7684\u8a71\uff0c\u53ef\u4ee5\u7528 NSG \u5c0d Subnet \u7bc4\u570d\u9032\u884c\u7db2\u8def\u63a7\u7ba1</li> </ul>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q-a","title":"Q &amp; A","text":"","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q1-nsg-rules","title":"Q1: \u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0cNSG \u63d0\u4f9b\u7684 Rules \u6709\u54ea\u4e00\u4e9b?","text":"<p>A1: \u8b93 VM \u53ef\u4ee5\u900f\u904e Default outbound access IP \u7684\u65b9\u5f0f\u9023\u7dda\u51fa\u7684\u662f\u56e0\u70ba <code>65001 AllowInternetOutbound</code> \u7684\u898f\u5247</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q2-65001-allowinternetoutbound","title":"Q2: \u6211\u53ef\u4e0d\u53ef\u4ee5\u76f4\u63a5\u62ff\u6389 <code>65001 AllowInternetOutbound</code> \u7684\u898f\u5247?","text":"<p>A2: \u4e0d\u884c\uff0c\u9019\u662f Azure \u9810\u8a2d\u7684\u898f\u5247\uff0c\u5efa\u8b70\u65b0\u589e\u4e00\u689d <code>DenyAllInternetOutbound</code> \u7684\u898f\u5247\u900f\u904e\u8f03\u9ad8\u7684 Priority \u8986\u84cb\u898f\u5247\u6216\u65bc OS Level \u9032\u884c\u9632\u706b\u7246\u7ba1\u7406\uff0c\u5982 Linux iptables, Windows Firewall</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q3-default-outbound-access-ip","title":"Q3: \u6211\u53ef\u4e0d\u53ef\u4ee5\u4e0d\u8981\u6709 Default outbound access IP?","text":"<p>A3: \u4e0d\u884c\uff0c\u9019\u662f Azure \u9810\u8a2d\u7684\u80fd\u529b</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q4-default-outbound-access-ip","title":"Q4: \u6211\u662f\u4e0d\u662f\u53ef\u4ee5\u4e00\u76f4\u7528 Default outbound access IP \u4f86\u9023\u7dda?","text":"<p>A4: \u4e0d\u4fdd\u8b49\uff0c\u56e0\u4e26\u975e\u6b63\u5f0f\u670d\u52d9\uff0c\u5efa\u8b70\u639b\u8f09 Azure Public IP \u4f86\u9023\u7dda</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q5-public-ip-vm-internet","title":"Q5: \u70ba\u5565\u6211\u6c92\u6307\u6d3e\u4efb\u4f55 Public IP \u7684 VM \u53ef\u4ee5\u9023\u5230 Internet \u53bb\u66f4\u65b0\u7cfb\u7d71?","text":"<p>A5: \u56e0\u9810\u8a2d\u72c0\u6cc1\u4e0b\u6709 Default outbound access IP \u7684\u5b58\u5728\uff0c\u548c NSG \u9810\u8a2d\u898f\u5247 <code>65001 AllowInternetOutbound</code> \u7684\u5b58\u5728\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u9023\u5230 Internet \u53bb\u66f4\u65b0\u7cfb\u7d71</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q6-default-outbound-access-ip","title":"Q6: \u90a3\u6211\u53ef\u4ee5\u7528 Default outbound access IP \u9023\u7dda\u9032\u4f86\u55ce?","text":"<p>A6: \u4e0d\u884c\uff0c\u6c92\u6709\u7d66 Inbound Traffic \u80fd\u529b\uff0cPing \u4e0d\u5230\uff0c\u9023\u4e0d\u9032\u4f86</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#q7-tldr","title":"Q7: TL;DR \u7d66\u6211\u4e00\u53e5\u8a71","text":"<p>A7: NSG \u8981\u7528\uff0c\u7528\u4e86\u5e73\u5b89\uff0cIP \u5f8c\u4e0a\uff0c\u4e0a\u73ed\u9806\u9042</p>","tags":["azure","networking","vm"]},{"location":"20230209-azure-vm-outbound-methods.html#references","title":"References","text":"<ul> <li>Toni Pasanen - Azure Networking Fundamentals: Internet Access with VM-Specific Public IP</li> <li>When is default outbound access provided?</li> <li>Use Source Network Address Translation (SNAT) for outbound connections</li> <li>Azure Public IP - SKU</li> <li>Scale Azure Firewall SNAT ports with NAT Gateway for large workloads</li> <li>Tutorial: Integrate a NAT gateway with a public load balancer using the Azure portal</li> <li>Tutorial: Integrate a NAT gateway with an internal load balancer using the Azure portal</li> </ul>","tags":["azure","networking","vm"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html","title":"\u770b OpenAI \u4f7f\u7528\u9214\u80fd\u529b\u62db\u559a Kubernetes 7500 \u53f0\u7bc0\u9ede!!!","text":"Quote <p>\u5f9e 2018 \u8d77\uff0cOpenAI \u6240\u63a1\u7528\u7684 Kubernetes \u7bc0\u9ede\u6578\u91cf\u65bc 3 \u5e74\u5167\u6210\u9577 300%</p> <ul> <li>2017 Kubernetes Case Study - OpenAI</li> <li>2018/01/18 OpenAI \u767c\u5e03 Scaling Kubernetes to 2500 Nodes</li> <li>2021/01/18 OpenAI \u767c\u5e03 Scaling Kubernetes to 7500 Nodes</li> </ul>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#_1","title":"\u524d\u8a00","text":"<p>OpenAI \u65bc 2021 \u5e74\u7684\u6642\u5019\u5df2\u7d93\u4f86\u5230 7,500 \u7bc0\u9ede\u6578\u91cf\u898f\u6a21\u4e86\uff0c\u66f4\u4f55\u6cc1\u73fe\u5728 2023 \u5e74\u6709\u8d85\u5feb\u901f\u3001\u66f4\u8a87\u5f35\u7684\u5168\u7403\u7e3d\u9ad4\u4f7f\u7528\u91cf\uff0c\u6839\u672c\u662f HPC/AI/ML on Kubernetes \u65bc\u4e00\u8eab\u6700\u4f73\u67b6\u69cb\u5178\u7bc4\uff0c\u5982\u679c\u4f60\u5c0d\u9019\u7a2e\u8d85\u5927\u898f\u6a21\u7684 Kubernetes \u6709\u8208\u8da3\u7684\u8a71\uff0c\u52d9\u5fc5\u8981\u628a\u4e0a\u9762\u7684\u6587\u7ae0\u90fd\u770b\u904e\u597d\u5e7e\u904d\uff0c\u53ef\u4ee5\u907f\u514d\u8e29\u5230\u5730\u96f7\uff0c\u7562\u7adf...\u90a3\u4e9b\u90fd\u662f OpenAI \u7528\u9214\u80fd\u529b\u63db\u4f86\u7684\u8840\u6dda\u7d93\u9a57\u554a...</p> <p>\u96d6\u7136\u6c92\u6709\u7279\u5225\u63d0\u53ca\uff0c\u4f46\u5c31\u6587\u7ae0\u88e1\u9762\u63cf\u8ff0\u7684\u5167\u5bb9\uff0c\u61c9\u8a72\u662f\u7528 Azure Kubernetes Service (with Azure CNI) \u4f5c\u70ba\u57fa\u5e95\uff0c\u4e0b\u9762\u6703\u6709\u4e00\u500b\u7ae0\u7bc0\u5c08\u9580\u8b1b Azure Kubernetes Service \u7684\u95dc\u9375\u8cc7\u8a0a\uff0c\u6559\u5927\u5bb6\u600e\u9ebc\u7b97 Pod / Node / Subnet \u6578\u91cf\u5927\u5c0f</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#tldr-openai-kubernetes-3","title":"TL;DR: OpenAI \u63a1\u7528 Kubernetes \u4e3b\u8981 3 \u5927\u6548\u76ca","text":"<ol> <li>\u6613\u642c\u9077 (Portability): \u57fa\u65bc\u57fa\u790e\u67b6\u69cb\u5373\u4ee3\u78bc (Infrastructure as Code, IaC)\u3001Kubernetes \u4e00\u81f4\u7684\u4e14\u8072\u660e\u5f0f API (Consistent &amp; Declarative API)\u3001\u5bb9\u5668\u6620\u50cf\u6a94\u4e0d\u53ef\u8b8a\u52d5\u6027 (Container Immutable Image) 3 \u500b\u7279\u6027\uff0c\u8b93\u4f60\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u96f2\u7aef\u5e73\u53f0\u4e0a\u904b\u884c\u4f60\u7684\u96f2\u539f\u751f\u7a0b\u5f0f</li> <li>\u7701\u6210\u672c (Cost Savings): \u5728\u4e0d\u540c\u958b\u767c\u60c5\u5883\u7684\u6642\u5019\uff0c\u53ef\u4ee5\u5bb9\u6613\u79fb\u52d5\u4f60\u7684\u8cc7\u6e90\uff0c\u4f8b\u5982\uff1a\u5728\u958b\u767c\u968e\u6bb5\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7684 Kubernetes \u74b0\u5883\uff0c\u5982 minikube, kind, kubeadm, Docker Desktop \u7b49\uff0c\u800c\u5728\u751f\u7522\u968e\u6bb5\u5247\u53ef\u4ee5\u4f7f\u7528\u5927\u898f\u6a21\u4e14\u53d7\u652f\u63f4\u7684 Kubernetes \u74b0\u5883\uff0c\u5982 Azure Kubernetes Service \u7b49\uff0c\u548c Kubernetes Cluster Autoscaler (CA) \u81ea\u52d5\u8abf\u6574\u96c6\u7fa4\u5927\u5c0f\uff0e\u900f\u904e\u5f48\u6027\u9078\u64c7\u9069\u7576\u7684\u74b0\u5883\uff0c\u964d\u4f4e\u6574\u9ad4\u6210\u672c\uff0c\u63d0\u5347\u5229\u7528\u7387\uff0c\u7372\u5f97\u66f4\u591a\u786c\u9ad4\u8a08\u7b97\u8cc7\u6e90</li> <li>\u589e\u6548\u7387 (Improved Efficiency): \u4e00\u540d\u958b\u767c\u5206\u6563\u5f0f\u7cfb\u7d71\u7cfb\u7d71\u7684\u7814\u7a76\u54e1\uff0c\u53ef\u4ee5\u5728 2 ~ 3 \u5929\u5167\u8b93\u4ed6\u7684\u7a0b\u5f0f\u6b63\u78ba\u7684\u904b\u884c\uff0c1 ~ 2 \u9031\u5f8c\u5c31\u53ef\u4ee5\u64f4\u5f35\u5230\u597d\u5e7e\u767e\u500b GPU \u7bc0\u9ede\uff0c\u76f8\u8f03\u65bc\u4ee5\u524d\u5247\u662f\u9700\u8981\u4ee5\u6708\u70ba\u55ae\u4f4d\u7684\u5de5\u4f5c\u6642\u9593\uff0c\u4fdd\u6301\u958b\u767c\u5feb\u901f\u8fed\u4ee3\u7684\u6548\u76ca</li> </ol>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#openai-2500","title":"\u770b OpenAI \u4f7f\u7528\u9214\u80fd\u529b: 2,500 \u7bc0\u9ede\u898f\u6a21","text":"<p>\u57fa\u65bc Scaling Kubernetes to 2500 Nodes\uff0c\u5efa\u8b70\u53ef\u4ee5\u53c3\u8003 Evan Lin - Scaling Kubernetes to 2,500 Nodes \u7684\u6587\u7ae0\u6574\u7406</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#openai-7500","title":"\u770b OpenAI \u4f7f\u7528\u9214\u80fd\u529b: 7,500 \u7bc0\u9ede\u898f\u6a21","text":"<p>\u4e0b\u9762\u7531\u6211\u500b\u4eba\u57fa\u65bc Scaling Kubernetes to 7500 Nodes \u7684\u6587\u7ae0\u6574\u7406\u4e86\u4e0b\u5217\u53ef\u4ee5\u53c3\u8003\u7684\u5b78\u7fd2\u9ede\uff0c\u53e6\u5916\u8072\u660e\uff0c\u9019\u4e0d\u662f\u7528 ChatGPT \u5e6b\u6211\u6574\u7406\u7684</p> <ul> <li> <p>\u8a08\u7b97\u76f8\u95dc</p> <ul> <li>\u904b\u884c MPI Jobs: \u4ee5 MPI \u4f5c\u70ba\u8abf\u5ea6\u57fa\u790e\uff0c\u800c\u975e\u5927\u91cf\u5229\u7528 Kubernetes \u5167\u5efa\u4e4b Scheduler</li> <li>\u6700\u5e38\u898b\u932f\u8aa4\u70ba Uncorrectable ECC error</li> </ul> </li> <li> <p>GPU \u76f8\u95dc</p> <ul> <li>GPU \u9593\u901a\u8a0a\u5f37\u5316: \u5229\u7528 NVIDIA NVlink \u4ea4\u53c9\u901a\u8a0a\u548c GPUDirect RDMA \u8207 NIC \u76f4\u63a5\u901a\u8a0a\u4f7f\u6574\u9ad4\u7cfb\u7d71\u8f38\u9001\u91cf\u6975\u5927\u5316</li> <li>\u591a\u6578 1 \u500b\u7bc0\u9ede\u653e 1 \u500b Pod: \u56e0 CPU / NUMA / PCI-E / Physical Server / Bandwidth \u4e26\u975e\u8abf\u5ea6\u8cc7\u6e90\u7684\u4e3b\u56e0\uff0c\u8abf\u5ea6\u58d3\u529b\u6975\u4f4e\uff0c\u4e3b\u8981\u662f GPU \u8cc7\u6e90</li> </ul> </li> <li> <p>\u7db2\u8def\u76f8\u95dc</p> <ul> <li>\u7c21\u5316\u7db2\u8def\u8907\u96dc\u6027: Pod \u53ef\u4ee5\u76f4\u63a5\u900f\u904e SSH \u9023\u7dda\u5230 Pod IP \u9032\u884c\u9023\u7dda\uff0c\u800c\u975e Service Endpoint</li> <li>Flannel CNI \u5728\u5927\u898f\u6a21\u4e0a\u4f7f\u7528\u6703\u6709 Throughput \u554f\u984c</li> <li>\u5927\u91cf\u63a1\u7528 iptables mangle \u898f\u5247: \u5c0d\u6d41\u91cf\u65b9\u5411\u9032\u884c\u6a19\u8a18\uff0c\u4ee5\u4fbf\u9032\u884c\u6d41\u91cf\u63a7\u5236\uff0c\u800c\u975e\u63a1\u7528\u4e00\u689d\u4e00\u689d\u8def\u7531\u898f\u5247\u7ba1\u7406</li> <li>\u63a1\u7528 Prometheus \u7684 iptables-exporter \u4f5c\u70ba\u7db2\u8def\u6d41\u91cf\u8ffd\u8e64\u57fa\u790e</li> <li>\u63a1\u7528 Hub and Spoke \u7db2\u8def\u67b6\u69cb: \u7814\u7a76\u4eba\u54e1\u53ef\u4ee5\u5f9e Hub \u670d\u52d9\u8a2a\u554f\u5230\u4efb\u4f55 Spoke \u7684\u670d\u52d9\uff0c\u5982 AKS \u7b49\uff0c\u4f46\u4efb\u610f 2 \u500b Spoke \u88e1\u7684 AKS \u670d\u52d9\u5247\u56e0 Azure Virtual Network \u539f\u751f\u4e0d\u5177\u5099\u8de8 VNet Transit \u80fd\u529b\uff0c\u5247\u7121\u6cd5\u4e92\u76f8\u9023\u63a5\uff0c\u4fdd\u6301\u6545\u969c\u9694\u96e2\u539f\u5247 (Break Failure Isolation)</li> <li>\u63a1\u7528\u81ea\u5efa NAT \u670d\u52d9\u8655\u7406 inbound DNAT \u6d41\u91cf</li> <li>\u500b\u5225 Pod \u7db2\u8def\u6d41\u91cf\u52a0\u7e3d\u8d77\u4f86\u76f8\u7576\u9a5a\u4eba</li> </ul> </li> <li> <p>\u5132\u5b58\u76f8\u95dc</p> <ul> <li>\u63a1\u7528 Azure Blob Storage \u4f5c\u70ba\u4e3b\u8981\u5132\u5b58\u7cfb\u7d71: \u56e0\u70ba Azure Blob Storage \u6613\u65bc\u64f4\u5c55\uff0c\u4e14\u4e0d\u9700\u8981 slow detach/attach \u7684\u984d\u5916\u64cd\u4f5c</li> </ul> </li> <li> <p>Kubernetes \u76f8\u95dc</p> <ul> <li>\u7121\u9032\u884c\u904e etcd self-healing automation\uff0c\u6700\u5927\u7684\u96c6\u7fa4\u55ae\u7368\u904b\u884c 5 \u500b API Server \u548c 5 \u500b etcd \u7bc0\u9ede</li> <li>\u7bc0\u9ede\u6578\u91cf\u591a\uff0c\u5c0e\u81f4 API Server \u8a18\u61b6\u9ad4\u5403\u91cd: \u57fa\u65bc 7500 \u53f0\u7bc0\u9ede\u96c6\u7fa4\uff0c\u6bcf\u500b API Servers \u9700\u8981 70GB \u7684\u8a18\u61b6\u9ad4</li> <li>API Server \u58d3\u529b\u6700\u5927\u4f86\u6e90\u662f Endpoints \u4e0a\u7684 WATCH</li> <li>Cluster Autoscaler \u60c5\u5883\u6e1b\u5c11\uff0c\u56e0\u70ba\u96c6\u7fa4\u5df2\u7d93\u5f88\u5927\u4e86</li> <li>\u91dd\u5c0d\u5718\u968a\u8cc7\u6e90\u5206\u914d\u5be6\u505a team-resource-manager</li> <li>\u63a1\u7528 CPU &amp; GPU Balloons \u8b93 Cluster Autoscaler \u4e0d\u6703\u8a8d\u70ba\u7bc0\u9ede\u9592\u7f6e\u800c\u9032\u884c\u79fb\u9664\uff0c\u907f\u514d\u7522\u751f\u4e0d\u5fc5\u8981\u7684\u8abf\u5ea6\u58d3\u529b</li> <li>\u63a1\u7528 Pod Anti-affinity \u78ba\u4fdd Pod \u6700\u7d42\u6703\u88ab\u5e73\u5747\u5730\u5206\u4f48\u5230\u5404\u500b\u7bc0\u9ede\u4e0a</li> <li>\u63a1\u7528 Coscheduling \u6279\u6b21\u8655\u7406\uff0c\u907f\u514d all or nothing \u7684\u60c5\u6cc1</li> </ul> </li> <li> <p>Monitoring \u76f8\u95dc</p> <ul> <li>\u63a1\u7528 Promeheus \u548c Grafana \u4f5c\u70ba\u76e3\u63a7\u7cfb\u7d71</li> <li>\u63a1\u7528 kube-prometheus: \u5c0d\u65bc HTTP 429 (Too Many Requests) \u548c 5XX (Server Error) \u767c\u9001\u8b66\u5831\u76f8\u7576\u6709\u6548\u679c</li> <li>\u63a1\u7528 Prometheus relabel \u529f\u80fd\uff0c\u907f\u514d\u6536\u96c6\u5230\u4e0d\u5fc5\u8981\u7684 Metrics\uff0c\u964d\u4f4e\u58d3\u529b</li> <li>\u63a1\u7528 GOMAXPROCS=24 \u6e1b\u7de9 WAL (Write-Ahead Log) \u91cd\u65b0\u57f7\u884c\u6b21\u6578</li> <li>\u63a1\u7528 dcgm-exporter\uff0c\u8a2d\u5b9a DCGM_FI_DEV_XID_ERRORS\uff0c\u6293\u53d6 XID Errors\uff0c\u4e26\u767c\u9001\u8b66\u5831</li> <li>\u63a1\u7528 NVMLDevice Query API: \u63d0\u4f9b\u6709\u95dc GPU \u7684\u5065\u5eb7\u60c5\u6cc1\u548c\u64cd\u4f5c\u7684\u66f4\u8a73\u7d30\u4fe1\u606f</li> <li>\u4e26\u975e\u6240\u6709 GPU \u932f\u8aa4\u90fd\u53ef\u4ee5\u5f9e DCGM \u770b\u5230 Error Code</li> <li>Promtheus \u81ea\u5e36\u7684 TSDB (Time Series Database) \u4e26\u975e\u6700\u4f73\u9078\u64c7\uff0c\u901f\u5ea6\u5f88\u6162\uff0c\u91cd\u555f\u9700\u8981\u5f88\u9577\u6642\u9593\u91cd\u65b0\u57f7\u884c WAL</li> </ul> </li> </ul>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#_2","title":"\u500b\u4eba\u89c0\u9ede","text":"<ol> <li>\u6beb\u7121\u7591\u554f Kubernetes \u67b6\u69cb\u8a2d\u8a08\u7684\u78ba\u9069\u5408\u505a\u70ba\u5927\u898f\u6a21\u8a08\u7b97\u9700\u6c42\u7684\u57fa\u790e\u5e73\u53f0</li> <li>\u63a1\u7528 Kubernetes \u4f9d\u7136\u6703\u9700\u8981\u8655\u7406\u4e0d\u5c11\u6280\u8853\u554f\u984c\uff0c\u5982\u7db2\u8def\u3001\u76e3\u63a7\u3001\u8cc7\u6e90\u8abf\u5ea6\u7b49\uff0c\u4e26\u4e0d\u662f\u539f\u751f\u8a2d\u8a08\u5c31\u80fd\u89e3\u6c7a\u6240\u6709\u554f\u984c</li> <li>\u9664\u7279\u5b9a\u7522\u696d\u4ee5\u5916\uff0c\u53f0\u7063\u5927\u591a\u6578\u4f01\u696d\u55ae\u5ea7 Kubernetes \u591a\u534a\u90fd\u662f\u4f4e\u65bc 25 \u53f0\u7bc0\u9ede\u9019\u500b\u6578\u91cf\u7d1a\u8ddd\uff0c\u82e5\u662f\u6709\u9078\u64c7\u7279\u5b9a\u5ee0\u5546\u652f\u63f4\u7684 Kubernetes \u591a\u534a\u4e0d\u592a\u6703\u9047\u5230\u4e0a\u9762\u7684\u554f\u984c\uff0c\u5982\u679c\u64d4\u5fc3\u4f30\u7b97\u4e0d\u5920\u7684\u8a71\uff0c\u500b\u4eba\u5efa\u8b70 Control Plane \u7684\u7bc0\u9ede\u5927\u5c0f\u8a08\u7b97\u53ef\u4ee5\u4ee5 100 \u53f0\u7bc0\u9ede\u627f\u8f09\u91cf\u505a\u70ba\u57fa\u6e96\uff0c\u4e0d\u7528\u4ee5 7,500 \u9019\u500b\u898f\u6a21\u7576\u4f5c\u57fa\u790e\u53c3\u8003</li> <li>Control Plane \u9867\u5f97\u597d\uff0c\u665a\u4e0a\u7761\u89ba\u7761\u5f97\u8457</li> <li>\u9019\u6587\u7ae0\u6c92\u7279\u5225\u8b1b Underlay Networking \u8a2d\u8a08\uff0c\u57fa\u65bc\u5df2\u77e5 Azure \u6a5f\u623f\u7db2\u8def\u898f\u5283\u61c9\u8a72\u6703\u662f\u4ee5 Spine-Leaf Topology \u70ba\u8a2d\u8a08\u57fa\u790e\uff0c\u4f46\u5177\u9ad4 Switch \u662f\u7528\u4ec0\u9ebc\u5c31\u4e0d\u77e5\u9053\u4e86\uff0c\u4e3b\u8981\u539f\u56e0\u662f\u56e0\u70ba GPUDirect RDMA \u9700\u8981 Switch \u652f\u63f4\u80fd\u529b</li> <li>\u6279\u6b21\u8a08\u7b97\u8655\u7406\u53ca\u8cc7\u6e90\u5206\u914d\u652a\u548c\u5728\u4e00\u8d77\uff0c\u662f\u4e00\u500b\u5f88\u91cd\u8981\u7684\u7814\u7a76\u8b70\u984c</li> </ol>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#azure-kubernetes-sevices","title":"Azure Kubernetes Sevices \u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u95dc\u9375\u8cc7\u8a0a","text":"Info <p>2023/02/14 \u66f4\u65b0</p> <p>\u57fa\u65bc Quotas, virtual machine size restrictions, and region availability in Azure Kubernetes Service (AKS) \u63d0\u4f9b\u95dc\u9375\u8cc7\u8a0a\u5982\u4e0b:</p> <p>\u4ee5\u63a1\u7528 Azure Standard Load Balancer \u53ca Standard Tier \u70ba\u4e3b,</p> Resource Limit \u65bc\u55ae\u4e00\u96c6\u7fa4\u5167\u4e4b\u6700\u5927\u7bc0\u9ede\u6578 \u4e0a\u9650 5000 \u53f0\u7bc0\u9ede\uff0c\u7cfb\u7d71\u9810\u8a2d 1000 \u53f0\u7bc0\u9ede \u65bc\u55ae\u4e00\u7bc0\u9ede\u5167\u4e4b\u6700\u5927 Pod \u6578 \uff08CNI \u63a1\u7528 kubenet) \u6700\u5927 250 \u500b\uff0c\u7cfb\u7d71\u9810\u8a2d 110 \u500b \u65bc\u55ae\u4e00\u7bc0\u9ede\u5167\u4e4b\u6700\u5927 Pod \u6578 \uff08CNI \u63a1\u7528 Azure CNI) \u6700\u5927 250 \u500b\uff0c\u7cfb\u7d71\u9810\u8a2d 30 \u500b","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#pod","title":"\u95dc\u65bc\u6700\u5927 Pod \u6578\u91cf","text":"<p>\u57fa\u65bc\u4e0a\u9762\u6578\u64da\u53ef\u4ee5\u63db\u7b97\u51fa \u55ae\u4e00 AKS \u96c6\u7fa4\u53d7\u652f\u63f4\u7684\u72c0\u6cc1\u4e0b\uff0c\u6700\u591a\u7684 Pod \u6578\u70ba 1,250,000 Pods \uff08= 5000 \u500b\u7bc0\u9ede * 250 \u500b Pod)\uff0c\u4f46\u9019\u500b\u6578\u5b57\u662f\u4f30\u7b97\u503c\uff0c\u56e0\u70ba\u5be6\u969b\u53ef\u7528 Pod \u6578\u91cf\u6703\u53d7\u5230\u5be6\u969b\u8a08\u7b97\u8cc7\u6e90\u5206\u914d\u3001Kubernetes Deployment \u64b0\u5beb\u65b9\u5f0f\u7b49\u56e0\u7d20\u5f71\u97ff</p> <p>\u5be6\u52d9\u4e0a\uff0c\u55ae\u4e00\u7bc0\u9ede\u4e0a Pod \u6578\u91cf\u8a2d\u8d85\u5927\uff0c\u8001\u5be6\u8aaa\u6c92\u4ec0\u9ebc\u7279\u5225\u7528\u8655\uff0c\u53ef\u80fd\u4e00\u5169\u500b Pod \u5c31\u628a\u6574\u500b\u7bc0\u9ede\u8cc7\u6e90\u5403\u5b8c\u4e86\uff0c\u770b\u770b OpenAI \u7684\u7528\u6cd5\u4e5f\u662f\u4e00\u6a23\uff0c1 \u500b\u7bc0\u9ede 1 \u500b Pod\uff0c\u56e0\u70ba\u95dc\u9375\u74f6\u9838\u5728\u65bc GPU \u8cc7\u6e90\uff0c\u5982\u679c\u4f60\u60f3\u8981\u7cbe\u7b97\u7684\u8a71\uff0c\u5efa\u8b70\u53ef\u53c3\u8003\u4e4b\u524d\u7684\u6587\u7ae0 \u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7 \u9032\u884c\u7cbe\u7d30\u8a08\u7b97</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#azure-subnet","title":"\u95dc\u65bc Azure Subnet \u8a08\u7b97","text":"<p>Kubernetes \u8a2d\u8a08\u6700\u9ebb\u7169\u7684\u5c31\u662f\u7db2\u8def\u898f\u5283\uff0c\u56e0\u70ba\u5b83\u662f\u90e8\u7f72\u5f8c\u4e0d\u80fd\u6539\u7684\u53c3\u6578\uff0c\u6240\u4ee5\u5728\u90e8\u7f72\u4e4b\u524d\u4e00\u5b9a\u8981\u5148\u7b97\u597d\uff0c\u907f\u514d\u5f8c\u7e8c\u64f4\u5145\u6709\u554f\u984c\uff0e\u800c\u63a1\u7528\u4e0d\u540c Kubernetes CNI \u6703\u5f71\u97ff\u5230 Subnet \u8a08\u7b97\uff0c\u4e0b\u9762\u4ee5\u73fe\u884c AKS \u652f\u63f4\u7684 2 \u7a2e CNI \u4f86\u505a\u8a08\u7b97\uff1a</p> <ol> <li>\u63a1\u7528 kubenet CNI</li> <li>\u63a1\u7528 Azure CNI</li> </ol> <p>\u82e5\u4f60\u5c0d\u65bc\u5169\u8005 CNI \u6709\u8208\u8da3\u6bd4\u8f03\u7684\u8a71\uff0c\u53ef\u4ee5\u53c3\u8003\u6b64\u6587 AKS - \u6bd4\u8f03\u7db2\u8def\u6a21\u578b\uff0c\u9019\u908a\u4e0d\u518d\u8d05\u8ff0</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#kubenet-cni","title":"\u63a1\u7528 kubenet CNI","text":"Note <p>\u82e5\u63a1\u7528 kubenet CNI \u7684\u8a71\uff0cPod \u4e0d\u652f\u63f4\u76f4\u63a5\u5f9e Azure Subnet \u62ff\u5230 IP\uff0c\u4e2d\u9593\u6703\u904e iptables \u9032\u884c SNAT \u8f49\u63db</p> <p>\u57fa\u65bc Use kubenet networking with your own IP address ranges in Azure Kubernetes Service (AKS)  - IP address availability and exhaustion \u6587\u4ef6\uff0c\u56e0\u70ba\u9032\u884c AKS \u5347\u7d1a\u7684\u6642\u5019\uff0c\u6703\u63a1\u7528\u5148\u5efa\u5f8c\u62c6\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u9810\u7559\u4e00\u500b\u7bc0\u9ede\u7684 IP \u7a7a\u9593\u4f9b\u4f7f\u7528\uff0c\u6240\u4ee5\u6b63\u78ba\u7684\u7bc0\u9ede\u8a08\u7b97\u57fa\u790e\u6703\u662f <code>No. of Nodes + 1</code></p> <p>\u4e0b\u5217\u63d0\u4f9b\u8a08\u7b97\u516c\u5f0f</p> <p>Minimum Subnet Size = Node IP = No. of Nodes + 1</p> <p>\u8a66\u7b97 1\uff1a\u4e00\u5ea7\u5177\u5099 50 \u500b\u7bc0\u9ede\u7684 AKS \u63a1\u7528 kubenet CNI</p> <p>\u6700\u5c0f\u53ef\u7528 IP \u9700\u6c42\u70ba 51 \u500b = (50 \u500b\u7bc0\u9ede + 1) \u57fa\u65bc Visual Subnet Calculator (Azure Edition)\uff0c\u53ef\u4ee5\u8a08\u7b97\u51fa\u6700\u5c0f Subnet \u70ba /26\uff0c\u7db2\u6bb5\u53ef\u7528 IP \u6578\u91cf\u70ba 59 \u500b\uff0c\u8a72\u6578\u5b57\u5927\u65bc\u9700\u6c42 51</p> <p>\u8a66\u7b97 2: \u4e00\u5ea7\u5177\u5099 5,000 \u500b\u7bc0\u9ede\u7684 AKS \u63a1\u7528 kubenet CNI</p> <p>\u6700\u5c0f\u53ef\u7528 IP \u9700\u6c42\u70ba 5,000 \u500b = (4999 \u500b\u7bc0\u9ede + 1) \u57fa\u65bc Visual Subnet Calculator (Azure Edition)\uff0c\u53ef\u4ee5\u8a08\u7b97\u51fa\u6700\u5c0f Subnet \u70ba /19\uff0c\u7db2\u6bb5\u53ef\u7528 IP \u6578\u91cf\u70ba 8,187 \u500b\uff0c\u8a72\u6578\u5b57\u5927\u65bc\u9700\u6c42 5,000</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#azure-cni","title":"\u63a1\u7528 Azure CNI","text":"Note <p>\u82e5\u63a1\u7528 Azure CNI \u7684\u8a71\uff0c\u6bcf\u4e00\u500b Pod \u90fd\u80fd\u62ff\u5230 Azure Subnet \u5206\u914d\u5230\u7684 IP\uff0c\u8207\u5176\u5b83 Pod \u9032\u884c\u6e9d\u901a\u6642\u4e0d\u6703\u6709\u984d\u5916\u7684 SNAT \u8f49\u63db\u6210\u672c</p> <p>\u57fa\u65bc Configure Azure CNI networking in Azure Kubernetes Service (AKS) - Plan IP addressing for your cluster \u6587\u4ef6\uff0c\u56e0\u70ba\u9032\u884c AKS \u5347\u7d1a\u7684\u6642\u5019\uff0c\u6703\u63a1\u7528\u5148\u5efa\u5f8c\u62c6\u7684\u65b9\u5f0f\uff0c\u6240\u4ee5\u9700\u8981\u9810\u7559\u4e00\u500b\u7bc0\u9ede\u7684 IP \u7a7a\u9593\u4f9b\u4f7f\u7528\uff0c\u6240\u4ee5\u6b63\u78ba\u7684\u7bc0\u9ede\u8a08\u7b97\u57fa\u790e\u6703\u662f <code>No. of Nodes + 1</code></p> <p>\u6545\u4e0b\u5217\u63d0\u4f9b\u4e00\u500b\u5408\u7406\u7684\u8a08\u7b97\u516c\u5f0f</p> <p>Minimum Subnet Size = Node IP + Pod IP = (No. of Nodes + 1) + ((No. of Nodes + 1) * Maximum pods per nodes that you can configure)</p> <p>\u8a66\u7b97 1\uff1a\u4e00\u5ea7\u5177\u5099 50 \u500b\u7bc0\u9ede\u7684 AKS \u63a1\u7528 Azure CNI</p> <p>\u6700\u5c0f\u53ef\u7528 IP \u9700\u6c42\u70ba 12,801 \u500b = (50 \u500b\u7bc0\u9ede + 1) + ((50 \u500b\u7bc0\u9ede + 1) * 250 Pods) \u57fa\u65bc Visual Subnet Calculator (Azure Edition)\uff0c\u53ef\u4ee5\u8a08\u7b97\u51fa\u6700\u5c0f Subnet \u70ba /18\uff0c\u7db2\u6bb5\u53ef\u7528 IP \u6578\u91cf\u70ba 16379 \u500b\uff0c\u8a72\u6578\u5b57\u5927\u65bc\u9700\u6c42 12,801</p> <p>\u8a66\u7b97 2: \u4e00\u5ea7\u5177\u5099 5000 \u500b\u7bc0\u9ede\u7684 AKS \u63a1\u7528 Azure CNI</p> <p>\u6700\u5c0f\u53ef\u7528 IP \u9700\u6c42\u70ba 1,255,000 \u500b = (4999 \u500b\u7bc0\u9ede + 1) + ((4999 \u500b\u7bc0\u9ede + 1) * 250 Pods) \u57fa\u65bc Visual Subnet Calculator (Azure Edition)\uff0c\u53ef\u4ee5\u8a08\u7b97\u51fa\u6700\u5c0f Subnet \u70ba /11\uff0c\u7db2\u6bb5\u53ef\u7528 IP \u6578\u91cf\u70ba 2,097,147 \u500b\uff0c\u8a72\u6578\u5b57\u5927\u65bc\u9700\u6c42 1,255,000</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#azure-vm","title":"\u95dc\u65bc Azure VM \u5927\u5c0f","text":"<ul> <li>Azure VM \u5927\u5c0f\u4e0d\u80fd\u4f4e\u65bc 2 vCPU\uff0c\u4f4e\u65bc\u7684\u8a71\u6703\u4e0d\u80fd\u6b63\u5e38\u904b\u4f5c\uff0c\u8a73\u7d30 Azure Siez \u53ef\u53c3\u8003 Azure Virtual Machines sizes</li> <li>Container Images \u5927\u5c0f\u6703\u5f71\u97ff\u5230 Kubernetes Node \u7684\u5927\u5c0f\uff0c\u7576\u6709\u904e\u5927\u7684 Container Images\uff0ckubelet \u6703\u56e0\u70ba\u6c92\u6709\u8db3\u5920\u7684\u786c\u789f\u7a7a\u9593\u800c\u7121\u6cd5\u6b63\u5e38\u904b\u4f5c\uff0c\u9019\u500b\u5728\u8dd1 AI \u6a21\u7d44\u5be6\u9a57\u7684\u6642\u5019\u6703\u6bd4\u8f03\u5e38\u9047\u5230\uff0c\u56e0\u70ba AI \u6a21\u7d44\u7684\u5bb9\u5668\u6620\u50cf\u6a94\u901a\u5e38\u90fd\u6703\u5f88\u5927\uff0c\u53ef\u53c3\u8003 NVIDIA NGC Container Catalog \u6240\u63d0\u4f9b\u7684\u5bb9\u5668\u6620\u50cf\u6a94\u5927\u5c0f</li> </ul>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#_3","title":"\u7e3d\u7d50","text":"<p>\u6709\u4e9b\u4e8b\u60c5\u53ea\u80fd\u64c1\u6709\u9214\u80fd\u529b\u624d\u6703\u77e5\u9053</p>","tags":["kubernetes","openai"]},{"location":"20230214-openai-scaling-kubernetes-to-7500-nodes.html#_4","title":"\u611f\u8b1d\u6821\u7a3f","text":"<ul> <li>@hwchiu</li> <li>@Evan Lin</li> </ul>","tags":["kubernetes","openai"]},{"location":"20230301-iac-personal-experiences.html","title":"\u9078\u64c7 IaC \u5de5\u5177\u662f\u591a\u9078\u984c\uff0c\u800c\u4e0d\u662f\u55ae\u9078\u984c","text":"","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#_1","title":"\u524d\u8a00","text":"<p>\u5f88\u591a\u670b\u53cb\u8b1b\u5230 Infrastructure as Code (IaC) \u7684\u6642\u5019\u591a\u534a\u90fd\u6703\u76f4\u63a5\u843d\u5728\u55ae\u4e00\u5de5\u5177\u9078\u64c7\u7684\u8a0e\u8ad6\uff0c\u60f3\u8981\u7aae\u8209\u51fa\u6700\u7d42\u9078\u64c7\uff0c\u4f46\u96a8\u8457\u6642\u9593\u4e45\u4e86\u6211\u89ba\u5f97\u9019\u500b\u8b70\u984c\u61c9\u8a72\u8981\u4ee5\u5171\u751f\u5171\u69ae\u7684\u89d2\u5ea6\u770b\u5f85\u6bd4\u8f03\u597d</p> <p>\u65e9\u671f\u7684\u6642\u5019\u90fd\u662f Shell Script \u7576\u9053\u5c45\u591a\uff0c\u76f4\u81f3 2012 \u5e74\u5de6\u53f3 Ansible (2015 \u5e74\u88ab Red Hat \u6536\u8cfc)\u3001Puppet (2022 \u5e74\u88ab Perforce \u6536\u8cfc)\u3001Chef (2020 \u5e74\u88ab Progress \u6536\u8cfc)\u3001Saltstack (2020 \u5e74\u88ab VMware \u6536\u8cfc) \u7b49 4 \u5927\u591a\u6578\u4ee5\u4f5c\u696d\u7cfb\u7d71\u7ba1\u7406\u70ba\u4e3b\u7684\u7d44\u614b\u7ba1\u7406 (Configuration Management) \u8208\u76db\uff0c\u5230\u5404\u5927\u96f2\u5ee0\u5546\u8fc5\u901f\u5d1b\u8d77\u51fa\u73fe Hashicorp Terraform (2021 \u5e74 IPO) \u9019\u985e\u4ee5\u96f2\u5e73\u53f0 (Cloud Provider) \u70ba IaC \u6838\u5fc3\u7684\u5de5\u5177\uff0c\u5177\u9ad4\u4f86\u8b1b\uff0c\u88ab\u7ba1\u7406\u7684\u5e73\u53f0\u4e0d\u540c\uff0c\u9078\u64c7\u7684\u65b9\u5411\u6703\u6709\u9ede\u4e0d\u4e00\u6a23\uff0c\u4e0b\u9762\u6703\u6709\u4e00\u4e9b\u6211\u500b\u4eba\u7684\u7d93\u9a57\u5206\u4eab</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#declarative-imperative","title":"\u5ba3\u544a\u5f0f (Declarative) \u8207\u547d\u4ee4\u5f0f (Imperative)","text":"<p>\u7d55\u5927\u90e8\u5206\u7684 IT \u7ba1\u7406\u4eba\u54e1\u61c9\u8a72\u90fd\u662f\u6bd4\u8f03\u7fd2\u6163\u547d\u4ee4\u5f0f (Imperative) \u7684\u64cd\u4f5c\u65b9\u5f0f\uff0c\u7562\u7adf\u8ab0\u4e0d\u662f\u7528 Bash\u3001CLI \u9577\u5927\u7684\u5462? \u4f46\u96a8\u8457\u670d\u52d9\u8d8a\u4f86\u8d8a\u591a\u548c\u5df2\u77e5\u7684\u8cc7\u6e90\u76f8\u4f9d\u6027\u554f\u984c\uff0c\u5f8c\u4f86\u6f38\u6f38\u5730\u5ba3\u544a\u5f0f (Declarative) \u7ba1\u7406\u6210\u70ba\u4e3b\u6d41\uff0c\u5176\u5be6\u6700\u7d93\u5178\u7684\u6848\u4f8b\u5c31\u662f Kubernetes\uff0c\u4f46\u5176\u5be6\u4f60\u4e0d\u592a\u9700\u8981\u4e86\u89e3\u5230\u9019\u9ebc\u7d30\uff0c\u53cd\u6b63\u90fd\u662f\u8981\u7ba1\u7406\uff0c\u7528\u6700\u6709\u5229\u65bc\u5718\u968a\u7684\u5de5\u5177\uff0c\u9054\u5230\u6700\u7d42\u76ee\u7684\u5c31\u597d</p> \u65b9\u5f0f \u89e3\u91cb \u512a\u9ede \u7f3a\u9ede \u547d\u4ee4\u5f0f (Imperative) \u660e\u78ba\u9673\u8ff0\u70ba\u7522\u751f\u6240\u9700\u7d50\u679c\u6240\u57f7\u884c\u7684\u547d\u4ee4 1. \u5c0d\u65bc\u64cd\u4f5c\u504f\u5411 Step by Step \u6027\u8cea\u7684\u76f8\u7576\u597d\u75282. \u5c0d\u65bc\u4e00\u6b21\u6027\u5de5\u4f5c\u597d\u75283. \u6240\u6709\u7cfb\u7d71\u7ba1\u7406\u7684\u57fa\u672c\u529f 1. \u5e73\u53f0\u5c64\u7d1a\u7684\u76f8\u4f9d\u6027\u8655\u7406\u4e0d\u5f372.\u9700\u8981\u4e00\u5b9a\u7684 Coding \u6280\u80fd\uff0c\u5982 Shell Script\u3001Powershell \u7b49\uff0c\u8655\u7406\u932f\u8aa4\u548c if-else \u5224\u65b73. \u8a2d\u5b9a\u98c4\u79fb\u5f88\u96e3\u4fee\u6b63\uff0c\u591a\u6578\u9700\u8981\u500b\u5225\u8655\u7406 \u5ba3\u544a\u5f0f (Declarative) \u6307\u5b9a\u60f3\u8981\u7684\u7d50\u679c\uff0c\u800c\u4e0d\u662f\u6307\u5b9a\u8981\u5982\u4f55\u5b8c\u6210 1. \u4e0d\u592a\u9700\u8981 Coding \u6280\u80fd\u5373\u53ef\u4f7f\u75282. \u9ad8\u5ea6\u91cd\u8907\u60273. \u5bb9\u6613\u4fee\u6b63\u8a2d\u5b9a\u98c4\u79fb\u554f\u984c 1. \u5c0d\u65bc\u6d41\u7a0b\u63a7\u5236\u8f03\u4e0d\u5f48\u60272. Day 2 Operation \u4e0d\u5f37\uff0c\u8b6c\u5982\u8aaa\u65e2\u6709 OS \u6539 IP","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#azure-red-hat-openshift","title":"\u4f86\u500b\u4f8b\u5b50: \u4ee5\u90e8\u7f72 Azure Red Hat OpenShift","text":"<p>\u56e0\u4eca\u5e74\u4f86 Microsoft Azure \u4e0a\u73ed\uff0c\u914d\u4e0a\u525b\u597d\u4e4b\u524d\u5728 Red Hat \u4e0a\u73ed\u7684\u7d93\u9a57\uff0c\u6211\u4e0b\u9762\u4e3b\u8981\u6703\u4ee5 Azure Red Hat OpenShift \u90e8\u7f72\u7d93\u9a57\u70ba\u4e3b\uff0c\u8a72\u649e\u5230\u7684\u5730\u96f7\u6211\u5168\u90e8\u90fd\u649e\u5230\u4e86\uff0c\u5206\u4eab\u6211\u500b\u4eba\u5728\u9078\u64c7 IaC \u5de5\u5177\u6642\u7684\u4e00\u4e9b\u7d93\u9a57</p> \u5de5\u5177 \u5c6c\u6027 \u8cc7\u6e90\u7ba1\u7406\u65b9\u5f0f \u53ef\u8b80\u6027 \u53ef\u64f4\u5c55\u6027 \u53ef\u7dad\u8b77\u6027 \u7ba1\u7406\u9846\u7c92\u5ea6 \u512a\u9ede \u7f3a\u9ede Azure CLI \u547d\u4ee4\u5f0f (Imperative) Azure Resource Manager \u6307\u4ee4\u76f8\u7576\u76f4\u89ba\uff0c\u4e00\u6b21\u6027\u7684\u64cd\u4f5c\u597d\u7528 Shell Script \u52d5\u4e0d\u52d5\u5c31\u4e00\u767e\u884c\u8d77\u8df3\uff0c\u6709\u8003\u616e\u8b8a\u6578\u3001 if-else \u5224\u65b7\u3001Error Handling \u7684\u8a71\u6703\u66f4\u8907\u96dc Ansible Playbook \u5ba3\u544a\u5f0f (Declarative) Azure Resource Manager \u842c\u7528\u81a0\u8a9e\u8a00 \u9700\u8981\u5148\u900f\u904e Azure CLI \u4e00\u6b65\u4e00\u6b65\u4e86\u89e3\u64cd\u4f5c\u6d41\u7a0b\u624d\u80fd\u5beb\u51fa Ansible Playbook ARM Template \u5ba3\u544a\u5f0f (Declarative) Azure Resource Manager \u4e00\u6b21\u6027\u7684\u64cd\u4f5c\u597d\u7528\uff0c\u53ef\u652f\u63f4 Azure Portal \u4e0a\u5448\u73fe\u9700\u90e8\u7f72\u6b04\u4f4d \u6211\u500b\u4eba\u89ba\u5f97\u96e3\u8b80\u548c\u96e3\u6539 Terraform \u5ba3\u544a\u5f0f (Declarative) Azure Resource Manager \u8cc7\u6e90\u76f8\u4f9d\u6027\u8655\u7406\u5f37\uff0c\u90e8\u7f72 Cloud Provideer \u8cc7\u6e90\u9996\u9078 \u9700\u8981\u77e5\u9053 Terraform HCL \u600e\u9ebc\u5beb\uff0c\u9019\u5c0d\u883b\u591a\u4eba\u662f\u500b\u9580\u6abb\u7684 <p>\u9019\u908a\u91dd\u5c0d\u90e8\u7f72 Private Azure Red Hat OpenShift \u63d0\u4f9b\u53c3\u8003\u7bc4\u4f8b\uff0cpichuang/compare-iac-implementation</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#_2","title":"\u5e73\u53f0\u5206\u6790\u548c\u500b\u4eba\u5de5\u5177\u9078\u64c7\u8868","text":"<p>\u57fa\u65bc\u4e0d\u540c\u5e73\u53f0\u4e4b\u4e0b\uff0c\u4e0b\u9762\u63d0\u4f9b\u6211\u500b\u4eba\u77e5\u9053\uff0c\u4e14\u7528\u904e\u7684 Infrastructure as Code \u7684\u6392\u5217\u7d44\u5408</p> Platform Consistent Management Layer GUI CLI + Ansible CLI Collections Ansible Collections Terraform Provider Python SDK Azure Azure Resource Manager Azure Portal Azure CLI / Azure PowerShell ansible.builtin.shell ansible.azure.azcollection hashicorp/azurerm azure/azure-sdk-for-python VMware vSphere VMware vCenter (vc) VMware vCenter WEB UI govc / VMware PowerCLI ansible.builtin.shell ansible.community.vmware hashicorp/vsphere, \u500b\u4eba\u5c11\u7528 vmware/pyvmomi Kubernetes Kubernetes API Server N/A kubectl ansible.builtin.shell ansible.kubernetes.core hashicorp/kubernetes, \u500b\u4eba\u5c11\u7528 kubernetes-client/python Red Hat OpenShift Kubernetes API Server OpenShift Web Console oc / kubectl ansible.builtin.shell redhat.openshift, \u500b\u4eba\u5c11\u7528 N/A openshift/openshift-client-python VMware vSphere with Tanzu VMware vCenter 7 (vc) + Custer API VMware vCenter kubectl vsphere ansible.builtin.shell N/A N/A N/A VMware Tanzu Kubernetes Grid 1.x Kubernetes API Server + Custer API N/A tanzu / kubectl ansible.builtin.shell N/A N/A N/A Linux N/A X Windows bash ansible.builtin.shell Depends on Linux Distribution N/A Built-in Python Windows N/A Windows Desktop PowerShell ansible.windows.win_command ansible.windows.win_command N/A ansible.windows Cisco 2960 Switch N/A N/A IOS CLI N/A ansible.cisco.ios N/A N/A","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#azure","title":"Azure","text":"<p>Azure Iac \u5c0d\u7b56</p> <p>\u5148 Terraform\uff0c\u5f8c ansible.builtin.shell + Azure CLI</p> <p>\u57fa\u65bc What is Azure Resource Manager? \u6240\u8ff0\uff0cAzure Resource Manger \u63d0\u4f9b\u4e86\u5982\u4e0b\u5716\u6240\u5448\u73fe\u7684\u7d71\u4e00\u7ba1\u7406\u5c64 (Consistent Management Layer)\uff0c\u63d0\u4f9b\u7d71\u4e00\u7684 API\uff0c\u7121\u8ad6\u4f60\u662f\u4f7f\u7528 Azure Portal (\u5c6c\u65bc ARM Template \u7bc4\u7587)\u3001Azure PowerShell\u3001Azure CLI \u6216\u8005\u662f\u7528 Postman \u81ea\u5df1\u6162\u6162\u6253 REST API\uff0c\u5176\u5be6\u90fd\u662f\u547c\u53eb\u5230\u5e95\u5c64\u76f8\u540c\u7684 API Call\uff0c\u7406\u8ad6\u4e0a\u4e26\u4e0d\u6703\u6709\u4e0d\u76f8\u540c\u7684\u72c0\u6cc1\u767c\u751f\uff0c\u4f46\u5be6\u52d9\u4e0a\u4f60\u6709\u6642\u6703\u767c\u73fe\u4e0a\u9762\u5e7e\u500b\u5de5\u5177\u64cd\u4f5c\u6709\u9ede\u4e0d\u4e00\u6a23\uff0c\u4e3b\u8981\u539f\u56e0\u5728\u65bc Azure Resource Manager \u4e0a\u9762\u6240\u63d0\u4f9b SDK \u53ef\u80fd\u9084\u6c92\u5be6\u4f5c\u76f8\u95dc\u529f\u80fd\u3001 API Version \u9084\u6c92\u5347\u4e0a\u53bb\u6216\u8005\u662f\u6839\u672c\u4e0a\u547c\u53eb\u64cd\u4f5c\u7684\u6642\u5019\u662f\u8003\u616e\u7279\u5b9a\u72c0\u6cc1\u800c\u5beb\u6b7b\uff0c\u9019\u4e9b\u90fd\u7b97\u662f\u5e38\u898b\u7684\u72c0\u6cc1</p> <p></p> <p>\u91dd\u5c0d Azure Cloud Provider \u90e8\u5c6c\u548c\u7ba1\u7406\u4e0a\uff0c\u53ef\u4ee5\u5206\u70ba 2 \u500b\u968e\u6bb5:</p> <ol> <li>\u5e73\u53f0\u90e8\u7f72 (Infrastucture Provisioning): \u5f9e 0 \u5230 1, \u670d\u52d9\u5f9e\u7121\u5230\u6709\uff0c\u5305\u542b\u7db2\u8def\u3001\u8cc7\u6599\u5eab\u3001\u865b\u64ec\u6a5f VM Size \u7b49\u7b49</li> <li>\u5e73\u53f0\u7ba1\u7406 (Infrastructure Configurations): \u5f9e 1 \u5230 2, \u65e2\u6709\u670d\u52d9\u6301\u7e8c\u7dad\u8b77\uff0c\u4e0d\u505a\u5e73\u53f0\u5c64\u7d1a\u7684\u8b8a\u66f4</li> </ol>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#1-infrastucture-provisioning","title":"\u95dc\u65bc 1. \u5e73\u53f0\u90e8\u7f72 (Infrastucture Provisioning) \u968e\u6bb5","text":"<p>\u9078\u64c7\u4e0a\u6703\u4f7f\u7528\u5230\u7684\u5de5\u5177\u7d44\u5408\u6709</p> <ol> <li>\u55ae\u7368\u4f7f\u7528 Terraform \u6240\u63d0\u4f9b\u7684 azurerm</li> <li>\u4ee5 Azure CLI \u529f\u80fd\u70ba\u4e3b\uff0cAnsible \u6216 Shell Script \u70ba\u8f14\u52a9\u7ba1\u7406\u64cd\u4f5c\u6d41\u7a0b</li> </ol> <p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c\u4f60\u61c9\u8a72\u90fd\u8981\u7528 Terraform \u5b8c\u6210\u5f9e\u7121\u5230\u6709\u7684\u5e73\u53f0\u90e8\u7f72\u968e\u6bb5\uff0c\u8b93 AzureRM Terraform Provider \u76f4\u63a5\u5c0d Azure Resource Manager \u9032\u884c\u7ba1\u7406\uff0c\u6587\u4ef6\u53ef\u53c3\u8003 hashicorp/terraform-provider-azurerm\uff0c\u6545\u628a Terraform \u5beb\u597d\u7684\u78ba\u53ef\u4ee5\u52a0\u901f\u5e73\u53f0\u90e8\u7f72\u901f\u5ea6\u548c\u7ba1\u7406\uff0c\u4f46...\u6709\u6642\u5019\u4f60\u6703\u9047\u5230 Terraform \u6240\u63d0\u4f9b\u7684\u529f\u80fd\u4e26\u975e\u662f\u5b8c\u5584\u7684\uff0c\u8b6c\u5982\u8aaa Azure Red Hat OpenShift (aro) \u7684\u90e8\u7f72\u80fd\u529b\u76f4\u81f3\u4eca\u65e5\u9084\u5728 hashicorp /terraform-provider-azurerm - New Resource: azurerm_redhat_openshift_cluster #20266 \u8eba\u8457\uff0c\u4f60\u7528\u5b98\u65b9 azurerm \u662f\u5beb\u4e0d\u51fa\u4f86\u76f8\u95dc\u529f\u80fd\u7684\uff0c\u9019\u6642\u5019\u4f60\u5c31\u9700\u8981\u63db\u4e0b\u4e00\u500b\u505a\u6cd5\u4e86</p> <p>Azure CLI \u8ddf Azure PowerShell \u7562\u7adf\u662f Azure \u89aa\u5152\u5b50\uff0c\u76f8\u95dc\u6307\u4ee4\u548c\u6e2c\u8a66\u90fd\u5beb\u5f97\u76f8\u7576\u5b8c\u5584\uff0c\u5982\u679c\u4f60\u770b\u5230\u65b0\u7684\u529f\u80fd\u51fa\u7684\u6642\u5019\uff0c\u591a\u534a\u6700\u65b0\u7684 Azure CLI \u4e5f\u90fd\u6709\u63d0\u4f9b\u5c0d\u61c9\u7684\u6307\u4ee4\u7d66\u4f60\u64cd\u4f5c\u4e86\uff0c\u6240\u4ee5\u53ea\u8981\u9047\u5230\u592a\u65b0\u7684\u670d\u52d9\uff0cTerraform \u6e2c\u4e0d\u51fa\u4f86\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u63db\u6210\u7528 Azure CLI \u70ba\u4e3b\u7684\u65b9\u5f0f\u4f86\u64cd\u4f5c\uff0c\u8f14\u4ee5 Shell Script \u6216\u8005\u662f Ansible \u4f86\u5b8c\u6210\u6574\u9ad4\u7684\u64cd\u4f5c\u6d41\u7a0b\uff0c\u5982\u679c\u4f60\u662f\u55ae\u7d14\u7528 Bash + Azure CLI \u7684\u8a71\uff0c\u98a8\u683c\u5982\u7bc4\u4f8b Azure CLI + Bash - azcli-create-private-aro.azcli</p> <p>\u70ba\u4f55\u4e0d\u4f7f\u7528 ARM Template \u6216 Bicep? \u6211\u500b\u4eba\u89ba\u5f97\u662f\u5f88\u96e3\u5beb\uff0c\u5f88\u96e3\u5c07\u5177\u5099\u908f\u8f2f\u548c\u6d41\u7a0b\u76f8\u95dc\u7684\u5143\u7d20\u5beb\u9032\u53bb\uff0c\u4f46\u4e00\u6b21\u90e8\u7f72\u7684\u53ef\u4ee5\u7528\uff0c\u4f46\u9019\u500b\u592a\u5bb9\u6613\u88ab Terraform \u89d2\u8272\u53d6\u4ee3\uff0c\u6216\u8005\u662f\u5fd8\u8a18\u5c07\u529f\u80fd\u5beb\u9032\u53bb\uff0c\u770b\u770b Azure Red Hat OpenShift \u5728 Azure Portal \u4e0a\u4f60\u662f\u9ede\u4e0d\u51fa Private \u67b6\u69cb\u7684...\u9664\u975e\u4f60\u81ea\u5df1\u624b\u52d5\u532f\u5165 ARM Template\uff0c\u5982\u7bc4\u4f8b ARM Template - arm-template-create-private-aro.json</p> <p>\u70ba\u4f55\u4e0d\u4f7f\u7528 Anisble Module \u63d0\u4f9b\u7684 Ansible - Azure.Azcollection? \u9019\u500b\u8981\u770b\u72c0\u6cc1\uff0c\u591a\u6578\u4e0d\u4f7f\u7528\u7684\u7406\u7531\u8ddf Terraform \u6709\u4e9b Azure \u670d\u52d9\u771f\u7684\u6c92\u5be6\u4f5c\u51fa\u4f86\u4e00\u6a23\uff0c\u6291\u6216\u8005\u662f\u8a72\u6a21\u7d44\u592a\u4e45\u6c92\u66f4\u65b0\uff0c\u4ee5 Azure Red Hat OpenShift \u70ba\u4f8b\uff0c<code>azure.azcollection.azure_rm_openshiftmanagedcluster</code> \u662f Ansible Module \u540d\u7a31\uff0c\u96d6\u7136\u6a21\u7d44\u6709\u662f\u6709\uff0c\u4f46\u6709\u6bb5\u6642\u9593\u6c92\u66f4\u65b0\u4e86\uff0c\u5c0e\u81f4\u67d0\u90e8\u5206 API \u547c\u53eb\u6703\u5931\u6557\uff0c\u5be6\u52d9\u4e0a\u90e8\u7f72\u4e0d\u51fa\u4f86\uff0c\u6240\u4ee5\u6700\u7d42\u9084\u662f\u7528 Azure CLI \u4f86\u5b8c\u6210\u64cd\u4f5c\u3002</p> <p>\u4f46\u6211\u4e26\u4e0d\u662f\u5426\u5b9a azure.azcollection \u6240\u6709\u7684\u6a21\u7d44\uff0c\u53ea\u8981\u662f\u5e38\u898b\u7684\u670d\u52d9\uff0c\u5982\u7db2\u8def\u3001\u90e8\u7f72\u865b\u64ec\u6a5f\u7b49\u7b49\uff0c\u4f7f\u7528\u4e0a\u90fd\u4e0d\u6703\u6709\u592a\u5927\u554f\u984c\uff0c\u6240\u4ee5\u6b63\u78ba\u7528\u6cd5\u662f Azure Collection + Azure CLI \u6df7\u8457\u7528\uff0c\u800c\u4e0d\u662f\u53ea\u7528\u55ae\u4e00\u500b\u9078\u64c7\uff0c\u98a8\u683c\u5982\u7bc4\u4f8b Ansible Playbook - ansible-create-private-aro.yml\uff0c\u5e38\u7528\u670d\u52d9\u7528 azure.azcollection \u6a21\u7d44\uff0c\u4e0d\u5e38\u7528\u6216\u65b0\u670d\u52d9\u7528 Azure CLI + Ansible Module - shell, command \u4f86\u5b8c\u6210\u6574\u9ad4\u7684\u64cd\u4f5c\u6d41\u7a0b</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#2-infrastructure-configurations","title":"\u95dc\u65bc 2. \u5e73\u53f0\u7ba1\u7406 (Infrastructure Configurations) \u968e\u6bb5","text":"<p>\u5206\u70ba\u5169\u500b\u90e8\u5206\u770b\uff0c\u5982\u679c\u4f60\u662f\u7ba1\u7406 PaaS \u4e4b\u985e\u7684\u670d\u52d9\uff0c\u7684\u78ba\u4f60\u9084\u662f\u53ef\u4ee5\u7e7c\u7e8c\u4f7f\u7528 Terraform \u6216\u8005\u662f\u7528 <code>az xxx update</code> \u4f86\u9032\u884c\u57fa\u65bc\u5e73\u53f0\u7684\u8a2d\u5b9a\u66f4\u65b0\u7ba1\u7406\uff0c\u4f46\u5982\u679c\u662f VM \u5c64\u7d1a\u7684\u670d\u52d9\uff0c\u9700\u8981\u52d5\u5230\u4f5c\u696d\u7cfb\u7d71\u88e1\u7684\u8a2d\u5b9a\uff0c\u5982 Ubuntu \u60f3\u8981\u6539 Interface IP, Red Hat Enterprise Linux \u9700\u8981\u4e0a sysctl\u3001Windows Server Firewall Allow ICMP \u7b49\u7b49\u504f\u5411\u4f5c\u696d\u7cfb\u7d71\u5c64\u7d1a\u7684\u7ba1\u7406\uff0c\u6c92\u610f\u5916\u5c31\u662f\u4ee5 Ansible \u70ba\u4e3b\u4e86\uff0cAnsible \u6700\u6709\u512a\u52e2\u7684\u5730\u65b9\u5c31\u662f Agentless \u9019\u500b\u7279\u6027\uff0c\u6709 SSH \u6216 WinRM \u5c31\u80fd\u505a\u5f8c\u7e8c\u7684\u4f5c\u696d\u7cfb\u7d71\u7ba1\u7406\u4e86\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003\u5c0f\u5f1f\u4e4b\u524d\u5beb\u7684 30 \u5206\u9418\u5167\u5f9e\u958b\u59cb\u5230\u5165\u9580\u7684 Ansible</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#vmware-vsphere","title":"VMware vSphere","text":"<p>VMware vSphere Iac \u5c0d\u7b56</p> <p>\u9996\u9078 Ansible \u4e26\u5927\u91cf\u4f7f\u7528 ansible.community.vmware</p> <p>\u96d6\u7136 VMware vSphere \u662f\u500b\u5e73\u53f0\uff0c\u4e5f\u6709 Terraform Provider \u7684\u6a21\u7d44\uff0c\u4f46\u5be6\u52d9\u4e0a\u5982\u679c\u4f60\u4e0d\u662f\u628a\u5b83\u7576\u4f5c Cloud Provider \u7684\u4f7f\u7528\u65b9\u5f0f\u7684\u8a71\uff0c\u504f\u5411\u662f\u4e00\u6b65\u4e00\u6b65\u64cd\u4f5c\u7684\u8a71\uff0c\u53ef\u80fd\u7528 VMware vCenter Web UI \u64cd\u4f5c\u5c45\u591a</p> <p>\u5018\u82e5\u4f60\u4e00\u5b9a\u8981\u505a IaC \u53c8\u4ee5 Ansible \u70ba\u4e3b\u7684\u8a71\uff0c\u4f60\u4e00\u5b9a\u6703\u5927\u91cf\u7528\u5230 community.vmware.vmware_guest\uff0c\u7121\u8ad6\u662f\u81ea\u52d5\u5316\u5f9e VM Template \u90e8\u7f72\u4e00\u53f0\u65b0\u7684 VM\u3001\u91dd\u5c0d\u6307\u5b9a\u6a5f\u5668\u958b\u95dc\u6a5f\u3001\u4fee\u6539 VM Instance\uff0c\u4f46\u9019\u6a21\u7d44\u7ba1\u7406\u7684\u5c64\u7d1a\u7406\u8ad6\u4e0a\u662f\u4e0d\u6703\u6df1\u5165\u5230 OS \u88e1\u9762\u7684\uff0c\u4e3b\u8981\u90fd\u662f\u4ee5 VMware VM instance \u89d2\u5ea6\u518d\u505a\u7ba1\u7406\uff0c\u4e26\u4e0d\u6d89\u53ca\u5230\u4f5c\u696d\u7cfb\u7d71\u5167\u90e8\u7684\u8a2d\u5b9a\u4fee\u6539\uff0c\u8ddf <code>az vm</code> \u548c <code>govc vm.clone</code> \u6709\u7570\u66f2\u540c\u5de5\u4e4b\u5999</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#kubernetes","title":"Kubernetes","text":"<p>Kubernetes Iac \u5c0d\u7b56</p> <p>\u91dd\u5c0d Kubernetes \u88e1\u9762\u7684\u8cc7\u6e90\u5c0d\u7b56 ansible.builtin.shell + kubectl/helm \u91dd\u5c0d Kubernetes \u5916\u90e8\u7684\u670d\u52d9\u5c0d\u7b56\uff0c\u56de\u6b78\u5230\u5404\u81ea\u5e73\u53f0\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u5982 VMware vSphere\u3001Azure\u3001AWS\u3001GCP \u7b49\u7b49</p> <p>Kubernetes \u5e73\u53f0\u540c\u6642\u9593\u5305\u542b\u4e86\u5e73\u53f0\u7ba1\u7406\u548c\u61c9\u7528\u7a0b\u5f0f\u90e8\u7f72\uff0c\u6700\u6c92\u554f\u984c\u7684\u90e8\u5206\u5c31\u662f\u61c9\u7528\u7a0b\u5f0f\u90e8\u7f72\uff0c\u4e8b\u60c5\u6700\u55ae\u7d14\uff0c\u4f60\u627e\u54ea\u4e00\u5bb6\u6216\u8005\u662f\u54ea\u4e00\u5ea7\u90fd\u5dee\u4e0d\u591a\u8655\u88e1\u65b9\u5f0f\uff0c\u6700\u5927\u7684\u8b70\u984c\u662f\u5728 Kubernetes \u5e73\u53f0\u7ba1\u7406\u4e0a</p> <p>\u7ba1\u7406 Kubernetes \u5e73\u53f0\u6709 2 \u500b\u5c64\u9762\u8981\u8a0e\u8ad6</p> <ol> <li>\u5728 Kubernetes \u88e1\u9762\u7684\u8cc7\u6e90 (Resource): \u4e3b\u8981\u7528 kubectl/helm \u6307\u4ee4\u64cd\u4f5c\u5373\u53ef\uff0c\u53ef\u4ee5\u642d\u8457 Ansible ansible.buitin.shell \u4f86\u505a\uff0c\u9019\u500b\u4e8b\u60c5\u4e5f\u7b97\u5c0f\uff0c\u57fa\u672c\u4e0a\u8ddf\u61c9\u7528\u7a0b\u5f0f\u90e8\u7f72\u5dee\u4e0d\u591a\u5c64\u7d1a\uff0c\u53ea\u662f\u6bd4\u8f03\u504f\u5411 Kubernetes \u5167\u90e8\u8996\u91ce\u7684\u5e73\u53f0\u7ba1\u7406\uff0cCNCF CKA / CKAD / CKS \u57fa\u672c\u4e0a\u90fd\u662f\u8003\u9019\u500b\u7bc4\u570d\u7684\u77e5\u8b58</li> <li>\u5728 Kubernetes \u5916\u9762\u7684\u670d\u52d9 (Services/Provider): \u4e3b\u8981\u662f\u7121\u6cd5\u7528 kubectl \u64cd\u4f5c\u7686\u5c6c\u6b64\u985e\uff0c\u5927\u591a\u6578\u8b70\u984c\u90fd\u8ddf Kubernetes \u8b70\u984c\u7121\u95dc\uff0c\u5982 Underlay Networking\u3001\u7bc0\u9ede\u5927\u5c0f\u3001\u958b\u95dc\u6a5f\u3001External Load Balancer \u4ecb\u63a5\u3001NetAPP Trident CSI \u4e32\u63a5\u3001F5 BIG-IP CIS \u6574\u5408\u3001Veritas Kubernetes \u5099\u4efd\u7b49\u7b49\uff0c\u9019\u500b\u662f\u6700\u5177\u6311\u6230\u7684\u5730\u65b9\uff0c\u56e0\u70ba\u5f88\u5403\u65e2\u6709\u65b9\u6848\u5c0d\u63a5 Kubernetes \u6574\u5408\u7684\u7406\u89e3</li> </ol> <p>2 \u500b\u554f\u984c\u53ef\u4ee5\u8b93\u4f60\u5206\u6e05\u8b70\u984c</p> <ul> <li> <p>\u6700\u6838\u5fc3\u554f\u984c\u662f<code>\u4f60\u7684 Kubernetes \u662f\u8ab0\u5bb6\u7684?</code> \u9019\u500b\u6703\u5f71\u97ff\u5230\u4f60\u8981\u5982\u4f55\u7ba1\u7406 Kubernetes\uff0c\u5982\u516c\u6709\u96f2\u63d0\u4f9b\u7684 Kubernetes\uff0c\u5982 AKS\u3001EKS\u3001GKE \u7b49\uff0c\u9084\u662f\u5ee0\u5546\u63d0\u4f9b\u70ba\u4e3b\u7684 Kubernetes\uff0c\u5982 Red Hat OpenShift on Bare Metal\u3001Red Hat OpenShift on VMware vSphere\u3001VMware vSphere with Tanzu\u3001VMware Tanzu Kubernetes Grid\u3001Rancher\u3001Rancher \u7b49\uff0c\u6216\u8005\u662f\u81ea\u67b6 DIY \u7684 Kubernetes</p> </li> <li> <p>\u5176\u6b21\u662f <code>Cluster API \u6709\u6c92\u6709\u7528?</code> \u6709\u7528\u7684\u8a71\uff0cKubernetes \u53ef\u4ee5\u900f\u904e Cluster API Provider \u7684\u65b9\u5f0f\u53bb\u8abf\u5ea6\u5e95\u5c64\u8cc7\u6e90\uff0c\u67b6\u69cb\u8a2d\u8a08\u5f97\u7576\u7684\u72c0\u6cc1\u4e0b\u4f60\u4e0d\u592a\u9700\u8981\u63d2\u624b\uff0c\u53ef\u53c3\u8003 20211122_Kubernetes \u591a\u53e2\u96c6\u53ca\u55ae\u53e2\u96c6\u67b6\u69cb\u9078\u64c7\u63a2\u8a0e\uff0c\u6c92\u7528\u7684\u8a71\u5c31\u662f\u56de\u6b78\u5230\u5404\u81ea\u5e95\u5c64\u5e73\u53f0\u7684\u7ba1\u7406\u65b9\u5f0f\uff0c\u5730\u7aef\u6211\u9047\u5230\u7684\u6848\u5b50\u57fa\u672c\u4e0a\u90fd\u662f\u6c92\u7528\u7684</p> </li> </ul> Kubernetes Solution Platform Cluster API Enabled? Kubernetes \u5916\u90e8\u670d\u52d9\u8cc7\u6e90\u7ba1\u7406\u65b9\u5f0f Kubernetes \u5167\u90e8\u8cc7\u6e90\u7ba1\u7406\u65b9\u5f0f Azure Kuberentes Service Azure 1. az aks2. Terraform kubectl/helm Red Hat OpenShift 4 Bare Metal ansible.Dellemc.Openmanage \u6216\u8005\u662f HPE iLo, \u9019\u500b\u6bd4\u8f03\u7279\u6b8a\u4e00\u9ede kubectl/oc/helm Red Hat OpenShift 4 Bare Metal ansible.Dellemc.Openmanage \u6216\u8005\u662f HPE iLo kubectl/oc/helm Red Hat OpenShift 4 VMware vSphere VMware vCenter kubectl/oc/helm Red Hat OpenShift 4 VMware vSphere ansible.community.vmware kubectl/oc/helm Red Hat OpenShift 4 Azure Terraform kubectl/oc/helm Azure Red Hat OpenShift Azure Azure CLI kubectl/oc/helm VMware vSphere with Tanzu VMware vSphere VMware vCenter kubectl/kapp VMware Tanzu Kubernetes Grid 1.x VMware vSphere tanzu kubectl/kapp VMware Tanzu Kubernetes Grid 1.x Azure tanzu kubectl/kapp <p>\u91dd\u5c0d OpenShift 4 \u5167\u90e8\u8cc7\u6e90\u7ba1\u7406\u65b9\u5f0f\uff0c\u6211\u4e4b\u524d\u6709\u91dd\u5c0d OpenShift Day 2 Operations \u5e38\u9047\u5230\u7684\u7ba1\u7406\u60c5\u5883\uff0c\u7528 Ansible \u5beb\u4e86\u4e0d\u5c11\u7bc4\u4f8b\u4e0b\u4f86\u53ef\u4ee5\u53c3\u8003 pichuang/openshift4-toolbox\uff0c\u4f8b\u5982 Etcd \u5099\u4efd\u3001\u6aa2\u67e5\u3001\u53e2\u96c6\u958b\u95dc\u6a5f\u3001\u5b89\u88dd Service Mesh \u7686\u80fd\u5beb</p> <p>\u53e6\u5916 VMware \u76f8\u95dc\u7684\u89e3\u6c7a\u65b9\u6848 VMware vSphere with Tanzu \u548c VMware Tanzu Kubernetes Grid\uff0c\u6703\u76f8\u7576\u8457\u91cd\u5728 VMware vSphere \u548c Tanzu Management Cluster (mc)/Supervisor Cluster(sc) \u7684\u67b6\u69cb\u8a2d\u8a08\u4e0a\uff0c\u4f46\u9019\u500b\u8d85\u51fa\u8a0e\u8ad6\u7bc4\u570d\uff0c\u672c\u6587\u4e0d\u8a0e\u8ad6</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#linux","title":"Linux \u4f5c\u696d\u7cfb\u7d71","text":"<p>Linux IaC \u5c0d\u7b56</p> <p>ansible.builtin.shell + Ansible Collections + Shell Script</p> <p>\u592a\u591a\u4e86\u8b1b\u4e0d\u5b8c\uff0c\u7db2\u8def\u4e0a\u53c3\u8003\u6587\u7ae0\u975e\u5e38\u591a\uff0c\u5982\u679c\u4e0d\u5acc\u68c4\u7684\u8a71\u53ef\u53c3\u8003 30 \u5206\u9418\u5167\u5f9e\u958b\u59cb\u5230\u5165\u9580\u7684 Ansible \u548c Ansible \u6280\u8853\u6982\u89c0\u4ecb\u7d39_20190130\uff0c\u4e3b\u8981\u5148\u6703 2 \u500b\u5c31\u597d\uff0c\u5176\u4ed6\u90fd\u662f\u8b8a\u5316\u800c\u5df2</p> <pre><code># 1: \u5c0d\u591a\u500b\u4f3a\u670d\u5668\u4e0b\u76f8\u540c\u6307\u4ee4\nansible -i inventory all -m shell -k -a &lt;\u6307\u4ee4&gt;\n\n# 2: \u5c07\u4e00\u500b\u6a94\u6848\u6216\u8cc7\u6599\u593e\u50b3\u9001\u5230\u591a\u500b\u4f3a\u670d\u5668\u4e0a\n# \u6a94\u6848\nansible -i inventory all -m copy -k -a \"src=/etc/motd dest=/etc/motd\"\n# \u8cc7\u6599\u593e\nansible -i inventory all -m copy -k -a \"src=/etc/yum.repos.d/ dest=/etc/yum.repos.d/\"\n</code></pre> <p>\u70ba\u4f55\u4e0d\u4f7f\u7528 Terraform? \u666e\u904d Linux \u4f5c\u696d\u7cfb\u7d71\u90fd\u6c92\u6709 API \u53ef\u4ee5\u8b93\u4f60\u547c\u53eb\uff0c\u6240\u4ee5\u4e5f\u81ea\u7136\u6c92\u6709\u76f8\u95dc\u6a21\u7d44\u53ef\u4ee5\u7528\uff0c\u90fd\u662f\u6eff\u6eff\u7684 CLI...</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#windows","title":"Windows \u4f5c\u696d\u7cfb\u7d71","text":"<p>Windows IaC \u5c0d\u7b56</p> <p>ansible.windows.win_command + Ansible Collections + PowerShell Script</p> <p>\u63a1\u7528\u908f\u8f2f\u8ddf\u7ba1\u7406 Linux \u4f5c\u696d\u7cfb\u7d71\u4e00\u6a23\uff0c\u9019\u908a\u63d0\u4f9b\u5e7e\u500b\u6211\u5e38\u7528\u7684\u7bc4\u4f8b</p> <ul> <li>\u91dd\u5c0d Windows Firewall \u958b ICMP request</li> <li>\u50b3\u7279\u5b9a\u6a94\u6848\u5230\u6240\u6709 Windows Server \u4e0a</li> </ul> <p>\u53ea\u662f\u56e0\u70ba Windows \u6b0a\u9650\u9810\u8a2d\u958b\u5f97\u5f88\u4f4e\uff0c\u5728\u4e00\u958b\u59cb\u4f7f\u7528\u7684\u6642\u5019\u9700\u8981\u5148\u7279\u5225\u628a Execution Policy \u8a2d\u5b9a\u6210 RemoteSigned\uff0c\u9019\u6a23\u624d\u80fd\u8b93 Ansible \u900f\u904e WinRM \u4f86\u57f7\u884c Powershell Script</p> set-remotesigned-policy.ps1<pre><code>Set-ExecutionPolicy RemoteSigned\nGet-ExecutionPolicy\n\nwinrm quickconfig\n\n# Enable WinRm Auth\nwinrm set winrm/config/service/auth '@{Basic=\"true\"}'\n\n# Enable Allow Un-encrypt\nwinrm set winrm/config/service '@{AllowUnencrypted=\"true\"}'\n\n# Verify WinRm Listener\nwinrm enumerate winrm/config/listener\n</code></pre> <p>\u70ba\u4f55\u4e0d\u4f7f\u7528 Terraform? Windows \u5728\u4f5c\u696d\u7cfb\u7d71\u5c64\u7d1a\u4e0a\u96d6\u8aaa\u6709\u4e00\u7968 API \u53ef\u4ee5\u7528\uff0c\u4f46\u73fe\u884c\u6c92\u4eba\u91dd\u5c0d Windows \u64b0\u5beb\u5c6c\u65bc\u4ed6\u7684 Terraform Provider\uff0c\u6211\u76f8\u4fe1\u4ee5\u5f8c\u4e5f\u4e0d\u6703\u6709\u3002\u4f46\u5982\u679c\u4f60\u662f\u8aaa Hyper-v \u958b\u8d77\u4f86\u7684\u72c0\u6cc1\uff0c\u90a3...\u9019\u500b\u5c31\u662f\u53e6\u5916\u4e00\u500b\u8a0e\u8ad6\u4e86\uff0c\u73fe\u884c\u5169\u908a\u5b98\u65b9\u662f\u6c92\u652f\u63f4\u5566...</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#tldr","title":"TL;DR","text":"<ol> <li>Terraform \u642d\u5e73\u53f0\u6839\u57fa</li> <li>Ansible \u7ba1\u809a\u5b50\u548c\u9ecf\u670d\u52d9</li> <li>GitHub Copilot + OpenAI ChatGPT \u4e0a\u96d9 Buff</li> </ol>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#qa","title":"Q&amp;A","text":"","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q1-shell-script-ansible","title":"Q1: \u8981\u7814\u7a76\u4e00\u500b\u65b0\u670d\u52d9\u7684\u6642\u5019\uff0c\u6211\u61c9\u8a72\u8981\u5148\u7528 Shell Script \u5beb\u9084\u662f Ansible \u6a21\u7d44\u515c?","text":"<p>Shell Script \u5148\u5beb\uff0c\u56e0\u70ba\u4f60\u6703\u6709\u5f88\u5927\u6642\u9593\u5728\u7814\u7a76\u5230\u5e95\u600e\u9ebc\u628a CLI \u515c\u8d77\u4f86\uff0c\u7b49\u5230\u515c\u8d77\u4f86\u4e4b\u5f8c\uff0c\u5982\u679c\u6709\u9700\u8981\u5206\u4eab\u7d66\u5176\u4ed6\u4eba\u57f7\u884c\u7684\u8a71\uff0c\u53ef\u4ee5\u6539\u5beb\u6210 Ansible Playbook\uff0c\u6703\u66f4\u5177\u53ef\u8b80\u6027\u548c\u7dad\u8b77\u6027</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q2-ansible-shell-script","title":"Q2: Ansible \u65e2\u7136\u4ec0\u9ebc\u90fd\u53ef\u4ee5\u505a\uff0c\u90a3\u662f\u4e0d\u662f\u90fd\u4e0d\u7528\u5b78 Shell Script?","text":"<p>\u4e0d\uff0cAnsible \u5f37\u9805\u662f Step by Step \u6d41\u7a0b\u63a7\u5236\uff0c\u4f46\u5c0d\u65bc\u6587\u5b57\u8655\u7406\u548c\u6a94\u6848\u8655\u7406\u6211\u89ba\u5f97\u8d85\u7d1a\u5f31\uff0c\u8b6c\u5982\u8aaa\u4f60\u7528 Ansible \u8655\u7406 JSON/YAML \u683c\u5f0f\u8f49\u63db\u4fdd\u8b49\u8f49\u5230\u5410\u8840</p> <p>\u89e3\u6cd5\u662f\u7528 ansible.builtin.shell \u76f4\u63a5\u547c\u53eb Shell Script\uff0c\u7136\u5f8c\u90a3\u500b Shell Script \u53ef\u4ee5\u5728\u88e1\u9762\u7528\u4f60\u5e38\u7528\u7684\u5de5\u5177\u505a\u6a94\u6848\u8655\u7406</p> <pre><code>- name: Convert JSON to YAML using Shell Script\n  become: true\n  vars:\n    json_file: /path/to/input.json\n    yaml_file: /path/to/output.yaml\n  shell: covert_json_to_yaml.sh {{ json_file }} {{ yaml_file }}\n</code></pre>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q3-azureansible-ansibleazcollections-terraform","title":"Q3: \u91dd\u5c0d\u7ba1\u7406 Azure\uff0cAnsible \u65e2\u7136\u6709 ansible.azcollections\uff0c\u90a3\u70ba\u4ec0\u9ebc\u6211\u9084\u9700\u8981\u7528 Terraform \u4f86\u90e8\u7f72\u5462?","text":"<p>Ansible \u4e26\u4e0d\u5177\u5099\u8cc7\u6e90\u76f8\u4f9d\u6027\u8655\u7406\u80fd\u529b\uff0c\u5982\u679c\u4f60\u90e8\u7f72 AKS \u670d\u52d9\uff0c\u4f46\u4f60\u6c92\u6709\u5148\u628a VNet \u4e4b\u985e\u7684\u670d\u52d9\u5148\u5f04\u597d\uff0c\u4ed6\u662f\u6c92\u8fa6\u6cd5\u77e5\u9053\u9019\u4ef6\u4e8b\uff0c\u4f46 Terraform \u53ef\u4ee5\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u8981\u7528 Ansible \u5b8c\u6210\u985e\u540c\u65bc Terraform \u7684\u4e8b\u60c5\uff0c\u4f60\u52e2\u5fc5\u8981\u82b1\u4e0d\u5c11\u6642\u9593\u7528 Azure CLI \u5148\u7406\u89e3\u6bcf\u4e00\u6b65\u8cc7\u6e90\u662f\u600e\u9ebc\u88ab\u5efa\u7acb\u8d77\u4f86\u7684\uff0c\u7136\u5f8c\u518d\u7528 Ansible \u4f86\u5be6\u4f5c\uff0c\u6642\u9593\u6210\u672c\u4e0d\u592a\u5408\uff0c</p> <p>\u6545\u500b\u4eba\u5efa\u8b70\u53ef\u4ee5\u5b9a\u8abf</p> <ol> <li>\u5e73\u53f0\u90e8\u7f72 (Infrastucture Provisioning): Terraform</li> <li>\u5e73\u53f0\u7ba1\u7406 (Infrastructure Configurations): Ansible</li> </ol>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q4-iac","title":"Q4: \u5982\u679c\u53ea\u6709\u4e00\u5957 IaC \u8981\u9078\uff0c\u9078\u54ea\u5957?","text":"<p>Ansible \u5427\uff0cAgenless \u7279\u6027\u53ef\u4ee5\u5f88\u7c21\u55ae\u628a\u4e00\u5806\u5947\u602a\u670d\u52d9\u50cf\u81a0\u6c34\u4e00\u6a23\u9ecf\u5728\u4e00\u8d77\uff0c\u662f\u4e00\u500b\u842c\u80fd\u81a0\u7b49\u7d1a DSL</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q5-azure-3-azure-cliterraformansible","title":"Q5: \u91dd\u5c0d Azure\uff0c\u8d77\u78bc\u6709 3 \u500b\u4e0d\u540c\u7684\u5de5\u5177\u53ef\u4ee5\u9078\u64c7 Azure CLI\u3001Terraform\u3001Ansible\uff0c\u90a3\u6211\u8981\u600e\u9ebc\u9078?","text":"<p>\u5148 Terraform\uff0c\u5beb\u4e0d\u51fa\u4f86\u7528 Azure CLI \u786c\u4e0a\u770b\u770b\uff0c\u5982\u679c\u8981\u5c07\u904e\u7a0b\u81ea\u52d5\u5316\uff0c\u518d\u7528 Ansible \u5305\u8d77\u4f86</p> <p>\u4e3b\u8981\u539f\u56e0\u662f\u56e0\u70ba\u6a21\u7d44\u66f4\u65b0\u983b\u7387\u662f REST API &gt; Azure CLI &gt; Terraform &gt;&gt;&gt; Ansible Collections\uff0c\u4f46\u591a\u6578\u72c0\u6cc1\u7684\u4f7f\u7528\u5834\u666f\u90fd\u662f\u5e38\u898b\u7684\u670d\u52d9\uff0c\u6240\u4ee5\u53ef\u4ee5\u4ee5 Terraform \u70ba\u4e3b\uff0c\u5927\u591a\u6578\u90fd\u6709\u652f\u63f4</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q6-docker-compose-iac","title":"Q6: \u984c\u5916\u8a71 docker-compose \u7b97\u4e0d\u7b97 IaC \u5be6\u8e10\u7684\u4e00\u74b0?","text":"<p>Yes. \u53ef\u9810\u6e2c\u7d50\u679c\u3001\u53ef\u91cd\u8907\u6d41\u7a0b\u3001\u53ef\u7248\u63a7\u7a0b\u5f0f\u78bc\uff0c\u662f\u4e00\u500b\u5f88\u597d\u7684 IaC \u5be6\u8e10</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q7-terraform-ansible-shell-script","title":"Q7: \u6211\u4e0d\u6703\u5beb Terraform / Ansible / Shell Script\uff0c\u90a3\u8981\u600e\u9ebc\u5beb?","text":"<p>\u627e\u5ee0\u5546\u670d\u52d9 (x)\uff0cGitHub Copilot \u7528\u8d77\u4f86 (o)</p> <p>GitHub Copilot \u80cc\u5f8c\u6280\u8853\u662f\u7531 OpenAI \u6240\u63d0\u4f9b\u7684 Codex \u6a21\u578b\u6240\u652f\u63f4\u7684\uff0c\u800c Codex \u6a21\u578b\u662f\u57fa\u65bc GPT-3 \u6240\u8a13\u7df4\u51fa\u4f86\u7684\uff0cGPT-3 \u662f\u4e00\u500b\u81ea\u7136\u8a9e\u8a00\u8655\u7406\u6a21\u578b\uff0c\u53ef\u4ee5\u6839\u64da\u8f38\u5165\u7684\u6587\u5b57\u6216 Comments\uff0c\u81ea\u52d5\u7522\u751f\u7a0b\u5f0f\u78bc\uff0c\u76f8\u7576\u5f37\u608d\u597d\u7528</p> <p>\u4f46\u5be6\u969b\u4e0a\u4f60\u9084\u662f\u8981\u5c0d\u9019\u4e9b\u8a9e\u8a00\u672c\u8eab\u8981\u6709\u4e00\u9ede\u7406\u89e3\uff0c\u4e0d\u7136\u6703\u5f88\u96e3\u5224\u65b7 GitHub Copilot \u5beb\u51fa\u4f86\u7684\u6771\u897f\u5230\u5e95\u662f\u5c0d\u9084\u662f\u932f</p> <p>\u5982\u679c\u771f\u7684\u60f3\u8981\u6709\u500b 24hr \u5c0f\u8001\u5e2b\u6559\u5b78\u7684\u8a71\uff0c\u5c31\u662f\u8981\u7528 OpenAI ChatGPT \u4e86</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#q8-ansible-puppet-saltstack-chef","title":"Q8: \u4f60\u9019\u9ebc\u63a8 Ansible\uff0c\u90a3 Puppet / Saltstack / Chef \u60c5\u4f55\u4ee5\u582a?","text":"<p>\u6211\u500b\u4eba\u592a\u5403 Agentless \u8a2d\u8a08\u4e86\uff0c\u5176\u4ed6\u4e09\u5bb6\u56e0\u70ba\u90fd\u9700\u8981\u585e Agent \u9032\u53bb\uff0c\u6240\u4ee5\u5f88\u65e9\u671f\u5c31\u653e\u68c4\u4e0d\u592a\u770b</p>","tags":["iac","linux"]},{"location":"20230301-iac-personal-experiences.html#references","title":"References","text":"<ul> <li>What is Azure Resource Manager?</li> <li>hashicorp/terraform-provider-azurerm</li> <li>New Resource: azurerm_redhat_openshift_cluster #20266</li> <li>Ansible - Azure.Azcollection</li> <li>azure.azcollection.azure_rm_openshiftmanagedcluster module \u2013 Manage Azure Red Hat OpenShift Managed Cluster instance\uf0c1</li> </ul>","tags":["iac","linux"]},{"location":"20230306-tdd-for-network-connectivity.html","title":"\u904b\u7528 Testinfra \u4f86\u78ba\u4fdd\u7db2\u8def\u9023\u901a\u6027\u6e2c\u8a66","text":"<p>\u8d77\u6e90\u662f\u56e0\u70ba\u505a Azure \u7db2\u8def\u67b6\u69cb\u8a2d\u8a08\uff0c\u7db2\u8def\u7dda\u62c9\u5b8c (ExpressRoute\u3001S2S VPN\u3001VNet Peering \u7b49) \u4e4b\u5f8c\uff0c\u4e0b\u4e00\u500b\u9700\u6c42\u591a\u534a\u90fd\u662f\u8981\u628a Firewall \u958b\u8d77\u4f86\uff0c\u5e0c\u671b\u6240\u6709\u7684\u9023\u7dda\u90fd\u8981\u7d93\u904e Azure Firewall \u78ba\u4fdd\u9023\u7dda\u5b89\u5168\u6027\uff0c\u4f46\u57fa\u65bc Azure Networking \u672c\u8eab\u7684\u7279\u6027\u548c\u4f7f\u7528\u8005\u7684\u5c0d\u65bc\u7db2\u8def\u9023\u901a (Network Connectivity) \u7684\u9700\u6c42\uff0c\u8eab\u70ba\u4e00\u540d\u8a18\u61b6\u529b\u4e0d\u7b97\u7279\u597d\u7684\u67b6\u69cb\u5e2b\uff0c\u70ba\u4e86\u78ba\u4fdd\u4f7f\u7528\u8005\u8b1b\u7684\u8ddf\u5be6\u969b\u4e0a\u904b\u4f5c\u7684\u7d50\u679c\u662f\u4e00\u6a23\u7684\uff0c\u9019\u6642\u5019\u5c31\u8981\u628a\u65e9\u5e74\u5728 Edgecore Network \u6642\u671f\u8b1b\u904e\u7684 NetDevOps: Next-Generation Network Engineer \u62ff\u4f86\u7528\u7528\u4e86</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#_1","title":"\u4f60\u61c9\u8a72\u8981\u77e5\u9053\u7684\u5c0f\u77e5\u8b58","text":"","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#testinfra_1","title":"Testinfra","text":"<p>Testinfra \u662f\u77e5\u540d Python \u6e2c\u8a66\u958b\u767c\u6846\u67b6 pytest \u884d\u751f\u7684\u4e00\u500b\u6e2c\u8a66\u5f15\u64ce\uff0c\u4e3b\u8981\u5c0d\u6a19\u7684\u529f\u80fd\u662f\u53e6\u4e00\u500b\u4ee5 Ruby \u70ba\u57fa\u790e\u7684 Serverspec\uff0c\u4f46\u4e3b\u8981\u4e5f\u4e0d\u662f\u8981\u4f60\u6703\u5beb\u7a0b\u5f0f\u8a9e\u8a00\u624d\u80fd\u7528\uff0c\u53cd\u6b63\u7528\u9806\u624b\u7684\u5c31\u597d\uff0c\u908f\u8f2f\u4e0a\u90fd\u5dee\u4e0d\u591a</p> <p>\u96d6\u8aaa Testinfra \u9810\u8a2d\u662f\u4f7f\u7528 pytest \u4f5c\u70ba\u57fa\u790e\uff0c\u4f46\u4e5f\u53ef\u4ee5\u8ddf\u53e6\u4e00\u500b\u5f88\u5e38\u898b\u7684 Python \u6e2c\u8a66\u6846\u67b6 unittest \u878d\u548c\u5728\u4e00\u8d77\uff0c\u6211\u662f\u4ee5\u9019\u500b\u5beb\u6cd5\u70ba\u4e3b\uff0c\u5982\u679c\u4f60\u89ba\u5f97\u4e0d\u592a\u9806\u773c\u53ef\u4ee5\u770b\u5b98\u65b9\u7684 examples \u81ea\u5df1\u4fee\u6539\uff0c\u9644\u4e0a\u672c\u6587\u6703\u4f7f\u7528\u5230\u7684 Code Snippet pichuang/testinfra-code-snippet</p> <p>\u500b\u4eba\u5e38\u7528\u5230\u7684 4 \u500b\u65b7\u8a00 (Assertion) \u6709\u4ee5\u4e0b\u5e7e\u7a2e\uff0c\u4f46\u4e0d\u9650\u65bc\uff0c\u53ef\u53c3\u8003unittest - assert methods:</p> Assert Methods \u8868\u9054\u5f0f \u89e3\u91cb \u767d\u8a71\u6587 assertEqual(a, b) a == b \u53ef\u4ee5\u62ff\u4f86\u6aa2\u67e5 HTTP Status Code \u70ba 200 \u9019\u500b\u7db2\u9801\u5f88\u6b63\u5e38 assertNotEqual(a, b) a != b \u53ef\u4ee5\u62ff\u4f86\u6aa2\u67e5 HTTP Status Code \u4e0d\u70ba 200 \u9019\u500b\u7db2\u9801\u4e0d\u5b58\u5728\u662f\u6b63\u5e38\u7684 assertTrue(x) bool(x) is True \u53ef\u4ee5\u6aa2\u67e5 Boolen \u9019\u500b\u670d\u52d9\u6211\u8981\u9023\u5f97\u5230 assertFalse(x) bool(x) is False \u53ef\u4ee5\u6aa2\u67e5 Boolen \u9019\u500b\u670d\u52d9\u6211\u4e0d\u61c9\u8a72\u9023\u7684\u5230 <p>\u5be6\u969b\u4e0a\u57f7\u884c\u65b9\u5f0f\u8981\u8a18\u5f97\u52a0 <code>-v</code> \u624d\u80fd\u770b\u5230\u767e\u5206\u6bd4</p> <pre><code>pytest -v test*.py\n</code></pre> <p></p> <p>\u6b64\u5916 testinfra \u9084\u652f\u63f4\u591a\u7a2e connection backend\uff0c\u5305\u542b: kubectl\u3001openshift\u3001ssh\u3001ansible\u3001docker\u3001podman \u7b49\uff0c\u548c\u591a\u7a2e Modules \u53ef\u4ee5\u6aa2\u67e5\uff0c\u5305\u542b: file\u3001group\u3001host\u3001package\u3001process\u3001service\u3001user \u7b49\uff0c\u53ef\u4ee5\u53c3\u8003\u5b98\u65b9\u6587\u4ef6\uff0c\u6709\u9700\u6c42\u7684\u53ef\u4ee5\u81ea\u884c\u8a66\u8a66</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#azure-firewall","title":"Azure Firewall","text":"<p>Azure Firewall \u662f Azure \u63d0\u4f9b\u7684 PaaS \u6240\u63d0\u4f9b\u7684\u4f01\u696d\u7d1a Firewall \u80fd\u529b\uff0c\u53ef\u4ee5\u900f\u904e Azure Resource Manager \u5c07\u670d\u52d9\u5e36\u8d77\u4f86\uff0c\u61c9\u5c0d\u4e0d\u540c\u7684 SKU \u53ef\u4ee5\u63d0\u4f9b\u4e0d\u540c\u5c64\u7d1a\u7684\u4fdd\u8b77\u80fd\u529b\uff0c\u9700\u8981 Azure Firewall Policy \u624d\u80fd\u6b63\u5e38\u4f5c\u52d5\uff0c\u6c92\u8a2d\u5b9a\u534a\u689d Policy \u7684\u72c0\u6cc1\u4e0b\u662f\u9810\u8a2d <code>DenyAll</code></p> <p>\u5982\u679c\u8981\u5728 Azure Firewall \u770b\u5230\u5177\u9ad4\u7684 Log \u72c0\u614b\uff0c\u4f60\u9700\u8981\u53e6\u5916\u8a2d\u5b9a Log Analytics Workspace\uff0c\u4e26\u4e14\u5728 Diagnostic Setting \u8a2d\u5b9a\u597d Log Analytics Workspace\uff0c\u624d\u80fd\u5728 Azure Firewall \u770b\u5230 Log</p> <p></p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#azure-firewall-policy","title":"Azure Firewall Policy","text":"<p>Azure Firewall \u5be6\u969b\u4e0a\u9700\u8981\u642d\u914d Azure Firewall Policy \u91dd\u5c0d\u4ee5\u4e0b Rule Types \u9032\u884c\u8a2d\u5b9a:</p> Rule Types Default Priority Protocols Description DNAT 100 TCP, UDP \u53ef\u4ee5\u900f\u904e DNAT \u5c07 Inbound Traffic \u8f49\u63db Azure \u5167\u90e8\u7684 Private IP Network 200 Any, TCP, UDP, ICMP \u53ef\u4ee5\u57fa\u65bc L3/L4 IP, Port, Protocols \u9032\u884c\u6d41\u91cf\u7be9\u9078 Application 300 HTTP, HTTPS \u53ef\u4ee5\u57fa\u65bc FQDN, URL, HTTP, HTTPS \u9032\u884c\u6d41\u91cf\u7be9\u9078 <p>\u5be6\u52d9\u4e0a\u898f\u5247\u61c9\u8a72\u6703\u8d8a\u5beb\u8d8a\u591a\uff0c\u70ba\u4e86\u78ba\u4fdd\u662f\u4e0d\u662f\u771f\u7684\u6709\u7b26\u5408\u9019\u4e9b\u898f\u5247\uff0c\u751f\u547d\u6709\u9650\uff0c\u53ef\u4ee5\u7528 testinfra <code>\u5f9e\u4f7f\u7528\u8005\u8996\u89d2</code>\u4f86\u53cd\u8986\u78ba\u4fdd\u9019\u4e9b\u898f\u5247\u662f\u6b63\u78ba\u7684</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#unit-test","title":"Unit Test \u6848\u4f8b\u5206\u6790","text":"<p>\u56e0\u70ba\u61f6\u5f97\u5f9e Azure Firewall \u756b\u9762\u622a\u5716\uff0c\u6545\u4ee5 Terraform azurerm_firewall_policy_rule_collection_group \u4f86\u8868\u793a Azure Firewall Policy \u7684\u898f\u5247\u5beb\u6cd5\uff0c\u548c\u5176\u5c0d\u61c9\u7684\u6e2c\u8a66</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#a-ping","title":"\u4f7f\u7528\u8005 A \u8aaa: \u5e95\u4e0b\u6240\u6709\u670d\u52d9\u90fd\u8981\u53ef\u4ee5\u4e92\u76f8 Ping \u5230","text":"<p>\u56e0\u70ba Azure Firewall \u9810\u8a2d\u662f <code>DenyAll</code>\uff0c\u6240\u4ee5\u9019\u908a\u8981\u5148\u958b\u653e ICMP \u7684\u898f\u5247\uff0c\u8b93\u6240\u6709\u7684\u6d41\u91cf\u90fd\u53ef\u4ee5\u4e92\u76f8 Ping \u5230</p> network-icmp.tf<pre><code>resource \"azurerm_firewall_policy_rule_collection_group\" \"fprcg-for-transit\" {\n  network_rule_collection {\n    name     = \"network-rule-collection-for-transit\"\n    priority = 200\n    action   = \"Allow\"\n    rule {\n      name                  = \"network-rule-icmp-any-to-any\"\n      protocols             = [\"ICMP\"]\n      source_addresses      = [\"*\"]\n      destination_addresses = [\"*\"]\n      destination_ports     = [\"*\"]\n    }\n  }\n}\n</code></pre> <p>\u4ee5 Testinfra \u64b0\u5beb Unittest \u5c31\u6703\u50cf\u4e0b\u5217\u9019\u6a23\uff0c\u5176\u4e2d <code>testinfra.get_host(\"local://\")</code> \u662f\u8868\u793a\u5728\u672c\u6a5f\u57f7\u884c\u6e2c\u8a66\uff0c<code>self.host.addr(\"10.73.30.164\").is_reachable</code> \u7b49\u50f9\u65bc <code>ping -W 1 -c 10.73.30.164</code></p> testinfra-icmp.py<pre><code>class TestNetworkRules(unittest.TestCase):\n    def setUp(self):\n        self.host = testinfra.get_host(\"local://\")\n    def test_to_hub_vm(self):\n        self.assertTrue(self.host.addr(\"10.73.30.164\").is_reachable)\n    def test_to_spoke1_vm(self):\n        self.assertTrue(self.host.addr(\"10.73.31.4\").is_reachable)\n    def test_to_spoke2_vm(self):\n        self.assertTrue(self.host.addr(\"10.73.33.4\").is_reachable)\n</code></pre>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#b-google-dns-8888-dns","title":"\u4f7f\u7528\u8005 B \u8aaa: \u6211\u8981\u80fd\u9023\u5230 Google DNS 8.8.8.8 \u9032\u884c DNS \u89e3\u6790","text":"<p>\u9019\u500b\u5c31\u662f\u4e00\u500b\u5e38\u898b\u7684\u898f\u5247\u9700\u6c42\uff0c\u9700\u8981\u80fd\u5920\u9023\u5230\u7279\u5b9a IP \u7684\u67d0\u500b Port \u505a\u9ede\u4e8b\uff0c\u6240\u4ee5\u9019\u908a\u8981\u6311\u9078 Network Rule Collection\uff0c\u958b\u653e 8.8.8.8 \u7684 53 Port</p> network-dns.tf<pre><code>resource \"azurerm_firewall_policy_rule_collection_group\" \"fprcg-for-transit\" {\n  network_rule_collection {\n    name     = \"network-rule-collection-for-google-dns\"\n    priority = 201\n    action   = \"Allow\"\n    rule {\n      name                  = \"network-rule-icmp-any-to-any\"\n      protocols             = [\"TCP\", \"UDP\"]\n      source_addresses      = [\"*\"]\n      destination_addresses = [\"8.8.8.8\"]\n      destination_ports     = [\"53\"]\n    }\n  }\n}\n</code></pre> <p><code>google_dns.port(53).is_reachable</code> \u82e5\u6709\u6307\u5b9a Port \u5247\u6703\u4f7f\u7528 <code>nc -w 1 -z &lt;IP&gt; &lt;Port&gt;</code> \u4f86\u505a\u9a57\u8b49\uff0c\u800c\u4e0d\u662f ping\u3002\u9019\u908a\u4e5f\u53ef\u4ee5\u89c0\u5bdf\u5230 8.8.8.8\uff0c\u5176\u5be6\u6c92\u6709\u958b 80 \u51fa\u51fa\u4f86\uff0c\u53ea\u6709 53 \u548c 443 \u4ee5\u53ca ICMP</p> testinfra-google-dns.py<pre><code>class TestNetworkRules(unittest.TestCase):\n    def setUp(self):\n        self.host = testinfra.get_host(\"local://\")\n    def test_to_google_dns(self):\n        google_dns = self.host.addr(\"8.8.8.8\")\n        self.assertTrue(google_dns.is_reachable) # Equal to \"ping -W 1 -c 1 8.8.8.8\"\n        self.assertTrue(google_dns.port(53).is_reachable) # Equal to \"nc -w 1 -z 8.8.8.8 53\"\n        self.assertFalse(google_dns.port(80).is_reachable) # Equal to \"nc -w 1 -z 8.8.8.8 80\"\n        self.assertTrue(google_dns.port(443).is_reachable) # Equal to \"nc -w 1 -z 8.8.8.8 443\"\n</code></pre>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#c-githubcom-git-clone","title":"\u4f7f\u7528\u8005 C \u8aaa: \u6211\u8981\u80fd\u9023\u5230 github.com \u9032\u884c git clone \u7684\u64cd\u4f5c","text":"<p>\u56e0\u70ba\u662f\u91dd\u5c0d\u7279\u5b9a FQDN, \u6240\u4ee5\u8981\u4f7f\u7528 Application Rule Collection\uff0c\u958b\u653e 443 Port</p> application-github.tf<pre><code>resource \"azurerm_firewall_policy_rule_collection_group\" \"fprcg-for-transit\" {\n  application_rule_collection {\n    name     = \"application-rule-collection-for-transit\"\n    priority = 300\n    action   = \"Allow\"\n    rule {\n      name = \"application-rule-https-any-to-github\"\n      protocols {\n        type = \"Https\"\n        port = 443\n      }\n      source_addresses  = [\"*\"]\n      destination_fqdns = [\"github.com\"]\n    }\n}\n</code></pre> <p>\u56e0\u70ba Testinfra \u91dd\u5c0d\u7db2\u8def\u7684\u90e8\u5206\uff0c\u6bd4\u8f03\u91dd\u5c0d L3/L4 \u6709\u8457\u58a8\uff0c\u4f46\u6c92\u6709\u7279\u5225\u91dd\u5c0d L7 \u7684\u6aa2\u67e5\uff0c\u6545\u8981\u81ea\u5df1\u6488 <code>curl -o /dev/null -s -w %{http_code}</code> HTTP Status Code \u4f86\u505a\u6aa2\u67e5\u3002is_resolvable \u4e3b\u8981\u662f\u7528\u4f86\u6aa2\u67e5 DNS \u662f\u5426\u6b63\u5e38\uff0c\u82e5\u6b63\u5e38\u5247\u6703\u56de\u50b3 IP\u3002</p> testinfra-github.py<pre><code>class TestApplicationRules(unittest.TestCase):\n    def setUp(self):\n        self.host = testinfra.get_host(\"local://\")\n    def test_to_github(self):\n        # L3/L4 Check\n        github_network = self.host.addr(\"github.com\")\n        self.assertFalse(github.is_reachable) # Equal to \"ping -W 1 -c 1 github.com\"\n        self.assertTrue(github.port(80).is_reachable) # Equal to \"nc -w 1 -z github.com 80\"\n        self.assertTrue(github.port(443).is_reachable) # Equal to \"nc -w 1 -z github.com 443\"\n        self.assertTrue(github.port(443).is_resolvable) # Equal to \"getent ahosts github.com\"\n        # L7 Check\n        github_http = self.host.run(\"curl --connect-timeout 3 -o /dev/null -s -w %{http_code} https://github.com\")\n        self.assertNotEqual(github.stdout, \"200\") # Use HTTP Status Code to check if the website is up\n</code></pre>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#d-azurearchiveubuntucom-apt-update-apt-upgrade","title":"\u4f7f\u7528\u8005 D \u8aaa: \u6211\u8981\u80fd\u9023\u5230 azure.archive.ubuntu.com \u9032\u884c apt update &amp;&amp; apt upgrade \u7684\u64cd\u4f5c","text":"<p>Azure \u5167\u63d0\u4f9b\u7684 azure.archive.ubuntu.com \u662f\u7d66 Ubuntu \u7cfb\u5217\u7684 VM \u4f86\u9032\u884c apt update &amp;&amp; apt upgrade \u7684\u64cd\u4f5c\uff0c\u4f46\u50c5\u6709 HTTP \u6c92\u6709 HTTPS\uff0c\u6240\u4ee5\u9019\u908a\u4e5f\u8981\u4f7f\u7528 Application Rule Collection\uff0c\u958b\u653e HTTP/80</p> application-ubuntu.tf<pre><code>resource \"azurerm_firewall_policy_rule_collection_group\" \"fprcg-for-transit\" {\n  application_rule_collection {\n    name     = \"application-rule-collection-for-transit\"\n    priority = 301\n    action   = \"Allow\"\n    rule {\n      name = \"application-rule-https-any-to-ubuntu\"\n      protocols {\n        type = \"Http\"\n        port = 80\n      }\n      source_addresses  = [\"*\"]\n      destination_fqdns = [\"azure.archive.ubuntu.com\"]\n    }\n}\n</code></pre> <p>\u9019\u908a\u91dd\u5c0d HTTPS \u4e0d\u61c9\u8a72\u5b58\u5728\u56de\u61c9\u7684\u72c0\u6cc1\u9032\u884c\u6aa2\u67e5\uff0c\u4f7f\u7528 <code>assertNotEqual</code> \u4f86\u6aa2\u67e5\u4e0d\u61c9\u8a72\u6709 HTTP Status Code 200 \u7684\u72c0\u6cc1\u767c\u751f</p> testinfra-ubuntu.py<pre><code>class TestApplicationRules(unittest.TestCase):\n    def setUp(self):\n        self.host = testinfra.get_host(\"local://\")\n    def test_to_ubuntu(self):\n        # L3/L4 Check\n        azure_ubuntu_repo = self.host.addr(\"azure.archive.ubuntu.com\")\n        self.assertFalse(azure_ubuntu_repo.is_reachable) # Equal to \"ping -W 1 -c 1 azure.archive.ubuntu.com\"\n        self.assertTrue(azure_ubuntu_repo.port(80).is_reachable)  # Equal to \"nc -w 1 -z azure.archive.ubuntu.com 80\"\n        self.assertFalse(azure_ubuntu_repo.port(443).is_reachable) # Equal to \"nc -w 1 -z azure.archive.ubuntu.com 443\"\n        self.assertTrue(azure_ubuntu_repo.is_resolvable) # Equal to \"getent ahosts azure.archive.ubuntu.com\"\n        # L7 Check\n        azure_ubuntu_http = self.host.run(\"curl --connect-timeout 3 -o /dev/null -s -w %{http_code} https://azure.archive.ubuntu.com\")\n        self.assertNotEqual(azure_ubuntu_http.stdout, \"200\") # HTTPS is not supported\n\n        azure_ubuntu_http = self.host.run(\"curl --connect-timeout 3 -o /dev/null -s -w %{http_code} http://azure.archive.ubuntu.com\")\n        self.assertEqual(azure_ubuntu_http.stdout, \"200\") # HTTP is supported\n</code></pre>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#qa","title":"Q&amp;A","text":"","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q1-serverspec","title":"Q1: \u70ba\u4f55\u4e0d\u7528 Serverspec \u4f86\u5beb\u6e2c\u8a66?","text":"<ol> <li>Python \u5728\u591a\u6578\u7684 Linux \u74b0\u5883\u90fd\u6709</li> <li>\u6211\u500b\u4eba\u770b\u4e0d\u592a\u61c2 Ruby \u7684 Source Code\uff0c\u4f46 Python \u5c31\u770b\u5f97\u61c2\u4e86</li> </ol>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q2-pytest-pytest-testinfra","title":"Q2: pytest \u8ddf pytest-testinfra \u6709\u4ec0\u9ebc\u5dee\u5225?","text":"<ul> <li>pytest: \u5e6b\u52a9\u4f60\u5beb\u51fa\u66f4\u597d\u7684 Python \u7a0b\u5f0f</li> <li>pytest-testinfra: \u57fa\u65bc pytest \u7684\u57fa\u790e\uff0c\u5e6b\u52a9\u4f60\u6301\u7e8c\u6aa2\u67e5\u51fa\u4f60\u6c92\u6ce8\u610f\u5230\u7684 Infrastructure \u529f\u80fd\u6027\u554f\u984c</li> </ul>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q3-azure","title":"Q3: \u6211\u4e00\u5b9a\u8981\u4f7f\u7528 Azure \u624d\u80fd\u5beb\u6e2c\u8a66\u55ce?","text":"<p>No. \u4f60\u6b64\u6642\u6b64\u523b\u53ea\u8981\u6709\u9047\u5230\u7db2\u8def\u6aa2\u67e5\u554f\u984c\uff0c\u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u5beb</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q4","title":"Q4: \u6211\u4e0d\u77e5\u9053\u6211\u70ba\u4ec0\u9ebc\u88ab\u6a94\u4e86\uff0c\u5beb\u6e2c\u8a66\u53ef\u4ee5\u5e6b\u52a9\u6211\u55ce?","text":"<p>\u5176\u5be6\u5beb Unit Test \u5c31\u662f\u5e6b\u52a9\u4f60\u4e86\u89e3\u4f60\u7684 Firewall Rule \u5230\u5e95\u662f\u6709\u6b63\u5e38\u904b\u4f5c\u9084\u662f\u6c92\u6b63\u5e38\u904b\u4f5c\uff0c\u5982\u679c\u4f60\u6709\u4ed4\u7d30\u770b Azure Firewall Log\uff0c\u5728\u4e0a\u9762\u90fd\u6703\u5f88\u6e05\u695a\u986f\u793a\u4f60\u9019\u500b\u52d5\u4f5c\uff0c\u662f\u5c0d\u61c9\u5230\u54ea\u4e00\u689d Policy \u800c Allow \u6216\u8005\u662f Deny\uff0c\u53ef\u4ee5\u4ee5\u4f7f\u7528\u8005\u7684\u89d2\u5ea6\u78ba\u4fdd\u4f60\u7684\u8a8d\u77e5\u3001\u4f7f\u7528\u8005\u7684\u8a8d\u77e5\u4ee5\u53ca Azure Firewall \u7684\u8a2d\u5b9a\u662f\u6b63\u78ba\u7684</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q5","title":"Q5: \u6211\u61f6\u5f97\u5beb\uff0c\u6709\u6c92\u6709\u61f6\u4eba\u5305","text":"<p>\u8acb\u53c3\u8003 Code Snippet pichuang/testinfra-code-snippet \u8907\u88fd\u8cbc\u4e0a\u4fee\u6539</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q6","title":"Q6: \u611f\u89ba\u7db2\u8def\u6e2c\u8a66\u611f\u89ba\u90fd\u662f\u6b63\u9762\u8868\u5217\uff0c\u90fd\u6c92\u6709\u8ca0\u5411\u8868\u5217\u7684\u55ce?","text":"<p>\u591a\u4f7f\u7528 assertFalse \u548c assertNotEqual \u4f86\u78ba\u4fdd\u4f60\u7684\u6e2c\u8a66\u662f\u6b63\u78ba\u7684\uff0c\u7136\u5f8c\u4f60\u4e0d\u592a\u53ef\u80fd\u7aae\u76e1\u6240\u6709\u7684\u53ef\u80fd\u6027\uff0c\u6240\u4ee5\u4e00\u958b\u59cb\u4ee5\u6b63\u9762\u8868\u5217\u7684 Test Case \u5148\u51fa\u767c\uff0c\u5728\u5f8c\u7e8c\u7684\u6e2c\u8a66\u548c\u56de\u994b\u4e2d\uff0c\u518d\u4f9d\u7167\u4f60\u7684\u9700\u6c42\u4f86\u589e\u52a0 Unit Test Case</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q7","title":"Q7: \u9019\u500b\u6709\u6c92\u6709\u4ec0\u9ebc\u65b9\u6cd5\u8ad6","text":"<p>TDD (Test Driven Development)\uff0c\u53ea\u662f\u591a\u534a\u90fd\u662f\u7528 TDD \u5e6b\u52a9\u7a0b\u5f0f\u66f4\u597d\uff0c\u9019\u908a\u662f\u7528 TDD \u5e6b\u52a9\u4f60\u7684 Firewall Policy \u8a2d\u8a08\u7684\u66f4\u597d</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q8-ip-url","title":"Q8: \u770b\u5230 IP \u548c URL \u5efa\u8b70\u6e2c\u8a66\u9806\u5e8f\u70ba\u4f55?","text":"<ul> <li> <p>\u4f60\u5982\u679c\u662f\u8981\u6e2c\u8a66\u7279\u5b9a IP \u7684\u8a71\uff0c\u8b6c\u5982 8.8.8.8\uff0c\u5efa\u8b70\u6e2c\u8a66\u9806\u5e8f\u70ba</p> <ol> <li>ICMP \u901a\u4e0d\u901a</li> <li>\u7279\u5b9a Port \u901a\u4e0d\u901a</li> </ol> </li> <li> <p>\u4f60\u5982\u679c\u662f\u8981\u6e2c\u8a66\u7279\u5b9a URL \u7684\u8a71\uff0c\u8b6c\u5982 https://blog.pichuang.com.tw\uff0c\u5efa\u8b70\u6e2c\u8a66\u9806\u5e8f\u70ba</p> <ol> <li>ICMP \u901a\u4e0d\u901a</li> <li>\u7279\u5b9a Port \u901a\u4e0d\u901a</li> <li>\u80fd\u4e0d\u80fd\u505a DNS Resolution</li> <li>\u4ee5 Curl \u8a72 URL \u7372\u5f97 HTTP Status Sode \u4f86\u5224\u65b7\u6b63\u4e0d\u6b63\u5e38</li> </ol> </li> </ul>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q9-pytest-unittest","title":"Q9: \u65e2\u7136\u90fd\u662f\u7528 pytest \u70ba\u4e3b\uff0c\u90a3\u5e79\u561b\u9084\u8981\u7528 unittest \u6846\u67b6?","text":"<p>\u6069...\u6211\u4e00\u958b\u59cb\u5c31\u7528 unitest \u6846\u67b6\u5beb\uff0c\u7136\u5f8c\u5c31...\u61f6\u5f97\u91cd\u69cb\u4e86</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#q10-github-copilot","title":"Q10: \u70ba\u5565\u4e0d\u8981\u5168\u90e8\u76f4\u63a5\u7528 GitHub Copilot \u81ea\u52d5\u5beb\u5168\u90e8\u6e2c\u8a66?","text":"<p>GitHub Copilot \u4e0d\u61c2\u7db2\u8def\u8cc7\u5b89\u3001\u6cd5\u898f\u548c\u4eba\u5fc3 :)</p>","tags":["test","networking","azure"]},{"location":"20230306-tdd-for-network-connectivity.html#references","title":"References","text":"<ul> <li>Azure Firewall Policy rule sets</li> <li>pytest: helps you write better programs</li> <li>pichuang/testinfra-code-snippet</li> <li>Testinfra: Testinfra test your infrastructure</li> </ul>","tags":["test","networking","azure"]},{"location":"20230316-openai-api-development-exp.html","title":"\u4f7f\u7528 OpenAI API \u958b\u767c\u7d93\u9a57\u5206\u4eab","text":"Note <p>\u56e0 OpenAI \u76f8\u95dc\u6280\u8853\u767c\u5c55\u795e\u901f\uff0c\u672c\u6587\u6709\u6548\u6642\u9593\u53ef\u80fd\u4e0d\u7b97\u592a\u9577\uff0c\u95b1\u8b80\u5f8c\u52d9\u5fc5\u8981\u81ea\u884c\u518d\u7528\u81ea\u8eab\u7d93\u9a57\u9a57\u8b49</p> <p>\u5f88\u4e45\u6c92\u5beb Python\uff0c\u4f46\u6211\u672c\u4f86\u53ea\u662f\u60f3\u8981\u7814\u7a76\u4e00\u4e0b APM (Application Performance Monitoring) \u600e\u9ebc\u9806\u5229\u5730\u8dd1\u5728 AKS \u548c ARO \u4e0a\uff0c\u7136\u5f8c\u5c31\u4e0d\u5c0f\u5fc3\u5c31\u628a Line Bot ft. OpenAI \u5beb\u4e00\u5beb\u4e86\uff0c\u65e2\u7136\u5beb\u4e86\u5c31\u9806\u4fbf\u7d00\u9304\u4e00\u4e0b</p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#tldr","title":"TL;DR","text":"<ol> <li>Azure OpenAI Service \u548c OpenAI \u7684 API \u547c\u53eb\u6709\u53ef\u80fd\u6703\u4e0d\u4e00\u6a23\uff0c\u52d9\u5fc5\u8981\u78ba\u8a8d</li> <li>Error Handling \u5efa\u8b70\u8981\u505a\uff0c\u4e0d\u7136\u4f60\u6c38\u9060\u53ea\u6703\u6536\u5230 500 Internal Server Error</li> <li>\u79c1\u6709\u7db2\u8def\u9023\u5165\u65b9\u5f0f\uff0c\u552f\u4e00\u9078\u64c7 Azure OpenAI Service</li> </ol>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#azure-openai-service-openai","title":"Azure OpenAI Service \u8207 OpenAI \u7570\u540c\u4e4b\u8655","text":"<p>\u57fa\u65bc\u5c0f\u5f1f\u81ea\u884c\u5beb\u904e\u5169\u908a\u670d\u52d9\u7684\u7d93\u9a57\u548c\u5c0d Azure \u719f\u6089\u7a0b\u5ea6\uff0c\u5217\u8209\u51fa\u4e0b\u5217\u7684\u6bd4\u8f03</p> Features Azure OpenAI Service (AOAI) OpenAI (OAI) \u670d\u52d9\u5b9a\u4f4d \u7a69\u5b9a \u6700\u65b0 API Endpoint https://{your own endpoint}.openai.azure.com https://api.openai.com SLA 99.9% \u672a\u4f86\u6703\u63a8\u51fa \u6a21\u578b\u652f\u63f4 GPT-3.5, DALL-E and Codex (including Codex Fine-Tuning) GPT-3.5, Codex and DALL-E, ChatGPT API and Whisper API Azure \u53ef\u7528\u5340\u57df 3 \u500b, West Europe/South Central US/East US 1 \u500b, US \u4e3b\u8981\u670d\u52d9\u7a97\u53e3 Microsoft Azure OpenAI \u5ba2\u6236\u652f\u63f4\u65b9\u5f0f \u5728\u5730 Azure \u5718\u968a \u9700\u81ea\u884c\u627e OpenAI \u5718\u968a \u652f\u63f4\u4ed8\u6b3e\u65b9\u5f0f \u4f7f\u7528 MACC (Microsoft Azure Consumption Commitment) \u4fe1\u7528\u5361\u6216\u5176\u4ed6\u65b9\u5f0f Public API Endpoint \u53ef \u53ef Public API Endpoint \u8cc7\u5b89\u6a5f\u5236 \u53ef\u9650\u5b9a\u7279\u5b9a IP \u6216\u7279\u5b9a Subnet \u9023\u5165 \u7121 Private API Endpoint \u4f7f\u7528 Azure Private Endpoint / Private Link \u7121 Security \u53ef\u6cbf\u7528 Azure \u65e2\u6709\u8cc7\u5b89\u670d\u52d9 \u9700\u81ea\u884c\u8655\u7406 RBAC \u63a1\u7528 Azure Acitve Directory \u6216\u81ea\u884c\u6574\u5408 3rd SSO OpenAI \u81ea\u5e36 SSO \u6216\u81ea\u884c\u6574\u5408 3rd SSO","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#_1","title":"\u500b\u4eba\u7d93\u9a57\u5206\u4eab","text":"<p>\u6574\u9ad4\u67b6\u69cb\u5716</p> <p></p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#bot","title":"Bot \u4e3b\u7a0b\u5f0f","text":"<p>\u4e3b\u8981\u76ee\u7684\u662f\u5e0c\u671b\u80fd\u8b93 Line \u53ef\u4ee5\u4e32\u63a5\u5230 OpenAI API\uff0c\u76f4\u63a5\u4f7f\u7528 Line \u9032\u884c\u5c0d\u8a71\uff0c\u76ee\u524d\u5df2\u5be6\u4f5c\u51fa\u4e0b\u5217 3 \u7a2e\u65b9\u5f0f\uff0c\u4e3b\u8981\u6703\u91dd\u5c0d 2 \u548c 3 \u4ee5 Python \u70ba\u4e3b\u7684\u65b9\u5f0f\u4f5c\u63a2\u8a0e</p> <ol> <li>OpenAI API + Nodejs 11</li> <li>OpenAI API + Python 3.9 + Flask</li> <li>Azure OpenAI API + Python 3.9 + Flask</li> </ol> <p>\u82e5\u4ee5 Python 3 \u70ba\u4e3b\u7684\u958b\u767c\u8a9e\u8a00\uff0c\u4f60\u6703\u9700\u8981\u77e5\u9053\u4e0b\u5217\u5e7e\u500b Python \u76f8\u95dc\u7684\u8cc7\u8a0a\uff0c\u57fa\u672c\u4e0a\u5168\u90e8\u90fd\u4e00\u6a23 \uff0c\u8981\u7559\u610f AOAI \u8ddf OAI \u6240\u4f7f\u7528\u5230\u7684 Python SDK <code>\u76ee\u524d</code>\u662f\u540c\u4e00\u500b</p> DX Azure OpenAI Service (AOAI) OpenAI (OAI) API Framework Flask 2.x Flask 2.x Python Library OpenAI Python Library OpenAI Python Library Line Bot Library Line Bot SDK Python Line Bot SDK Python Python Version Python 3.9 Python 3.9 Python Environment venv venv <p>\u7a0b\u5f0f\u958b\u767c\u4e0a\uff0c\u53ef\u4ee5\u5206\u4e0b\u5217 2 \u968e\u6bb5:</p> <ol> <li>Flask + Line Message API \u4e32\u63a5\u53ca\u6e2c\u8a66: \u9019\u500b\u7db2\u8def\u4e0a\u76f8\u7576\u591a\u652f\u63f4\uff0cLine SDK \u7bc4\u4f8b\u4e5f\u5beb\u5f97\u5f88\u6e05\u695a\uff0c\u96e3\u5ea6\u4e0d\u9ad8</li> <li> <p>Flask + Azure OpenAI \u6216 OpenAI \u4e32\u63a5\u53ca\u6e2c\u8a66: \u9019\u500b\u8981\u7559\u610f\u5230\uff0c\u5169\u908a\u6240\u4f7f\u7528\u7684 Funcion\u3001API Endpoint\u3001\u56de\u50b3\u5167\u5bb9\u7b49\u7b49\u90fd\u4e0d\u4e00\u6a23</p> <ul> <li>\u5982\u679c\u4f60\u662f\u4ee5 Azure OpenAI Service \u958b\u767c\u70ba\u4e3b\u7684\uff0c\u52d9\u5fc5\u8981\u628a Azure OpenAI Studio \u6240\u63d0\u4f9b\u7684 Playground \u5148\u73a9\u904e\u4e00\u6b21\uff0c\u6703\u7701\u4e0b\u76f8\u7576\u591a\u7684\u89c0\u843d\u9670\u6642\u9593</li> <li>\u5982\u679c\u4f60\u662f\u4ee5 OpenAI Service \u958b\u767c\u70ba\u4e3b\u7684\uff0c\u5c31\u662f\u5148\u770b OpenAI Cookbook \u70ba\u4e3b</li> </ul> </li> </ol> <p>\u4e3b\u8981\u90fd\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u662f\u5728\u9001\u8a0a\u606f\u51fa\u53bb\u5230 AOAI/OAI API Endpoint \u7684\u90e8\u5206\uff0c\u4e0b\u9762\u63d0\u4f9b 2 \u500b\u5beb\u6cd5\u4e0a\u7684\u5dee\u7570</p> azure-openai-service.snippet<pre><code>gpt_response = openai.Completion.create(\n    engine=\"gpt35\",\n    prompt=create_prompt(system_message, messages),\n    max_tokens=2048,\n    temperature=0.7,\n    stop=[\"&lt;|im_end|&gt;\"],\n)\n</code></pre> openai-service.snippet<pre><code>gpt_response = openai.ChatCompletion.create(\n    model=\"gpt-3.5-turbo\",\n    messages=[\n        {\"role\": \"user\", \"content\": event.message.text }\n    ],\n    max_tokens=2048,\n    temperature=0.7,\n    stop=None\n)\n</code></pre> <p>\u64da\u6211\u5c0d\u73fe\u884c SDK \u548c API \u7684\u7406\u89e3\u662f OpenAI \u6703\u5148\u7576\u524d\u5c0e\u9a57\u8b49\u6e2c\u8a66\u7684\u89d2\u8272\uff0c\u7b49\u4f7f\u7528\u5230\u5927\u90e8\u5206\u7684\u554f\u984c\u90fd\u89e3\u6c7a\u4e86\u4ee5\u5f8c\uff0c\u624d\u6703\u4e0b\u653e\u5230 Azure OpenAPI \u4f86\u505a\u4f01\u696d\u7d1a\u7684\u5c0e\u5165\u548c\u4f7f\u7528\uff0c\u4f46\u56e0\u70ba\u9019\u6280\u8853\u9032\u5c55\u5f88\u5feb</p> <p>\u95dc\u65bc Error Handling\uff0c\u8655\u7406\u9019\u6bb5\u7a0b\u5f0f\u78bc\u7684\u6642\u5019\uff0c\u6703\u6709\u8d85\u9ad8\u6a5f\u7387\u6703\u6536\u5230 500 Internal Server Error\uff0c\u6709\u5404\u5f0f\u5404\u6a23\u7684\u7406\u7531\u6703\u5c0e\u81f4\u51fa\u73fe\u9019\u500b\uff0c\u53cd\u8209  InvalidRequestError\u3001APIConnectionError\u3001AuthError \u548c\u4f60\u8f38\u5165\u5b83\u89ba\u5f97\u4e0d\u5408\u898f\u7684\u6587\u5b57\u7b49\u7b49\uff0c\u90fd\u6703\u5410\u76f8\u540c\u7684 HTTP Status 500 \u7d66\u4f60\uff0c\u8a73\u7d30\u53ef\u770b error.py\uff0c\u6240\u4ee5\u5efa\u8b70 Error Handling \u8981\u505a\u548c\u4e0a Logger \u7d00\u9304\u4e00\u4e0b</p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#bot_1","title":"Bot \u904b\u884c\u5e73\u53f0\u53ca\u90e8\u7f72\u65b9\u5f0f","text":"<p>\u95dc\u65bc\u904b\u884c\u5e73\u53f0\uff0c\u63d0\u4f9b\u4e0b\u5217\u53c3\u6578</p> <ul> <li> <p>Azure Web App Service</p> <ul> <li>App Service Plan: <code>B1</code></li> <li>Operating System: <code>Linux</code></li> <li>Language: <code>Python 3.9</code></li> </ul> </li> </ul> <p>\u5982\u679c\u4f60\u662f\u5beb NodeJS \u7684\u8a71\uff0c\u53ef\u4ee5\u76f4\u63a5\u52a0\u958b Application Insight \u505a Auto-instrumentation\uff0c\u8d85...\u65b9\u4fbf(\u5982\u4e0b\u5716)\uff0c\u53ef\u60dc Python \u6c92\u6709\uff0c\u8981\u81ea\u5df1\u5beb</p> <p></p> <p>\u95dc\u65bc\u90e8\u7f72\u65b9\u5f0f\uff0c\u4e3b\u8981\u63a1\u7528 GitHub \u548c GitHub Actions\uff0c\u81ea\u52d5\u90e8\u7f72\u5230\u6307\u5b9a\u7684 Azure Web App Service \u4e0a\u904b\u884c\uff0cWorkflow \u6703\u81ea\u5df1\u7522\u751f\u51fa\u4f86\uff0c\u6240\u4ee5\u6211\u4e5f\u5c31\u6c92\u6709\u6539\u4ec0\u9ebc\u5c31\u4e0a\u4e86</p> <p></p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#_2","title":"\u4e0b\u4e00\u6b65?","text":"<ol> <li>\u96f2\u5730\u7db2\u8def\u6574\u5408: \u56e0\u70ba\u53ea\u6709 Azure OpenAI Service \u53ef\u4ee5\u628a API Endpoint \u8eb2\u5728 Private Network \u88e1</li> <li>\u5f37\u5316 Application Performance Management (APM) \u80fd\u529b: \u4f7f\u7528 Azure Application Insight\uff0c\u4e3b\u8981\u662f\u6536\u96c6 Metrics \u6bd4\u8f03\u597d\u5224\u65b7 API \u4e4b\u9593\u547c\u53eb\u7684\u72c0\u6cc1</li> <li>\u5bb9\u5668\u5316: Dockerfile \u548c docker-compose \u64b0\u5beb</li> <li>\u90e8\u7f72\u5230 Azure Kubernetes Service / Azure Red Hat OpenShift: \u56e0\u70ba\u9019\u500b\u670d\u52d9\u525b\u597d\u662f Stateless Application \u7684\u4ee3\u8868\uff0c\u6240\u4ee5\u76f8\u7576\u9069\u5408\u62ff\u4f86\u4e1f\u5728 K8s \u4e0a\u9762\u641e\u5f88\u591a\u5947\u602a\u7684 Demo</li> </ol>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q-a","title":"Q &amp; A","text":"","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q1-flask","title":"Q1: \u70ba\u4f55\u4f7f\u7528 Flask?","text":"<p>\u6211\u89ba\u5f97\u770b\u8d77\u4f86\u6bd4\u8f03\u76f4\u89ba\u4e00\u9ede\uff0cVSCode \u539f\u751f\u4e5f\u652f\u63f4 Flask Debugger\uff0c\u8a73\u53c3 Flask Tutorial in Visual Studio Code\uff0c\u9084\u6211\u9752\u6625\uff0c\u6e1b\u5c11\u89c0\u843d\u9670\u6642\u9593</p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q2-aoai-oai-flask-app","title":"Q2: \u53ef\u4e0d\u53ef\u4ee5\u5c07 AOAI \u8ddf OAI \u7684\u547c\u53eb\u5beb\u5728\u540c\u4e00\u500b flask app?","text":"<p>\u6280\u8853\u4e0a\u4e00\u5b9a\u53ef\u4ee5\uff0c\u4f46\u56e0\u70ba AOAI \u8ddf OAI \u7121\u8ad6\u662f\u51fd\u5f0f\u3001API Endpoint\u3001Parameter\u3001Key Format\uff0c\u5176\u5be6\u9084\u662f\u6709\u5dee\u7570\uff0c\u79c9\u6301 KISS \u539f\u5247\uff0c\u5efa\u8b70 AOAI \u5beb\u4e00\u500b app\uff0cOAI \u81ea\u5df1\u5beb\u4e00\u500b app\uff0c\u4e0d\u8981\u641e\u5f97\u592a\u8907\u96dc</p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q3-model-azure-openai-service-openai","title":"Q3: \u7528\u540c\u4e00\u53e5\u6587\u5b57\uff0c\u540c\u6a23\u7684 Model\uff0c\u554f Azure OpenAI Service \u8ddf OpenAI \u6703\u662f\u4e00\u6a23\u7684\u7d50\u679c\u55ce?","text":"<p>\u4e0d\u4e00\u6a23\uff0c\u5982\u679c\u8a60\u5531 (Prompt) \u592a\u77ed\u7684\u8a71\uff0c\u540c\u4e00\u500b\u554f\u984c\u554f\u8d77\u4f86\u6703\u5929\u5dee\u5730\u9060\uff0c\u8acb\u53c3\u8003\u4e0b\u5217\u7bc4\u4f8b</p> <p></p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q4-api-endpoint","title":"Q4: \u5982\u679c\u6211\u9700\u8981 API Endpoint \u5728\u79c1\u6709\u7db2\u8def\u5167\uff0c\u8981\u9078\u4ec0\u9ebc?","text":"<p>\u53ea\u6709 Azure OpenAI Service\uff0c\u56e0\u70ba\u6709\u652f\u63f4 Private Link / Private Endpoint\uff0c\u540c\u6642\u4e4b\u9593\u4e5f\u6709\u652f\u63f4\u8de8\u5340\u57df\u9023\u7dda\u7684\u65b9\u5f0f\uff0c\u4e0b\u5716\u5c31\u662f\u4e00\u500b\u5f88\u5178\u578b\u7684\u8a2d\u5b9a\uff0cAzure OpenAI Service \u958b\u5728 South Central US\uff0c\u800c Private Endpoint \u548c Private Link \u5247\u653e\u5728 Japan East</p> <p></p>","tags":["openai","azure"]},{"location":"20230316-openai-api-development-exp.html#q5-api-endpoint-rate-limitquotaauth","title":"Q5: \u5982\u679c\u6211\u9700\u8981 API Endpoint \u5728\u5916\u7db2\uff0c\u4f46\u53c8\u8981\u6709 Rate Limit\u3001Quota\u3001Auth \u7b49\u7b49\u7684\u7ba1\u7406\u6a5f\u5236\u8a72\u600e\u9ebc\u8fa6?","text":"<p>\u8acb\u627e API Management \u76f8\u95dc\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u5982\u679c\u4f60\u662f Azure \u7684\u8a71\u5c31\u662f Azure API Management \u53ef\u4ee5\u898f\u5283\u4f7f\u7528</p>","tags":["openai","azure"]},{"location":"20230411-slo-latency.html","title":"\u5982\u4f55\u5b9a\u7fa9 Network Latency SLOs? 4 \u500b\u8a2d\u8a08\u539f\u5247\u8207\u767e\u5206\u4f4d\u6578\u89e3\u6790","text":"Note <p>\u8861\u91cf\u4f60\u60f3\u8981\u76e3\u63a7\u7684\u5167\u5bb9\u610f\u7fa9\uff0c\u4e0d\u8981\u53ea\u76e3\u63a7\u60a8\u78b0\u5de7\u80fd\u5920\u8f15\u9b06\u76e3\u63a7\u7684\u5167\u5bb9</p> <p>Service Level Objectives (SLO) \u53ef\u4ee5\u8b93\u4f60\u6e05\u695a\u7684\u7406\u89e3\u73fe\u5728\u7cfb\u7d71\u904b\u4f5c\u7684\u72c0\u6cc1\uff0c\u4f46\u5b83\u80cc\u5f8c\u7684\u6578\u5b57\u4ee3\u8868\u610f\u7fa9\u662f\u9700\u8981\u900f\u904e\u4e00\u9023\u4e32\u7684\u6578\u5b57\u7d71\u8a08\u548c\u8a08\u7b97\u800c\u5f97\u7684\u3002\u800c\u6700\u8fd1\u7121\u8ad6\u662f\u8a2d\u8a08\u8de8\u570b\u7db2\u8def\uff0c\u96f2\u5730\u6df7\u5408\u7db2\u8def\uff0c\u90fd\u6703\u9047\u5230\u4e00\u500b\u95dc\u9375\u5143\u7d20: <code>Latency</code> \u5ef6\u9072\uff0c\u5c0d\u65bc\u8cc7\u6599\u50b3\u8f38\u4f86\u8aaa\uff0c\u5ef6\u9072\u662f\u4e00\u500b\u5f88\u91cd\u8981\u7684\u6307\u6a19\uff0c\u56e0\u6b64\u6211\u5011\u9700\u8981\u4e00\u500b\u65b9\u6cd5\u4f86\u5b9a\u7fa9\u9019\u500b\u6307\u6a19\uff0c\u9019\u7bc7\u6587\u7ae0\u5c31\u662f\u8981\u4f86\u4ecb\u7d39\u5982\u4f55\u5b9a\u7fa9 Network Latency SLOs</p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#4","title":"4 \u500b\u8a2d\u8a08\u539f\u5247","text":"<ol> <li>\u55ae\u4f4d\u5fc5\u9808\u662f <code>milliseconds (ms)</code></li> <li>\u5efa\u8b70\u8981\u5448\u73fe 6 \u500b\u767e\u5206\u4f4d\u6578 (P, Percentile) : <code>P50, P75, P90, P99, P99.9, P99.99</code></li> <li>\u9664\u4e86\u4e0a\u8ff0\u7684\u767e\u5206\u4f4d\u6578\uff0c\u5982\u679c\u8981\u65b0\u589e\u65b0\u7684\u767e\u5206\u4f4d\u6578\uff0c\u5247\u9700\u8981\u4e00\u5b9a\u8981 <code>&gt;= P50</code>\uff0c\u82e5\u4f4e\u65bc P50 \u5247\u6c92\u6709\u610f\u7fa9</li> <li>SLO Target \u9700\u8981\u5305\u542b\u4e0a\u8ff0\u6700\u5c11 2 \u500b\u767e\u5206\u4f4d\u6578\uff0c\u5176\u4e2d\u4e00\u500b\u5fc5\u9808\u662f <code>P99</code></li> </ol>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#network-latency-slo","title":"Network Latency SLO \u5e38\u898b\u63cf\u8ff0","text":"<p>\u63a1\u7528\u767e\u5206\u4f4d\u6578\u8868\u793a\u6cd5: \u65bc\u7279\u5b9a\u670d\u52d9 X\uff0c\u767e\u5206\u4f4d\u6578 % Latency \u5728 \u7279\u5b9a\u6642\u9593\u5340\u6bb5 P \u5167 \u9700\u8981\u5c0f\u65bc\u591a\u5c11 T ms\"</p> <p>\u201cCompoents X report that % of latency in PERIOD are served in &lt; T ms\u201d</p> <p>\u5728\u591a\u6578\u72c0\u6cc1\u4f86\u8b1b\uff0cLatency \u662f\u8d8a\u4f4e\u8d8a\u597d (Lower is Better)\uff0c\u6240\u4ee5\u5f8c\u9762\u7684\u5224\u65b7\u5f0f\u70ba<code>\u5c0f\u65bc</code>\u70ba\u4e3b</p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#_1","title":"\u767e\u5206\u4f4d\u6578\u89e3\u6790","text":"<p>\u4ee5\u4e0b\u5217\u8cc7\u6599\u96c6\u4f5c\u70ba\u7bc4\u4f8b</p> data set<pre><code>40, 38, 39.3, 120, 50, 78, 38.1, 37.2, 100, 39, 37, 37.3\n</code></pre> <p></p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#p50-median","title":"\u70ba\u4f55\u8981\u8a2d\u5b9a P50 (\u4e2d\u4f4d\u6578, Median)?","text":"<p>\u7279\u5b9a\u6642\u9593\u5340\u6bb5\u4e2d\uff0c100 \u500b\u6578\u5b57\u4e2d\uff0c\u5f9e\u5c0f\u5230\u5927\u9032\u884c\u6392\u5e8f\uff0c\u7b2c 50% \u6578\u5b57\uff0c\u4ee5\u4e0a\u9762 Data Set \u70ba\u4f8b\uff0cP50 = <code>39.15</code>\uff0c\u4ee3\u8868 50% \u7684 Network Latency \u5728 39.15ms \u4ee5\u4e0b\u6216\u66f4\u5c0f</p> <ol> <li>\u9069\u5408\u60c5\u5883: \u9069\u5408\u770b\u5168\u7ad9\u7db2\u8def\u6548\u80fd\u4e0b\u964d\u6216\u4e0a\u5347\uff0c\u6574\u9ad4\u66f2\u7dda\u7a69\u5b9a</li> <li>\u4e0d\u9069\u5408\u60c5\u5883: \u4f7f\u7528\u8005\u8ddf\u4f60\u8aaa\u4ed6<code>\u73fe\u5728\u9023\u7dda</code>\u5f88\u6162</li> <li>\u80fd\u5920\u907f\u514d: \u975e\u5e38\u614b\u5206\u4f48\u72c0\u6cc1 (Non-normal distributions) \u548c\u504f\u5dee\u503c\u5f71\u97ff</li> </ol> <p>Azure network round-trip latency statistics \u5176\u5be6\u5c31\u662f\u4e00\u500b\u6700\u597d\u7684\u7bc4\u4f8b\uff0c\u4e0b\u5716\u63d0\u4f9b\u4e86\u65bc <code>2022/06 \u6642\u9593 30 \u5929\u5340\u6bb5 P50 \u7684 Latency \u8868\u73fe</code></p> <p></p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#p99","title":"\u70ba\u4f55\u8981\u8a2d\u5b9a P99 \u6216\u66f4\u9ad8\u767e\u5206\u4f4d\u6578?","text":"<p>\u7279\u5b9a\u6642\u9593\u5340\u6bb5\u4e2d\uff0c100 \u500b\u6578\u5b57\u4e2d\uff0c\u5f9e\u5c0f\u5230\u5927\u9032\u884c\u6392\u5e8f\uff0c\u7b2c 99% \u7684\u6578\u5b57\uff0c\u4ee5\u4e0a\u9762 Data Set \u70ba\u4f8b\uff0cP99 = <code>119.98</code>\uff0c\u4ee3\u8868 99% \u7684 Network Latency \u5728 119.98ms \u4ee5\u4e0b\u6216\u66f4\u5c0f</p> <ol> <li>\u9069\u5408\u60c5\u5883: \u8cbc\u8fd1\u4f7f\u7528\u8005\u7576\u4e0b\u4f7f\u7528\u72c0\u6cc1\uff0c\u53ef\u4ee5\u5145\u5206\u53cd\u6620\u7576\u524d\u7a0b\u5f0f\u8a2d\u8a08\u8b8a\u5316\u5c0e\u81f4\u7684\u5f71\u97ff\uff0c\u8b6c\u5982\u8aaa\u5f8c\u7aef\u670d\u52d9\u5beb\u592a\u6162\u6216\u6548\u7387\u4e0d\u597d\u5c0e\u81f4\u5f88\u6162</li> <li>\u4e0d\u9069\u5408\u60c5\u5883: \u60f3\u8981\u77e5\u9053\u5168\u7ad9\u5e38\u614b\u7a69\u5b9a\u5ea6\u5982\u4f55</li> <li>\u80fd\u5920\u907f\u514d: \u5e38\u614b\u5206\u4f48\u72c0\u6cc1 (Normal distributions) \u5c0e\u81f4\u5ffd\u8996\u504f\u5dee\u503c\u72c0\u6cc1</li> </ol> <p>\u5e38\u898b\u6703\u770b\u5230 P99.9 \u6bd4\u8f03\u9069\u7528\u65bc Application \u7aef\uff0c\u5982\u679c\u4f60\u662f\u4ee5 Infra \u89d2\u5ea6\u770b P99.9 \u7684\u8a71\uff0c\u767e\u5206\u4f4d\u6578\u8d8a\u9ad8\u6700\u4f73\u5316\u6210\u672c\u6703\u8d85\u9ad8\uff0c\u8b6c\u5982\u8aaa\u4f60\u60f3\u8981\u9019\u9ebc\u6975\u7aef\u964d\u4f4e Network Latency \u548c Jitter \u7684\u8a71\uff0c\u6211\u770b\u5927\u6982\u8981\u5149\u7e96\u76f4\u9023\uff0c\u6216\u8005\u662f\u4e2d\u9593\u8a2d\u5099\u90fd\u662f\u8d85\u9ad8\u6a94\u7684 Router \u548c Switch \u53ef\u80fd\u6bd4\u8f03\u6709\u6a5f\u6703\u8fa6\u5230...\u5c0d Infra \u4e0d\u592a\u73fe\u5be6</p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#average","title":"\u4e0d\u8981\u4f7f\u7528\u5e73\u5747\u503c (Average)","text":"Note <p>\u5e73\u5747\u503c (Average) \u4e0d\u7b49\u65bc P50 (\u4e2d\u4f4d\u6578, Median)</p> <p>\u5e73\u5747\u503c (Average) \u5c31\u662f\u7b97\u8853\u5e73\u5747\u6578\uff0c\u8a08\u7b97\u65b9\u5f0f\u70ba\u4e00\u7d44\u6578\u5b57\u76f8\u52a0\uff0c\u7136\u5f8c\u518d\u9664\u65bc\u9019\u7d44\u6578\u5b57\u7684\u500b\u6578\uff0c\u4e0d\u80fd\u53cd\u6620\u7576\u524d\u72c0\u6cc1\uff0c\u56e0\u70ba\u5e73\u5747\u503c\u6703\u53d7\u5230\u6975\u7aef\u503c\u5f71\u97ff\uff0c\u8acb\u7528\u4e2d\u4f4d\u6578 (P50) \u66ff\u4ee3</p> <p>\u8209\u4f8b\u4e00\u500b\u6975\u7aef\u4f8b\u5b50\u628a Fibonacci Series \u5217\u51fa\u4f86\uff0c\u7b97\u51fa\u4f86\u7684\u5e73\u5747\u503c\u8ddf P50 \u6703\u6709\u76f8\u7576\u5927\u7684\u5dee\u8ddd\uff0c\u56e0\u53d7\u5230\u5927\u6578\u5f71\u97ff\uff0c\u5e73\u5747\u503c\u6703\u9060\u5927\u65bc P50\u3002\u63db\u500b\u767d\u8a71\u4f86\u8b1b\uff0c\u6211\u3001\u53f0\u7063\u9996\u5bcc\u3001\u5168\u7403\u9996\u5bcc 3 \u4f4d\u5e73\u5747\u8d77\u4f86\uff0c\u53ef\u4ee5\u8cb7\u4e0b\u4e00\u68df 101\uff0c\u76f8\u7576\u4e0d\u6e96\u78ba...</p> <p>\u6839\u64da #LatencyTipOfTheDay: Average (def): a random number that falls somewhere between the maximum and 1/2 the median. Most often used to ignore reality.\uff0c\u6307\u51fa Average \u56e0\u4ecb\u65bc\u70ba\u6700\u5927\u503c (MAXIMUM) ~ \u4e2d\u4f4d\u6578/2 \u4e4b\u9593</p> <p></p> <p>\u6545\u4f60\u8001\u95c6\u6216\u4f7f\u7528\u8005\u8981\u6c42\u4f60<code>\u63d0\u4f9b\u67d0\u67d0\u7cfb\u7d71\u7684\u904b\u884c\u5e73\u5747\u72c0\u6cc1</code>\uff0c\u6b63\u78ba\u4f86\u8aaa\u61c9\u8a72\u8981\u81ea\u884c\u7ffb\u8b6f\u6210<code>\u63d0\u4f9b\u67d0\u67d0\u7cfb\u7d71\u7684\u4e2d\u4f4d\u6578 (P50) \u72c0\u6cc1</code> \u624d\u662f\u6bd4\u8f03\u6b63\u78ba</p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#_2","title":"\u500b\u4eba\u5efa\u8b70","text":"<p>\u57fa\u65bc <code>P50, P75, P90, P99, P99.9, P99.99</code>\uff0c\u4ee5 P99 \u70ba\u4e2d\u592e\u4f0d</p> <ul> <li>\u5982\u679c\u4f60\u662f\u504f\u5411 Infrastructure \u76e3\u63a7\u6216\u8005\u662f\u504f\u57fa\u790e\u5efa\u8a2d\u7684 Administrator\uff0c\u5efa\u8b70\u53ef\u4ee5\u9577\u671f\u8ffd\u8e64 P50, P75, P90, P99 \u9019\u56db\u689d\u7684\u8b8a\u5316\uff0c\u56e0\u70ba\u9019\u56db\u689d\u7684\u8b8a\u5316\uff0c\u53ef\u4ee5\u53cd\u6620\u51fa\u4f60\u7684\u57fa\u790e\u5efa\u8a2d\u662f\u5426\u7a69\u5b9a</li> <li>\u5982\u679c\u4f60\u662f\u504f\u5411 Application \u76e3\u63a7\u6216\u8005\u662f\u504f API \u6548\u80fd\u7684 Developer\uff0c\u5efa\u8b70\u53ef\u4ee5\u8ffd\u8e64 P99, P99.9, P99.99 \u9019\u4e09\u689d\u7684\u8b8a\u5316\uff0c\u6bd4\u8f03\u80fd\u5920\u53cd\u6620\u51fa\u4f60\u7684\u7a0b\u5f0f\u662f\u5426\u6709\u7279\u6b8a\u72c0\u6cc1</li> <li>\u4e0a\u73ed\u5e73\u6642\u4f8b\u884c\u5831\u544a\u6293 P50 \u6578\u5b57\uff0c\u81e8\u6642\u51fa\u4e8b\u6293 P99 \u6216\u66f4\u9ad8\u6578\u5b57\u6bd4\u8f03\u597d\u7406\u89e3\u73fe\u5728\u767c\u751f\u5565\u4e8b</li> </ul>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#qa","title":"Q&amp;A","text":"","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#q1-ping-rtt-avg","title":"Q1: \u5982\u679c\u6211\u81e8\u6642\u4f7f\u7528 ping \u5c0d\u7279\u5b9a\u670d\u52d9\u505a RTT \u91cf\u6e2c\uff0c\u90a3\u4ed6\u53ea\u6709 avg. \u5448\u73fe\uff0c\u90a3\u9019\u6a23\u6e96\u55ce?","text":"<pre><code>$ ping www.microsoft.com.tw\nPING microsoft.com.tw (20.112.52.29) 56(84) bytes of data.\n64 bytes from 20.112.52.29 (20.112.52.29): icmp_seq=1 ttl=108 time=134 ms\n64 bytes from 20.112.52.29 (20.112.52.29): icmp_seq=2 ttl=108 time=137 ms\n64 bytes from 20.112.52.29 (20.112.52.29): icmp_seq=3 ttl=108 time=139 ms\n64 bytes from 20.112.52.29 (20.112.52.29): icmp_seq=4 ttl=108 time=137 ms\n^C\n--- microsoft.com.tw ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 10238ms\nrtt min/avg/max/mdev = 133.904/136.817/138.914/1.855 ms\n</code></pre> <p>A1: \u4ee5\u4e0a\u9762\u7684\u6578\u5b57\u4f86\u770b\uff0c\u4ed6\u7684 P50 \u662f 134\uff0c\u8aa0\u5982\u4e0a\u9762\u8b1b\uff0c\u770b avg. \u4e0d\u6e96\uff0c<code>\u5728\u7db2\u8def\u76f8\u5c0d\u7a69\u5b9a\u7684\u72c0\u6cc1\u4e0b\uff0c\u53ea\u80fd\u8aaa\u6709\u9ad8\u5ea6\u6a5f\u6703\u5e73\u5747\u503c\u8fd1\u4f3c\u65bc P50</code>\uff0c\u4f46\u4f60\u7528 ping \u5de5\u5177\u76ee\u7684\u4e0d\u662f\u771f\u7684\u8981\u9577\u671f\u76e3\u63a7\u6578\u64da\uff0c\u4e3b\u8981\u662f\u81e8\u6642\u7db2\u8def\u9664\u932f\uff0c\u8b6c\u5982\u8aaa\u6293\u7206 ping\u3001\u6216\u8005\u662f\u81e8\u6642\u6536\u96c6\u4e00\u4e0b\u7db2\u8def\u72c0\u6cc1\uff0c\u4ee5\u9664\u932f\u4f86\u8b1b\u662f\u5f88\u597d\u7528\u7684\uff0c\u6240\u4ee5\u5927\u5bb6\u9084\u662f\u53ef\u4ee5\u52a0\u6e1b\u7528\u7528</p>","tags":["slo","o11y"]},{"location":"20230411-slo-latency.html#references-","title":"References-","text":"<ul> <li>Azure network round-trip latency statistics</li> <li>Latency Tip Of The Day</li> <li>Latency SLOs Done Right</li> </ul>","tags":["slo","o11y"]},{"location":"20230417-composite-sla.html","title":"\u8a08\u7b97\u51fa\u6b63\u78ba\u7684\u670d\u52d9\u6c34\u5e73\u5354\u8b70\uff1a\u63a2\u7d22 Composite SLAs \u8a08\u7b97\u548c\u67b6\u69cb\u8a2d\u8a08","text":"<p>\u6700\u8fd1\u9019\u5e7e\u5468\u6536\u5230\u5e7e\u500b\u60f3\u8981\u505a SLA 99.999% \u7684\u6848\u5b50\uff0c\u56e0\u6d89\u53ca\u7684\u670d\u52d9\u773e\u591a\uff0c\u6240\u4ee5\u6545\u91dd\u5c0d\u5982\u4f55\u5408\u7406\u8a08\u7b97 SLA \u548c\u5176\u67b6\u69cb\u8a2d\u8a08\u5148\u505a\u4e00\u500b\u7d00\u9304\uff0c\u4f46\u9019\u908a\u4e26\u4e0d\u6d89\u53ca\u8cc7\u6599\u6700\u7d42\u4e00\u81f4\u6027\u548c\u5c0d\u5916\u7db2\u8def\u7684\u8a2d\u8a08\u8a0e\u8ad6</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#tldr","title":"TL;DR","text":"<ol> <li>\u76f8\u6bd4\u55ae\u4e00\u670d\u52d9 SLA \u8a08\u7b97\uff0c\u8907\u5408 SLA (Composite SLA) \u662f\u66f4\u70ba\u5408\u7406\u7684\u8a08\u7b97\u65b9\u5f0f</li> <li>\u8907\u5408 SLA (Composite SLA) \u6703\u96a8\u8a8d\u5217\u7bc4\u570d\u4e0d\u540c\u800c\u6709\u6240\u8b8a\u5316\uff0c\u5c31\u7b97\u662f\u540c\u4e00\u5f35\u67b6\u69cb\u5716</li> <li>\u82e5\u76f8\u4f9d\u6027\u670d\u52d9\u8d8a\u591a\uff0c\u56e0\u53ef\u80fd\u5931\u6557\u767c\u751f\u9ede\u591a\uff0c\u5247\u8907\u5408 SLA \u6703\u5fc5\u7136\u4f4e\u65bc\u55ae\u4e00\u670d\u52d9 SLA</li> <li>\u55ae\u5340\u57df\u67b6\u69cb\u63d0\u4f9b\u591a\u500b\u5099\u63f4\u4f5c\u6cd5\u53ef\u5c0f\u5e45\u63d0\u5347\u6574\u9ad4 SLA</li> <li>\u591a\u5340\u57df\u67b6\u69cb\u8a2d\u8a08\u53ef\u4ee5\u5927\u5e45\u63d0\u5347\u6574\u9ad4 SLA\uff0c\u81f3\u5c11 2 \u500b\u5340\u57df\uff0c\u81f3\u591a 3 \u500b\u5340\u57df</li> </ol>","tags":["sla"]},{"location":"20230417-composite-sla.html#kubernetes-communtiy-day-taiwan-2023","title":"Kubernetes Communtiy Day Taiwan 2023 \u958b\u653e\u5fb5\u7a3f!!!","text":"<p>COSCUP 2023 \u5c07\u81f3\uff0cCloud Native Taiwan User Group \u8ddf\u6b77\u5e74\u4e00\u6a23\u6211\u5011\u4e5f\u6703\u65bc 2023/07/29 ~ 2023/07/30 \u5167\uff0c\u8209\u8fa6 Kubernetes Communtiy Day Taiwan 2023</p> <p>\u76ee\u524d\u5df2\u6b63\u5f0f\u958b\u653e\u5fb5\u7a3f\uff0c\u53ef\u65bc  COSCUP \u6295\u7a3f\u7cfb\u7d71 \u9032\u884c\u6295\u7a3f</p> <ul> <li>\u6b63\u5f0f\u6295\u7a3f\u958b\u59cb\u65e5\u671f\uff1a2023 \u5e74 04 \u6708 14 \u65e5</li> <li>\u6b63\u5f0f\u6295\u7a3f\u622a\u6b62\u65e5\u671f\uff1a2023 \u5e74 05 \u6708 22 \u65e5</li> <li>\u901a\u77e5\u8b1b\u8005\u793e\u7fa4\u8ecc\u6295\u7a3f\u7d50\u679c\uff1a2023 \u5e74 06 \u6708 23 \u65e5</li> </ul> <p>\u5f85\u6295\u7a3f\u7d50\u679c\u51fa\u7210\u5f8c\uff0c\u6211\u5011\u4e5f\u6703\u5c07\u76f8\u95dc\u8cc7\u8a0a\u540c\u6b65\u767c\u5e03\u81f3 KCD Taiwan \u5b98\u65b9\u9801\u9762</p> <p>\u6b61\u8fce\u5927\u5bb6\u591a\u591a\u53c3\u52a0</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#sla-composite-sla","title":"\u55ae\u5340\u57df\u5167\u7684\u8907\u5408 SLA (Composite SLA) \u8a08\u7b97","text":"<p>\u7121\u8ad6\u662f\u54ea\u4e00\u5bb6\u5ee0\u5546\u6240\u63d0\u4f9b\u7d66\u4f60\u7684 SLA\uff0c\u90fd\u662f\u57fa\u65bc\u4e00\u500b\u9650\u5b9a\u7bc4\u570d\u6216\u7279\u5b9a\u7522\u54c1\u5167\uff0c\u6240\u8a02\u7acb\u7684 SLA\uff0c\u4f46\u6b63\u5e38\u72c0\u6cc1\u4e0b\u4f60\u4e0d\u592a\u53ef\u80fd\u53ea\u55ae\u7368\u4f7f\u7528\u4e00\u500b\u670d\u52d9\u5c31\u80fd\u6490\u8d77\u5168\u90e8\u7684\u5c0d\u5916\u670d\u52d9</p> <p>\u8907\u5408 SLA (Composite SLA) \u4e3b\u8981\u5c31\u662f\u5c07\u591a\u500b\u670d\u52d9\u7684\u4e0d\u540c\u5c64\u7d1a\u7684\u53ef\u7528\u6027\u9032\u884c\u6df7\u5408\u8a08\u7b97\uff0c\u5206\u70ba\u5169\u500b\u5834\u666f: \u6709\u670d\u52d9\u76f8\u4f9d\u6027\u548c\u7121\u670d\u52d9\u76f8\u4f9d\u6027</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#1-and","title":"1. AND: \u670d\u52d9\u4e4b\u9593\u6709\u76f8\u4f9d\u6027","text":"<p>\u4ee5\u4e0a\u5716\u70ba\u4f8b\uff0c\u82e5\u6709\u500b\u5c0d\u5916\u670d\u52d9\u9700\u8981\u540c\u6642\u4f7f\u7528\u5230 Azure Red Hat OpenShift \u548c Azure Cosomos DB \u5b58\u653e\u8cc7\u6599\uff0c\u5169\u8005\u670d\u52d9\u7f3a\u4e00\u4e0d\u53ef\uff0c\u5247\u8a72 SLA \u8a08\u7b97\u65b9\u5f0f\u70ba\u5169\u8005\u76f8\u4e58\u5373\u53ef\uff0c\u53ef\u5f97\u8a72\u5716 SLA \u70ba 99.94900005%</p> <ul> <li>Azure Red Hat OpenShift: 99.95%</li> <li>Azure Cosmos DB: 99.999%</li> </ul> <p>Composite SLA = 99.94900005% = 99.95% * 99.999%</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#2-or","title":"2. OR: \u670d\u52d9\u4e4b\u9593\u7121\u76f8\u4f9d\u6027","text":"<p>\u4ee5\u4e0a\u5716\u70ba\u4f8b\uff0c\u82e5\u6709\u500b\u5c0d\u5916\u670d\u52d9\u9700\u8981\u540c\u6642\u4f7f\u7528\u5230 Azure Red Hat OpenShift \u548c Azure Cosomos DB \u5b58\u653e\u8cc7\u6599\uff0c\u4e14\u591a\u8a2d\u5b9a Azure Service Bus \u7576\u4f5c Queue \u4f86\u4f7f\u7528\uff0c\u5373\u4f7f\u9023\u7dda\u4e0d\u5230 Azure Cosmos DB \u6642\uff0c\u5c0d\u5916\u670d\u52d9\u9084\u662f\u53ef\u4ee5\u6b63\u5e38\u904b\u884c\uff0c\u4f46 Azure Cosmos DB \u548c Azure Service Bus \u540c\u6642\u5931\u6548\u7684\u6642\u5019\uff0c\u5c0d\u5916\u670d\u52d9\u5c31\u6703\u4e2d\u65b7\u3002</p> <ul> <li>Azure Red Hat OpenShift: 99.95%</li> <li>Azure Cosmos DB: 99.999%</li> <li>Azure Service Bus: 99.9%</li> </ul> <p>\u91dd\u5c0d\u7121\u76f8\u4f9d\u6027\u670d\u52d9 Azure Cosmos DB \u548c Azure Service Bus \u9700\u8981\u512a\u5148\u8a08\u7b97 SLA\uff0c</p> <p>Composite SLA = 99.999999% = 1 - \u5169\u8005\u540c\u6642\u5931\u6557\u6a5f\u7387 = 1 - ((1 - 99.999%) * (1 - 99.9%))</p> <p>\u5176\u6b21\u518d\u91dd\u5c0d\u524d\u9762\u5fc5\u8981\u670d\u52d9 Azure Red Hat OpenShift \u9032\u884c\u76f8\u4f9d\u6027\u8a08\u7b97\uff0c\u6545\u53ef\u5f97:</p> <p>Total Composite SLA = 99.949999% = 99.95% * 99.999999%</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#_1","title":"\u5c0f\u7d50","text":"\u6bd4\u8f03 \u7121 Queue \u6709 Queue SLA 99.94900005% 99.949999% Daily 44s 43s Weekly 5m 8.4s 5m 2.4s Monthly 22m 10s 21m 44s Quarterly 1h 6m 30s 1h 5m 12s Yearly 4h 26m 1.9s 4h 20m 49s <p>\u900f\u904e\u65b0\u589e Queue \u6216\u5176\u4ed6\u5099\u63f4\u670d\u52d9\uff0c\u5247\u53ef\u4ee5\u5c0f\u5e45\u5ea6\u63d0\u5347 SLA \u7684\u6578\u5b57</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#sla-composite-sla_1","title":"\u591a\u5340\u57df\u5167\u7684\u8907\u5408 SLA (Composite SLA) \u8a08\u7b97","text":"<p>\u5982\u4f55\u5927\u5e45\u5ea6\u63d0\u5347 SLA? \u7c21\u55ae\u4f86\u8aaa\u5c31\u662f\u8de8\u5340\u57df\u505a\u9ad8\u53ef\u7528\u67b6\u69cb\uff0c\u5206\u6563\u55ae\u4e00\u5340\u57df\u5d29\u58de\u98a8\u96aa</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#1-sla-composite-sla","title":"1. \u8a08\u7b97\u55ae\u5340\u57df\u5167\u7684\u8907\u5408 SLA (Composite SLA)","text":"<ul> <li>Azure Load Balancer: 99.99%</li> <li>Azure Red Hat OpenShift: 99.95%</li> <li>Azure Cosmos DB: 99.999%</li> <li>Azure Storage Accounts: 99.99%</li> </ul> <p>Composite SLA for Japan East = 99.929011% = 99.99% * 99.95% * 99.999% * 99.99%</p> <p>\u4ee5\u55ae\u4e00\u5340\u57df\u670d\u52d9\u4f86\u8b1b\uff0c99.929011% \u5df2\u7d93\u6bd4\u5e38\u898b\u57fa\u672c\u8981\u6c42 99.9% \u4f86\u7684\u597d\u4e0d\u5c11\u4e86\uff0c\u6240\u4ee5\u5c0d\u65bc\u5f88\u591a\u670d\u52d9\u4f86\u8aaa\u9084\u7b97\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u7bc4\u570d\uff0c\u4f46\u5982\u679c\u5c0d\u65bc\u8981\u505a\u51fa 99.999% \u7b49\u7d1a\u670d\u52d9\u4f86\u8b1b\u662f\u6709\u76f8\u7576\u8ddd\u96e2\u7684\uff0c\u6545\u4e0b\u9762\u4f86\u8a0e\u8ad6\u63d0\u5347 SLA</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#2-sla-composite-sla","title":"2. \u8a08\u7b97\u591a\u5340\u57df\u5167\u7684\u8907\u5408 SLA (Composite SLA)","text":"<ul> <li>Azure Traffic Manager: 99.99%</li> <li>Composite SLA for Japan East: 99.929011%</li> <li>Composite SLA for Japan West: 99.929011%</li> </ul> <p>\u9996\u5148\u5148\u8a08\u7b97\u61c9\u7528\u7a0b\u5f0f\u5728\u6240\u6709\u5340\u57df\u7206\u70b8\u7684\u6a5f\u7387</p> <p>\u61c9\u7528\u7a0b\u5f0f\u5728\u591a\u500b\u5340\u57df\u5408\u4f75 SLA \u516c\u5f0f\u70ba (1 - (1 - SLA) ^ R)</p> <ul> <li>R: \u662f\u5340\u57df\u6578\u91cf</li> <li>SLA: \u662f\u55ae\u4e00\u5340\u57df\u7684 SLA \u5354\u8b70\u6578\u5b57</li> </ul> <p>\u6545\u53ef\u5f97\u77e5\u7a0b\u5f0f\u4f48\u7f72\u5728\u5169\u500b\u5340\u57df\u6642\uff0c\u53ef\u7372\u5f97\u4e0b\u5217 SLA \u7b49\u7d1a</p> <p>Composite SLA for Azure Red Hat OpenShift in 2 regions = 99.9999% = (1 - (1 - 0.99929011)^2)</p> <p>\u4f46\u56e0\u524d\u9762\u9700\u8981\u653e\u7f6e Azure Traffic Manager \u670d\u52d9\u78ba\u4fdd\u524d\u7f6e\u6d41\u91cf\u80fd\u5920\u5169\u908a\u5c0e\u6d41\uff0c\u6545\u9084\u9700\u8a08\u7b97\uff0c\u6545\u53ef\u5f97</p> <p>Totla Composite SLA = 99.9899% = 99.99% * 99.99%</p> <p>\u9019\u908a\u6709\u9700\u8981\u8a0e\u8ad6\u7684\u5730\u65b9\u662f\u6709\u6c92\u6709\u8981\u628a Azure Traffic Manager \u5217\u70ba SLA \u8a08\u7b97\u7bc4\u570d\u5167\uff0c\u56e0\u70ba\u5b83\u5176\u5be6\u53ef\u4ee5\u653e\u5728\u7b2c\u4e09\u500b\u5340\u57df\uff0c\u7136\u5f8c\u8a72\u670d\u52d9\u7279\u6027\uff0c\u662f\u505a DNS Query\uff0c\u5be6\u969b\u4e0a\u4e0d\u6703\u5f71\u97ff\u5230\uff0c\u55ae\u4e00\u5340\u57df\u7684\u904b\u884c\uff0c\u4f46\u9019\u500b\u56e0\u4e0d\u540c\u4f7f\u7528\u8005\u8a8d\u5217\u7bc4\u570d\u800c\u7570\uff0c\u4e0d\u7136\u4ee5 Azure Red Hat OpenShift \u672c\u8eab\u904b\u4f5c\u4e0b\uff0c\u900f\u904e\u7b2c\u4e8c\u500b\u5340\u57df\u7684\u5efa\u7f6e\uff0c\u5c31\u53ef\u4ee5\u4f86\u5230 6 \u500b 9 \u7684\u7b49\u7d1a\uff0c\u56e0\u9ad8\u65bc\u5e38\u807d\u5230 5 \u500b 9\uff0c\u5c0d\u65bc\u7dad\u904b\u96d9\u53e2\u96c6 Kubernetes \u904b\u4f5c\u70ba\u76ee\u6a19\u4f86\u8b1b\u662f\u76f8\u7576\u8db3\u5920\u7684</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#_2","title":"\u5c0f\u7d50","text":"\u6bd4\u8f03 \u55ae\u5340\u57df \u96d9\u5340\u57df SLA 99.929011% 99.9999% Daily 1m 1.3s 0.086s Weekly 7m 9.3s 0.6s Monthly 30m 51s 2.6s Quarterly 1h 32m 34s 7.8s Yearly 6h 10m 18s 31s <p>\u900f\u904e\u65b0\u589e\u4e00\u500b\u5340\u57df\u7684\u670d\u52d9\uff0c\u5247\u53ef\u4ee5\u5927\u5e45\u5ea6\u63d0\u5347 SLA \u7684\u6578\u5b57</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#sla-sla","title":"\u4ee5\u7279\u5b9a SLA \u70ba\u76ee\u6a19\uff0c\u55ae\u5340\u57df\u6240\u9700\u6700\u4f4e SLA","text":"<p>\u4ee5\u55ae\u4e00\u5340\u57df\u4f46\u4e0d\u9650\u65bc\u5176\u55ae\u4f4d (\u5982\u670d\u52d9\u3001\u500b\u9ad4\u6578\u3001AZ) \u6240\u9700\u6700\u4f4e SLA \u8a08\u7b97\u65b9\u5f0f\u5982\u4e0b:</p> <p>\u55ae\u4e00\u5340\u57df\u6240\u9700\u6700\u4f4e SLA = (1 - (1 - SLA)^(1/R))</p> <ul> <li>R: \u662f\u5340\u57df\u6578\u91cf</li> <li>SLA: \u662f\u9810\u671f\u9054\u5230\u7684 SLA \u5354\u8b70\u6578\u5b57</li> </ul> <p>Makrdown \u7248:</p> Availability Target SLA \u65bc 1 \u500b Region \u4e4b\u4e0b\uff0c\u55ae 1 Region \u6700\u5c0f SLA \u9700 \u65bc 2 \u500b Region \u4e4b\u4e0b\uff0c\u55ae 1 Region \u6700\u5c0f SLA \u9700 \u65bc 3 \u500b Region \u4e4b\u4e0b\uff0c\u55ae 1 Region \u6700\u5c0f SLA \u9700 \u65bc 4 \u500b Region \u4e4b\u4e0b\uff0c\u55ae 1 Region \u6700\u5c0f SLA \u9700 2 Nines 99% 99.0000000% 90.0000000% 78.4556531% 68.3772234% 3 Nines 99.9% 99.9000000% 96.8377223% 90.0000000% 82.2172059% 3 and a half nines 99.95% 99.9500000% 97.7639320% 92.0629947% 85.0465122% 4 Nines 99.99 % 99.9900000% 99.0000000% 95.3584112% 90.0000000% 5 Nines 99.999% 99.9990000% 99.6837722% 97.8455653% 94.3765867% 6 Nines 99.9999% 99.9999000% 99.9000000% 99.0000000% 96.8377223% 7 Nines 99.99999% 99.9999900% 99.9683772% 99.5358411% 98.2217206% 8 Nines 99.999999% 99.9999990% 99.9900000% 99.7845565% 99.0000000% 9 Nines 99.9999999% 99.9999999% 99.9968377% 99.9000000% 99.4376587% <p>\u5f69\u8272\u597d\u8b80\u7248:</p> <p></p>","tags":["sla"]},{"location":"20230417-composite-sla.html#qa","title":"Q&amp;A","text":"","tags":["sla"]},{"location":"20230417-composite-sla.html#q1-sla-683772234-2-nines","title":"Q1: \u67d0\u67d0\u500b\u670d\u52d9\u8d85\u721b\uff0c\u4e00\u5929\u6703\u7576\u6a5f\u4e03\u5c0f\u6642\u4ee5\u4e0a\uff0c\u7d04 SLA 68.3772234%\uff0c\u662f\u4e0d\u662f\u6c38\u9060\u9054\u4e0d\u5230 2 nines?","text":"<p>A1:</p> <p>\u4ee5\u4e0a\u9762\u8a08\u7b97\u55ae\u4e00\u5340\u57df\u6240\u9700\u6700\u4f4e SLA \u8a08\u7b97\u4f86\u8aaa\uff0c\u4e0d\u8003\u616e\u8cc7\u6599\u4e00\u81f4\u6027\u53ca\u7db2\u8def\u53ef\u9054\u6027\uff0c\u4f60\u53ea\u8981\u5728 4 \u500b\u4e0d\u540c\u5340\u57df\u5efa\u7acb\u76f8\u540c SLA 68.3772234% \u670d\u52d9\uff0c\u6700\u5dee\u9084\u662f\u53ef\u4ee5\u62ff\u5230 SLA 99% \u7684\u7b49\u7d1a</p> <p>\u4f46...\u4f60\u61c9\u8a72\u8981\u505a\u7684\u4e8b\u60c5\u662f\u7814\u7a76\u4e00\u4e0b\u70ba\u5565\u4e00\u500b\u670d\u52d9\u4e00\u5929\u6703\u5674\u6389\u4e03\u5c0f\u6642\u4ee5\u4e0a\uff0c\u800c\u4e0d\u662f\u5728\u9019\u908a\u7b97\u6578\u5b78</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#q2-5-9-sla","title":"Q2: \u70ba\u4f55\u4f7f\u7528\u8005\u958b\u982d\u90fd\u8aaa\u8acb\u63d0\u4f9b\u7d66\u6211 5 \u500b 9 \u7684 SLA \u67b6\u69cb\u8a2d\u8a08?","text":"<p>A2:</p> <p>SLA 99.999% \u53ef\u63a5\u53d7\u505c\u6a5f\u6642\u9593\u5982\u4e0b:</p> <ul> <li>Daily: 0.86s</li> <li>Weekly: 6s</li> <li>Monthly: 26s</li> <li>Quarterly: 1m 18s</li> <li>Yearly: 5m 13s</li> </ul> <p>\u4e3b\u8981\u662f Daily \u9019\u500b\u6578\u5b57\u662f\u525b\u597d\u4f4e\u65bc 1s \u7684\uff0c\u6240\u4ee5\u666e\u904d\u624d\u6703\u6709\u9019\u500b\u7406\u89e3\uff0c\u57fa\u672c\u4e0a\u8981\u8fa6\u5230\u5c31\u662f\u4e00\u5b9a\u8981\u505a\u5230\u6574\u9ad4\u67b6\u69cb\u4e0d\u80fd\u505c\u6a5f\u3001\u7570\u5730\u6284\u5beb\u3001\u7db2\u8def\u5168\u7403\u8ca0\u8f09\u3001CDN \u90fd\u8981\u62ff\u51fa\u4f86\u7528\uff0c\u60f3\u7576\u7136\u800c\u6210\u672c\u6703\u5f88\u9ad8\uff0c\u767d\u8a71\u4f86\u8b1b\u5c31\u662f\uff0c\u9019\u500b\u670d\u52d9\u4e0d\u80fd\u6389</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#q3-99999-sla-99929011","title":"Q3: \u5982\u679c\u6211\u8ddf\u7d42\u7aef\u5ba2\u6236\u7c3d\u4e86\u4e00\u500b 99.999% \u7684 SLA \u5354\u8b70\uff0c\u4f46\u6211\u77e5\u9053\u81ea\u5bb6\u670d\u52d9\u53ea\u6709\u7b97\u51fa 99.929011%\uff0c\u9019\u6a23\u53ef\u4ee5\u55ce?","text":"Target SLA 99.999% 99.929011% Daily 0.86s 1m 1.3s Weekly 6s 7m 9.3s Monthly 26s 30m 51s Quarterly 1m 18s 1h 32m 34s Yearly 5m13s 6h 10m 18s <p>SLA \u53ea\u662f\u4e00\u7d19\u627f\u8afe\uff0c\u82e5\u5df2\u77e5\u4e2d\u9593\u9019\u9ebc\u5927\u7684\u98a8\u96aa\uff0c\u7c3d\u4e0b\u53bb\u7576\u7136\u5c31\u662f\u5f97\u8981\u81ea\u5df1\u625b\u7684\u4f4f\uff0c\u4e0d\u7136\u5c31\u662f\u518d\u6295\u6ce8\u6210\u672c\u628a\u67b6\u69cb\u6301\u7e8c\u6539\u5584\u5230\u63a5\u8fd1\u76ee\u6a19</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#q4-azure","title":"Q4: \u6709\u5426 Azure \u63a8\u85a6\u7684\u591a\u5340\u57df\u67b6\u69cb\u8aaa\u660e?","text":"<p>Multi-region load balancing with Traffic Manager and Application Gateway</p> <p></p> <p>Multitenant SaaS on Azure</p> <p></p> <p>Multi-region N-tier application</p> <p></p>","tags":["sla"]},{"location":"20230417-composite-sla.html#q5-azure-sla","title":"Q5: \u6709\u5426 Azure SLA \u5b98\u65b9\u6e05\u55ae?","text":"<ul> <li>\u597d\u8b80\u7248: Azure SLA Board</li> <li>\u5b98\u65b9\u6587\u4ef6\u7248: Service Level Agreements (SLA) for Online Services</li> </ul>","tags":["sla"]},{"location":"20230417-composite-sla.html#q6-azure-sla","title":"Q6: \u9664\u4e86 Azure \u9700\u8981\u7b97\u51fa SLA \u4ee5\u5916\uff0c\u9084\u6709\u6c92\u6709\u4ec0\u9ebc\u662f\u9700\u8981\u81ea\u884c\u8003\u91cf\u7684?","text":"<p>A6:</p> <p>\u6709\uff0c\u4f7f\u7528\u8005\u81ea\u5df1\u61c9\u7528\u7a0b\u5f0f\u7684 SLA</p> <p>\u6b63\u78ba\u4f60\u61c9\u8a72\u53ef\u4ee5\u63d0\u4f9b\u51fa\u53bb\u7684 SLA \u7406\u8ad6\u4e0a\u662f Composite SLA = \u61c9\u7528\u7a0b\u5f0f SLA * \u57fa\u790e\u67b6\u69cb SLA \u800c\u4e0d\u662f\u50c5\u63d0\u4f9b\u4e00\u65b9\u7684 SLA \u4fdd\u8b49</p> <p>\u5982\u679c\u7a0b\u5f0f\u5beb\u5f97\u592a\u721b\uff0c\u4f8b\u5982\u5929\u5929 OOM\u3001Crash\u3001Query \u6548\u80fd\u592a\u5dee\u7b49\u7b49\uff0c\u6309\u7167\u8cac\u4efb\u5283\u5206\uff0c\u9019\u500b\u662f\u500b\u5225\u4f7f\u7528\u8005\u61c9\u8a72\u8981\u81ea\u5df1\u8ca0\u8cac\u7684\uff0c\u800c\u975e\u57fa\u790e\u5e73\u53f0\u80fd\u625b\u7684</p>","tags":["sla"]},{"location":"20230417-composite-sla.html#referecens","title":"Referecens","text":"<ul> <li>Composite SLA V2</li> <li>\u4f7f\u7528\u5546\u52d9\u8a08\u91cf\u4f86\u8a2d\u8a08\u5177\u5fa9\u539f\u529f\u80fd\u7684 Azure \u61c9\u7528\u7a0b\u5f0f</li> <li>Service Level Agreements (SLA) for Online Services</li> <li>Azure SLA Board</li> <li>Multi-region load balancing with Traffic Manager and Application Gateway</li> <li>Multitenant SaaS on Azure</li> <li>Multi-region N-tier application</li> </ul>","tags":["sla"]},{"location":"20230515-deepdive-sig-scalability.html","title":"SIG Kubernetes Scability \u591a\u7dad\u5ea6\u5206\u6790","text":"<p>\u524d\u9663\u5b50\u525b\u597d Kubecon EU 2023 \u525b\u8fa6\u5b8c\uff0c\u76f8\u95dc\u7684\u5f71\u7247\u4e5f\u91cb\u51fa\u5230 YouTube - KubeCon + CloudNativeCon Europe 2023 \u4e0a\uff0c\u5171\u8a08 314 \u90e8\uff0c\u5728\u7576\u707d\u5384\u6797\u514b\u7834\u58de\u6d77\u62c9\u9b6f\u5927\u9678\u7684\u540c\u6642\uff0c\u8a18\u5f97\u4e5f\u8981\u4e0d\u5fd8\u6301\u7e8c\u5b78\u7fd2</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#kubernetes-communtiy-day-taiwan-2023","title":"Kubernetes Communtiy Day Taiwan 2023 \u5269\u4e0b\u4e00\u5468\u53ef\u4ee5\u6295\u7a3f!!!","text":"<p>COSCUP 2023 \u5c07\u81f3\uff0cCloud Native Taiwan User Group \u8ddf\u6b77\u5e74\u4e00\u6a23\u6211\u5011\u4e5f\u6703\u65bc 2023/07/29 ~ 2023/07/30 \u5167\uff0c\u8209\u8fa6 Kubernetes Communtiy Day Taiwan 2023</p> <p>\u76ee\u524d\u50c5\u5269\u4e00\u5468\u95dc\u9589\u5fb5\u7a3f\uff0c\u53ef\u65bc  COSCUP \u6295\u7a3f\u7cfb\u7d71 \u9032\u884c\u6295\u7a3f</p> <ul> <li>\u6b63\u5f0f\u6295\u7a3f\u958b\u59cb\u65e5\u671f\uff1a2023 \u5e74 04 \u6708 14 \u65e5</li> <li><code>\u6b63\u5f0f\u6295\u7a3f\u622a\u6b62\u65e5\u671f\uff1a2023 \u5e74 05 \u6708 22 \u65e5</code></li> <li>\u901a\u77e5\u8b1b\u8005\u793e\u7fa4\u8ecc\u6295\u7a3f\u7d50\u679c\uff1a2023 \u5e74 06 \u6708 23 \u65e5</li> </ul> <p>\u6b64\u5916\u57fa\u65bc CNCF \u793e\u7fa4\u6cbb\u7406\u898f\u7bc4\uff0c\u5f9e KCD Taiwan \u5c07 Communtiy Group \u55ae\u7368\u62c6\u5206\u51fa\u4f86\uff0c</p> <ul> <li>Kubernetes Community Days Taiwan (KCD Taiwan), \u57fa\u65bc Kubernetes Community Days \u6cbb\u7406\u898f\u7bc4\uff0c\u7db2\u7ad9\u70ba https://community.cncf.io/kcd-taiwan/\uff0c\u70ba\u5e74\u5ea6\u5730\u5340\u6d3b\u52d5</li> <li>Cloud Native Taiwan User Group (CNTUG), \u57fa\u65bc CNCF Community groups \u6cbb\u7406\u898f\u7bc4\uff0c\u7db2\u7ad9\u70ba https://community.cncf.io/cloud-native-taiwan-user-group/\uff0c\u70ba\u4f8b\u884c\u793e\u7fa4\u6d3b\u52d5</li> </ul> <p>\u6b61\u8fce\u6709\u60f3\u8981\u8d0a\u52a9\u3001\u6f14\u8b1b\u7684\u500b\u4eba\u6216\u5ee0\u5546\u53ef\u4ee5\u4f9d\u9700\u6c42\u5404\u5225\u8a0e\u8ad6</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#kubernetes-scability","title":"Kubernetes Scability \u591a\u7dad\u5ea6\u5206\u6790","text":"<p>Kubernetes Scalabilty \u662f\u4e00\u500b\u591a\u7dad\u5ea6\u7684\u554f\u984c\uff0c\u4e0d\u55ae\u55ae\u53ea\u662f\u7528\u7bc0\u9ede\u500b\u6578\u4f86\u505a\u70ba\u8861\u91cf\u552f\u4e00\u57fa\u790e\uff0c\u5efa\u8b70\u53c3\u95b1 Kubecon 2018 NA - Kubernetes Scalability: A multi-dimensional analysis</p> <p>\u9019\u908a\u63d0\u5e7e\u500b\u6211\u89ba\u5f97\u6bd4\u8f03\u91cd\u8981\u7684</p> <ul> <li><code># Nodes v.s. # Pods/node</code>: Nodes \u8d8a\u591a\u3001Pod \u65bc\u55ae\u4e00 Node \u4e0a\u8d8a\u5c11\uff0c\u7bc0\u9ede\u8d8a\u591a\u3001Pod \u65bc\u55ae\u4e00\u7bc0\u9ede\u4e0a\u53ef\u4ee5\u8d8a\u591a\u3002\u500b\u4eba\u5efa\u8b70\uff0c\u901a\u5e38 <code># Pods/Node</code> \u662f\u56fa\u5b9a\u7684\uff0c\u80fd\u52d5\u7684\u90fd\u662f\u4ee5 <code># Nodes</code> \u5c45\u591a\uff0c\u6240\u4ee5\u53ef\u4ee5\u56fa\u5b9a <code># Pods/Node</code> \u518d\u63db\u7b97\u7e3d\u6578</li> <li><code># Services v.s. # Endpoints/Service</code>: Service \u8d8a\u591a\u3001Endpoints/svc \u8d8a\u5c11\uff0cService \u8d8a\u5c11\uff0cEndpoint/svc \u53ef\u4ee5\u8d8a\u591a\u3002\u500b\u4eba\u5efa\u8b70\uff0c<code># Endpoints/Service</code> \u9019\u500b\u4e0d\u8981\u8d85\u904e 250 \u6216\u4e0d\u8981\u8d85\u904e <code># Pods/node</code> \u7684\u4e0a\u9650</li> <li><code># Service/ns</code>: Service \u8d8a\u591a\u3001Namespace \u8d8a\u5c11\uff0cService \u8d8a\u5c11\u3001Namespace \u53ef\u4ee5\u8d8a\u591a\u3002\u500b\u4eba\u5efa\u8b70\uff0c<code># Service/ns</code> \u9019\u500b\u4e0d\u8981\u8d85\u904e 5000\uff0c\u6703\u6709 Pod Crash \u7684\u72c0\u6cc1\u767c\u751f</li> </ul>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#2023-slisslos","title":"2023 SLIs/SLOs \u7684\u8b8a\u5316","text":"<p>\u7576\u5e74 2015 \u7684\u5176\u4e2d\u4e00\u689d\u91dd\u5c0d API \u547c\u53eb\u7684\u5b9a\u7fa9 \"99% of all our API calls return in less than 1 second\" \u56e0\u70ba\u9019\u53e5\u8a71\u770b\u7684\u4eba\u6709\u5404\u7a2e\u4e0d\u4e00\u6a23\u7684\u89e3\u8b80\uff0c\u6240\u4ee5\u5230\u4e86\u4eca\u5e74 2023 \u5c31\u63db\u6210\u4e0b\u5217 2 \u500b\u66f4\u70ba\u5be6\u969b\u7684 SLI / SLO \u5b9a\u7fa9\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003\u9019\u500b Git Diff</p> SLI <p>\"Latency of processing mutating API calls for single objects for every (resource, verb) pair, measured as 99th percentile over last 5 minutes\" \"\u91dd\u5c0d\u55ae\u4e00\u7269\u4ef6\u8655\u7406\u8b8a\u66f4 API \u547c\u53eb\u7684\u5ef6\u9072\uff0c\u5c0d\u65bc\u6bcf\u4e00\u500b\uff08\u8cc7\u6e90\u3001\u52d5\u4f5c\uff09\u914d\u5c0d\uff0c\u4ee5\u904e\u53bb 5 \u5206\u9418\u5167\u7684\u7b2c 99 \u767e\u5206\u4f4d\u9032\u884c\u6e2c\u91cf\u3002\"</p> <p>\u9019\u689d\u4e3b\u8981\u6709\u6392\u9664\u8acb\u6c42\u5728 Queue \u4e2d\u7684\u7b49\u5f85\u6642\u9593\uff0c\u56e0\u70ba\u6c92\u6709\u8fa6\u6cd5\u9810\u4f30 Control Plane \u7684\u8ca0\u8f09\u72c0\u6cc1\uff0c\u6545\u4e0d\u8003\u616e\u9019\u90e8\u5206\u7684\u6642\u9593\u6d88\u8017</p> SLO <p>\"In default Kubernetes installation, for every (resource, verb) pair, excluding virtual and aggregated resources, 99th perccentile per cluster-day &lt;=1s\" \"\u5728\u9810\u8a2d\u7684 Kubernetes \u5b89\u88dd\u4e2d\uff0c\u5c0d\u65bc\u6bcf\u4e00\u500b\uff08\u8cc7\u6e90\u3001\u52d5\u4f5c\uff09\u914d\u5c0d\uff0c\u6392\u9664\u865b\u64ec\u548c\u805a\u5408\u8cc7\u6e90\uff0c\u6bcf\u500b\u96c6\u7fa4\u6bcf\u5929\u7684\u7b2c 99 \u767e\u5206\u4f4d\u5ef6\u9072\u61c9\u8a72\u5c0f\u65bc\u7b49\u65bc 1 \u79d2\u3002\"</p> <p>\u5176\u5be6\u9084\u6709\u984d\u5916\u5b98\u65b9\u627f\u8a8d\u548c\u6b63\u5728\u88ab\u8a0e\u8ad6\u7684 SLIs/SLOs\uff0c\u53ef\u53c3\u8003 Steady state SLIs/SLOs</p> <ol> <li>API call latency SLIs/SLOs details</li> <li>API call extension points latency SLIs details</li> <li>In-cluster dns latency SLIs/SLOs details</li> <li>DNS programming latency SLIs/SLOs details</li> <li>In-cluster network latency SLIs/SLOs details</li> <li>Network programming latency SLIs/SLOs details</li> <li>Pod startup latency SLI/SLO details</li> <li>Watch latency SLI details</li> </ol>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#_1","title":"\u53ef\u64f4\u5c55\u6027\u7684\u5df2\u6e2c\u8a66\u7bc4\u570d","text":"<p>\u60f3\u8981\u7cbe\u78ba\u5730\u5b9a\u7fa9\u53ef\u64f4\u5c55\u6027\u7bc4\u570d (Scalability envelope) \u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u4f46\u53ef\u4ee5\u6293\u5230\u5927\u7d04\u4e14\u5408\u7406\u7684\u7bc4\u570d\uff0c\u8b6c\u5982 Kubernetes Scalability thresholds \u6240\u5217\u7684\u7bc4\u570d\uff0c\u88e1\u9762\u5c07 scope \u62c6\u5206\u6210 2 \u500b\u7dad\u5ea6: namespace \u548c cluster</p> <p>\u4f9d\u6211\u500b\u4eba\u7406\u89e3\uff0c\u4e00\u822c\u4f86\u8aaa\u67b6\u69cb\u5e2b\u6703\u95dc\u5fc3\u7684\u90fd\u662f\u4e0b\u5217\u9019\u5e7e\u500b\u7bc4\u570d\uff0c\u4e3b\u8981\u6703\u626f\u5230\u7db2\u8def\uff0c\u5176\u4ed6\u9078\u9805\u8981\u7206\u6389\u7684\u6a5f\u6703\u5176\u5be6\u883b\u4f4e\u7684\uff0c\u81f3\u65bc\u5404\u5225\u6578\u5b57\u7684\u89e3\u8b80\u5c31\u56e0\u4eba\u800c\u7570\u4e86</p> Quantity Threshold scope=namespace Threshold: scope=cluster #Nodes n/a 5000 #Namespaces n/a 10000 #Pods 3000 150000 #Pods per node min(110, 10*#cores) min(110, 10*#cores) #Services 5000 10000 #All service endpoints TBD TBD #Endpoints per service 250 n/a #Deployments 2000 TBD <p>\u500b\u4eba\u7d93\u9a57\u4e0a\uff0c\u4e0a\u9762\u7684\u6578\u5b57\u5982 Nodes / Pods / Pods per node / Services \u90fd\u8ddf\u8981\u8a08\u7b97\u51fa\u7db2\u6bb5\u8981\u5207\u591a\u5c11\u3001\u7bc0\u9ede\u8981\u591a\u5c11\u500b\uff0c\u53ef\u627f\u8f09\u591a\u5c11\u5de5\u4f5c\u8ca0\u8f09\u91cf\u5f88\u6709\u95dc\u4fc2\uff0c\u6240\u4ee5\u5728\u898f\u756b\u7684\u6642\u5019\u52d9\u5fc5\u8981\u76f8\u7576\u6e05\u695a\u3002</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#_2","title":"\u5be6\u969b\u58d3\u6e2c\u65b9\u5f0f","text":"<p>\u4e3b\u8981\u58d3\u6e2c\u5de5\u5177\u6703\u7528 kubernetes/perf-tests \u88e1\u9762\u7684\u5de5\u5177:</p> <ul> <li>ClusterLoader2</li> <li>Kubemark</li> </ul> <p>\u800c\u8dd1\u5b8c\u6e2c\u8a66\u5247\u6703\u7522\u751f\u6e2c\u8a66\u5831\u8868\u53ef\u4ee5\u89c0\u5bdf\u73fe\u6cc1</p> <p></p> <p>\u6bcf\u6b21 Kubernetes Release \u90fd\u8981\u901a\u904e Peformance 100 nodes / 500 nodes / Correctness 5000 nodes\uff0c\u6e2c\u8a66\u5167\u5bb9\u90fd\u662f\u7531 kubernetes/sig-scalability/sig-scalability-periodic-jobs.yaml \u4f86\u5b9a\u7fa9\uff0c\u800c\u5831\u8868\u53ef\u4ee5\u5f9e https://testgrid.k8s.io \u9019\u908a\u7372\u5f97\u3002\u4eca\u5e74\u56e0\u70ba\u5404\u5bb6\u9810\u7b97\u7dca\u7e2e\uff0c\u73fe\u5728\u9001 Kubernetes Code \u4e0a\u53bb\uff0c\u9810\u8a2d\u53ea\u6703\u8dd1 Performance 100 Nodes \u800c\u5df2\uff0c\u800c\u5927\u90e8\u5206\u7684\u64f4\u5c55\u6027\u8b70\u984c\u90fd\u6703\u51fa\u73fe\u5728\u898f\u6a21\u5728\u8d85\u904e\u4ee5\u5f8c 100 Nodes</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#_3","title":"\u9810\u671f\u6539\u9032\u65b9\u5411","text":"<ul> <li>Kubernetes v1.20 beta - API Priority &amp; Faireness</li> <li>API Streaming Lists</li> <li>Gracefule shutdown</li> <li>Kube-apiserver improvements</li> <li>Improvements towards supporting higher throughput</li> </ul>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#qa","title":"Q&amp;A","text":"","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#q1-kubernetes-sig-autoscaling","title":"Q1: \u8207 Kubernetes SIG Autoscaling \u5dee\u7570\u662f?","text":"Note <p>Not to confuse with SIG Autoscaling!</p> <p>SIG Scalabilty \u95dc\u5fc3 Kubernetes \u6574\u9ad4\u7cfb\u7d71\u7684\u6975\u9650\uff0c\u5982\u679c\u4f60\u662f\u8ca0\u8cac\u63d0\u4f9b Kubernetes \u5b89\u88dd\u5efa\u7f6e\u7684\u6216\u9700\u8981\u57fa\u65bc\u4ee5 OSS Kubernetes \u70ba\u57fa\u790e\u7684\u81ea\u884c\u7dad\u8b77\u7248\u672c\uff0c\u6703\u9700\u8981\u95dc\u5fc3 Scalability \u8b70\u984c SIG Autoscaling \u95dc\u5fc3 Horizontal Pod Autoscaling / Vertical Pod Autoscaling / Cluster Autoscaling\uff0c\u5982\u679c\u4f60\u53ea\u662f\u9700\u8981 Kubernetes \u4e0a\u9762\u7684\u7a0b\u5f0f\u90e8\u7f72\uff0c\u5247\u50c5\u9700\u8981\u95dc\u5fc3 Autoscaling \u8b70\u984c</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#q2-kubernetes-sig-scalability","title":"Q2: Kubernetes SIG Scalability \u7684\u4e3b\u8981\u4efb\u52d9\u662f?","text":"<p>\u4e3b\u8981\u9801\u9762\u65bc Scalability SIG (Special Interest Group)</p> <p>5 \u500b\u4e3b\u8981\u7684\u5de5\u4f5c\u9818\u57df:</p> <ol> <li>\u5b9a\u7fa9\u548c\u9a45\u52d5 (Define &amp; Drive): \u5b9a\u7fa9\u548c\u9a45\u52d5\u53ef\u64f4\u5c55\u6027\u76ee\u6a19</li> <li>\u5354\u8abf\u548c\u8ca2\u737b (Coordinate &amp; Contribute): \u6539\u9032 Performance \u66f4\u63a5\u8fd1\u76ee\u6a19</li> <li>\u76e3\u63a7\u548c\u91cf\u6e2c (Montior &amp; Measure): \u900f\u904e\u76e3\u63a7\u548c\u91cf\u6e2c\u4f86\u78ba\u4fdd\u5be6\u969b\u7cfb\u7d71\u884c\u70ba\u63a5\u8fd1\u76ee\u6a19</li> <li>\u4fdd\u6301\u548c\u4fdd\u8b77 (Preserve &amp; Protect): \u78ba\u4fdd\u7cfb\u7d71\u514d\u53d7\u53ef\u64f4\u5c55\u6027\u56de\u6b78 (Scalability regressions) \u7684\u5f71\u97ff</li> <li>\u8aee\u8a62\u548c\u6559\u5b78 (Consult &amp; Coach): \u900f\u904e\u793e\u7fa4\u5354\u4f5c\u7372\u5f97\u66f4\u591a\u7684\u4f7f\u7528\u6848\u4f8b\u548c\u56de\u994b\u7d93\u9a57</li> </ol>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#q3-kubernetes","title":"Q3: Kubernetes \u6574\u9ad4\u58d3\u529b\u6e2c\u8a66\u6700\u5927\u7684\u9ede\u5728\u54ea\u88e1?","text":"<p>Control Plane</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#q4-5000","title":"Q4: \u6e2c\u8a66\u7bc0\u9ede 5000 \u662f\u4e0d\u662f\u4e0a\u9650?","text":"<p>\u4e0d\u662f\uff0c\u8b1b\u8005\u8aaa\u4e3b\u8981\u5361\u5728\u6e2c\u8a66\u6210\u672c\u592a\u9ad8\uff0c\u6b64\u5916\u591a\u6578\u4f7f\u7528\u8005\u5c0d\u6b64\u6c92\u6709\u4ec0\u9ebc\u7279\u5225\u671f\u5f85\uff0c\u6b63\u5e38\u898f\u756b\u53ef\u4ee5\u4ee5 100 Nodes \u70ba\u57fa\u790e\u8a2d\u8a08\u5c31\u597d</p> <p>\u95dc\u65bc\u7528 Azure Kubernetes Service \u8a08\u7b97 5000 \u500b\u7bc0\u9ede\u7684\u8a08\u7b97\u65b9\u5f0f\uff0c\u53ef\u4ee5\u53c3\u8003\u4e4b\u524d\u5beb\u7684\u62d9\u4f5c \u770b OpenAI \u4f7f\u7528\u9214\u80fd\u529b\u62db\u559a Kubernetes 7500 \u53f0\u7bc0\u9ede!!!\uff0c\u6709\u8a73\u7d30\u7684\u8a08\u7b97\u904e\u7a0b</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#q5-kubernetes","title":"Q5: \u5982\u4f55\u91cf\u6e2c Kubernetes \u6574\u9ad4\u7684\u6548\u80fd? \u7b2c\u4e00\u6b65\u662f?","text":"<p>\u4e0a Grafana + Prometheus \u6703\u662f\u5f88\u597d\u7684\u8d77\u6b65\uff0c\u6216\u8005\u662f\u53ef\u4ee5\u5f9e CNCF Observability \u6311\u51fa\u9069\u5408\u7684\u5de5\u5177\u3002 \u82e5\u60f3\u8981\u91dd\u5c0d Observability \u6709\u66f4\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u5efa\u8b70\u53ef\u4ee5\u53c3\u52a0 CNCF TAG (Technical Advisory Group) Observability \ud83d\udd2d\u2699\ufe0f</p>","tags":["kubernetes"]},{"location":"20230515-deepdive-sig-scalability.html#references","title":"References","text":"<ul> <li>Intro + Deep Dive: Kubernetes SIG Scalability - Wojciech Tyczynski, Google</li> <li>Intro + Deep Dive: SIG Scalability - Marcel Zi\u0119ba &amp; Wojciech Tyczy\u0144ski, Google</li> <li>Kubernetes Scalability thresholds</li> <li>Scalability Special Interest Group</li> <li>Steady state SLIs/SLOs</li> <li>ClusterLoader2</li> <li>kubernetes/sig-scalability/sig-scalability-periodic-jobs.yaml</li> <li>testgrid.k8s.io</li> <li>YouTube - KubeCon + CloudNativeCon Europe 2023</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html","title":"Kubernetes Probe \u985e\u578b\u53ca\u5be6\u4f5c\u65b9\u5f0f\u7684\u4f7f\u7528\u8aaa\u660e\u8207\u5c0f\u5efa\u8b70","text":"<p>\u6700\u8fd1\u770b\u5230\u4e00\u500b\u5f88\u6709\u8da3\u7684\u7db2\u7ad9 kube-score\uff0c\u4f60\u628a\u4f60\u7684 Kubernetes Deployment \u4e1f\u9032\u53bb\u4e4b\u5f8c\uff0c\u5b83\u5c31\u6703\u5404\u7a2e\u7121\u60c5\u5730\u8ddf\u4f60\u8aaa\u54ea\u88e1\u4e0d\u597d\u3002\u7576\u4e2d\u88e1\u9762\u6709\u63d0\u5230\u91dd\u5c0d Kubernetes Probe \u76f8\u95dc\u7684\u5efa\u8b70\uff0c\u525b\u597d\u6700\u8fd1\u6848\u5b50\u6709\u9700\u8981\u7279\u5225\u7cbe\u7b97\u6642\u9593\uff0c\u6545\u7279\u5225\u5beb\u4e86\u7bc7\u6587\u7ae0\u4f9b\u5927\u5bb6\u53c3\u8003\u3002\u9806\u4fbf\u9644\u4e0a\u4e00\u5f35\uff0c\u5f9e Bing Creator \u63d0\u4f9b\u7684 DALL.E \u6a21\u578b\u6240\u7406\u89e3\u5230\u7684 Kubernetes livenessProbe\u3001readinessProbe \u4ee5\u53ca startupProbe \u8996\u89ba\u5316\u7684\u6a23\u5b50\uff0c\u5f88\u50cf...\u5de6\u7d0d\u70cf\u80fd\u6e90\u7d50\u6676</p> <p></p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#tldr","title":"TL;DR","text":"<ul> <li>Kubernetse Probe \u985e\u578b\u91cd\u8981\u6027\u6392\u5e8f: readinessProbe &gt; livenessProbe &gt; startupProbe</li> <li>\u5448\u4e0a\uff0c\u6bcf\u4e00\u500b Kubernetes Probe \u90fd\u6709\u5404\u81ea\u7684 initialDelaySeconds\u3001periodSeconds\u3001successThreshold\u3001failureThreshold\u3001timeoutSeconds \u4ee5\u53ca Probe \u5be6\u4f5c\u65b9\u6cd5\u53ef\u4ee5\u8a2d\u5b9a\uff0c\u4e26\u4e0d\u91cd\u8907</li> <li>Probe \u5e38\u898b\u5be6\u4f5c\u65b9\u6cd5\u6392\u5e8f: HTTP Probe &gt; Exec Probe &gt; TCP Socket Probe</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#cloud-native-taiwan-user-group","title":"\u95dc\u65bc Cloud Native Taiwan User Group","text":"<p>\u57fa\u65bc CNCF \u6cbb\u7406\u898f\u7bc4\uff0c\u524d\u9663\u5b50\u5c07\u793e\u5718\u62c6\u5206\u6210\u5169\u500b\uff0c\u5206\u5225\u662f Cloud Native Taiwan User Group \u548c Kubernetes Community Days Taiwan</p> <p>\u6b61\u8fce\u5927\u5bb6\u52d5\u52d5\u624b\u52a0\u5165\u4e00\u4e0b CNCF \u793e\u7fa4\u6703\u54e1\uff0c\u4e26\u4e14\u9ede\u64ca\u52a0\u5165 (Join)</p> <p></p> <p>\u53e6\u5916\u6211\u5011 2023/06 \u6709\u793e\u7fa4\u6d3b\u52d5 CNTUG 2023/06 Meetup\uff0c\u9700\u900f\u904e\u8a72\u7cfb\u7d71\u5831\u540d\uff0c\u7d71\u8a08\u4eba\u6578\uff0c\u6b61\u8fce\u5927\u5bb6\u53c3\u52a0</p> <p>Cloud Native Taiwan User Group 2023/06</p> <ul> <li>Kubernetes \u4f38\u7e2e\u81ea\u5982\u7684\u5de5\u4f5c\u8ca0\u8f09! -  Phil Huang</li> <li>Topic Scalable NATS architecture with JetStream - \u4f55\u79c9\u8ce2</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#kubernetes-3-probe","title":"Kubernetes \u80fd\u8a2d\u5b9a\u7684 3 \u7a2e Probe \u985e\u578b","text":"<p>\u57fa\u65bc Kubernetes \u5b98\u65b9\u6587\u4ef6\u6307\u51fa</p> Probe \u529f\u80fd\u63cf\u8ff0 \u7528\u9014 \u4f7f\u7528\u5834\u666f Liveness Probe (\u5b58\u6d3b\u63a2\u91dd) \u7528\u65bc\u6aa2\u6e2c Pod \u662f\u5426\u5728\u904b\u884c\u72c0\u614b\u4e0b \u78ba\u4fdd\u61c9\u7528\u7a0b\u5e8f\u5728\u5bb9\u5668\u5167\u90e8\u904b\u884c\uff0c\u5982\u679c\u6aa2\u6e2c\u5931\u6557\uff0cKubernetes \u5c07\u6703\u7d42\u6b62\u5bb9\u5668\u4e26\u91cd\u65b0\u555f\u52d5\u5b83 \u9019\u53ef\u7528\u65bc\u6aa2\u6e2c\u61c9\u7528\u7a0b\u5e8f\u7684\u7570\u5e38\u72c0\u614b\uff08\u4f8b\u5982\uff0c\u7576\u61c9\u7528\u7a0b\u5e8f\u6b7b\u6389\u6216\u8655\u65bc\u4e0d\u6b63\u5e38\u72c0\u614b\u6642\uff09\uff0c\u985e\u4f3c\u65bc\u96fb\u8166\u555f\u52d5\u5f8c\u5f9e\u5916\u90e8\u76e3\u63a7 BMC \u78ba\u8a8d\u6a5f\u5668\u904b\u4f5c\u6b63\u5e38 Readiness Probe (\u5c31\u7dd2\u63a2\u91dd) \u7528\u65bc\u6aa2\u6e2c Application \u662f\u5426\u6e96\u5099\u597d\u63a5\u53d7\u7db2\u8def\u6d41\u91cf \u7576\u5bb9\u5668\u5167\u7684\u61c9\u7528\u7a0b\u5e8f\u6b63\u5728\u555f\u52d5\u6216\u6b63\u5728\u9032\u884c\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c\u6642\uff0c\u53ef\u4ee5\u4f7f\u7528 Readiness Probe\u3002\u7576\u61c9\u7528\u7a0b\u5e8f\u5c31\u7dd2\u6642\uff0c\u5b83\u5c07\u8fd4\u56de\u6210\u529f\u7684\u61c9\u7b54\uff0c\u4e26\u4e14 Kubernetes \u53ef\u4ee5\u958b\u59cb\u5c07\u6d41\u91cf\u8def\u7531\u5230\u8a72\u5bb9\u5668\u3002 \u6301\u7e8c\u6027\u670d\u52d9\u5065\u5eb7\u6aa2\u67e5\uff0c\u985e\u4f3c\u65bc\u4f5c\u696d\u7cfb\u7d71\u904b\u884c\u6b63\u5e38 Startup Probe (\u555f\u52d5\u63a2\u91dd) \u7528\u65bc\u6aa2\u6e2c Pod \u7684\u555f\u52d5\u9032\u5ea6 Startup Probe \u985e\u4f3c\u65bc Readiness Probe\uff0c\u5b83\u7528\u65bc\u6aa2\u6e2c\u5bb9\u5668\u662f\u5426\u6b63\u5728\u9032\u884c\u555f\u52d5\u904e\u7a0b\u3002\u8207 Readiness Probe \u4e0d\u540c\uff0cStartup Probe \u53ef\u4ee5\u5728\u61c9\u7528\u7a0b\u5e8f\u5c31\u7dd2\u4e4b\u524d\u57f7\u884c\u591a\u6b21\u6aa2\u6e2c\u3002 App \u521d\u59cb\u5316\uff0c\u985e\u4f3c\u65bc\u96fb\u8166\u555f\u52d5\u7684\u6642\u5019\u6703\u6709 BIOS \u6aa2\u67e5\u7a0b\u5e8f <p>Liveness Probe </p> <p>Readiness Probe </p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#probe-3","title":"\u6bcf\u4e00\u500b Probe \u53ef\u4ee5\u7528\u4e0b\u5217 3 \u7a2e\u5be6\u4f5c\u65b9\u5f0f\u9032\u884c\u6aa2\u67e5","text":"","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#http-probe","title":"HTTP Probe","text":"<p>\u6700\u5927\u5b97\u7684\u6aa2\u67e5\u65b9\u5f0f\uff0c\u5982\u679c Kubernetes \u6536\u5230 HTTP Status Code 200 ~ 300 \u7684\u7bc4\u570d\uff0c\u5247\u6703\u6a19\u8a3b\u70ba Health\uff0c\u53cd\u4e4b\u5247\u6703\u6a19\u8a3b\u70ba Unhealth</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    test: http-probe\n  name: http-probe\nspec:\n  containers:\n  - name: http-probe\n    image: k8s.gcr.io/liveness\n    args:\n    - /server\n    livenessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n        httpHeaders:\n        - name: X-Custom-Header\n          value: Awesome\n      initialDelaySeconds: 3\n      periodSeconds: 10\n\n    readinessProbe:\n      httpGet:\n        path: /healthz\n        port: 8080\n        httpHeaders:\n        - name: X-Custom-Header\n          value: Awesome\n      initialDelaySeconds: 3\n      periodSeconds: 10\n</code></pre> <p>\u5176\u5be6\u5f88\u591a Framework \u6216 Library \u5167\u5efa\u90fd\u6709\u91dd\u5c0d\u9019\u500b\u9700\u6c42\u9032\u884c\u5be6\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528</p> <ul> <li>Spring Boot: Liveness and Readiness Probes with Spring Boot</li> <li>.NET Core: Health checks in ASP.NET Core</li> <li>Python3: flask-healthz</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#exec-probe","title":"Exec Probe","text":"<p>\u5982\u679c Kubernetes \u6536\u5230 Exit Code \u70ba 0\uff0c\u5247\u6703\u6a19\u8a3b\u70ba Health\uff0c\u53cd\u4e4b\u5247\u6703\u6a19\u8a3b\u70ba Unhealth</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  labels:\n    test: exec-probe\n  name: exec-probe\nspec:\n  containers:\n  - name: exec-probe\n    image: k8s.gcr.io/busybox\n    args:\n    - /bin/sh\n    - -c\n    - touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600\n    livenessProbe:\n      exec:\n        command:\n        - cat\n        - /tmp/healthy\n      initialDelaySeconds: 5\n      periodSeconds: 10\n    readinessProbe:\n      exec:\n        command:\n        - cat\n        - /tmp/healthy\n      initialDelaySeconds: 5\n      periodSeconds: 10\n</code></pre>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#tcp-socket-probe","title":"TCP Socket Probe","text":"<p>\u5982\u679c Kubernetes \u80fd\u5efa\u7acb TCP Establish connection\uff0c\u5247\u6703\u6a19\u8a3b\u70ba Health\uff0c\u53cd\u4e4b\u5247\u6703\u6a19\u8a3b\u70ba Unhealth</p> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: goproxy\n  labels:\n    app: goproxy\nspec:\n  containers:\n  - name: goproxy\n    image: k8s.gcr.io/goproxy:0.1\n    ports:\n    - containerPort: 8080\n    readinessProbe:\n      tcpSocket:\n        port: 8080\n      initialDelaySeconds: 5\n      periodSeconds: 10\n\n    livenessProbe:\n      tcpSocket:\n        port: 8080\n      initialDelaySeconds: 15\n      periodSeconds: 20\n</code></pre>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#use-cases","title":"Use Cases","text":"\u53c3\u6578 \u63cf\u8ff0 kubernetes \u9810\u8a2d\u503c NATS-Operator Strimzi Kafka Operator kubernetes/ingress-nginx mysql/mysql-operator mariadb-operator/mariadb-operator <code>livenessProbe.enabled</code> \u555f\u7528 Liveness probe N/A true true true N/A N/A <code>livenessProbe.initialDelaySeconds</code> \u521d\u59cb\u5316 Liveness Probe \u524d\u7684\u5ef6\u9072\u6642\u9593 0 30 10 10 N/A N/A <code>livenessProbe.periodSeconds</code> \u591a\u4e45\u91cf\u6e2c\u4e00\u6b21 10 10 30 10 N/A N/A <code>livenessProbe.timeoutSeconds</code> \u591a\u4e45\u6703\u8d85\u6642 1 5 N/A 1 N/A N/A <code>livenessProbe.failureThreshold</code> \u6210\u529f\u5f8c\u88ab\u8996\u70ba\u5931\u6557\u7684\u63a2\u6e2c\u7684\u6700\u5c0f\u9023\u7e8c\u5931\u6557\u6b21\u6578 3 6 N/A 5 N/A N/A <code>livenessProbe.successThreshold</code> \u63a2\u6e2c\u5931\u6557\u5f8c\u88ab\u8996\u70ba\u6210\u529f\u7684\u6700\u5c11\u9023\u7e8c\u6210\u529f\u6b21\u6578 1 1 N/A 1 N/A N/A livenessProbe HealthCheck Liveness Probe \u63a2\u91dd\u65b9\u5f0f N/A httpGet httpGet httpGet N/A N/A <code>readinessProbe.enabled</code> \u555f\u7528 Readiness Probe N/A true true true true true <code>readinessProbe.initialDelaySeconds</code> \u521d\u59cb\u5316 Readiness Probe \u524d\u7684\u5ef6\u9072\u6642\u9593 0 5 10 10 1 5 <code>readinessProbe.periodSeconds</code> \u591a\u4e45\u91cf\u6e2c\u4e00\u6b21 10 10 30 10 3 10 <code>readinessProbe.timeoutSeconds</code> \u591a\u4e45\u6703\u8d85\u6642 1 5 N/A 1 N/A N/A <code>readinessProbe.failureThreshold</code> \u6210\u529f\u5f8c\u88ab\u8996\u70ba\u5931\u6557\u7684\u63a2\u6e2c\u7684\u6700\u5c0f\u9023\u7e8c\u5931\u6557\u6b21\u6578 3 6 N/A 3 N/A N/A <code>readinessProbe.successThreshold</code> \u63a2\u6e2c\u5931\u6557\u5f8c\u88ab\u8996\u70ba\u6210\u529f\u7684\u6700\u5c11\u9023\u7e8c\u6210\u529f\u6b21\u6578 1 1 N/A 1 N/A N/A readinessProbe HealthCheck Readiness Probe \u63a2\u91dd\u65b9\u5f0f N/A httpGet httpGet httpGet exec httpGet","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#nats-operator","title":"\u4ee5 NATS-Operator \u70ba\u4f8b","text":"<p>\u57fa\u65bc NATS-Operator Deployment \u548c NATS-Operator \u9810\u8a2d\u503c\uff0c\u9019\u908a\u56e0\u756b\u5716\u89e3\u91cb\u65b9\u4fbf\uff0c\u6709\u8abf\u6574\u4e86\u4e00\u4e0b\u53c3\u6578\u3002\u6545\u53ef\u5f97\u4ee5\u4e0b\u622a\u53d6\u8a2d\u5b9a</p> <pre><code>        livenessProbe:\n          httpGet:\n            path: /readyz\n            port: readyz\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 5\n          successThreshold: 6\n          failureThreshold: 3\n        readinessProbe:\n          httpGet:\n            path: /readyz\n            port: readyz\n          initialDelaySeconds: 5\n          periodSeconds: 10\n          timeoutSeconds: 5\n          successThreshold: 6\n          failureThreshold: 2\n</code></pre>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q1-kubernetes-pod-pod-restarted-unhealthy","title":"Q1: \u5982\u679c\u7a0b\u5f0f\u904b\u884c\u4e00\u6bb5\u6642\u9593\uff0c\u7136\u5f8c Kubernetes \u767c\u73fe Pod \u8981 Pod Restarted \u6216\u8005\u662f\u6a19\u8a3b Unhealthy \u6700\u77ed\u6642\u9593\u70ba\u4f55?","text":"<p>\u9996\u5148\u56e0\u70ba\u7a0b\u5f0f\u5df2\u7d93\u904b\u884c\u4e00\u6bb5\u6642\u9593\u4e86\uff0c\u6240\u4ee5\u53ef\u4ee5\u7701\u7565 initialDelaySeconds \u7684\u6642\u9593</p> <p>\u6545\u6b63\u78ba\u7684\u7b97\u5f0f\u70ba</p> <ul> <li>\u6700\u77ed\u91cd\u555f Pod \u6642\u9593 = (<code>livenessProbe.failureThreshold</code> - 1) * <code>livenessProbe.periodSeconds</code> + <code>livenessProbe.timeoutSeconds</code> =  ( 3 - 1 ) * 10 + 5 = 25</li> <li>\u6700\u77ed\u79fb\u9664 Endpoint List \u6642\u9593 = (<code>readinessProbe.failureThreshold</code> - 1) * <code>readinessProbe.periodSeconds</code> + <code>readinessProbe.timeoutSeconds</code> =  ( 2 - 1 ) * 10 + 5 = 15</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q2-pod-restart","title":"Q2: \u5982\u679c\u7a0b\u5f0f\u521d\u59cb\u904b\u884c\uff0c\u7136\u5f8c\u56e0\u70ba\u7a0b\u5f0f\u88e1\u9762\u6c92\u5beb\u597d\uff0c\u5c0e\u81f4 Pod Restart \u958b\u59cb\u57f7\u884c\u7684\u6700\u77ed\u548c\u6700\u9577\u6642\u9593\u70ba\u4f55?","text":"<p>\u9700\u8981\u628a <code>livenessProbe.initialDelaySeconds</code> \u6642\u9593\u653e\u9032\u53bb\u8a55\u4f30</p> <ul> <li>\u6700\u77ed\u91cd\u555f Pod \u6642\u9593 = <code>livenessProbe.initialDelaySeconds</code> + (<code>livenessProbe.failureThreshold</code> - 1) * <code>livenessProbe.periodSeconds</code> + <code>livenessProbe.timeoutSeconds</code> =  30 + ( 3 - 1 ) * 10 + 5 = 55</li> <li>\u6700\u9577\u91cd\u555f Pod \u6642\u9593 = <code>livenessProbe.initialDelaySeconds</code> + <code>livenessProbe.failureThreshold</code> * <code>livenessProbe.periodSeconds</code> + <code>livenessProbe.timeoutSeconds</code> =  30 + 3 * 10 + 5 = 65</li> </ul> <p>\u5169\u8005\u6642\u9593\u5dee\u5176\u5be6\u5c31\u662f\u5dee\u4e00\u500b livenessProbe.periodSeconds \u6642\u9593</p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q3-pod-endpoint-list-endponit-list-kubernetes","title":"Q3: \u5982\u679c Pod \u5f9e Endpoint list \u79fb\u9664\u4e86\u4e00\u6bb5\u6642\u9593\u5f8c\uff0c\u7576\u7a0b\u5f0f\u6b63\u78ba\u904b\u884c\u6642\uff0c\u6700\u77ed\u9700\u82b1\u591a\u5c11\u6642\u9593\u53ef\u4ee5\u52a0\u56de\u5230 Endponit list \u52a0\u56de\u5230 Kubernetes \u670d\u52d9\u7684\u884c\u5217\u5167?","text":"<p>\u4e3b\u8981\u8981\u770b <code>readinessProbe.successThreshold</code></p> <ul> <li>\u6700\u77ed\u6062\u5fa9\u670d\u52d9\u6642\u9593 = <code>readinessProbe.successThreshold</code> * <code>readinessProbe.periodSeconds</code> + <code>readinessProbe.timeoutSeconds</code> = 6 * 10 + 5 = 65</li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q4-readinessprobe","title":"Q4: \u5982\u679c\u6c92\u8a2d\u5b9a readinessProbe \u6703\u600e\u6a23\u55ce?","text":"<p>\u6709\u53ef\u80fd\u6703\u5728 Pod \u9084\u6c92\u555f\u52d5\u7684\u6642\u5019\uff0c\u6d41\u91cf\u5c31 Kubernetes \u5224\u65b7\u53ef\u4ee5\u88ab\u63a8\u9032\u53bb\uff0c\u6216\u8005\u662f Pod \u6b63\u5728\u8dd1\u505c\u6b62\u7a0b\u5e8f\u7684\u6642\u5019\uff0c\u6d41\u91cf\u9084\u662f\u88ab\u63a8\u9032\u53bb</p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q5-livenessprobe","title":"Q5: \u5982\u679c\u6c92\u8a2d\u5b9a livenessProbe \u6703\u600e\u6a23\u55ce?","text":"<p>\u4e0d\u6703\u600e\u6a23\uff0c\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u8981\u8a2d\u5b9a\u4ec0\u9ebc\uff0c\u4e0d\u7528\u7279\u5225\u8a2d\u5b9a\uff0ckubelet \u6703\u6839\u64da Pod \u7684 restartPolicy \u9032\u884c\u6b63\u78ba\u7684\u52d5\u4f5c\u3002\u5982\u679c\u6709\u8a2d\u5b9a\u7684\u8a71\uff0c\u76e1\u91cf\u4e0d\u8981\u8ddf readinessProbe \u6aa2\u67e5\u540c\u4e00\u500b\u5730\u65b9</p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#q6-startupprobe","title":"Q6: \u5982\u679c\u6c92\u8a2d\u5b9a startupProbe \u6703\u600e\u6a23\u55ce?","text":"<p>\u4e0d\u6703\u600e\u6a23\uff0c\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u8981\u8a2d\u5b9a\u4ec0\u9ebc\uff0c\u4e0d\u7528\u7279\u5225\u8a2d\u5b9a\uff0c\u53ef\u4ee5\u7528\u62c9\u9577 <code>livenessProbe.initialDelaySeconds</code> \u4e92\u63db\uff0cstartupProbe \u7684\u7279\u6027\u662f\u53ea\u8981\u6210\u529f\u4e00\u6b21\u5c31\u6703\u63db\u624b\u7d66 livenessProbe \u6216 readinessProbe \u9032\u884c\u63a2\u6e2c</p> <p>\u516c\u5f0f\u70ba <code>livenessProbe.initialDelaySeconds</code> \u5927\u7d04\u7b49\u65bc <code>startupProbe.initialDelaySeconds</code> + <code>startupProbe.periodSeconds</code> * <code>startupProbe.failureThreshold</code>\uff0c\u53ef\u4ee5\u76e1\u65e9\u518d\u521d\u59cb\u968e\u6bb5\u767c\u73fe\u670d\u52d9\u555f\u52d5\u4e0d\u4e86</p>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#_1","title":"\u500b\u4eba\u5c0f\u5efa\u8b70","text":"<ul> <li> <p>\u95dc\u65bc initialDelaySeconds</p> <ul> <li>\u91dd\u5c0d livenessProbe.initialDelaySeconds \u7279\u5225\u6709\u7528</li> <li>\u63a1\u7528 P99 \u7684\u555f\u52d5\u6642\u9593\u70ba\u4e3b\uff0c\u4e3b\u8981\u662f\u56e0\u70ba\u9019\u500b\u6578\u5b57\u985e\u540c\u65bc\u958b\u6a5f\u9700\u8981\u591a\u4e45\u6642\u9593\uff0c\u57fa\u672c\u4e0a\u90fd\u76f8\u7576\u56fa\u5b9a</li> <li>\u591a\u6578\u6709\u7528 Framework\u3001JVM \u7b49\u90fd\u6703\u6709\u555f\u52d5\u6642\u9593\u7684\u7d71\u8a08\u53ef\u4ee5\u53c3\u8003</li> <li>\u5982\u679c\u771f\u7684\u6293\u4e0d\u6e96\u7684\u8a71\uff0c\u5efa\u8b70\u4e0a startupProbe\uff0c\u800c\u4e0d\u8981\u7528 livenessProbe.initialDelaySeconds</li> </ul> </li> <li> <p>\u95dc\u65bc periodSeconds</p> <ul> <li>\u7d55\u5927\u90e8\u5206\u7684\u72c0\u6cc1\u4e0b 10s \u76f8\u7576\u8db3\u5920</li> <li>\u5982\u679c\u8a2d\u5b9a\u592a\u77ed\uff0c\u6709\u53ef\u80fd Pod \u53ea\u662f\u66ab\u6642\u6027\u5f88\u5fd9\u4f86\u4e0d\u53ca\u56de\u61c9\uff0c\u4ed6\u5c31\u88ab\u6b78\u985e\u5728 Failure \u7684\u72c0\u614b\uff0c\u5982\u679c\u5728\u6574\u9ad4\u7cfb\u7d71\u90fd\u662f\u5f88\u5fd9\u7684\u72c0\u6cc1\u4e0b\uff0c\u6703\u5c0e\u81f4\u87ba\u65cb\u5f0f\u6548\u80fd\u4e0b\u964d\uff0c\u80fd\u8005\u904e\u52de</li> <li>\u5982\u679c\u8a2d\u5b9a\u592a\u9577\uff0cPod \u771f\u7684\u6709\u4e8b\u60c5\u7684\u6642\u5019\uff0c\u8981\u5f88\u4e45\u624d\u6703\u6709\u53cd\u61c9</li> </ul> </li> <li> <p>\u95dc\u65bc timeoutSeconds</p> <ul> <li>\u6700\u5927\u591a\u6578\u6293 periodSeconds/2 \u6216\u4f4e\u65bc\u7684\u6578\u5b57</li> <li>\u6700\u5c0f\u70ba 1s</li> </ul> </li> <li> <p>\u95dc\u65bc failureThreshold</p> <ul> <li>\u5efa\u8b70 3</li> <li>\u8a2d\u5b9a\u592a\u9ad8\uff0cPod \u771f\u7684\u58de\u6389\u7684\u6642\u5019\uff0c\u5c0e\u81f4\u771f\u7684\u8981\u91cd\u555f\u6216\u79fb\u51fa\u7684\u6642\u9593\u62c9\u7684\u592a\u9577</li> <li>\u8a2d\u5b9a\u592a\u77ed\uff0cPod \u53ef\u80fd\u53ea\u662f\u66ab\u6642\u5f88\u5fd9\u7684\u6642\u5019\uff0c\u5c31\u6703\u904e\u65e9\u7684\u91cd\u555f\u6216\u79fb\u51fa\uff0c\u5c0e\u81f4\u87ba\u65cb\u5f0f\u6548\u80fd\u4e0b\u964d\uff0c\u80fd\u8005\u904e\u52de</li> </ul> </li> <li> <p>\u95dc\u65bc successThreshold</p> <ul> <li>\u5efa\u8b70 1</li> <li>\u91dd\u5c0d readinessProbe.successThreshold \u7279\u5225\u6709\u7528\uff0clivenessProbe.successThreshold \u6c92\u4ec0\u9ebc\u7279\u5225\u6548\u679c\uff0c\u56e0\u70ba\u5f8c\u8005\u6703\u628a Pod \u6574\u500b\u91cd\u555f\u6389\uff0c\u6545\u6c92\u6709\u56de\u4f86\u7684\u6a5f\u6703</li> <li>\u5982\u679c Pod \u8207\u5176\u4ed6\u670d\u52d9\u76f8\u95dc\u670d\u52d9\u591a\u7684\u8a71\uff0c\u53ef\u4ee5\u6578\u5b57\u62c9\u5927\u4e00\u9ede\uff0c</li> </ul> </li> <li> <p>\u95dc\u65bc livenessProbe</p> <ul> <li>\u56e0\u70ba\u6d89\u53ca\u5230\u91cd\u555f Pod \u7684\u80fd\u529b\uff0c\u6545\u9700\u8981\u4fdd\u5b88\u7684\u8a2d\u5b9a\u8a72\u9805\u76ee</li> <li>\u6aa2\u67e5\u50c5\u9700\u50c5\u67e5\u81ea\u8eab\u5373\u53ef\uff0c\u4e0d\u61c9\u8a72\u6d89\u53ca\u6aa2\u67e5\u5916\u90e8\u76f8\u4f9d\u6027\u670d\u52d9</li> </ul> </li> <li> <p>\u95dc\u65bc readinessProbe</p> <ul> <li>\u56e0\u70ba\u6bd4\u8f03\u504f\u5411\u670d\u52d9\u7684 healthcheck\uff0c\u6545\u53ef\u4ee5\u6bd4\u8f03\u5bec\u9b06\u4e00\u9ede\u7684\u8a2d\u5b9a</li> </ul> </li> </ul>","tags":["kubernetes"]},{"location":"20230529-kubernetes-probe.html#references","title":"References","text":"<ul> <li>\u914d\u7f6e\u5b58\u6d3b\u3001\u5c31\u7eea\u548c\u542f\u52a8\u63a2\u9488</li> <li>Liveness and Readiness Probes</li> <li>Creating Kubernetes liveness and readiness probes</li> <li>Kubernetes best practices: Setting up health checks with readiness and liveness probes</li> <li>\u5be6\u73fe\u4e0d\u505c\u6a5f\u7684 Pod \u66f4\u65b0\u65b9\u5f0f</li> <li>Readiness and Liveness Probes</li> </ul>","tags":["kubernetes"]},{"location":"20230629-debian-or-ubuntu.html","title":"\u5bb9\u5668\u57fa\u790e\u6620\u50cf\u6a94\u8981\u9078 Debian \u9084\u662f Ubuntu?","text":"<p>\u4f86\u554f\u554f\u5927\u5bb6\u4e00\u500b\u554f\u984c\uff0c\u4ee5 Container Base Images \u4f86\u8aaa\uff0c\u4ee5 Deb \u9ad4\u7cfb\u4f86\u770b\uff0c\u4f60\u89ba\u5f97 Debian \u6bd4\u8f03\u5b89\u5168\u9084\u662f Ubuntu \u6bd4\u8f03\u5b89\u5168?</p> <p></p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#static-analysis","title":"\u5bb9\u5668\u6620\u50cf\u6a94\u7684\u975c\u614b\u6383\u63cf (Static Analysis) \u65b9\u5f0f","text":"<p>\u4ee5\u73fe\u884c\u8cc7\u5b89\u670d\u52d9\u6383 Container Images\uff0c\u7d55\u5927\u90e8\u5206\u90fd\u662f\u4ee5\u975c\u614b\u6383\u63cf\u70ba\u4e3b (\u52d5\u614b\u8dd1\u6c99\u7bb1\u5167\u7684\u8acb\u5bb9\u6211\u5148\u8df3\u904e)\uff0c\u6383\u7684\u65b9\u5f0f\u4e3b\u8981\u90fd\u662f\u770b\u88e1\u9762\u7684\u5b89\u88dd\u4e2d\u5957\u4ef6\u6709\u6c92\u6709\u4f7f\u7528\u5230\u6709\u6f0f\u6d1e\u7684\u5957\u4ef6 (\u53ef\u7528 apt list --installed \u689d\u5217\u5b89\u88dd\u4e2d\u7684\u5957\u4ef6\u548c\u7248\u672c) \u7136\u5f8c\u5c0d\u4e0a\u5df2\u77e5\u7684 CVE Database\uff0c\u4ee5 Harbor \u63d0\u4f9b\u7684 Harbor Compatibility List- Scanner Adapters\uff0c\u7121\u8ad6\u662f clair / sysdig / aqua / trivy \u5be6\u4f5c\u62db\u6578\u90fd\u662f\u5dee\u4e0d\u591a\u7684</p> <pre><code>$ date\nThu Jun 29 23:25:30 CST 2023\n\n$ docker run -it --rm --name debug docker.io/library/ubuntu:22.04 /bin/bash\nroot@82f6bb20f606:/# apt list --installed | head -n 10\n\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\nListing...\nadduser/now 3.118ubuntu5 all [installed,local]\napt/now 2.4.9 amd64 [installed,local]\nbase-files/now 12ubuntu4.3 amd64 [installed,local]\nbase-passwd/now 3.5.52build1 amd64 [installed,local]\nbash/now 5.1-6ubuntu1 amd64 [installed,local]\nbsdutils/now 1:2.37.2-4ubuntu3 amd64 [installed,local]\ncoreutils/now 8.32-4.1ubuntu1 amd64 [installed,local]\ndash/now 0.5.11+git20210903+057cd650a4ed-3build1 amd64 [installed,local]\ndebconf/now 1.5.79ubuntu1 all [installed,local]\n\nroot@82f6bb20f606:/# cat /etc/os-release\nPRETTY_NAME=\"Ubuntu 22.04.2 LTS\"\nNAME=\"Ubuntu\"\nVERSION_ID=\"22.04\"\nVERSION=\"22.04.2 LTS (Jammy Jellyfish)\"\nVERSION_CODENAME=jammy\nID=ubuntu\nID_LIKE=debian\nHOME_URL=\"https://www.ubuntu.com/\"\nSUPPORT_URL=\"https://help.ubuntu.com/\"\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\nUBUNTU_CODENAME=jammy\n</code></pre>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#cve","title":"\u4ee5\u4f5c\u696d\u7cfb\u7d71\u89d2\u5ea6\u689d\u5217\u5df2\u77e5 CVE","text":"<p>\u53ef\u4ee5\u89c0\u5bdf\u5169\u908a\u7684 Security Tracker\uff0e\u9078 High \u5c31\u597d</p> <ol> <li>Debian - Security Bug Tracker \u4ed6\u6240\u6709\u7248\u865f\u90fd\u6703\u5217\u51fa\u4f86\uff0cbuster (10,oldoldstable,LTS) / bullseye (11,oldstable) / bookworm (stable) \u4e09\u500b\u7248\u672c\u90fd\u53ef\u4ee5\u770b\u4e00\u4e0b</li> <li>Ubuntu- CVE search results \u4ee5 22.04 LTS \u70ba\u4e3b</li> </ol> <p>\u5efa\u8b70\u53ef\u4ee5\u770b\u5e38\u4e0a CVE \u5217\u8868\u7684 linux* \u958b\u982d\u7684\u5957\u4ef6\uff0c\u4f60\u6703\u767c\u73fe\u5230\u5e7e\u500b\u4e8b\u5be6</p> <ol> <li>\u7121\u8ad6\u662f Ubuntu \u6216 Debian\uff0c\u4e0d\u662f\u6bcf\u4e00\u500b CVE \u6a19\u8a3b High \u5728\u4e0a\u6e38\u5957\u4ef6\u90fd\u6709\u88ab\u4fee\u5fa9\uff0c\u6240\u4ee5\u4f60\u5c31\u7b97 <code>apt update &amp;&amp; apt upgrade</code> \u66f4\u65b0\u5230\u6700\u65b0\u7248\uff0c\u4e0d\u4e00\u5b9a\u80fd\u6703\u95dc\u6389\u6240\u6709 CVE High \u7684\u554f\u984c</li> <li> <p>CVE \u6703\u96a8\u4f60\u7684\u4f5c\u696d\u7cfb\u7d71 OS \u548c\u767c\u5e03\u7248\u865f <code>cat /etc/os-release</code> \u6709\u4e0b\u5217 4 \u500b\u4e0d\u540c\u7684\u5448\u73fe\u7d50\u679c</p> <ol> <li>\u820a\u7248\u6c92\u6709\u9019\u500b\u554f\u984c\uff0c\u4f46\u65b0\u7248\u767c\u884c\u7248\u6709\uff0c\u8b6c\u5982 CVE-2023-35829</li> <li>\u820a\u7248\u4e0d\u4fee\uff0c\u4f46\u65b0\u7248\u4fee\u4e86\uff0c\u8b6c\u5982 CVE-2023-23005</li> <li>\u525b\u767c\u73fe\u9084\u4e0d\u77e5\u9053\u600e\u9ebc\u4fee\uff0c\u8b6c\u5982 CVE-2023-35827</li> <li>\u770b\u8d77\u4f86\u662f\u6c92\u4eba\u60f3\u4fee\uff0c\u8b6c\u5982 CVE-2020-36694</li> </ol> </li> </ol> <p>\u7e3d\u6b78\u4f86\u8aaa\uff0c\u5982\u679c\u4f60\u66f4\u65b0\u5230\u6700\u65b0\u7684\u7248\u672c\uff0c\u7121\u8ad6\u662f Debian \u9084\u662f Ubuntu \u4f60\u90fd\u9084\u662f\u6703\u6709\u5e7e\u500b CVE High \u7684\u554f\u984c\u6703\u4eae\u5728\u4f60\u7684\u5831\u544a\u4e0a\uff0c\u90a3\u600e\u9ebc\u8fa6? \u56b4\u683c\u4f86\u8aaa\u4f60\u4e5f\u53ea\u80fd\u7b49\u793e\u7fa4\u67d0\u500b\u4eba\u5e6b\u5fd9\u505a\u5957\u4ef6\u66f4\u65b0\uff0c\u6216\u8005\u662f\u7528\u5176\u4ed6<code>\u975e\u6280\u8853\u7684\u65b9\u5f0f</code>\u89e3\u6c7a\uff0c\u7562\u7adf\u4e0d\u662f\u6bcf\u500b CVE \u90fd\u80fd\u88ab\u5229\u7528\u6216\u597d\u5229\u7528</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#_1","title":"\u65e2\u7136\u90fd\u6c92\u8fa6\u6cd5\u5b8c\u5168\u4fee\u5230\u6c92\u6709\uff0c\u90a3\u8981\u600e\u9ebc\u9078\u64c7?","text":"<p>\u4ee5\u73fe\u5728 2023 \u9019\u500b\u6642\u9593\u9ede\u4f86\u8aaa\uff0c\u4e0d\u5982\u5e73\u5fc3\u800c\u8ad6\uff0c\u4e3b\u8981\u53ef\u4ee5\u5c0d\u6bd4\u5169\u908a CVE \u7684\u8655\u7406\u53cd\u61c9\u901f\u5ea6\u548c\u80fd\u4e0d\u80fd\u505a backport (\u5411\u5f8c\u79fb\u690d)</p> <ul> <li>Debian Security FAQ: \u57fa\u672c\u4e0a\u6bd4\u8f03\u504f\u793e\u7fa4\u81ea\u4e3b\u904b\u4f5c\uff0c\u4f60\u5f97\u56de\u5831\u5230\uff0c\u6216\u81ea\u5df1\u6372\u8d77\u624b\u4fee\u5fa9\uff0c\u800c\u4e14\u6709\u554f\u984c\u4fee\u5fa9\u7684\u6642\u5019\uff0c\u6309\u7167 <code>Q: \u5957\u4ef6\u7684\u7248\u672c\u865f\u8868\u660e\u6211\u4ecd\u5728\u904b\u884c\u53d7\u6f0f\u6d1e\u5f71\u97ff\u7684\u7248\u672c\uff01</code> \u7684\u8aaa\u6cd5\u662f <code>A: \u6211\u5011\u5c07\u5b89\u5168\u88dc\u4e01\u5411\u5f8c\u79fb\u690d\u5230\u7a69\u5b9a\u767c\u884c\u7248 (Stable Release) \u4e2d\u96a8\u9644\u7684\u5957\u4ef6\u7248\u672c\uff0c\u800c\u4e0d\u662f\u5347\u7d1a\u5230\u65b0\u7248\u672c</code></li> <li>Ubuntu - Long Term Supported OCI Images: \u9019\u500b\u56e0\u70ba\u6709 Canonical \u5f8c\u9762\u6295\u4eba\u529b\u4e0b\u53bb\u7dad\u8b77\uff0c\u6309\u7167 <code>Is the LTS Docker Image Portfolio a free or a commercial offering?</code> \u7684\u8aaa\u6cd5\uff0c\u6240\u4ee5\u6700\u5c0f 5y LTS \u66f4\u65b0\uff0c\u6709\u8a02\u95b1\u8cb7\u652f\u63f4\u7684\u8a71\u6700\u9577 10y \u7684\u5b89\u5168\u4fee\u88dc\uff0c\u5176\u5be6\u8ddf Red Hat / SUSE \u92b7\u552e\u6a21\u5f0f\u662f\u5927\u540c\u5c0f\u7570\uff0c\u9019\u7a2e\u6bd4\u8f03\u6709\u4eba\u529b\u505a backport\uff0c\u610f\u601d\u662f\u8aaa\u73fe\u5728\u7684 patch \u53ef\u4ee5\u56de\u6714\u5230\u524d\u9762\u7684\u7248\u672c\u53bb\u4fee\u5fa9</li> </ul> <p>\u6545\u5c31\u5546\u7528\u652f\u63f4\u4f86\u8aaa\uff0cCanonical \u56e0\u70ba\u6709\u65e2\u6709\u7684\u5546\u696d\u6a21\u5f0f\u652f\u6490\u4ed6\u5011\u990a\u5de5\u7a0b\u5e2b\uff0c\u6545\u6574\u9ad4\u63a1\u7528\u98a8\u96aa\u4f86\u8aaa\uff0c\u9084\u76f8\u5c0d\u6bd4 Debian \u4f4e\u4e00\u9ede\uff0c\u66f4\u4f55\u6cc1 Ubuntu \u771f\u7684\u662f\u592a\u591a\u516c\u53f8 (e.g. Cloud Provider / OEM) \u9810\u8a2d\u6709\u7528\uff0c\u7121\u8ad6\u662f\u6709\u6c92\u6709\u8d70 Partner Channel \u8a02\u95b1\uff0c\u6216\u8005\u662f OEM \u8def\u7dda</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#_2","title":"\u7d50\u8ad6","text":"<p>\u7d50\u8ad6\u4f86\u8aaa\uff0c\u5982\u679c\u53eb\u6211\u9078\u64c7 Debian \u9ad4\u7cfb\u7684 Container Base Images \uff0c\u4e0b\u5217\u63d0\u4f9b\u500b\u4eba\u4e3b\u89c0\u5224\u65b7...</p> <p>\u6e96\u5247\u5982\u4e0b\uff0c\u5f9e\u5546\u52d9\u89e3\u5230\u6280\u8853\u89e3:</p> <ol> <li>\u91cd\u8996 Security \u4fee\u5fa9\u80fd\u91cf</li> <li>\u8ddf\u8457\u5e95\u5c64\u4f5c\u696d\u7cfb\u7d71 (Host OS) \u9078: \u56e0\u70ba Container \u662f\u5171\u7528 Host OS Kernel\uff0c\u5982\u679c\u525b\u597d\u4f60\u7528\u5230\u7684\u529f\u80fd\u6709\u9019\u7a2e\u504f\u7279\u5b9a Kernel \u7684 lib \u6216\u5957\u4ef6\uff0c\u90a3\u5efa\u8b70\u8ddf\u8457 Host OS \u9078\uff0c\u5982\u679c\u6c92\u9019\u7a2e\u9700\u6c42\uff0c\u9084\u662f\u5efa\u8b70\u8ddf\u8457 Host OS \u9078\uff0c\u5176\u6b21\u624d\u9078\u5225\u7684</li> <li>\u62c9\u6700\u65b0\u7248\u672c: dockerfile \u958b\u982d\u8a18\u5f97\u8981\u5148 apt update &amp;&amp; apt upgrade</li> <li>\u8d70 Distroless: \u88dd\u6700\u5c11\u4f46\u5fc5\u9808\u7684\u5957\u4ef6\uff0c\u4e0d\u8981\u88dd\u591a\u9918\u5957\u4ef6\uff0c\u4f46\u9019\u500b\u9700\u8981\u5c0d Multi Stage Build \u6709\u9ad8\u5ea6\u7406\u89e3\u7684\u5de5\u7a0b\u5718\u968a\u624d\u53ef\u4ee5\u9078\u7684\u6280\u8853\u89e3\u6cd5</li> </ol> <p>\u9806\u5e8f\u5982\u4e0b:</p> <ol> <li>docker.io/library/ubuntu:22.04</li> <li>Distroless \u9ad4\u7cfb</li> <li>docker.io/library/debian:bookworm</li> </ol>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#qa","title":"Q&amp;A","text":"","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q1-debian-ubuntu","title":"Q1: \u53ef\u662f\u4eba\u5bb6\u8aaa\u4e0d\u662f Debian \u6bd4\u8f03\u7a69\u5b9a? Ubuntu \u6bd4\u8f03\u4e0d\u7a69\u5b9a?","text":"<p>\u5177\u9ad4\u4f86\u8aaa\uff0c\u53ef\u4ee5\u5148\u8a66\u554f\u81ea\u5df1\uff0c\u4f55\u8b02<code>\u7a69\u5b9a</code>\u7684\u5b9a\u7fa9? \u4e0d\u5e38\u66f4\u65b0\u7684\u767c\u884c\u7248\u3001\u5c11\u4eba\u4f7f\u7528\u7684\u767c\u884c\u7248\u3001\u5c11\u6f0f\u6d1e\u7684\u767c\u884c\u7248? \u9019\u4e9b\u90fd\u6709\u807d\u904e\uff0c\u4f46\u9019\u500b\u8ddf\u5546\u52d9\u4f7f\u7528\u4e0a\u7684\u95dc\u4fc2\u8981\u600e\u9ebc\u639b\u52fe\u8d77\u4f86\uff0c\u53ef\u4ee5\u7528\u5be6\u52d9\u9762\u554f\u984c\u4f86\u8a0e\u8ad6\uff0c<code>CVE \u5957\u4ef6\u5831\u544a\u5c31\u4eae\u5728\u90a3\u908a\uff0c\u8acb\u554f\u8981\u627e\u8ab0\u8655\u7406\u4fee\u5fa9?</code></p> <p>\u95dc\u9375\u91cd\u9ede\u662f\u8ab0 (Who) \u53bb\u4fee\uff0c\u53cd\u800c\u4e0d\u662f CVE Database\uff0c\u56e0\u70ba CVE \u4f60\u64cb\u4e86\u4e00\u500b\u660e\u5929\u9084\u6703\u6709\u4e0b\u4e00\u500b\uff0c\u57fa\u672c\u4e0a\u6c92\u4ec0\u9ebc\u7279\u5225\u53ef\u4ee5\u8a0e\u8ad6\uff0c\u770b\u770b\u4eca\u5e74 2023 \u624d\u904e\u4e00\u534a CVE \u7de8\u865f\u5df2\u7d93\u4f86\u5230 14141\uff0c\u4f46\u8ab0 (Who) \u8981\u63d0\u4f9b\u8655\u7406\u65b9\u5f0f\u662f\u4e00\u500b\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u7121\u8ad6\u662f\u4fee\u88dc (Fixed) \u6216\u8005\u662f\u7de9\u89e3 (Mitigation)</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q2-apt-update-apt-upgrade-cve","title":"Q2: \u4e0d\u662f\u6309 apt update &amp;&amp; apt upgrade \u5c31\u53ef\u4ee5\u4fee\u88dc\u5168\u90e8 CVE \u7684\u6771\u897f\u55ce?","text":"<p>\u7d30\u5206\u4f86\u8b1b\uff0c\u5957\u4ef6\u5eab\u9084\u6709\u5206 Ubuntu / Debian \u5b98\u65b9\u6536\u7de8\u6b63\u5f0f\u652f\u63f4\u7684\u5957\u4ef6\u5eab\uff0c\u548c\u7b2c\u4e09\u65b9\u5957\u4ef6\u5eab (e.g. PPA \u6216\u5176\u4ed6\u639b apt-repos / dpkg -i) \u7684\u5b89\u88dd\uff0c\u5343\u842c\u4e0d\u8981\u671f\u671b\u5168\u90e8\u5957\u4ef6\u90fd\u80fd\u4e00\u767c\u89e3\u6c7a\u7684\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u4f60 CVE \u4eae\u534a\u5929\uff0c\u6709\u9ad8\u5ea6\u6a5f\u6703\u7b49\u5230\u4ed6\u751f\u547d\u5468\u671f\u7d50\u675f\u9084\u662f\u6703\u7e7c\u7e8c\u4eae\u8457</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q3","title":"Q3: \u6211\u5c31\u662f\u4e0d\u60f3\u4ed8\u9322\uff0c\u4f46\u6211\u53c8\u8981\u6709\u8f03\u9ad8\u7684\u5b89\u5168\u6027\uff0c\u600e\u9ebc\u8fa6?","text":"<p>\u6700\u4f73\u505a\u6cd5\u5c31\u662f \"\u8acb\u6301\u7e8c\u4fdd\u6301\u6700\u65b0\u7248\u672c\"\uff0c\u56e0\u70ba\u73fe\u884c\u591a\u6578\u767c\u884c\u7248\uff0c\u9bae\u5c11\u6703\u6301\u7e8c backport \u56de\u53bb\u5230\u820a\u6709\u7684\u7248\u672c\uff0c\u4f60\u5982\u679c\u662f\u601d\u8003\u5b8c\u5168\u4e0d\u66f4\u65b0\uff0c\u4e0d\u4ee3\u8868\u5c31\u662f\u5b89\u5168\uff0c\u7136\u5f8c\u5c31\u6c92\u4f60\u7684\u4e8b\u4e86\uff0c\u4f60\u53ea\u662f\u9078\u64c7\u628a\u6280\u8853\u50b5\u7559\u5230\u4e4b\u5f8c\u518d\u4f86\u8655\u7406\uff0c\u4e2d\u9593\u7684\u6642\u9593\u5c31\u662f\u98a8\u96aa\u6240\u5728\uff0c\u9700\u8981\u81ea\u884c\u8a55\u4f30</p> <p>\u4ee5\u4e00\u500b\u7dda\u6027\u958b\u767c\u7684\u6a21\u5f0f\u4f86\u770b\uff0c\u4f60\u60f3\u60f3\u4f60\u4ee5\u524d\u5beb\u7684 code \u51fa\u554f\u984c\u4e86\uff0c\u5728\u4e0d\u5177\u5099\u4efb\u4f55 SLA \u5546\u52d9\u4fdd\u8b49\u4e0b\uff0c\u4f60\u662f\u6703\u4fee\u5728\u6700\u65b0\u7684\u7248\u672c\uff0c\u9084\u662f\u8981\u82b1\u5927\u91cf\u6642\u9593\u5f80\u56de\u4fee? \u7dad\u8b77\u662f\u9700\u8981\u4eba\u529b\u6210\u672c\u7684</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q4","title":"Q4: \u793e\u7fa4\u4e0d\u662f\u90fd\u6703\u81ea\u52d5\u63d0\u4f9b\u4fee\u88dc\u65b9\u5f0f\u55ce?","text":"<p>\u793e\u7fa4\uff0c\u662f\u7531\u4e00\u5806\u5fd7\u9858\u8005\u82b1\u6642\u9593\u8ca2\u737b\u6216\u8005\u662f\u6709\u53d7\u96c7\u7279\u5b9a\u516c\u53f8\u505a\u9650\u5b9a\u7bc4\u570d\u7684\u4e8b\u60c5\uff0c\u6f0f\u6d1e\u6703\u88ab\u4fee\u88dc\u662f\u56e0\u70ba\u6709\u5225\u7684\u7dad\u8b77\u8005\u6216\u516c\u53f8\u525b\u597d\u6709\u9019\u500b\u9700\u6c42\u8ca2\u737b\u51fa\u4f86\uff0c\u7d55\u5c0d\u4e0d\u662f\u7121\u4e2d\u751f\u6709\u7684</p> <p>\u4f46\u4ee5\u524d\u6216\u8a31\u4f60\u4e0d\u7528\u60f3\u9019\u4e9b\u5957\u4ef6\u600e\u9ebc\u4f86\u7684\uff0c\u7562\u7adf\u7528\u7684\u4eba\u4e0d\u662f\u5927\u5b97\uff0c\u4f46\u96a8\u8457\u6578\u4f4d\u767c\u5c55\u7684\u666e\u53ca\u6027\uff0cLinux \u548c OpenSource \u7684\u63a1\u7528\u8ddf\u967d\u5149\u7a7a\u6c23\u6c34\u4e00\u6a23\u7684\u81ea\u7136\uff0c\u9032\u800c\u767c\u751f\u883b\u591a\u8d77\u958b\u6e90\u8edf\u9ad4\u4f9b\u61c9\u93c8\u653b\u64ca (Software Supply Chain Attacks)\uff0c\u5404\u500b\u90fd\u662f\u5730\u5716\u70ae\u7b49\u7d1a\uff0c\u770b\u770b\u4e4b\u524d\u7684 NPM\u3001PyPI \u7684\u653b\u64ca\u7bc4\u570d\uff0c\u9084\u6709\u90a3\u500b\u57fa\u672c\u4e0a\u4eba\u4eba\u90fd\u6709\u7528\u5230\u4f46\u6975\u5c11\u4eba\u5728\u4e4e\u4ed6\u5230\u5e95\u600e\u9ebc\u8a95\u751f\u7684 OpenSSL\u3002\u56b4\u91cd\u5230 2021/5/21 \u7f8e\u570b\u7e3d\u7d71\u90fd\u7c3d\u7f72\u884c\u653f\u547d\u4ee4 Executive Order 14028, \u201cImproving the Nation\u2019s Cybersecurity \u9032\u884c SBOM \u548c Software Supply Chain \u7684\u898f\u7bc4</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q5-ubuntu-debian-base-images","title":"Q5: \u5982\u679c\u7528 Ubuntu / Debian \u7684 Base Images \u6216\u76f8\u95dc\u5957\u4ef6\u62db\u81f4\u653b\u64ca\uff0c\u9019\u500b\u7b97\u8ab0\u7684\u8cac\u4efb?","text":"<p>\u4f7f\u7528\u8005\u8cac\u4efb\uff0c\u98a8\u96aa\u9700\u81ea\u8ca0</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q6","title":"Q6: \u6211\u4e0d\u60f3\u8981\u51fa\u4e8b\u7684\u6642\u5019\u81ea\u5df1\u64d4\u653f\u6cbb\u8cac\u4efb\uff0c\u90a3\u600e\u9ebc\u8fa6?","text":"<p>\u98a8\u96aa\u8f49\u5ac1 (a.k.a \u627e\u80cc\u934b\u4fe0)</p> <ol> <li>\u6cbb\u672c\u7684\u65b9\u5f0f\u5c31\u662f\u627e\u6709 SLA \u7684\u516c\u53f8\u8ca0\u8cac\uff0c\u4f8b\u5982 Canonical / Red Hat / SUSE \u7b49\u7b49\uff0c\u9019\u4e9b\u516c\u53f8\u90fd\u6709\u63d0\u4f9b\u5546\u696d\u652f\u63f4\uff0c\u4f46\u9019\u4e9b\u90fd\u662f\u8981\u4ed8\u8cbb\u7684\uff0c\u4e0d\u662f\u514d\u8cbb\u7684</li> <li>\u6cbb\u6a19\u7684\u65b9\u5f0f\u5c31\u662f\u8cc7\u5b89\u8a2d\u5099\u7528\u67b6\u69cb\u9762\u7bc9\u8d77\u5f37\u5316\u9632\u8b77\u7684\u80fd\u529b\uff0c\u4f46\u9084\u662f\u8981\u82b1\u9322</li> </ol> <p>\u4e0d\u82b1\u9322\u7684\u98a8\u96aa\u8f49\u5ac1...\u5982\u679c\u77e5\u9053\u7684\u4eba\uff0c\u8acb\u7559\u8a00\u6216\u79c1\u8a0a\u6559\u6211\u4e00\u4e0b</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q7","title":"Q7: \u4e0a\u8ff0\u8ad6\u8ff0\u9069\u7528\u65bc\u55ae\u7d14\u53ea\u662f\u8981\u9078\u64c7\u4f5c\u696d\u7cfb\u7d71\u4e0a\u55ce?","text":"<p>\u662f\uff0c\u672c\u6587\u8ad6\u8ff0\u4e0d\u50c5\u9650\u5b9a\u65bc\u5728 Base Images \u7684\u9078\u64c7\ufe50\u4e5f\u53ef\u5305\u542b\u55ae\u7d14 Deb \u9ad4\u7cfb\u7684\u4f5c\u696d\u7cfb\u7d71\u9078\u64c7\u8aaa\u660e</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q8-ubuntu-red-hat-suse","title":"Q8: \u654f\u611f\u4e00\u9ede\u7684\u554f\u984c\uff0cUbuntu / Red Hat / SUSE?","text":"<p>\u6211\u500b\u4eba\u652f\u6301\u6295\u6ce8\u5f88\u591a\u7cbe\u529b\u5728 <code>\u8ca2\u737b Upstream Open Source Project</code> \u7684\u516c\u53f8\u4e0a\uff0c\u9019\u624d\u662f\u6211\u8a8d\u77e5\u6bd4\u8f03\u6b63\u5e38\u7684\u958b\u6e90\u751f\u614b\u7cfb\uff0c\u6240\u4ee5\u8981\u6211\u6392\u7684\u8a71\u5c31\u662f Red Hat == SUSE &gt; Ubuntu\uff0c\u4f46\u9019\u53ea\u662f\u6211\u500b\u4eba\u7684\u770b\u6cd5\uff0c\u7562\u7adf\u6bd4\u8f03\u4ee5\u524d\u5e38\u649e\u5230\u524d\u5169\u5bb6\u7684\u4eba</p>","tags":["container"]},{"location":"20230629-debian-or-ubuntu.html#q9","title":"Q9: \u70ba\u5565\u9019\u4e16\u754c\u8ddf\u4ee5\u524d\u597d\u50cf\u4e0d\u592a\u4e00\u6a23?","text":"<p>\u807d\u9996\u9673\u5955\u8fc5\u7684\u6b4c\u5341\u5e74\u56de\u5473\u4e00\u4e0b\uff0c\u6211\u5927\u6982\u662f\u5341\u5e74\u591a\u4ee5\u524d\u63a5\u89f8 Linux\uff0c\u7528\u6700\u4e45\u7684\u7248\u672c\u662f Ubuntu 10.04\uff0c\u8001\u5be6\u8aaa\u7576\u6642\u771f\u5fc3\u6c92\u9019\u9ebc\u8907\u96dc\uff0c\u4f46\u73fe\u5728\u56e0\u70ba\u63a1\u7528\u7684\u4eba\u591a\uff0c\u6574\u500b\u751f\u614b\u7cfb\u76f8\u7576\u84ec\u52c3\uff0c\u505a\u6cd5\u4e5f\u6703\u76f8\u5c0d\u591a\u6a23\u5316\uff0c\u6240\u4ee5\u624d\u6703\u6709\u4e00\u7968\u958b\u6e90\u5c08\u6848\u7684\u6cbb\u7406\u6a21\u5f0f (Governance)</p>","tags":["container"]},{"location":"20230713-distroless-container-debug.html","title":"\u7576\u9047\u5230 Distroless Container \u9664\u932f\u8981\u4ec0\u9ebc\u6c92\u4ec0\u9ebc\u8a72\u600e\u9ebc\u8fa6? \u4f60\u7684\u597d\u670b\u53cb kubectl debug","text":"<p>\u9019\u7bc7\u53ea\u6709 Red Hat OpenShift \u70ba\u4e3b\u7684\u4f7f\u7528\u8005\u4e0d\u7528\u770b\uff0c\u90a3\u500b\u65e9\u5728 v3.6 \u597d\u5e7e\u5e74\u524d\u5c31\u5f04\u4e86\u4e00\u500b <code>oc debug</code> \u51fa\u4f86\u4e86\uff0c\u4f46\u4f60\u82e5\u662f\u4e00\u822c Kubernetes \u767c\u884c\u7248\u7684\uff0c\u4f8b\u5982 Tanzu Kubernetes Grid \u6216 Azure Kubernetes Service \u7b49\uff0c\u5247\u53ef\u4ee5\u53c3\u8003\u4e00\u4e0b\u6b64\u7bc7\u4f5c\u6cd5\u3002\u4e3b\u8981\u662f\u6703\u7528\u5230 Ephemeral Containers \u548c kubectl debug \u9019\u5169\u500b\u4e3b\u8981\u80fd\u529b\uff0c\u800c\u76ee\u524d\u90fd\u662f\u5728 Kubernetes v1.25 \u6a19\u8a3b Stable \u7a69\u5b9a\u72c0\u614b</p> <p></p>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#_1","title":"\u5178\u578b\u72c0\u6cc1","text":"<p>\u6709\u6642\u5019\u4f60\u6703\u9047\u5230\u4e00\u500b Container Images \u662f\u63a1 Distroless \u7684\u65b9\u5f0f\u904b\u884c\uff0c\u7279\u6027\u662f\u9664\u4e86\u7a0b\u5f0f\u672c\u8eab\u4ee5\u5916\uff0c\u4ec0\u9ebc Shell \u90fd\u6c92\u6709\uff0c\u7121\u6cd5\u767b\u5165\u9032\u53bb\uff0c\u6216\u8005\u662f\u4f60\u9032\u5f97\u53bb\u770b\u8d77\u4f86\u6709\u554f\u984c\u7684 Pod \u60f3\u8981\u9032\u884c\u4e00\u4e9b\u9664\u932f\u7684\u52d5\u4f5c\uff0c\u4f46\u525b\u597d\u6c92\u6709\u88dd\u4efb\u4f55\u5de5\u5177\u53ef\u4ee5\u4f7f\u7528\uff0c\u9019\u6642\u5019\u8a72\u600e\u9ebc\u8fa6\u5462? \u5176\u5be6\u4f60\u9700\u8981\u8981\u6e96\u5099\u4e00\u500b\u81ea\u5df1\u7de8\u8b6f\u597d\u7684 debug-container \u548c\u5b78\u7fd2\u4e00\u4e0b <code>kubectl debug</code> \u7684\u7528\u6cd5</p> <p>\u9019\u908a\u525b\u597d\u6709\u4e00\u500b Azure Kubernetes Service \u5e38\u898b\u7684\u72c0\u6cc1\uff0c\u5c31\u662f\u82e5\u60f3\u8981\u767b\u5165\u5230 CoreDNS Pod \u88e1\u9762\u67e5\u770b Corefile \u7684\u5167\u5bb9\uff0c\u4f60\u6703\u767c\u73fe\u5230\u5b83\u6703\u4e00\u76f4\u5674 <code>no such file or directory: unknown</code> \u4e4b\u985e\u7684\u932f\u8aa4\uff0c\u5176\u5be6\u662f\u56e0\u70ba\u9019\u500b Pod \u88e1\u9762\u6839\u672c\u6c92\u6709 /bin/bash \u6216\u8005\u662f /bin/cat \u7684\u6307\u4ee4\u53ef\u4ee5\u7528\uff0c\u53ef\u4ee5\u7b97\u662f\u5f88\u624e\u5be6\u7684 Distroless Container \u5be6\u52d9\u6848\u4f8b</p> <p></p> before<pre><code>repairman@vm-hub:~$ kubectl --namespace kube-system get pods -l k8s-app=kube-dns\nNAME                       READY   STATUS    RESTARTS   AGE\ncoredns-6698ddd997-gx66m   1/1     Running   0          11s\ncoredns-6698ddd997-rxlsl   1/1     Running   0          11s\n\nrepairman@vm-hub:~$ kubectl -n kube-system exec -ti coredns-6698ddd997-gx66m -- /bin/bash\nerror: Internal error occurred: error executing command in container: failed to exec in container: failed to start exec \"0f831ab9a9d243bb196e31d6578b19ea13088cdfeec57fb1953c3021a0463d12\": OCI runtime exec failed: exec failed: unable to start container process: exec: \"/bin/bash\": stat /bin/bash: no such file or directory: unknown\n\nrepairman@vm-hub:~$ kubectl -n kube-system exec -ti coredns-6698ddd997-gx66m -- cat /etc/coredns/Corefile\nerror: Internal error occurred: error executing command in container: failed to exec in container: failed to start exec \"7b5e958107188e3b7748a27138774775dbcebcb8c6bd178b357d187bda720bc9\": OCI runtime exec failed: exec failed: unable to start container process: exec: \"cat\": executable file not found in $PATH: unknown\n</code></pre> <p>\u4e0b\u9762\u63d0\u4f9b\u7528 dive \u6240\u5206\u6790\u7684\u5bb9\u5668\u6620\u50cf\u6a94\u5167\u5bb9</p> <p></p>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#2","title":"2 \u500b\u524d\u7f6e\u6e96\u5099","text":"<ol> <li>\u6e96\u5099\u4e00\u500b\u5177\u5099\u53ef\u7528 Shell \u8ddf\u5176\u4ed6\u9664\u932f\u7528\u5de5\u5177\u7684 Ephemeral Container Image\uff0c\u5982\u6211\u81ea\u5df1\u7de8\u8b6f\u7684 pichuang/debug-container:master\uff0c\u57fa\u65bc CentOS Stream\uff0c\u6bcf\u65e5\u66f4\u65b0\uff0c\u7c21\u55ae\u76f4\u89ba</li> <li>\u4f7f\u7528 <code>kubectl debug</code>\uff0c\u78ba\u4fdd\u4f60\u7684 kubectl \u7248\u672c\u662f\u5927\u65bc v1.25\uff0c\u76ee\u524d\u9019\u500b\u529f\u80fd\u662f\u5167\u5efa\u5728 kubectl \u88e1\u9762\uff0c\u4e0d\u9700\u8981\u984d\u5916\u88dd krew plugin \u5373\u53ef\u4f7f\u7528</li> </ol> <pre><code>$ kubectl version --short\nClient Version: v1.27.3\nKustomize Version: v5.0.1\nServer Version: v1.26.3\n</code></pre>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#2_1","title":"2 \u500b\u89e3\u6c7a\u65b9\u5f0f","text":"<ol> <li>\u4f7f\u7528 <code>--target</code>: \u76f4\u63a5\u5c0d Target Container \u9032\u884c\u64cd\u4f5c\uff0c\u5e38\u898b\u5982 Pod Running \u4e2d\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u4f46\u525b\u597d\u5b83\u662f distroless images\uff0c\u7f3a\u5c11\u4e00\u5806\u53ef\u57f7\u884c bin\u3002\u9019\u6642\u5019\u82e5\u4f60\u53ea\u662f\u60f3\u8981\u505a\u4e00\u4e9b\u57fa\u672c\u6e2c\u8a66\uff0c\u8b6c\u5982\u7db2\u8def\u6e2c\u8a66\u7b49\uff0c\u53ef\u4ee5\u8003\u616e\u4f7f\u7528 <code>--target</code> \u65b9\u5f0f\u628a\u81ea\u5df1\u6e96\u5099\u7684 Ephemeral Container \u639b\u9032\u53bb\u4f7f\u7528\uff0c\u7121\u9808\u7279\u5225\u4fee\u6539\u4e5f\u7121\u9808\u91cd\u958b</li> <li>\u4f7f\u7528 <code>--copy-to</code>: Copy \u4e00\u4efd Pod \u51fa\u53bb\u53e6\u5916\u7814\u7a76\uff0c\u6700\u5e38\u898b\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u53cd\u8209\u9047\u5230 Completed \u6216 CrashLoopBackOff \u7b49\u7121\u6cd5\u4f7f\u7528 kubectl exec \u65b9\u5f0f\u9032\u5165\u7684 Pod \u4e14\u60f3\u8981\u77e5\u9053\u5230\u5e95\u6b7b\u5728\u90a3\u88e1\uff0c\u53ef\u4ee5\u639b\u4e00\u500b Ephemeral Container \u4fee\u6539\u9032\u5165\u9ede\u6216\u547d\u4ee4\u7814\u7a76\u770b\u770b</li> </ol>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#1-target","title":"1. \u4f7f\u7528 <code>--target</code>","text":"target<pre><code>#\n# kubectl -n kube-system debug -it &lt;TARGET POD NAME&gt; --image=&lt;DEBUGGER CONTAINER&gt; --target=&lt;TARGET CONTAINER NAME&gt;\n#\n\nrepairman@vm-hub:~$ kubectl -n kube-system debug -it coredns-6698ddd997-gx66m --image=ghcr.io/pichuang/debug-container:master --target=coredns\nTargeting container \"coredns\". If you dont see processes from this container it may be because the container runtime doesnt support this feature.\nDefaulting debug container name to debugger-pbsr4.\nIf you dont see a command prompt, try pressing enter.\n[root@coredns-6698ddd997-gx66m /]# ps uax\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.1  0.2 762456 46012 ?        Ssl  07:24   0:01 /coredns -conf /etc/coredns/Corefile\nroot          63  0.0  0.0  12060  3284 pts/0    Ss   07:33   0:00 /bin/bash -l\nroot          88  0.0  0.0  44708  3380 pts/0    R+   07:35   0:00 ps uax\n\n[root@coredns-6698ddd997-gx66m /]# cat /proc/1/root/etc/coredns/Corefile | head -n5\n.:53 {\n    errors\n    ready\n    health {\n      lameduck 5s\n\n#\n# Qeury ephemeralContainerStatuses\n#\n# kubectl -n kube-system get pod coredns-6698ddd997-gx66m -o jsonpath='{range .status.ephemeralContainerStatuses[*]}{.name}{\"\\t\"}{.ready}{\"\\n\"}{end}'\n</code></pre> <p>\u5982\u679c\u8981\u67e5 Ephmeral Container \u7684\u72c0\u614b\uff0c\u8981\u5f9e <code>.status.ephemeralContainerStatuses</code> \u67e5\u8a62\uff0c\u53ef\u4ee5\u5f97\u77e5\u4f7f\u7528\u7684 image \u662f\u4ec0\u9ebc\uff0c\u4ee5\u53ca\u662f\u5426 Ready \u7b49\u8cc7\u8a0a</p>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#2-copy-to","title":"2. \u4f7f\u7528 <code>--copy-to</code>","text":"<p>\u9019\u908a\u8981\u7279\u5225\u6ce8\u610f\u7684\u662f\u8981\u628a <code>--share-processes</code> \u52fe\u8d77\u4f86\uff0c\u4e0d\u7136\u9810\u8a2d\u72c0\u6cc1\u4e0b Linux Namespace \u662f\u76f8\u4e92\u9694\u96e2\u7684\uff0c\u6703\u770b\u4e0d\u5230\u539f\u5148\u7684 Process</p> copy-to<pre><code>#\n# kubectl -n kube-system debug -it &lt;TARGET POD NAME&gt; --image=&lt;DEBUGGER CONTAINER&gt; --copy-to=&lt;NEW POD NAME&gt;\n#\nrepairman@vm-hub:~$ kubectl -n kube-system debug -it coredns-6698ddd997-gx66m --share-processes --image=ghcr.io/pichuang/debug-container:master --copy-to=copy-coredns\nDefaulting debug container name to debugger-lkp2m.\nIf you dont see a command prompt, try pressing enter.\n[root@copy-coredns /]# ps uax\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\n65535          1  0.1  0.0    972     4 ?        Ss   08:27   0:00 /pause\nroot           7  1.0  0.2 761944 41720 ?        Ssl  08:27   0:00 /coredns -conf /etc/coredns/Corefile\nroot          21  0.4  0.0  12060  3328 pts/0    Ss   08:27   0:00 /bin/bash -l\nroot          46  0.0  0.0  47656  3596 pts/0    R+   08:27   0:00 ps uax\n[root@copy-coredns /]# cat /proc/7/root/etc/coredns/Corefile | head -n5\n.:53 {\n    errors\n    ready\n    health {\n      lameduck 5s\n\n#\n# Reattach empeheral container\n#\nrepairman@vm-hub:~$ kubectl -n kube-system attach copy-coredns -c debugger-lkp2m -i -t\nIf you dont see a command prompt, try pressing enter.\n[root@copy-coredns /]# cat /proc/7/root/etc/coredns/Corefile | head -n5\n\n#\n# Check copy-coredns status\n#\nrepairman@vm-hub:~$ kubectl -n kube-system get pods |grep coredns\ncopy-coredns                                2/2     Running            0                 2m29s\ncoredns-6698ddd997-gx66m                    1/1     Running            0                 65m\ncoredns-6698ddd997-rxlsl                    1/1     Running            0                 65m\ncoredns-autoscaler-7dbcd7d9c8-pnqtt         1/1     Running            0                 17h\n\n#\n# Wipe out copy-coredns\n#\nrepairman@vm-hub:~$ kubectl -n kube-system delete pod copy-coredns\npod \"copy-coredns\" deleted\n</code></pre>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#microsoft-defender-for-cloud","title":"[\u63d2\u82b1] Microsoft Defender for Cloud","text":"<p>\u5c31\u5728\u6211\u5c0d Azure Kubernetes Service \u5167\u7684 CoreDNS \u4e0a\u4e0b\u5176\u624b\u7684\u6642\u5019...\u6211\u88ab\u5bc4\u4e86\u5c01 <code>Security Alert: CoreDNS modification in Kubernetes detected</code>\uff0c\u771f...\u8cbc\u5fc3\u7684\u63d0\u9192</p> Security Alert: CoreDNS modification in Kubernetes detected<pre><code>Kubernetes audit log analysis detected a modification of the CoreDNS configuration. The configuration of CoreDNS can be modified by overriding its configmap. While this activity can be legitimate, if attackers have permissions to modify the configmap, they can change the behavior of the cluster's DNS server and poison it.\n</code></pre> <p></p>","tags":["container","debug"]},{"location":"20230713-distroless-container-debug.html#refereneces","title":"Refereneces","text":"<ul> <li>CBL-Mariner Distroless Base</li> <li>pichuang/debug-container</li> <li>K8S \u6545\u969c\u6392\u9519\u65b0\u624b\u6bb5\uff1akubectl debug \u5b9e\u6218</li> <li>Ephemeral Containers</li> <li>Debugging with an ephemeral debug container</li> </ul>","tags":["container","debug"]},{"location":"20231012-sustainability-remote-capture-packets.html","title":"\u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b: \u9060\u7aef\u6293\u5c01\u5305\u5be6\u9304","text":"<p>\u6700\u8fd1\u56e0\u70ba 10/24 \u8981\u8fa6 CNCF Sustainability Week - Taiwan x Green Software Foundation \u6d3b\u52d5\uff0c\u770b\u4e86\u4e00\u5806 ESG \u76f8\u95dc\u7684\u6cbb\u7406\u6587\u7ae0\u548c\u6280\u8853\u66f8\uff0c\u56e0\u70ba\u525b\u597d\u6709\u4e9b\u5ba2\u6236\u662f\u505a\u8de8\u570b\u751f\u610f\u7684\uff0c\u9072\u65e9\u6703\u78b0\u5230\u548c\u88ab\u554f\u5230\u9019\u500b\u8b70\u984c\uff0c\u6240\u4ee5\u5c31\u5f9e\u6bd4\u8f03\u5e38\u63a5\u89f8\u7db2\u8def\u8457\u624b\u770b\u4e86\u4e00\u4e0b\u5be6\u52d9\u4e0a\u600e\u9ebc\u505a\uff0c\u7bc0\u80fd\u6e1b\u78b3\u5148\u5f9e\u5c11\u6536\u5c01\u5305\u958b\u59cb</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#cncf-sustainability-week-taiwan-x-green-software-foundation","title":"[\u6d3b\u52d5\u5ba3\u50b3] CNCF Sustainability Week - Taiwan x Green Software Foundation","text":"<p>\u5927\u5bb6\u77e5\u9053\u8fd1\u5e74\u78b3\u6392\u653e\u8b70\u984c\u98a8\u98a8\u706b\u706b\uff0c\u5f9e\u65e9\u671f\u4e0d\u77e5\u9053\u5728\u5e79\u561b\u7684\uff0c\u5230\u6b50\u76df\u5f9e 2023/10 \u6708\u8a66\u904b\u884c<code>\u78b3\u908a\u5883\u8abf\u6574\u6a5f\u5236 (Carbon Border Adjustment Mechanism, CBAM)</code>\uff0c\u800c\u7f8e\u570b 2024/1/1 \u8981\u6b63\u5f0f\u5be6\u65bd <code>\u6e05\u6f54\u7af6\u722d\u6cd5\u6848 (Clean Competition Act, CCA)</code>\uff0c\u8981\u62bd\u78b3\u95dc\u7a05\uff0c\u76ee\u524d\u724c\u50f9 55 USD/Kg CO2eq\uff0c\u8981\u7528\u4f86\u6e1b\u5c11\u6c23\u5019\u6c59\u67d3\u5566(\u6216\u5176\u4ed6\u6211\u4e5f\u4e0d\u77e5\u9053\u7684\u7528\u9014?)~</p> <p>\u4f60\u4e00\u5b9a\u60f3\u8aaa\u9019\u8ddf\u6280\u8853\u6253\u5de5\u4eba\u54e1\u5565\u4e8b\uff0c\u5c24\u5176\u662f Cloud Native \u9019\u908a\uff0c\u7576\u4f60\u6709\u9019\u500b\u60f3\u6cd5\u7684\u6642\u5019\uff0c\u4e0d\u5982\u5c31\u8d95\u5feb\u5831\u540d 2023/10/24 \u7dda\u4e0b\u6d3b\u52d5!!!\uff0c\u7576\u5929\u6709\u516c\u53f8\u6703\u8d0a\u52a9 Pizza\uff0c\u6b61\u8fce\u4f86\u5403\u6771\u897f\u517c\u804a\u5929</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#_2","title":"\u7de3\u8d77","text":"<p>\u56e0\u70ba\u6211\u5728 Target VM \u662f\u7528 RHEL 9.2 \u9032\u884c\u65e5\u5e38\u5de5\u4f5c\uff0c\u6c92\u6709 X.org / Gnome \u53ef\u4ee5\u7528\uff0c\u6709\u6642\u5019\u8981\u5728\u81ea\u5df1\u96fb\u8166\u4e0a\u7528 Wireshark \u770b\u5c01\u5305\u8981\u62c9\u4f86\u62c9\u53bb\u5f88\u4e0d\u7bc0\u80fd\u6e1b\u78b3\uff0c\u6240\u4ee5\u70ba\u4e86\u65b9\u4fbf\u81ea\u5df1\u548c\u78ba\u4fdd\u8cc7\u6599\u50b3\u8f38\u5b89\u5168\uff0c\u5c31\u62ff\u51fa ssh tunnel + linux pipeline \u5927\u6cd5\u4f86\u505a\u3002\u9019\u500b\u65b9\u5f0f\u4e0d\u9700\u8981\u4f7f\u7528 rpcapd\uff0c\u4f60\u53ea\u8981\u6709 sshd + tcpdump \u5c31\u53ef\u4ee5\u4e86</p> <p>\u4f46\u56e0\u70ba Azure Egress \u65b9\u5411\u8cc7\u6599\u50b3\u8f38\u6709\u7b97\u8cbb\u7528\uff0c\u9084\u662f\u8981\u7cbe\u6253\u7d30\u7b97\uff0c\u9806\u4fbf\u7bc0\u80fd\u6e1b\u78b3\uff0c\u6240\u4ee5\u624d\u6709\u9019\u7bc7\u6587\u7ae0\u7684\u8a95\u751f</p> <p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c\u4e00\u500b TCP \u5c01\u5305\u4e0a\u9650\u662f\u770b Maximum Segment Size (MSS) \u6b63\u5e38\u72c0\u6cc1\u4e0b\u4e0a\u9650\u70ba 1460 (MTU 1500 - IP Header 20 - TCP Header 20)\uff0c\u5148\u4e0d\u8003\u616e\u4e2d\u9593\u88ab MSS clamping\uff0c\u8b6c\u5982\u4ec0\u9ebc PPPoE \u9084\u662f\u67d0\u8a2d\u5099\u5077\u6539\u7684\u72c0\u6cc1\u3002\u82e5\u6211\u53ea\u662f\u8981\u55ae\u7d14\u67e5\u4fee\u7db2\u8def\u7684\u8a71\uff0c\u8b6c\u5982\u53ea\u662f\u8981\u89c0\u6e2c TCP Retransmission / Duplicated ACK \u7b49\uff0c\u5176\u5be6\u6211\u4e0d\u9700\u8981\u628a\u5168\u90e8 Frame \u6536\u6eff\u6536\u597d\u624d\u80fd\u77e5\u9053\u72c0\u6cc1\uff0c\u6211\u53ea\u8981\u80fd\u6536\u5230\u524d\u6bb5 TCP Header \u5c31\u53ef\u4ee5\u77e5\u9053\u7db2\u8def\u884c\u70ba\u4e86\uff0c\u6240\u4ee5\u9810\u671f\u4e0a\u53ea\u8981\u6bcf\u500b Frame \u6536 74 bytes \u6211\u5c31\u53ef\u4ee5\u89c0\u6e2c\u72c0\u6cc1\u4e86\uff0c\u53ef\u4ee5\u7bc0\u7701 20.45 \u500d (1512 / 74) \u7684\u7db2\u8def\u50b3\u8f38\u548c\u5132\u5b58\u6210\u672c</p> <p>\u8a66\u60f3\u5982\u679c\u539f\u5148\u53ea\u80fd\u76e3\u63a7 1 \u5c0f\u6642\uff0c\u900f\u904e\u9650\u5236 Frame\uff0c\u540c\u6a23\u50b3\u8f38\u548c\u5132\u5b58\u6210\u672c\uff0c\u53ef\u4ee5\u76e3\u63a7 20 \u5c0f\u6642\u4ee5\u4e0a\uff0c\u76f8\u7576\u5177\u5099\u57f7\u884c\u52d5\u529b</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#_3","title":"\u65e2\u6709\u67b6\u69cb\u5716\u53ca\u8981\u9ede\u63d0\u793a","text":"<ul> <li>a. \u5167\u90e8 WSL2 \u8207\u5916\u90e8 Windows 11 \u74b0\u5883\u53c3\u6578\u548c\u57f7\u884c: \u56e0\u70ba WSL \u5167\u7684\u74b0\u5883\u53ef\u4ee5\u8996\u540c\u65bc\u5728\u4e00\u53f0\u865b\u64ec\u6a5f\u4e0a\u9762\uff0c\u5305\u542b\u50cf SSH \u74b0\u5883\u8b8a\u6578\u3001\u7b49 PATH \u90fd\u6703\u8ddf\u5916\u90e8\u7684 Windows 11 \u4e0d\u540c\uff0c\u6545\u5f9e WSL2 \u8981\u5c0d Windows 11 \u57f7\u884c Wireshark \u5716\u5f62\u4ecb\u9762\u7684\u8a71\uff0c\u56e0\u70ba\u9810\u8a2d WSL2 \u7684 PATH \u4e26\u6c92\u6709\u8ddf\u5916\u90e8 Windows 11 \u6709\u76f8\u901a\uff0c\u6240\u4ee5\u6700\u5feb\u7684\u4f5c\u6cd5\u5c31\u662f\u8981\u7528\u7d55\u5c0d\u8def\u5f91\u4e14 Linux \u770b\u5f97\u61c2 <code>/mnt/c/Program\\ Files/Wireshark/Wireshark.exe</code> \u57f7\u884c\u7a0b\u5f0f\uff0c\u6216\u8005\u662f\u4f60\u628a Windows 11 \u7684\u90a3\u4e00\u5806 PATH \u585e\u5230 WSL2 \u4e5f\u53ef\u4ee5</li> <li>b. \u611b\u7528 SSH Key: \u9019\u500b\u8001\u6897\u4e86\uff0c\u8acb\u611b\u7528 <code>ssh-copy-id</code> \u5be6\u8e10\u514d\u5bc6\u78bc\u767b\u5165\uff1b\u5982\u679c\u8981\u505a\u5230\u96f6\u4fe1\u4efb\u7684\u8a71\uff0c\u5c31\u628a AAD Identity \u639b\u9032\u53bb</li> <li>c. DNAT: \u57fa\u65bc\u5b89\u5168\u63a7\u7ba1\u548c\u6210\u672c\u8003\u91cf\uff0c\u6211\u7528 DNAT \u70ba\u4e3b\uff1b\u5982\u679c\u8981\u505a\u5230\u96f6\u4fe1\u4efb\u7684\u8a71\uff0c\u61c9\u8a72\u8981\u7528 <code>Azure Bastion</code>\uff0c\u4f46\u9019\u74b0\u5883\u6211\u81ea\u5df1\u7528\u800c\u5df2\uff0c\u6211\u4fe1\u4efb\u6211\u81ea\u5df1</li> <li>d. tcpdump \u9700\u8981 root \u6b0a\u9650: tcpdump \u9700\u8981\u7279\u6b0a\u624d\u80fd\u4f7f\u7528\uff0c\u4e0d\u7136\u6703\u5674 <code>tcpdump: eth0: You don't have permission to capture on that device</code> \u7d66\u4f60\u770b\uff0c\u56e0\u70ba\u6211\u7684 SSH Key \u662f\u7d81 Normal User\uff0c\u4e26\u6c92\u6709\u7279\u5225\u5c0d root \u505a\u4ec0\u9ebc\u8a2d\u5b9a\uff0c\u6211\u662f\u63a1\u7528 <code>NOPASSWD: ALL</code> \u8655\u7406\uff0c\u4e0a\u73ed\u4e0d\u8981\u5b78</li> </ul>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#1","title":"1. \u6211\u5168\u90fd\u8981\u6536\u4e0b\u4f86!!!","text":"<pre><code># ssh &lt;Target username&gt;@&lt;Target IP&gt; -p &lt;Target Port&gt; -i &lt;SSH Private Key if have&gt; sudo tcpdump -U -s0 -w - -i &lt;Target Interface&gt; | wireshark -k -i -\nssh pichuang@localhost.divecode.in -p 5566 -i ~/.ssh/wolala-rsa sudo tcpdump -U -s0 -w - -i eth0 | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\n</code></pre> <p>\u9019\u500b\u61c9\u8a72\u662f\u6700\u76f4\u89ba\u7684\u505a\u6cd5\uff0c\u4f46\u5982\u679c\u4f60\u6e2c\u8a66\u7684\u65b9\u5f0f\u6709\u4e0a\u50b3\u548c\u4e0b\u8f09\u5927\u6a94\u50b3\u8f38\u7684\u6642\u5019\uff0c\u4fdd\u8b49\u50b3\u51fa\u4f86\u8d85\u5927\u8d85\u80d6\uff0c\u4e0d\u7b26\u5408\u672c\u6587\u6e1b\u78b3\u6548\u76ca\uff0c\u6240\u4ee5\u6211\u5011\u9700\u8981\u5c0d\u9019\u500b\u50b3\u8f38\u9032\u884c\u7cbe\u7149\u7626\u8eab\uff0c\u6700\u76f4\u89ba\u7684\u65b9\u5f0f\u5c31\u662f\u7528 tcpdump \u5167\u5efa\u7684\u53c3\u6578 <code>-s, --snapshot-length</code> \u9032\u884c\u63a7\u5236\uff0c\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c<code>-s0</code> \u662f\u53ef\u4ee5\u6536\u4e0b 252144 bytes\uff0c\u70ba\u4e86\u76f8\u5bb9\u65e9\u671f\u7248\u672c\u7684 tcpdump</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#2-tcp","title":"2. \u55ae\u7d14\u770b TCP \u4ea4\u63e1\u70ba\u4e3b","text":"<pre><code># ssh &lt;Target username&gt;@&lt;Target IP&gt; -p &lt;Target Port&gt; -i &lt;SSH Private Key if have&gt; sudo tcpdump -U -s74 -w - -i &lt;Target Interface&gt; | wireshark -k -i -\nssh pichuang@localhost.divecode.in -p 5566 -i ~/.ssh/wolala-rsa sudo tcpdump -U -s74 -w - -i eth0 | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\n</code></pre> <p>\u4ee5 IPv4 + TCP \u70ba\u4f8b, \u4e00\u500b Frame \u7d44\u6210\u5982\u4e0b:</p> <ul> <li>Ethernet Header = 14 bytes (112 bits)</li> <li>IP Header = 20 bytes (160 bits)</li> <li>TCP Header = \u6700\u5c0f 20 bytes (160 bits)\uff0c\u5efa\u8b70 40 bytes (320 bits)\uff0c\u56e0\u70ba TCP Header \u6700\u5c0f\u7b97\u5230 Urgent Pointer \u662f 20 bytes\uff0c\u4f46\u662f\u901a\u5e38\u90fd\u6703\u6709\u4e00\u5806 TCP Option \u7686\u5728\u5f8c\u9762\uff0c\u8b6c\u5982\u8aaa\u50cf Window Scale\u3001SACK\u3001MSS \u90fd\u6703\u653e\u5728\u9019\u908a\uff0c\u6240\u4ee5\u6700\u5927\u53ef\u80fd\u6703\u5230 40 bytes \u6216\u8d85\u904e</li> <li>TCP Payload \u53e6\u8a08</li> </ul> <p></p> <p>\u6240\u4ee5\u4ee5\u7db2\u8def\u5718\u968a\uff0c\u4e0d\u8003\u616e\u89c0\u6e2c TCP Payload\uff0c\u9577\u671f\u6536\u5c01\u5305\u5206\u6790 TCP Stream \u72c0\u6cc1\u7684\u8a71\uff0c\u5efa\u8b70\u8a2d\u5b9a\u500b 74 bytes (14 + 20 + 40) \u4ee5\u4e0a\uff0c\u624d\u4e0d\u6703\u6709 TCP Header \u88ab\u622a\u65b7\u7684\u8b70\u984c\u767c\u751f\uff0c\u4e5f\u4e0d\u6703\u6536\u4e86\u4e00\u5806 TCP Payload \u4f54\u64da\u5132\u5b58\u7a7a\u9593\u548c\u51fa\u7ad9\u6d41\u91cf\u3002\u800c\u88ab\u622a\u65b7\u7684\u5c01\u5305\u5167\u5bb9\u5728 Wireshark \u6703\u5448\u73fe <code>Packet Size Limited during capture</code> \u9019\u662f\u6b63\u5e38\u72c0\u6cc1</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#3-http-header","title":"3. \u60f3\u8981\u770b HTTP Header","text":"<pre><code># ssh &lt;Target username&gt;@&lt;Target IP&gt; -p &lt;Target Port&gt; -i &lt;SSH Private Key if have&gt; sudo tcpdump -U -s500 -w - -i &lt;Target Interface&gt; | wireshark -k -i -\nssh pichuang@localhost.divecode.in -p 5566 -i ~/.ssh/wolala-rsa sudo tcpdump -U -s500 -w - -i eth0 | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\n</code></pre> <p>\u53d6\u6750\u81f3 ByteByteGo - How does HTTPS work? (Episode 6)</p> <p>\u6211\u4e0d\u6703\u7528 http filter \u53bb\u904e\u6ffe\u518d\u6536\uff0c\u9084\u662f\u6536 tcp \u70ba\u4e3b\uff0c\u5f8c\u9762\u7528 tcp.stream \u904e\u6ffe\u3002\u9019\u539f\u56e0\u662f filter \u55ae\u7528 http \u7684\u8a71\uff0c\u6703\u770b\u4e0d\u5230 <code>http GET / HTTP1.1</code> \u4e4b\u524d\u7684 TCP Handshake \u4e2d SYN / SYNACK / ACK \u7684\u72c0\u6cc1\uff0c\u5927\u591a\u6578\u72c0\u6cc1\u90fd\u4e0d\u662f\u7a0b\u5f0f\u6c92\u5beb\u597d\uff0c\u90fd\u662f TCP \u90a3\u5c64\u88ab\u67d0\u500b\u9632\u706b\u7246\u64cb\u6389\uff0c\u4f46\u770b L7 \u6216\u53ea\u770b HTTP \u6703\u770b\u4e0d\u51fa\u4f86\uff0c\u5982\u4e0b No. 448, 449, 450 \u90a3\u4e09\u500b\u5c01\u5305</p> <p></p> <p>\u81f3\u65bc HTTP Header \u8981\u591a\u5927\uff0c\u6211\u7684\u7406\u89e3\u662f\u56e0\u670d\u52d9\u800c\u5b9a\uff0c\u6709\u4e9b\u670d\u52d9\u6216 CDN \u6703\u585e\u4e00\u5806 Header \u518d\u524d\u9762\uff0c\u53ef\u4ee5\u81ea\u884c\u8abf\u6574\u5927\u5c0f\uff0c\u6211\u9019\u908a\u5c31\u6293\u4e00\u500b 500 \u52a0\u6e1b\u770b</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#4-icmp","title":"4. \u55ae\u7d14\u770b ICMP \u70ba\u4e3b","text":"<pre><code># ssh &lt;Target username&gt;@&lt;Target IP&gt; -p &lt;Target Port&gt; -i &lt;SSH Private Key if have&gt; sudo tcpdump -U -s98 -w - -i &lt;Target Interface&gt; | wireshark -k -i -\nssh pichuang@localhost.divecode.in -p 5566 -i ~/.ssh/wolala-rsa sudo tcpdump -U -s98 -w - -i eth0 | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\n</code></pre> <p>\u4ee5 IPv4 + ICMP \u70ba\u4f8b\uff0c\u4e00\u500b Frame \u7d44\u6210\u5982\u4e0b:</p> <ul> <li>Ethernet Header = 14 bytes (112 bits)</li> <li>IP Header = 20 bytes (160 bits)</li> <li>ICMP Header = 8 bytes</li> <li>ICMP Data = \u6700\u5c0f\u9001\u51fa\u53bb 56 bytes\uff0cICMP Timestamp \u662f\u653e\u5728 ICMP Data \u88e1\u9762\u7684\u524d 8 bytes\uff0c\u4f46 Wireshark \u88e1\u9762\u7684 Data \u6703\u986f\u793a 48 bytes\uff0c\u4f46\u56de\u4f86\u7684\u8cc7\u8a0a\u4e0d\u4e00\u5b9a\u662f 56 Bytes \u800c\u5df2\uff0c\u6709\u53ef\u80fd\u6703\u6536\u5230\u602a\u602a\u7684\u5c01\u5305 (Malformed Packet) \u6703\u585e\u8d85\u904e\u9019\u500b\u6578\u5b57\u4ee5\u4e0a</li> </ul> <p></p> <p>\u9452\u65bc\u4ee5\u4e0a\u5947\u602a\u7684\u72c0\u6cc1\u7e3d\u548c\uff0c\u82e5\u8981\u6536\u5230\u7cbe\u7c21\u7684 ICMP \u5c01\u5305\u7684\u8a71\uff0c\u61c9\u8a72\u662f\u8981\u8a2d\u5b9a 98 bytes (14 + 20 + 8 + 56) \u4ee5\u4e0a\u597d\u4e00\u9ede</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#_4","title":"\u7d50\u8ad6","text":"<ol> <li>ssh \u771f\u7684\u5f88\u842c\u7528</li> <li>\u6536\u5c01\u5305\u9650\u5236\u500b Frame Size 500\uff0c\u53ef\u4ee5\u7bc0\u7701 70% \u7684\u6d88\u8017\uff0c\u9084\u6709\u4e0d\u4e9e\u65bc\u5168\u6536 (1512) \u7684\u89c0\u6e2c\u6548\u679c</li> <li>\u7bc0\u80fd\u6e1b\u78b3\uff0c\u5148\u5f9e\u53c3\u52a0 CNCF Sustainability Week - Taiwan x Green Software Foundation \u958b\u59cb</li> </ol>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#qa","title":"Q&amp;A","text":"","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#q1-azure-windows-vmrdp","title":"Q1: \u70ba\u4f55\u4e0d\u8981\u5728 Azure \u88e1\u9762\u958b Windows VM\uff0cRDP \u9032\u53bb\u5c31\u597d?","text":"<p>\u56e0\u70ba Windows Server \u6211\u4e0d\u7b97\u719f\u6089\uff0clinux \u6bd4\u8f03\u9999</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#q2-sustainability-engineering-cloud-native-sustainability","title":"Q2: \u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b (Sustainability Engineering) \u9084\u662f\u96f2\u539f\u751f\u6c38\u7e8c\u6027 (Cloud Native Sustainability) \u9019\u8ddf\u6211\u5565\u95dc\u4fc2?","text":"<p>\u76ee\u524d\u4f86\u770b\uff0c\u53cd\u8209\u727d\u626f\u5230\u6c38\u7e8c\u6027 (Sustainability) \u7684\u8b70\u984c\uff0c\u6700\u5927\u76ee\u6a19\u5c31\u662f\u8981\u76e1\u53ef\u80fd\u6e1b\u5c11\u78b3\u8db3\u8de1\uff0c\u5c31\u7b97\u6703\u9020\u6210\u6548\u80fd\u8b8a\u6162\u3001\u6216\u8005\u662f\u5ef6\u9072\u589e\u52a0\uff0c\u90fd\u662f\u53ef\u4ee5\u88ab\u63a5\u53d7\u7684\u3002\u4ee5\u7db2\u8def\u4f86\u770b\uff0c\u5c31\u662f\u76e1\u91cf\u6e1b\u5c11\u4e0d\u5fc5\u8981\u7684\u7db2\u8def\u50b3\u8f38\u6216\u8ca0\u8f09\uff0c\u5b83\u7684\u9644\u5e36\u6548\u76ca\u76ee\u524d\u770b\u8d77\u4f86\u5c31\u662f\u964d\u4f4e\u6210\u672c\u3001\u512a\u5316\u65e2\u6709\u6280\u8853</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#q3-sustainability","title":"Q3: Sustainability \u7b49\u65bc\u6210\u672c\u964d\u4f4e?","text":"<p>\u56b4\u683c\u4f86\u8aaa\uff0c\u4e0d\u662f\u5c0d\u7b49\u7684\uff0c\u70ba\u4e86\u8981\u53bb\u505a Sustainability \u53ef\u80fd\u8981\u5728\u5225\u7684\u5730\u65b9\u6295\u8cc7\u4e0d\u5c11\uff0c\u96d6\u7136\u4e3b\u8981\u770b\u8d77\u4f86\u90fd\u662f\u8ddf\u7da0\u96fb\u76f8\u95dc\u3002\u8b6c\u5982\u8aaa\uff0c\u539f\u5148\u670d\u52d9\u653e\u5728\u8001\u9060\u7684\u5340\u57df\uff0c\u4f46\u70ba\u4e86<code>\u6975\u7aef\u5316</code>\u9054\u5230\u6c38\u7e8c\u6027\u5de5\u7a0b\uff0c\u964d\u4f4e\u4e0d\u5fc5\u8981\u7684\u7db2\u8def\u50b3\u8f38\uff0c\u9078\u64c7\u628a CDN \u670d\u52d9\u5168\u90e8\u958b\u8d77\u4f86\uff0c\u9019\u6210\u672c\u5c31\u6703\u82b1\u5728\u5225\u7684\u5730\u65b9\u4e86\u3002\u4f46\u76ee\u524d\u78b3\u95dc\u7a05\u6709\u516c\u958b\u724c\u50f9\u53ef\u4ee5\u63a8\u7b97\uff0c\u8aaa\u4e0d\u5b9a\u7b97\u4e00\u7b97\u771f\u7684\u6709\u500b\u9ec3\u91d1\u4ea4\u53c9\uff0c\u53ea\u662f\u6211\u73fe\u5728\u6c92\u7cbe\u7b97\u7684\u5f88\u6e05\u6670</p>","tags":["wireshark","sustainability"]},{"location":"20231012-sustainability-remote-capture-packets.html#references","title":"References","text":"<ul> <li>Is there a practical HTTP Header length limit?</li> <li>Azure Kubernetes Service (AKS) \u4e2d\u7684\u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b\u505a\u6cd5</li> <li>Green Software Practitioner</li> </ul>","tags":["wireshark","sustainability"]},{"location":"20231013-remote-capture-packets-from-aks.html","title":"\u4eba\u5bb6\u90fd\u5728\u6293\u795e\u5947\u5bf6\u8c9d\uff0c\u800c\u6211\u5728\u6293 Kubernetes \u5c01\u5305","text":"<p>Wireshark: Packet Don't Lie.</p> <p></p> <p>\u6587\u7ae0 \u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b: \u9060\u7aef\u6293\u5c01\u5305\u5be6\u9304 \u63d0\u5230\u5982\u4f55\u9060\u7aef\u6293\u55ae\u9ad4 VM \u5c01\u5305\uff0c\u90a3\u540c\u6a23\u7684\u62db\u6578\u53ef\u4e0d\u53ef\u4ee5\u53bb\u6293 Azure Kubernetes Service \u7279\u5b9a Pod \u88e1\u9762\u7684\u5c01\u5305? \u7b54\u6848\u662f\u53ef\u4ee5\uff0c\u642d\u914d ksniff \u4f86\u505a\u5c31\u597d</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#kubernetes_1","title":"\u4f86\u6293 Kubernetes \u5c01\u5305","text":"","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#_1","title":"\u67b6\u69cb\u5716","text":"<ol> <li>\u56e0\u70ba\u6211\u4e0d\u80fd\u76f4\u63a5\u5f9e\u5bb6\u88e1\u9023\u7dda\u5230 Azure Kuberentes Service\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u9700\u8981\u900f\u904e Bastion VM \u9032\u884c\u64cd\u4f5c\u9023\u7dda\uff0c\u6240\u4ee5\u9700\u8981\u5148\u7528 SSH \u9023\u7dda\u5230 Bastion VM \u624d\u80fd\u505a\u4e8b</li> <li>kubectl \u4e00\u5b9a\u8981\u80fd\u5c0d Private AKS \u64cd\u4f5c\uff0c\u4e0d\u7136 ksniff \u6216\u7a0b\u5f0f\u4f60\u90fd\u7121\u6cd5\u90e8\u7f72\u4e0b\u53bb</li> <li>\u6574\u5f35\u5716\u6211\u6c92\u63d0\u7684\u90e8\u5206\u5c31\u662f Private AKS \u548c VM \u7684 UDR \u8a2d\u5b9a\uff0c\u4f46\u9019\u500b\u592a Azure Networking \u5148\u8df3\u904e</li> <li>\u4e00\u5982\u65e2\u5f80\uff0c\u6211\u662f\u5f37\u70c8\u5efa\u8b70\u4eba\u4eba\u90fd\u8981\u6709\u4e00\u500b debug container \u597d\u53bb\u505a\u4e00\u4e9b\u89c0\u843d\u9670\u7684\u4e8b\u60c5\uff0c\u8a73\u898b \u7576\u9047\u5230 Distroless Container \u9664\u932f\u8981\u4ec0\u9ebc\u6c92\u4ec0\u9ebc\u8a72\u600e\u9ebc\u8fa6? \u4f60\u7684\u597d\u670b\u53cb kubectl debug\uff0c\u9019\u908a\u4e0d\u8d05\u8ff0</li> </ol>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#0-ksniff","title":"0. \u5b89\u88dd ksniff","text":"<p>\u8acb\u76f4\u63a5\u53c3\u8003 eldadru/ksniff \u6587\u4ef6\uff0c\u53e6\u5916\u5b83\u7684\u524d\u7f6e\u4f5c\u696d\u662f\u8981\u88dd krew\uff0c\u52d9\u5fc5\u8981\u628a krew PATH \u8a2d\u5b9a\u597d</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#1-httpbin-re","title":"1. \u90e8\u7f72 httpbin-re \u670d\u52d9","text":"<pre><code># \u78ba\u5b9a kubectl \u904b\u4f5c\u6b63\u5e38\u4e14\u53ef\u4ee5\u9023\u7dda\u5230 Private AKS\n$ kubectl cluster-info\nKubernetes control plane is running at https://dns-aoai.private.eastus2.azmk8s.io:443\nCoreDNS is running at https://dns-aoai.private.eastus2.azmk8s.io:443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\nMetrics-server is running at https://dns-aoai.private.eastus2.azmk8s.io:443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy\n\n# \u8dd1\u4e00\u500b http server \u670d\u52d9\u8d77\u4f86\n$ kubectl apply -f https://raw.githubusercontent.com/pichuang/httpbin-re/master/k8s/httpbin-re.yaml\ndeployment.apps/httpbin-re created\nservice/httpbin-re created\n\n# \u78ba\u8a8d\u670d\u52d9\u6709\u63ed\u9732\u51fa\u4f86\n$ kubectl get svc httpbin-rek\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\nhttpbin-re   ClusterIP   10.0.133.240   &lt;none&gt;        8080/TCP   7h26m\n</code></pre> <p>\u4e3b\u8981\u662f\u8981\u90e8\u7f72\u4e00\u500b HTTP Server\uff0c\u5f85\u6703\u8981\u900f\u904e Ksniff \u53bb\u89c0\u5bdf\u9019\u500b\u670d\u52d9\u7684\u72c0\u6cc1\uff0c\u5982\u679c\u4f60\u6709\u5176\u4ed6\u670d\u52d9\u4e5f\u53ef\u4ee5\u81ea\u884c\u66ff\u63db\uff0c\u9019\u908a\u5c31\u662f Demo \u65b9\u4fbf</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#2-pod","title":"2. \u90e8\u7f72\u966a\u6e2c\u7528 Pod","text":"<pre><code># \u90e8\u7f72\u966a\u6e2c\u7528 Pod\uff0c\u7528\u9806\u624b\u7684\u5c31\u597d\uff0c\u6216\u8005\u662f\u4f60\u53ef\u4ee5\u8003\u616e\u7528 nicolaka/netshoot\n$ kubectl apply -f https://raw.githubusercontent.com/pichuang/debug-container/master/debug-container.yaml\npod/debug-container created\n\n# \u6e2c\u8a66\u53ef\u4ee5\u8ddf httpbin-re \u9023\u7dda\uff0c\u540c namespace\uff0c\u4e0d\u540c Pod\n# kubectl exec --it &lt;debug pod&gt; -- curl http://&lt;svc name&gt;/path\n$ kubectl exec --it debug-container -- curl http://httpbin-re:8080 | head -n 5\n$ kubectl exec --it debug-container -- curl http://httpbin-re.default:8080 | head -n 5\n$ kubectl exec --it debug-container -- curl http://httpbin-re.default.svc:8080 | head -n 5\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n...omit...\n\n# \u6e2c\u8a66\u53ef\u4ee5\u8ddf metrics-server \u9023\u7dda\uff0c\u4e0d\u540c namespace\uff0c\u4e0d\u540c Pod\n# kubectl exec --it &lt;debug pod&gt; -- curl --insecure https://&lt;svc name&gt;.&lt;namespace&gt;:&lt;svc port&gt;/path\n$ kubectl exec --it debug-container -- curl --insecure https://metrics-server.kube-system:443/metrics | head -n 5\n$ kubectl exec --it debug-container -- curl --insecure https://metrics-server.kube-system.svc:443/metrics | head -n 5\n{\n  \"kind\": \"Status\",\n  \"apiVersion\": \"v1\",\n  \"metadata\": {},\n  \"status\": \"Failure\",\n  \"message\": \"forbidden: User \\\"system:anonymous\\\" cannot get path \\\"/metrics\\\"\",\n  \"reason\": \"Forbidden\",\n  \"details\": {},\n  \"code\": 403\n}%\n</code></pre> <p>\u95dc\u65bc\u9019\u500b\u4ee5 Pod \u70ba\u51fa\u767c\u9ede\uff0c\u670d\u52d9\u4e4b\u9593\u7684\u9023\u7dda\u8b70\u984c\uff0c\u4ee5\u524d\u6709\u5beb\u904e\u70ba\u4ec0\u9ebc\u6211\u4f48\u7f72\u7684 Kubernetes \u670d\u52d9\u4e0d\u6703\u52d5!? \u500b\u4eba\u9664\u932f\u601d\u8def\u5206\u4eab \u4e00\u6587\uff0c\u88e1\u9762\u6709\u6bd4\u8f03\u4ed4\u7d30\u7684\u8aaa\u660e\uff0c\u9019\u908a\u5c31\u4e0d\u8d05\u8ff0\u4e86</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#3-httpbin-re-pod","title":"3. \u9060\u7aef\u6293 httpbin-re Pod \u7684\u5c01\u5305","text":"<pre><code># \u5217\u8209\u51fa httpbin-re Pod \u7684\u540d\u7a31\n$ kubectl get pod -n default -owide\nNAME                          READY   STATUS    RESTARTS   AGE     IP            NODE                                NOMINATED NODE   READINESS GATES\ndebug-container               1/1     Running   0          15m     `10.0.129.18`   aks-agentpool-14864487-vmss000000   &lt;none&gt;           &lt;none&gt;\nhttpbin-re-866499b564-blc95   1/1     Running   0          7h38m   10.0.129.6    aks-agentpool-14864487-vmss000000   &lt;none&gt;           &lt;none&gt;\nhttpbin-re-866499b564-xl726   1/1     Running   0          7h38m   `10.0.129.9`    aks-agentpool-14864487-vmss000000   &lt;none&gt;           &lt;none&gt;\nksniff-grlzn                  1/1     Running   0          82s     10.0.129.33   aks-agentpool-14864487-vmss000000   &lt;none&gt;           &lt;none&gt;\nksniff-n9ps6                  1/1     Running   0          36m     10.0.129.29   aks-agentpool-14864487-vmss000000   &lt;none&gt;           &lt;none&gt;\n</code></pre> <pre><code># \u900f\u904e ksniff \u4f86\u6293\u5c01\u5305\n# ssh &lt;Target username&gt;@&lt;Target IP&gt; -p &lt;Target Port&gt; -i &lt;SSH Private Key if have&gt; \"/bin/bash --login -c 'kubectl sniff -n &lt;namespace&gt; &lt;pod name&gt; -p -o -'\" | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\nssh pichuang@localhost.divecode.in -p 5566 -i ~/.ssh/wolala-rsa \"/bin/bash --login -c 'kubectl sniff -n default httpbin-re-866499b564-xl726 -p -o -'\" | /mnt/c/Program\\ Files/Wireshark/Wireshark.exe -k -i -\n</code></pre> <p>\u9019\u908a\u8981\u6ce8\u610f\u7684\u662f <code>/bin/bash --login -c</code>\uff0c\u56e0\u70ba SSH \u767b\u5165\u7684\u6642\u5019\u5403\u7684 $PATH \u9810\u8a2d\u662f\u4e0d\u6703\u53bb\u5403 ~/.bashrc\uff0c\u53ef\u4ee5\u7528 <code>env</code> \u9a57\u8b49\u770b\u770b\uff0c\u6240\u4ee5\u9700\u8981\u5148\u7528 <code>--login</code> \u5f8c\u624d\u80fd\u6b63\u78ba\u54ac\u5230 $PATH \u88e1\u9762\u7684 krew \u8def\u5f91\uff0c\u5176\u9918\u5c31\u662f pipeline \u548c I/O \u7684\u4e32\u6d41\u8655\u7406\u4e86</p> <p></p> <p>\u6b64\u5916\uff0c\u539f\u5148\u61c9\u8a72\u8981\u586b Ethernet Header (12 bytes) \u7684\u6b04\u4f4d\uff0c\u6703\u8b8a\u6210 <code>Linux cooked capture v2 (SLL_v2)</code>\uff0c\u6309\u7167 Linux cooked-mode capture (SLL) \u7684\u8aaa\u660e\uff0c\u9019\u662f\u4e00\u500b\u507d\u9020\u5354\u8b70\uff0c\u5c0d\u5206\u6790 Kubernetes \u4e0a\u7684\u670d\u52d9\u6bd4\u8f03\u6c92\u4ec0\u9ebc\u5f71\u97ff\uff0c\u56e0\u70ba\u4e3b\u8981\u90fd\u662f\u770b L3 / L4 \u5c64\u7d1a\u5c45\u591a\uff0c\u5305\u542b Pod IP / Pod Port / Service IP / Service Port / Node Port \u7b49\uff0c\u540c\u5834\u52a0\u6620\u4e00\u4e0b\uff0c HWCHIU \u5b78\u7fd2\u7b46\u8a18 - Kubernetes \u4e4b\u5c01\u5305\u53bb\u54ea\u5152</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#4-ksniff-pod","title":"4. \u6e05\u9664 ksniff Pod","text":"<pre><code>$ kubectl get pod -l app=ksniff -A\nNAME           READY   STATUS    RESTARTS   AGE\nksniff-g4bjz   1/1     Running   0          11m\nksniff-j7gnc   1/1     Running   0          16m\nksniff-kxfl5   1/1     Running   0          9m54s\nksniff-lb4xg   1/1     Running   0          6m29s\nksniff-n9ps6   1/1     Running   0          68m\nksniff-sph6l   1/1     Running   0          9m17s\nksniff-v2vd5   1/1     Running   0          14m\nksniff-vl627   1/1     Running   0          16m\n\n$ kubectl delete pod -l app=ksniff -A\npod \"ksniff-g4bjz\" deleted\npod \"ksniff-j7gnc\" deleted\npod \"ksniff-kxfl5\" deleted\npod \"ksniff-lb4xg\" deleted\npod \"ksniff-n9ps6\" deleted\npod \"ksniff-sph6l\" deleted\npod \"ksniff-v2vd5\" deleted\npod \"ksniff-vl627\" deleted\n</code></pre> <p>\u9000\u51fa\u7684\u6642\u5019\u770b\u8d77\u4f86\u662f\u4e0d\u6703\u9806\u4fbf\u628a ksniff \u7684 Pod \u79fb\u9664\u6389\uff0c\u8a18\u5f97\u8981\u624b\u52d5\u79fb\u9664\uff0c\u4e0d\u7136\u6703\u6709\u8cc7\u6e90\u6d6a\u8cbb\u7684\u554f\u984c</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#_2","title":"\u5f8c\u8a71","text":"<p>ksniff \u6c92\u6709\u53c3\u6578\u53ef\u4ee5\u8b93\u6211\u53bb\u6390\u5c01\u5305\u5927\u5c0f\uff0c\u6c92\u610f\u5916\u7684\u8a71\uff0c\u9084\u9700\u8981\u518d\u8df3\u677f\u6a5f\u591a\u4e00\u6bb5 tcpdump pipeline \u8655\u7406\uff0c\u4f46\u9019\u6a23\u5c31\u6703\u6536\u5230\u4e00\u5806\u6709\u7684\u6c92\u7684\u5c01\u5305\uff0c\u9084\u6c92\u60f3\u5230\u600e\u9ebc\u7528</p>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#qa","title":"Q&amp;A","text":"","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#q1-red-hat-openshift-container-platform-azure-red-hat-openshift","title":"Q1: \u5982\u679c\u6211\u662f Red Hat OpenShift Container Platform \u6216 Azure Red Hat OpenShift \u7684\u4f7f\u7528\u8005\uff0c\u4f46\u6b0a\u9650\u9396\u8d85\u56b4\u7684\u600e\u9ebc\u8fa6?","text":"<p>\u9019\u500b\u53ea\u80fd\u8aaa Red Hat \u4e00\u5982\u65e2\u5f80\u5730\u5df2\u7d93\u5148\u5e6b\u59b3\u6574\u597d\u5230 oc \u53bb\u4e86\uff0c\u4f60\u4e0d\u7528\u7279\u5225\u88dd ksniff\uff0c\u6b0a\u9650\u5c31\u662f\u7167\u4f60\u62ff\u5230\u7684 kubeconfig \u70ba\u4e3b</p> <pre><code>$ oc version\nClient Version: 4.12.36\nKustomize Version: v4.5.7\nKubernetes Version: v1.27.3\n\n$ oc sniff\nUsage:\n  sniff pod [-n namespace] [-c container] [-f filter] [-o output-file] [-l local-tcpdump-path] [-r remote-tcpdump-path] [flags]\n\nExamples:\nkubectl sniff hello-minikube-7c77b68cff-qbvsd -c hello-minikube\n\nFlags:\n  -c, --container string                container (optional)\n  -x, --context string                  kubectl context to work on (optional)\n  -f, --filter string                   tcpdump filter (optional)\n  -h, --help                            help for sniff\n      --image string                    the privileged container image (optional)\n  -i, --interface string                pod interface to packet capture (optional) (default \"any\")\n  -l, --local-tcpdump-path string       local static tcpdump binary path (optional)\n  -n, --namespace string                namespace (optional)\n  -o, --output-file string              output file path, tcpdump output will be redirect to this file instead of wireshark (optional) ('-' stdout)\n      --pod-creation-timeout duration   the length of time to wait for privileged pod to be created (e.g. 20s, 2m, 1h). A value of zero means the creation never times out. (default 1m0s)\n  -p, --privileged                      if specified, ksniff will deploy another pod that have privileges to attach target pod network namespace\n  -r, --remote-tcpdump-path string      remote static tcpdump binary path (optional) (default \"/tmp/static-tcpdump\")\n      --socket string                   the container runtime socket path (optional)\n      --tcpdump-image string            the tcpdump container image (optional)\n  -v, --verbose                         if specified, ksniff output will include debug information (optional)\n</code></pre>","tags":["wireshark","kubernetes"]},{"location":"20231013-remote-capture-packets-from-aks.html#references","title":"References","text":"<ul> <li>\u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b: \u9060\u7aef\u6293\u5c01\u5305\u5be6\u9304</li> <li>eldadru/ksniff</li> <li>krew</li> <li>\u70ba\u4ec0\u9ebc\u6211\u4f48\u7f72\u7684 Kubernetes \u670d\u52d9\u4e0d\u6703\u52d5!? \u500b\u4eba\u9664\u932f\u601d\u8def\u5206\u4eab</li> <li>Kubernetes \u4e4b\u5c01\u5305\u53bb\u54ea\u5152</li> <li>\u7576\u9047\u5230 Distroless Container \u9664\u932f\u8981\u4ec0\u9ebc\u6c92\u4ec0\u9ebc\u8a72\u600e\u9ebc\u8fa6? \u4f60\u7684\u597d\u670b\u53cb kubectl debug</li> </ul>","tags":["wireshark","kubernetes"]},{"location":"20231027-aks-node-c1000k.html","title":"\u63ea\u7adf...Azure Kubernetes Services \u7684\u7bc0\u9ede\u80fd\u4e0d\u80fd\u63d0\u4f9b C1000K \u7684\u80fd\u529b\u5462?","text":"<p>Kubernetes is Cloud OS, Containers are Linux</p> <p></p> <p>\u65e2\u524d\u7bc7\u6587\u7ae0 \u6c38\u7e8c\u6027\u8edf\u9ad4\u5de5\u7a0b: \u9060\u7aef\u6293\u5c01\u5305\u5be6\u9304 \u6709\u63d0\u5230\u964d\u4f4e\u4e0d\u5fc5\u8981\u7db2\u8def\u50b3\u8f38\u6210\u672c\u53ef\u6709\u6548\u6e1b\u5c11\u78b3\u6392\u653e\uff0c\u90a3\u6211\u7e7c\u7e8c\u57fa\u65bc Green Foundation \u6240\u63d0\u51fa\u7684\u7da0\u8272\u8edf\u9ad4\u5be6\u8e10\u8005 (Green Software Practitioner) \u7576\u4e2d\u7684\u539f\u5247\u63d0\u5347\u8a2d\u5099\u5229\u7528\u7387 (Increasing device utilization) \u4f86\u7e7c\u7e8c\u5ef6\u4f38\u9019\u500b\u5927\u8b70\u984c</p> <p>\u76e1\u529b\u5730\u63d0\u5347\u55ae\u53f0\u7bc0\u9ede\u6240\u80fd\u670d\u52d9\u7684\u91cf\u9ad4\uff0c\u6e1b\u5c11\u8cc7\u6e90\u6d6a\u8cbb\uff0c\u5f9e\u9019\u500b\u89d2\u5ea6\u770b\uff0c\u5176\u5be6\u5c31\u662f\u9700\u8981\u4f86\u63a2\u8a0e Azure Kuberenetes Service \u9810\u8a2d\u63d0\u4f9b\u7684\u9019\u4e9b\u7bc0\u9ede\uff0c\u672c\u9ad4\u5230\u5e95\u5920\u4e0d\u5920\u63d0\u4f9b\u6211\u5011\u5728\u5927\u6d41\u91cf\u548c\u9ad8\u6027\u80fd\u8a08\u7b97\u4e0a\u6240\u9700\u7684\u8cc7\u6e90\u548c\u8abf\u6559\uff0c\u9019\u908a\u5c31\u5f9e\u7d93\u5178\u7684\u767e\u842c\u4e26\u884c\u9023\u7dda C1000K (Concurrent 1000K Connections) \u4f86\u505a\u70ba\u57fa\u6e96\u4f86\u63a2\u8a0e</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#cncf-sustainability-week-taiwan-x-green-software-foundation","title":"[\u6d3b\u52d5\u5ba3\u50b3] CNCF Sustainability Week - Taiwan x Green Software Foundation","text":"<p>\u6700\u8fd1\u7684\u6211\u89ba\u5f97\u9019\u500b\u984c\u76ee\u6bd4\u8f03\u5728\u8003\u9a57 Linux \u9ad8\u6027\u80fd\u8abf\u6559\uff0c\u6b61\u8fce\u5927\u5bb6\u5831\u540d 2023/10/24 18:30-21:30 \u4f86\u5403\u5403\u559d\u559d\u63a2\u8a0e</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#azure-kubernetes-service","title":"\u767b\u5165 Azure Kubernetes Service \u7576\u4e2d\u7684\u4e00\u500b\u7bc0\u9ede","text":"<p>\u9019\u908a\u4f7f\u7528 v1.25 \u5f8c\uff0c\u958b\u59cb\u53ef\u4f7f\u7528\u7684 <code>kubectl debug</code> \u4f5c\u70ba\u4f7f\u7528\u57fa\u790e\uff0c\u4e4b\u524d\u6709\u4e9b\u904e\u4e00\u7bc7 \u7576\u9047\u5230 Distroless Container \u9664\u932f\u8981\u4ec0\u9ebc\u6c92\u4ec0\u9ebc\u8a72\u600e\u9ebc\u8fa6? \u4f60\u7684\u597d\u670b\u53cb kubectl debug \u6709\u5c08\u6587\u89e3\u91cb\u9019\u500b\u6307\u4ee4\u7684\u6548\u679c\uff0c\u4f46\u4eca\u5929\u6bd4\u8f03\u7279\u5225\u662f\uff0c\u5c0d\u8c61\u662f Node \u800c\u975e Pod</p> <pre><code>$ kubectl version\nClient Version: v1.28.1\nKustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3\nServer Version: v1.27.3\n\n# \u7372\u5f97 node \u540d\u7a31\n$ kubectl get nodes\nNAME                                STATUS   ROLES   AGE     VERSION\naks-agentpool-14864487-vmss000000   Ready    agent   6d14h   v1.27.3\n\n# kubectl debug node/&lt;node name&gt; -it --image-pull-policy=Always --quiet --image=&lt;image name&gt; -- &lt;command&gt;\n$ kubectl debug node/aks-agentpool-14864487-vmss000000 -it --image-pull-policy=Always --quiet --image=ghcr.io/pichuang/debug-container:master -- /bin/bash\n\n# \u52d9\u5fc5\u8981\u8a18\u5f97\u4f7f\u7528 chroot /host \u5207\u5230\u6b63\u78ba\u7684\u74b0\u5883\u53bb\n[root@aks-agentpool-14864487-vmss000000 /]# chroot /host /bin/bash\n\n# \u78ba\u4fdd\u4f60\u53ef\u4ee5\u770b\u5230\u4f5c\u696d\u7cfb\u7d71\u8cc7\u8a0a\nroot [ / ]# cat /etc/os-release\nNAME=\"Common Base Linux Mariner\"\nVERSION=\"2.0.20230924\"\nID=mariner\nVERSION_ID=\"2.0\"\nPRETTY_NAME=\"CBL-Mariner/Linux\"\nANSI_COLOR=\"1;34\"\nHOME_URL=\"https://aka.ms/cbl-mariner\"\nBUG_REPORT_URL=\"https://aka.ms/cbl-mariner\"\nSUPPORT_URL=\"https://aka.ms/cbl-mariner\"\n</code></pre> <p></p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#aks-node-cbl-mariner","title":"\u89e3\u5256 AKS Node \u88e1\u7684 CBL-Mariner \u4f5c\u696d\u7cfb\u7d71","text":"<p>\u5148\u8072\u660e\uff0c\u4e0b\u9762\u7684\u773e\u591a\u64cd\u4f5c\u90fd\u53ef\u4ee5\u9069\u7528\u65bc\u4efb\u4f55\u4e00\u5bb6\u7684 Kubernetes \u767c\u884c\u7248\u548c\u4ee5 Linux \u70ba\u57fa\u790e\u7684\u7bc0\u9ede\uff0c\u4f46\u7576\u4e2d\u7684\u8a2d\u5b9a\u6703\u96a8\u8457\u4e0b\u5217 3 \u500b\u72c0\u6cc1\u6709\u6240\u5dee\u7570\uff0c\u4f46\u57fa\u672c\u4e0a\u5927\u540c\u5c0f\u7570</p> <ol> <li>\u5ee0\u5546\u4e0d\u540c\uff0c\u5982 Azure \u548c Red Hat</li> <li>OS \u9078\u64c7\u4e0d\u540c\uff0c\u5982 Mariner 2.0\u3001Red Hat CoreOS\u3001Ubuntu 20.04</li> <li>Kernel \u7248\u672c\u4e0d\u540c\uff0c\u5982 5.15.131\u30015.x.x\u30013.11.x</li> </ol>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#aks-environment","title":"AKS Environment","text":"<ul> <li>Azure Kubernetes Service 1.27.3</li> <li>VM Instance: Standard D4as v5 (4 vcpus, 16 GiB memory)</li> <li>OS: CBL-Mariner 2.0\uff0c\u9019\u500b\u662f Azure \u89aa\u5927\u738b\u5b50\uff0c\u6700\u8fd1\u9084\u6709\u4e00\u500b Azure Linux \u89aa\u5c0f\u738b\u5b50\u51fa\u4f86\uff0c\u4f46\u9084\u6c92\u6b63\u5f0f\u7528\u904e</li> <li>CNI: Azure CNI</li> <li>(Azure \u9650\u5b9a) \u6709\u4f7f\u7528 UDR \u5f37\u5236\u63a7\u5236 Egress \u65b9\u5411</li> </ul>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#1-cpu","title":"1. CPU \u76f8\u95dc","text":"","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#a-hardware","title":"a. Hardware","text":"<pre><code>#\n# CPU\n#\n\n# \u67e5\u8a62 CPU \u578b\u865f\n# Standard D4as v5 (4 vcpus, 16 GiB memory)\n# https://azureprice.net/vm/Standard_D4as_v5\nroot [ / ]# cat /proc/cpuinfo | grep \"model name\" | cut -f2 -d: | uniq\nAMD EPYC 7763 64-Core Processor\n\n# \u67e5\u8a62\u7269\u7406 CPU \u500b\u6578\nroot [ / ]# cat /proc/cpuinfo | grep \"physical id\" | sort | uniq | wc -l\n1\n\n# \u67e5\u8a62\u6bcf\u500b\u7269\u7406 CPU \u7684 Core \u6578\n# \u82e5\u65bc Azure Portal \u8a2d\u5b9a `platformsettings.host_environment.disablehyperthreading: true` \u7684\u8a71\uff0c\u5247\u4e0d\u6703\u958b\u555f HT \u7684\u80fd\u529b\nroot [ / ]# cat /proc/cpuinfo | grep \"cpu cores\" | uniq\n2\n\n# \u67e5\u8a62\u6bcf\u500b\u908f\u8f2f vCPUs \u7684\u500b\u6578\n# \u908f\u8f2f vCPUs \u500b\u6578 = \u7269\u7406 CPU \u500b\u6578 * \u6bcf\u500b\u7269\u7406 CPU \u7684 Core \u500b\u6578 * 2 (\u9810\u8a2d Azure VM \u6703\u958b\u555f HT\uff0c\u610f\u65e8\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0cplatformsettings.host_environment.disablehyperthreading: false)\n# https://learn.microsoft.com/en-us/azure/virtual-machines/mitigate-se#linux\n# \u6839\u64da\u52a0\u7e3d processor \u6578\u91cf\uff0c\u6545\u77e5\u9053\u8a72 VM \u70ba 4 vcpus\nroot [ / ]# cat /proc/cpuinfo | grep \"processor\" | wc -l\n4\n\n# https://www.amd.com/en/products/cpu/amd-epyc-7763\n# Base Clock 2.45GHz, Max. Boost Clock Up to 3.5GHz\nroot [ / ]# cat /proc/cpuinfo | grep \"cpu MHz\" | uniq\ncpu MHz         : 2946.906\ncpu MHz         : 2445.427\ncpu MHz         : 2445.427\ncpu MHz         : 2445.427\n</code></pre> <p>\u4e3b\u8981\u9019\u908a\u662f\u8981\u8b1b\u6709\u958b HT \u548c\u6c92\u958b HT \u7684\u72c0\u6cc1\u4e0b\uff0cvCPU \u5448\u73fe\u6703\u4e0d\u540c\uff0c\u800c Azure VM \u9810\u8a2d\u72c0\u6cc1\u4e0b\u90fd\u662f\u6703\u628a HT \u958b\u8d77\u4f86\u7684\u3002\u5018\u82e5\u8981\u8dd1 HPC \u6216\u5176\u4ed6\u4f60\u5c31\u662f\u8981\u628a\u9019\u53f0\u6a5f\u5668\u6548\u80fd\u69a8\u5230\u6975\u9650\uff0c\u5247\u8981\u628a HT \u95dc\u6389\uff0c\u53ef\u4f7f\u7528 <code>platformsettings.host_environment.disablehyperthreading=true</code></p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#b-numa-non-uniform-memeory-acces","title":"b. NUMA (Non-uniform memeory acces)","text":"<pre><code># numa\nroot [ / ]# yum install numactl -y # \u9810\u8a2d\u6c92\u6709\uff0c\u9700\u8981\u88dd\n\n# \u5982\u4e0b\u986f\u793a\uff0c\u53ea\u6709\u4e00\u500b NUMA Node\uff0c\u88e1\u9762\u6709 4 \u500b vcpus \u4e14\u88ab\u5206\u914d\u5230 15734 MB \u7684 Memory\nroot [ ~ ]# numactl -H\navailable: 1 nodes (0)\nnode 0 cpus: 0 1 2 3\nnode 0 size: 15734 MB\nnode 0 free: 7277 MB\nnode distances:\nnode   0\n  0:  10\n\nroot [ ~ ]# numactl --show\npolicy: default\npreferred node: current\nphyscpubind: 0 1 2 3\ncpubind: 0\nnodebind: 0\nmembind: 0\n</code></pre> <p>\u9806\u4fbf\u4e00\u63d0\uff0c\u96d6\u7136\u8ddf\u7bc0\u9ede\u672c\u8eab\u6c92\u5565\u95dc\u4fc2\uff0c\u91dd\u5c0d Kubernetes Pod \u5c0d\u65bc CPU \u7684\u512a\u5316\uff0c\u9664\u4e86\u82b1\u9322\u7838\u8cb7\u66f4\u597d\u7684 CPU \u4ee5\u5916\uff0c\u6bd4\u8f03\u6709\u7b56\u7565\u6216\u5f88 Kubernetes \u7684\u65b9\u5f0f\u662f\uff0c\u63a1\u7528 Topology Manager \u5617\u8a66\u8abf\u6574\u51fa\u6700\u4f73\u5316 NUMA\uff0cControl Topology Management Policies on a node\u3002\u73fe\u884c\u5171\u6709 4 \u500b\u7b56\u7565\u53ef\u7528: none, best-effort, restricted, single-numa-node\uff0cAKS \u9810\u8a2d\u662f\u63a1\u7528 <code>none</code>\uff0c\u8a72\u529f\u80fd\u5e38\u898b\u65bc 5G / CNF \u7b49\u5c0d\u65bc Pod \u4e4b\u65bc NUMA \u7684\u4f7f\u7528\u6548\u7387\u6709\u7279\u5225\u8981\u6c42\u7684\u5834\u666f\uff0c\u5982 UPF \u670d\u52d9\u6703\u51fa\u73fe\uff0c\u53ef\u53c3\u8003 20221028 \u6dfa\u8ac7 Azure Private 5G Core \u548c Kubernetes</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#2-memory","title":"2. Memory \u76f8\u95dc","text":"<pre><code>#\n# Memory\n#\n\n# \u4f9d\u64da MemAvailable \u6240\u793a\uff0c\u9019\u53f0\u6a5f\u5668\u6709 13479504 kB \u7684 Memory \u53ef\u7528\nroot [ / ]# cat /proc/meminfo\nMemTotal:       16112256 kB # \u6240\u6709 Memory \u5927\u5c0f, \u6545\u70ba 16 GB\nMemFree:         7317172 kB # \u5b8c\u5168\u6c92\u5230\u7684 Memory \u5927\u5c0f\uff0c\u5f88\u986f\u7136\u6211\u9019\u53f0\u6a5f\u5668\u958b\u592a\u5927\u4e86\uff0c\u592a\u9592\nMemAvailable:   13479504 kB # \u5be6\u969b\u4e0a\u53ef\u7528\u7684 Memory \u5927\u5c0f\uff0cMemAvailable &lt;= MemFree + Active(file) + Inactive(file) + SReclaimable\nActive(file):    1067108 kB\nInactive(file):  5021812 kB\nSlab:             486692 kB\nSReclaimable:     334712 kB\nHugePages_Total:       0\n\n# MemTotal \u70ba 16112256 kB = 719104 kB + 15393152 kB\nroot [ / ]# cat /proc/zoneinfo\nNode 0, zone    DMA32\n  pages free     179568\n        managed  179776 # \u7d66 DMA32 \u4f7f\u7528\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593\u70ba 702.25 MB = 719104 KB = 179776 * 4 KB\nNode 0, zone   Normal\n  pages free     1974218\n        managed  3848288 # \u7d66 Normal \u4f7f\u7528\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593\u70ba 14.68 GB = 15393152 KB = 3848288 * 4 KB\n\n# \u4e00\u500b Slab page \u53ef\u7528\u7a7a\u9593 32768 Bytes = 4096 Bytes * pagesperslab 8\n# TCP \u5be6\u969b Slab page \u5167\u6709 31360 Bytes \u88ab\u4f7f\u7528 = objsize 2240 Bytes * objperslab 14\n# Slab page \u788e\u7247 1408 Bytes = 32768 - 31360\n# TCP \u5be6\u969b\u5360\u7528\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593 470400 Bytes = num_objs 210 * objsize 2240 Bytes\nroot [ / ]# cat /proc/slabinfo | grep TCP\n# name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_slabs&gt; &lt;sharedavail&gt;\nTCP                  210    210   2240   14    8 : tunables    0    0    0 : slabdata     15     15      0\n</code></pre> <p>\u8a18\u61b6\u9ad4\u662f\u4e0d\u53ef\u88ab\u58d3\u7e2e\u8cc7\u6e90\uff0c\u8ddf CPU \u4e0d\u4e00\u6a23\uff0c\u5982\u679c MemAvailable \u771f\u7684\u7528\u5230 0 \u7684\u72c0\u6cc1\u4e0b\uff0c\u5c31\u4ee3\u8868\u4f60\u7684\u7bc0\u9ede\u8a18\u61b6\u9ad4\u771f\u7684\u662f\u592a\u5c0f\u4e86\uff0c\u5b8c\u5168\u4e0d\u5920\u5206\u914d\u51fa\u53bb\uff0c\u4e0a\u9762\u7684 Pod \u5f88\u5bb9\u6613\u6709\u6eff\u6eff OOM \u7684\u72c0\u6cc1\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8981 Pod \u6709\u4fdd\u969c\u7684\u8cc7\u6e90\u53ef\u4ee5\u7528\uff0c\u4f60\u9700\u8981\u5f9e k8s \u7684\u89d2\u5ea6\u53bb\u63a7\u5236 cpu.request / cpu.limit / memory.request / memory.limit\uff0c\u53ef\u53c3\u8003\u5c0f\u5f1f\u820a\u6587 \u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7\uff0c\u9019\u7bc7\u4e0d\u6703\u7279\u5225\u6d89\u53ca\uff0c\u4e4b\u5f8c\u6703\u8b1b\u4e00\u7bc7\u7531\u4e0b\u800c\u4e0a\u7684 Node \u548c\u7531\u4e0a\u800c\u4e0b\u7684\u7ba1\u7406 Kubernetes \u89d2\u5ea6\u4e0a\u7684\u8cc7\u6e90\u5c0d\u7167</p> <p>\u9806\u4fbf\u4e00\u63d0\uff0c\u7dad\u6301\u4e00\u500b Long Lived TCP Connection \uff0c\u4e14\u4e0d\u5305\u542b\u5176\u4ed6\u7684\u8cc7\u6599\u50b3\u8f38\uff0c\u6d88\u8017\u7684\u8a18\u61b6\u9ad4\u5927\u7d04\u70ba ~3.3 KB\uff0c\u82e5\u5168\u90e8\u90fd\u662f Long Lived TCP Connection \u4e14\u7121\u5be6\u969b\u8cc7\u6599\u904b\u4f5c\u6216\u50b3\u8f38\u7684\u8a71\uff0c\u5927\u6982\u5c31\u662f\u6d88\u8017 3.3 GB \u8a18\u61b6\u9ad4\u5b58\u9019\u4e9b\u8cc7\u8a0a\uff0c\u53ef\u53c3\u8003 <code>Q5: \u55ae\u53f0 C1000K \u662f\u600e\u9ebc\u7b97\u51fa\u4f86\u7684? \u9810\u8a2d\u5565\u90fd\u6c92\u505a\u7684\u72c0\u6cc1\u4e0b\u8a18\u61b6\u9ad4\u6d88\u8017\u70ba\u4f55?</code> \u7684\u5167\u5bb9</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#3-linux-kernel","title":"3. Linux Kernel \u76f8\u95dc","text":"<pre><code>#\n# Kernel Paraemters\n#\nroot [ / ]# uname -a\nLinux aks-agentpool-14864487-vmss000000 5.15.131.1-2.cm2 #1 SMP Sun Sep 24 03:38:45 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\n\n# \u4e0b\u5217\u90fd\u662f CBL-Mariner \u7684\u9810\u8a2d\u503c\nroot [ / ]# sysctl -a\nnet.ipv4.ip_local_port_range = 32768    60999 # \u8a72 VM \u53ef\u4f7f\u7528\u7684 Port Range\uff0c\u9810\u8a2d\u7bc4\u570d\u70ba 32768 ~ 60999\uff0c\u5171 28232 \u500b Port\uff0c\u53ef\u8abf\u6574\nnet.ipv4.tcp_syn_retries = 6\nnet.ipv4.tcp_synack_retries = 5\nnet.ipv4.tcp_syncookies = 1 # \u9810\u8a2d\u53ef\u9632\u6b62\u90e8\u5206 SYN Flood \u653b\u64ca\nnet.ipv4.tcp_tw_reuse = 2\nnet.ipv4.tcp_max_syn_backlog = 16384\nnet.ipv4.tcp_max_tw_buckets = 65536\nnet.core.somaxconn = 16384\nfs.file-max = 9223372036854775807 # OS Level\uff0c\u70ba Int64.MaxValue \u6700\u5927\u4f4d\u6578\uff0c\u5341\u516d\u9032\u4f4d0x7FFFFFFFFFFFFFFF\nfs.nr_open = 1073741816 # Progess Level\uff0c\u9700\u8981\u6bd4 * hard nofile (1048576) \u5927\uff0c\u4e0d\u7136\u6703\u958b\u4e0d\u8d77\u4f86\nnet.ipv4.tcp_congestion_control = cubic\nnet.ipv4.tcp_mtu_probing = 0\nnet.ipv4.tcp_fastopen = 1\n\nroot [ / ]# ulimit -a\nreal-time non-blocking time  (microseconds, -R) unlimited\ncore file size              (blocks, -c) unlimited\ndata seg size               (kbytes, -d) unlimited\nscheduling priority                 (-e) 0\nfile size                   (blocks, -f) unlimited\npending signals                     (-i) 62863\nmax locked memory           (kbytes, -l) 64\nmax memory size             (kbytes, -m) unlimited\nopen files                          (-n) 1048576 # \u540c\u6642\u53ef\u6253\u958b\u7684\u6a94\u6848\u6578\u91cf\uff0cAzure \u63d0\u4f9b\u7684 CBL-Mariner \u4f5c\u696d\u7cfb\u7d71\u9810\u8a2d\u662f 2^20 \u500b\uff0c\u55ae\u53f0 VM \u5e33\u9762\u9810\u8a2d\u6578\u5b57\u662f\u652f\u63f4\u505a\u5230 C1000K \u7b49\u7d1a\npipe size                (512 bytes, -p) 8\nPOSIX message queues         (bytes, -q) 819200\nreal-time priority                  (-r) 0\nstack size                  (kbytes, -s) 8192\ncpu time                   (seconds, -t) unlimited\nmax user processes                  (-u) unlimited\nvirtual memory              (kbytes, -v) unlimited\nfile locks                          (-x) unlimited\n</code></pre> <p>\u524d\u9663\u5b50 CNCF \u6709\u4e00\u7bc7\u90e8\u843d\u683c Tuning EMQX to scale to one million concurrent connections on Kubernetes \u5c31\u5728\u8b1b\u5982\u4f55\u8abf\u6574\u7bc0\u9ede\u5167\u7684 Linux Kernel \u53c3\u6578\u4f86\u9054\u5230 1 \u767e\u842c Concurrent Connections</p> <p>\u9019\u908a\u4f86\u6bd4\u5c0d\u4e00\u4e0b CBL-Mariner \u9810\u8a2d\u53c3\u6578\u8ddf EMQX Linux Kernel Tuning \u7684\u5dee\u7570</p> sysctl CBL-Mariner 2.0 EMQX Note fs.file-max 9223372036854775807 2097152 \u6574\u500b OS \u6700\u5927\u958b\u6a94\u6578\u91cf fs.fs.nr_open 1073741816 2097152 \u55ae\u4e00\u7a0b\u5e8f\u6700\u5927\u958b\u6a94\u6578\u91cf net.core.somaxconn 16384 32768 \u5168\u9023\u63a5\u4f47\u5217\u9577\u5ea6: min(tcp_max_syn_backlog, somaxconn) net.ipv4.tcp_max_syn_backlog 16384 16384 \u5168\u9023\u63a5\u4f47\u5217\u9577\u5ea6: min(tcp_max_syn_backlog, somaxconn) net.core.netdev_max_backlog 1000 16384 net.ipv4.ip_local_port_range 32768 60999 1000 65535 VM \u53ef\u7528 Port \u7bc4\u570d\uff0c\u4f46\u55ae\u7d14\u4ee5 Server \u7aef\u89d2\u5ea6\u4f86\u8aaa\u8abf\u9019\u500b\u6c92\u5565\u592a\u5927\u7528\u8655\uff0c\u591a\u534a\u90fd 80, 443 \u70ba\u4e3b\uff0c\u4f46\u7576 Client \u4f86\u8b1b\u5c31\u6709\u6548\u679c\u4e86\uff0c\u8b6c\u5982\u8aaa\u4f60\u8981\u5916\u9023 DB \u9084\u662f\u6709\u7684\u6c92\u7684\u5916\u90e8\u670d\u52d9\u4e4b\u985e\u7684\uff0c\u9019\u500b\u8abf\u5927\u6703\u6bd4\u8f03\u597d net.core.rmem_default 212992 262144 TCP Recieve Windows net.core.rmem_max 212992 16777216 TCP Recieve Windows net.core.wmem_default 212992 262144 TCP Write Windows net.core.wmem_max 212992 16777216 TCP Write Windows net.core.optmem_max 20480 16777216 \u7de9\u885d\u5340\u5927\u5c0f net.ipv4.tcp_rmem 4096 131072 6291456 1024 262144 16777216 \u56e0\u70ba MQ\uff0c\u8a0a\u606f\u91cf\u5c0f\uff0c\u53ef\u4ee5 1KB \u5c31\u767c\u9001\u4e00\u6b21 net.ipv4.tcp_wmem 4096 16384 4194304 1024 262144 16777216 \u56e0\u70ba MQ\uff0c\u8a0a\u606f\u91cf\u5c0f\uff0c\u53ef\u4ee5 1KB \u5c31\u767c\u9001\u4e00\u6b21 net.netfilter.nf_conntrack_max 131072 1000000 \u8abf\u9ad8 nf_conntrack_max \u7684\u63a5\u53d7\u4e0a\u9650 net.netfilter.nf_conntrack_tcp_timeout_time_wait 120 30 net.ipv4.tcp_max_tw_buckets 65536 1048576 \u8d85\u904e TIME_WAIT \u8a2d\u5b9a\u503c\u5247\u6e05\u9664 net.ipv4.tcp_fin_timeout 60 15 \u8abf\u964d TCP \u5728 FIN-WAIT-2 \u7684\u6642\u9593 <p>\u5982\u679c\u8981\u91dd\u5c0d\u4e0a\u8ff0\u7684\u53c3\u6578\u9032\u884c\u8abf\u6574\uff0c\u5728 AKS \u88e1\u9762\uff0c\u4f60\u9700\u8981\u4f9d\u5faa \u81ea\u8a02 Azure Kubernetes Service (AKS) \u7bc0\u9ede\u96c6\u5340\u7684\u7bc0\u9ede\u8a2d\u5b9a \u9032\u884c\u8a2d\u5b9a\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u9032\u53bb\u7528 sysctl \u6539\u6578\u503c\uff0c\u4f46\u76ee\u524d az aks update \u6c92\u652f\u63f4 --linux-os-config</p> <pre><code>az aks create --name myAKSCluster --resource-group myResourceGroup --linux-os-config ./linuxosconfig.json\n</code></pre> <p>\u5982\u679c\u4f60\u662f\u81ea\u5efa\u4f5c\u696d\u7cfb\u7d71\u7684\u8a71\uff0c\u5c31\u5c0d /etc/sysctl.conf \u9032\u884c\u4fee\u6539\u5373\u53ef</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#4-networking","title":"4. Networking","text":"","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#a-networking-hardware","title":"a. Networking Hardware","text":"<pre><code>#\n# Networking Hardware\n#\n\n# \u986f\u793a\u9810\u8a2d\u7db2\u5361 eth0 \u652f\u63f4\u6700\u5927\u7684 Channel \u5927\u5c0f\u548c\u73fe\u884c\u8a2d\u5b9a\u7684\u5927\u5c0f\nroot [ ~ ]# ethtool -l eth0\nChannel parameters for eth0:\nPre-set maximums:\nRX:             n/a\nTX:             n/a\nOther:          n/a\nCombined:       4\nCurrent hardware settings:\nRX:             n/a\nTX:             n/a\nOther:          n/a\nCombined:       4 # \u7528\u6eff\u4e86\uff0c\u4ee3\u8868 RSS (Receive Side Scaling) \u6c92\u554f\u984c\uff0c\u5728 CBL-Mariner \u4e0a\u5df2\u7d93\u662f\u7db2\u8def\u6700\u4f73\u5316\u7528\u6cd5\n\n# \u4e0b\u9762\u7684 interrupts \u7d71\u4e00\u6703\u7531 irqbalance \u81ea\u52d5\u63a7\u5236\uff0c\u6b63\u5e38\u72c0\u6cc1\u4e0b\u4f60\u4e0d\u9700\u8981\u624b\u52d5\u53bb\u7dad\u8b77\u4e0b\u9762\u7684 /proc/irq/25,26,27,28/smp_affinity \u8a2d\u5b9a\n# systemctl status irqbalance\nroot [ ~ ]# cat /proc/interrupts | grep mlx5_comp\n           CPU0       CPU1       CPU2       CPU3\n 25:   14332354          0          0          0  Hyper-V PCIe MSI 3758129153-edge      mlx5_comp0@pci:3ffc:00:02.0\n 26:          0         14   13861183          0  Hyper-V PCIe MSI 3758129154-edge      mlx5_comp1@pci:3ffc:00:02.0\n 27:          0   17419688         12          0  Hyper-V PCIe MSI 3758129155-edge      mlx5_comp2@pci:3ffc:00:02.0\n 28:          0          0          0   10673131  Hyper-V PCIe MSI 3758129156-edge      mlx5_comp3@pci:3ffc:00:02.0\n...\n\n# \u9810\u8a2d\u662f\u4f7f\u7528 GRO \u5728 Linux Kernel \u4e0a\u628a\u5408\u4f75\u5c01\u5305\u7684\u4e8b\u60c5\u7d66\u89e3\u6c7a\u4e86\uff0c\u800c\u975e LRO \u5728\u7db2\u5361\u4e0a\u628a\u5408\u4f75\u5c01\u5305\u7684\u4e8b\u60c5\u7d66\u89e3\u6c7a\u4e86\nroot [ ~ ]# ethtool -k eth0\ngeneric-receive-offload: on\nlarge-receive-offload: off\n</code></pre>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#b-routing","title":"b. Routing","text":"<pre><code>#\n# Linux Networking\n#\n\n# \u986f\u793a\u9019\u53f0\u7bc0\u9ede\u4e0a\u7684\u8def\u7531\nroot [ ~ ]# ip route\n# \u9019\u908a\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5176\u5be6\u6211\u6709\u8a2d\u5b9a UDR \u5f37\u5236\u628a egress (a.k.a outbound traffic) \u6240\u6709\u6d41\u91cf\u5c0e\u5230 Firewall (10.99.x.x) \u4e0a\uff0c\u4f46\u5f9e\u8def\u7531\u8868\u4e0a\u6703\u770b\u4e0d\u51fa\u4f86\uff0c\u5f97\u5f9e Azure Portal \u4e0a\u770b\n# \u4ee5\u4e0b\u662f Node IP \u7684\u8def\u7531 10.0.128.0/24\uff0cDefault Gateway \u70ba\u8a72\u7db2\u6bb5\u7684\u7b2c\u4e00\u500b IP\uff0c\u4e5f\u5c31\u662f 10.0.128.1\ndefault via 10.0.128.1 dev eth0 proto dhcp src 10.0.128.5 metric 100\n10.0.128.0/24 dev eth0 proto kernel scope link src 10.0.128.5 metric 100\n10.0.128.1 dev eth0 proto dhcp scope link src 10.0.128.5 metric 100\n# \u4ee5\u4e0b\u662f Pod IP \u7684\u8def\u7531\uff0c10.0.129.0/24\n10.0.129.0/24 via 10.0.128.1 dev eth0 proto static\n10.0.129.5 dev azv7d24922a083 proto static\n10.0.129.8 dev azv9da73473eb2 proto static\n10.0.129.9 dev azv6f0c6f1ef57 proto static\n10.0.129.10 dev azvaa6ccb05bb5 proto static\n10.0.129.13 dev azvcdfece9bfdf proto static\n10.0.129.14 dev azvf893453cbc5 proto static\n10.0.129.15 dev azv1f6d5d20426 proto static\n10.0.129.16 dev azvf85308aa314 proto static\n10.0.129.17 dev azva9b3f83744f proto static\n10.0.129.21 dev azv224fa8c56a6 proto static\n10.0.129.22 dev azvbb0334487e3 proto static\n10.0.129.25 dev azvca12febb7ce proto static\n10.0.129.27 dev azv0867699d9ac proto static\n10.0.129.28 dev azva412bba2170 proto static\n10.0.129.29 dev azvd4c029379b6 proto static\n10.0.129.30 dev azv9a46f9ec6ea proto static\n10.0.129.35 dev azvd96d575dd35 proto static\n10.0.129.36 dev azvee4ae66e969 proto static\n# \u4e0b\u9762\u662f\u9019\u53f0\u7bc0\u9ede\u8207 Azure \u5e73\u53f0\u8cc7\u6e90 168.63.129.16 \u6e9d\u901a\u7528\u7684\u8def\u7531\n168.63.129.16 via 10.0.128.1 dev eth0 proto dhcp src 10.0.128.5 metric 100\n# \u4e0b\u9762\u662f\u8ddf Azure Instance Metadata Service \u6e9d\u901a\u7528\u7684\u8def\u7531\n169.254.169.254 via 10.0.128.1 dev eth0 proto dhcp src 10.0.128.5 metric 100\n</code></pre> <p>\u770b\u8def\u7531\u8868\u4e3b\u8981\u7684\u76ee\u7684\u662f\u8a0e\u8ad6 Kubernetes Egress\uff0c\u4e5f\u5c31\u662f Pod \u5f9e\u7bc0\u9ede\u51fa\u53bb\u7684\u8def\u5f91\u662f\u600e\u9ebc\u8d70\u7684\u3002\u56e0\u70ba\u6211\u4f7f\u7528\u7684 CNI (Container Networking Interface) \u70ba Azure-CNI\uff0c\u800c\u975e\u4f7f\u7528 kubenet \u6216 overlay CNI \u7b49\uff0c\u6240\u4ee5 Pod IP \u5176\u5be6\u5c31\u662f\u6211\u6307\u6d3e\u7684\u67d0\u4e00\u6bb5 Azure Subnet \u7db2\u6bb5\uff0c\u6309\u7167\u8a72\u8def\u7531\uff0c\u662f\u53ef\u4ee5\u5f9e\u5225\u7684 Azure Subnet \u6216\u5df2\u958b\u555f VNet Peering \u7684\u670d\u52d9\u76f4\u63a5\u6478\u5230 Pod IP\u3002</p> <p>\u82e5\u4f60\u7684 kube-proxy \u662f\u8d70 iptables \u7684\u8a71\uff0c\u5176\u5be6\u662f\u53ef\u4ee5\u5c0d Node \u5957 iptables rule \u5f71\u97ff\u4e0a\u9762\u7684 Pod \u8def\u7531\uff0c\u8b6c\u5982\u8aaa\u62ff ansible \u5c0d\u6240\u6709\u7bc0\u9ede\u76f4\u63a5\u4e0a\u8def\u7531\uff0c\u4f46\u9019\u5df2\u7d93\u975e Kubernetes \u80fd\u7ba1\u63a7\u7684\u7bc4\u570d\u4e86\uff0c\u6240\u4ee5\u6b63\u5e38\u72c0\u6cc1\u4e0b\u90fd\u4e0d\u5efa\u8b70\u5728\u4e0d\u6e05\u695a\u4e0d\u660e\u767d\u7684\u72c0\u6cc1\u4e0b\u9032\u884c\u9019\u4ef6\u4e8b</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#_1","title":"\u5f8c\u8a71","text":"<ol> <li>\u5176\u5be6\u4e00\u958b\u59cb\u6211\u53ea\u662f\u60f3\u8981\u7d00\u9304\u4e00\u4e0b AKS Node \u4e0a\u7684\u4e00\u4e9b\u9810\u8a2d\u53c3\u6578\uff0c\u4e0d\u77e5\u9053\u70ba\u5565\u8d8a\u5beb\u8d8a\u591a\u3002</li> <li>\u5982\u679c\u4f60\u6709\u770b\u61c2\u4e0a\u9762\u7684\u5167\u5bb9\uff0c\u4f60\u6703\u767c\u73fe\u5230\u5176\u5be6\u7814\u7a76 Kubernetes \u5c31\u8ddf\u7814\u7a76 Linux \u4f5c\u696d\u7cfb\u7d71\u662f\u6c92\u4ec0\u9ebc\u592a\u5927\u5340\u5225\u7684\uff0c\u4e0d\u5982\u8aaa Kubernetes \u5e6b\u4f60\u62bd\u8c61\u5316\u4e86\u5f88\u591a\u4e8b\u60c5\uff0c\u8b93\u4f60\u4e0d\u7528\u77e5\u9053\u5f97\u592a\u7d30\uff0c\u96d6\u7136\u8b8a\u76f8\u4f60\u9700\u8981\u5b78\u7fd2\u7684\u5c31\u662f Kubernetes \u7684\u8a9e\u8a00\uff0c\u5f9e\u5b78\u7fd2 shell \u6539\u6210\u5230 kubectl \u7684\u64cd\u4f5c</li> <li>\u770b\u8457\u4e0a\u9762\u7684\u5167\u5bb9\uff0c\u6240\u4ee5\u6211\u5e73\u6642\u624d\u6703\u5f88\u5e38\u8aaa\uff0c\u4f5c\u696d\u7cfb\u7d71\u7684\u7a69\u5b9a\u8207\u5426\u6703\u76f4\u63a5\u5f71\u97ff Kubernetes \u7684\u7a69\u5b9a\u6027\uff0c\u6eff\u6eff\u5730\u4f5c\u696d\u7cfb\u7d71\u53c3\u6578\u7d30\u7bc0</li> <li>AKS Node \u662f\u6709\u8003\u616e\u5230\u5927\u90e8\u5206\u7684\u4f7f\u7528\u8005\u90fd\u4e0d\u6703\u53bb\u770b\u9019\u4e9b\u53c3\u6578\uff0c\u8abf\u6559\u662f\u4ee5 C1000K \u70ba\u76ee\u6a19\u57fa\u6e96\u5148\u5e6b\u5927\u5bb6\u8abf\u597d\u4e86\uff0c\u6240\u4ee5\u6c92\u7279\u6b8a\u72c0\u6cc1\u4e0b\u90fd\u53ef\u4ee5\u9806\u9806\u7528\uff0c\u4e5f\u4e0d\u592a\u6703\u6709\u7bc0\u9ede\u786c\u9ad4+\u4f5c\u696d\u7cfb\u7d71\u6548\u80fd\u554f\u984c\uff0c\u81ea\u5efa\u7684\u5c31\u8981\u81ea\u5df1\u52a0\u6cb9\u4e86</li> </ol>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#qa","title":"Q&amp;A","text":"","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q1-azure-vm-ht","title":"Q1: \u5982\u4f55\u91dd\u5c0d Azure VM \u95dc\u9589 HT \u529f\u80fd?","text":"<p>\u91cd\u958b\u624d\u6703\u751f\u6548</p> <pre><code>az resource tag --ids /subscriptions/{SubID}/resourceGroups/{ResourceGroup}/providers/Microsoft.Compute/virtualMachines/{VM} --tags platformsettings.host_environment.disablehyperthreading=true\naz vm restart -g {ResourceGroup} -n {VM}\n</code></pre>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q2-azure-vm-instance-metadata","title":"Q2: \u5982\u4f55\u7372\u53d6\u8a72 Azure VM \u7684 Instance Metadata?","text":"<p>\u6839\u64da\u6b64\u6587 Azure VM Instance instance-metadata-service\uff0c\u53ef\u900f\u904e\u4ee5\u4e0b\u65b9\u5f0f\u7372\u53d6</p> <pre><code>root [ ~ ]# curl -s -H Metadata:true --noproxy \"*\" \"http://169.254.169.254/metadata/instance?api-version=2021-02-01\" | jq\n</code></pre>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q3-eth0-channel","title":"Q3: \u5982\u679c\u6709\u8981\u8abf\u6574 eth0 \u7684 channel \u5927\u5c0f\u8a72\u600e\u9ebc\u505a?","text":"<p>\u5982\u679c\u4f60\u662f\u7528 AKS \u7684\u4f7f\u7528\u8005\uff0c\u57fa\u672c\u4e0a\u90fd\u4e0d\u7528\u6539\uff0c\u9810\u8a2d\u4e00\u958b\u59cb\u90fd\u5f04\u597d\u4e86</p> <p>\u66ab\u6642\u8655\u7406\u65b9\u5f0f\uff0c\u56e0\u70ba\u9019\u500b\u662f\u66ab\u6642\u6027\u8a2d\u5b9a\uff0c\u5982\u679c\u8a72 AKS \u7bc0\u9ede\u88ab\u79fb\u9664\u4e86\uff0c\u65b0\u589e\u7bc0\u9ede\u6216\u65e2\u6709\u7684\u7bc0\u9ede\u4e26\u4e0d\u6703\u6709\u9019\u500b\u529f\u80fd</p> <pre><code>$ ethtool -L eth0 combined 4\n</code></pre>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q4-platformsettingshost_environmentdisablehyperthreading-true","title":"Q4: \u4f55\u6642\u6703\u9078\u64c7\u628a <code>platformsettings.host_environment.disablehyperthreading: true</code> \u53c3\u6578\u5957\u4e0a\u53bb","text":"<p>\u8dd1 HPC \u9ad8\u6548\u80fd\u8a08\u7b97\u985e\u578b\u7684\u90fd\u883b\u9069\u5408\u7684\uff0c\u4f60\u6703\u9700\u8981\u5b8c\u6574\u7684\u6838\u5fc3\u8a08\u7b97\u80fd\u529b\uff0c\u8b6c\u5982\u8aaa EDA / \u7b97\u5716 \u7b49</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q5-c1000k","title":"Q5: \u55ae\u53f0 C1000K \u662f\u600e\u9ebc\u7b97\u51fa\u4f86\u7684? \u9810\u8a2d\u5565\u90fd\u6c92\u505a\u7684\u72c0\u6cc1\u4e0b\u8a18\u61b6\u9ad4\u6d88\u8017\u70ba\u4f55?","text":"<p>Linux \u958b\u6a94\u9650\u5236\u4e3b\u8981\u5361 3 \u500b\u9ede\uff0c\u4e09\u8005\u7f3a\u4e00\u4e0d\u53ef\uff0c\u4ee5 CBL-Mariner \u4f86\u770b\u7684\u8a71\uff0c\u9810\u8a2d\u503c\u5982\u4e0b\u6240\u5217\uff0c\u6545\u55ae\u53f0\u6700\u5927\u53ef\u958b\u6a94\u6578\u91cf\u70ba 1048576\uff0c\u7d04 C1000K</p> Level Parameters Value Note OS sysctl -n fs.file-max 9223372036854775807 \u7576\u524d\u7cfb\u7d71\u6700\u5927\u53ef\u958b\u6a94\u6578\u91cf Process sysctl -n fs.nr_open 1073741816 \u55ae\u4e00\u7a0b\u5e8f\u53ef\u958b\u6a94\u6700\u5927\u6578\u91cf\uff0c\u4e00\u5b9a\u8981\u6bd4 hard nofile \u5927 User ulimit -n 1048576 \u7576\u524d\u4f7f\u7528\u8005\u53ef\u958b\u6a94\u6700\u5927\u6578\u91cf <p>\u7dad\u6301 1 \u500b TCP Connection \u7d04\u7565\u6d88\u8017 3.3 KB \u7684\u8a18\u61b6\u9ad4\uff0c\u6545\u5047\u8a2d\u5168\u90e8 1048576 \u90fd\u958b\u8d77\u4f86\u7684\u8a71\uff0c\u4fdd\u6301 Long Lived TCP Connection\uff0c\u4f46\u90fd\u6c92\u50b3\u8f38\u5176\u4ed6\u6771\u897f\u7684\u8a71\uff0c\u5927\u6982\u5c31 3.3 GB = 1048576 * 3.3 KB\uff0c\u4f46\u9019\u662f\u7406\u60f3\u503c\uff0c\u5be6\u969b\u4e0a\u6703\u5927\u4e00\u9ede\uff0c\u7531\u6b64\u53ef\u77e5\uff0c\u9023\u7dda\u6578\u91cf\u7684\u591a\u5be1\u5176\u5be6\u9084\u6709\u53d7\u9650\u65bc\u8a18\u61b6\u9ad4\u7684\u591a\u5be1\uff0c\u800c\u975e\u50c5\u53d7\u4e0a\u8ff0\u7684\u958b\u6a94\u6578\u91cf\u9650\u5236</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q6-1048576-50-tcp-connection-tcp-connection-1-kbs","title":"Q6: \u5982\u679c 1048576 \u6709 50% \u6d3b\u8e8d TCP Connection\uff0c\u6bcf\u500b TCP Connection \u9700\u8981\u50b3 1 KB/s \u7684\u8cc7\u6599\uff0c\u9019\u6a23\u7db2\u5361\u9700\u8981\u591a\u5927?","text":"<p>\u9019\u500b\u8981\u7b97\u983b\u5bec (Bandwidth)\uff0c\u4e5f\u5c31\u662f\u8981\u7b97\u6c34\u7ba1\u7684\u5927\u5c0f\uff0c\u9019\u7bc7\u6709\u4e00\u500b\u5c0f\u5f1f\u65e9\u671f\u5e38\u7528\u7684\u8868 Bandwidth &amp; Throughput</p> <p></p> <p>[(1048576 TCP Connection * 50% * 1KB/s) / 1024] = 512 MB/s * 8 bits = 4096 Mbps = 4 Gbps</p> <p>\u6700\u5c11\u4f60\u4e5f\u8981\u6709 4 Gbps Bandwidth \u624d\u80fd\u627f\u53d7\u9019\u500b\u91cf\u9ad4\uff0c\u800c Azure VM \u7684\u7db2\u8def\u983b\u5bec\u662f\u57fa\u65bc Instance \u7684\u9078\u64c7\u4e0d\u540c\uff0c\u800c\u4e0d\u662f\u770b\u5167\u5efa\u7db2\u5361\u7684\u8a2d\u5b9a (ethtool eth0)\uff0c\u6240\u4ee5\u53ef\u5f9e Dasv5 \u548c Dadsv5 \u7cfb\u5217 \u4e2d\u7684 <code>Standard_D4as_v5</code> \u7684\u6700\u5927\u7db2\u8def\u983b\u5bec (Max network bandwidth) \u53ef\u5f97\u77e5\u70ba 12500 Mbps\uff0c\u9060\u5927\u65bc\u6240\u9700\u7684 4096 Mbps\uff0c\u6545\u9019\u53f0 Standard_D4as_v5 \u662f\u53ef\u4ee5\u652f\u63f4\u554f\u984c\u6240\u9700\u7684\u8cc7\u6599\u50b3\u8f38\u91cf</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u4f60\u5728 AKS \u96c6\u7fa4\u5916\u9762\u6709\u7528 UDR \u4e1f\u7d66 Azure Firewall \u7684\u8a71\uff0c\u6839\u64da Choose the right Azure Firewall SKU to meet your needs \u7684\u6bd4\u8f03\u8868\uff0c\u4f60\u9700\u8981\u9078\u64c7 SKU \u6700\u5c0f\u70ba Standard (30 Gbps) \u6216 Premium (100 Gbps)\uff0c\u800c\u4e0d\u80fd\u9078 Basic\uff0c\u4e0d\u7136\u6574\u500b\u983b\u5bec\u6703\u5361\u5728 250 Mbps</p>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#q7-ulimit-n","title":"Q7: \u5982\u4f55\u8abf\u6574 ulimit -n \u7684\u503c?","text":"<p>\u5982\u679c\u4f60\u662f\u7528 AKS \u7684\u4f7f\u7528\u8005\uff0c\u57fa\u672c\u4e0a\u90fd\u4e0d\u7528\u6539\uff0c\u9810\u8a2d\u4e00\u958b\u59cb\u90fd\u5f04\u597d\u4e86</p> <p>\u5982\u679c\u4f60\u662f\u81ea\u67b6\u4f5c\u696d\u7cfb\u7d71\u7684\uff0c\u5c31\u7167\u4e0b\u9762\u7684\u8a2d\u5b9a\u5373\u53ef</p> <pre><code># \u5982\u679c\u6c92\u7279\u5225\u8abf\u904e\u7684\uff0c\u61c9\u8a72\u90fd\u662f 1024 \u70ba\u4e3b\uff0c\u8b6c\u5982\u50cf RHEL 9.2 \u548c RHEL 8.8 \u5c31\u662f\u9019\u6a23\n$ ulimit -n\n1024\n\n# \u5169\u8005\u53d6\u5176\u4f4e\n$ vim /etc/security/limits.conf\n* soft nofile 1048576\n* hard nofile 1048576\n\n# \u4e0d\u7528 reboot\uff0c\u767b\u51fa\u518d\u767b\u5165\u5c31\u597d\n$ logout; login\n$ ulimit -n\n1048576\n</code></pre>","tags":["kubernetes"]},{"location":"20231027-aks-node-c1000k.html#reference","title":"Reference","text":"<ul> <li>\u6211\u7684\u5185\u5b58\u5462\uff1fLinux MemAvailable \u5982\u4f55\u8ba1\u7b97</li> <li>Guidance for mitigating silicon based micro-architectural and speculative execution side-channel vulnerabilities</li> <li>Azure VM Instance instance-metadata-service</li> <li>\u7576\u9047\u5230 Distroless Container \u9664\u932f\u8981\u4ec0\u9ebc\u6c92\u4ec0\u9ebc\u8a72\u600e\u9ebc\u8fa6? \u4f60\u7684\u597d\u670b\u53cb kubectl debug</li> <li>microsoft/CBL-Mariner</li> <li>\u81ea\u8a02 Azure Kubernetes Service (AKS) \u7bc0\u9ede\u96c6\u5340\u7684\u7bc0\u9ede\u8a2d\u5b9a - Linux Kubelet \u81ea\u8a02\u8a2d\u5b9a</li> <li>Control Topology Management Policies on a node</li> <li>Tuning EMQX to scale to one million concurrent connections on Kubernetes</li> <li>EMQX Linux Kernel Tuning</li> <li>\u5982\u4f55\u79d1\u5b78\u5730\u4f30\u7b97 Kubernetes \u6240\u9700\u7684\u8cc7\u6e90? App \u89d2\u5ea6\u7bc7</li> <li>\u7b2c315\u671f | \u4ec0\u4e48\u662fC10K\uff1f\u5982\u4f55\u505a\u5230C1000K\uff1f</li> <li>Bandwidth &amp; Throughput</li> <li>Green Software Practitioner - Increasing device utilization</li> <li>Choose the right Azure Firewall SKU to meet your needs</li> </ul>","tags":["kubernetes"]},{"location":"20240124-ansible-on-azure.html","title":"\u4e0a\u73ed\u6642\u9593\u4e0d\u5920\u7528\u4e4b [A]nsible \u52a0\u4e0a [A]zure","text":"<p>\u56e0\u70ba\u4e4b\u524d\u96fb\u8166\u7de8\u8b6f Material for MkDocs \u6162\u5230\u6211\u6c92\u8fa6\u6cd5\u63a5\u53d7\uff0c\u6240\u4ee5\u524d\u9663\u5b50 Apple \u51fa MBPR M3 Pro \u4e4b\u5f8c\uff0c\u525b\u597d\u5e7e\u5e74\u524d\u8cb7\u7684 MBPR Intel \u4e5f\u662f\u865b\u7d2f\u7d2f\uff0c\u5c31\u5fc3\u4e00\u6a6b\u885d\u4e86\u4e00\u767c\uff0c\u7528\u4e86\u4e4b\u5f8c\u53ea\u80fd\u8aaa\u679c\u7136\u9084\u662f UNIX-like \u7cfb\u7d71\u6eab\u99a8\uff0c\u9999</p> <p>\u76ee\u524d\u4f7f\u7528 M3 Pro \u4e0b\u4f86\uff0c\u9664\u4e86 podman machine \u6709\u9ede\u6280\u8853\u554f\u984c\u4ee5\u5916\u548c Container \u7de8\u8b6f\u8981\u5f9e x86 \u63db arm \u5f88\u7169\u4ee5\u5916\uff0c\u5176\u4ed6\u90fd\u9084\u597d\uff0c\u9023 Microsoft Defender for Enpoint \u90fd\u6709\u652f\u63f4 M3 \u7684\u7248\u672c (\u4e0b\u5716\u6709\u771f\u76f8 XD)</p> <p></p>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#why-ansible-azure","title":"Why: \u70ba\u4ec0\u9ebc\u8981\u7528 Ansible \u7ba1\u7406 Azure?","text":"<p>\u56e0\u70ba\u6211\u591a\u6578\u7684\u67b6\u69cb\u8a2d\u8a08\u5de5\u4f5c\u90fd\u662f\u4e00\u6b65\u4e00\u6b65\u9032\u884c\u8a2d\u8a08\uff0c\u6bcf\u500b\u5ba2\u6236\u9577\u76f8\u548c\u9700\u6c42\u90fd\u6709\u9ede\u4e0d\u592a\u4e00\u6a23\uff0c\u6240\u4ee5\u6211\u5728\u591a\u6578\u72c0\u6cc1\u4e0b\u6703\u66f4\u50be\u5411\u63a1\u7528 Ansible \u9019\u7a2e\u547d\u4ee4\u5f0f (Imperative) \u7684\u65b9\u5f0f\u4f86 Step by Step \u63a7\u7ba1\u6d41\u7a0b\uff0c\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0c\u4e0d\u662f\u63a1\u7528 Terraform \u6216 Bicep \u8072\u660e\u5f0f (Declarative) \u7684\u65b9\u5f0f</p> <p>\u6b64\u5916\u672c\u5bb6\u7684 Azure CLI \u767c\u5c55\u90fd\u6703\u6bd4\u5176\u4ed6 IaC SDK \u4f86\u5f97\u5feb\uff0c\u8b6c\u5982\u8aaa\u50cf preview \u529f\u80fd\u6709\u6642\u5019\u5c31\u662f\u5f97\u7528\u5230\uff0c\u50cf AKS \u9ad4\u7cfb\u7684\u529f\u80fd\u5c31\u4e00\u7968\u653e\u5728 preview \u90a3\u908a\uff0c\u4f60\u53ea\u80fd\u7528\u4e0b azure-cli \u7684\u65b9\u5f0f\u9032\u884c\u64cd\u4f5c\uff0c\u4e45\u4e86\u5c31\u6703\u7fd2\u6163\u7528 Azure CLI \u70ba\u4e3b\u4f86\u7ba1\u7406 Azure</p>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#how-ansible-azure","title":"How: \u5982\u4f55\u7528 Ansible \u7ba1\u7406 Azure?","text":"<p>\u57fa\u65bc\u6211\u81ea\u5df1\u5e38\u5beb\u7684\u7d93\u9a57\uff0c\u4e3b\u8981\u5c31 3 \u500b\u62db\u6578</p> <ol> <li>Option 1: \u63a1\u7528 Ansible Colletion - azure.azcollection.*\uff0c\u7528\u5c01\u88dd\u597d\u7684 Python Libray \u53bb\u9032\u884c\u64cd\u4f5c</li> <li>Option 2: \u63a1\u7528 ansible.builtin.command + azure-cli\uff0c\u7528 shell \u6307\u4ee4\u547c\u53eb Azure CLI \u53bb\u9032\u884c\u64cd\u4f5c\uff0c\u7121\u8ad6\u662f Windows \u624d\u80fd\u4f7f\u7528\u7684 win_command \u9084\u662f Linux \u624d\u80fd\u4f7f\u7528\u7684 command \u7684\u5834\u666f\u90fd\u53ef\u4ee5\u7528</li> <li>Option 3: \u63a1\u7528 ansible.builtin.shell + azure-cli\uff0c\u6548\u679c\u8ddf Option 2 \u4e00\u6a23\uff0c\u53ea\u662f\u9019\u500b\u662f\u7576\u4f60\u88e1\u9762\u7684\u6307\u4ee4\u6709\u9700\u8981\u8655\u7406\u5230 \"&lt;\", \"&gt;\", \"|\", \";\", \"&amp;\" \u7b49\u5b57\u5143\u7684\u6642\u5019\u624d\u4f7f\u7528\uff0c\u4e0d\u7136\u8acb\u4e00\u5f8b\u5148\u7528 command \u6bd4\u8f03\u5b89\u5168</li> </ol> <p>\u9019 3 \u7a2e\u4f7f\u7528\u65b9\u5f0f\u7684\u9806\u5e8f\u9078\u64c7\u5c31\u662f\uff0c\u5e38\u898b\u7684\u670d\u52d9\u53ef\u4ee5\u5148\u7528 <code>azure.azcollection.*</code>\uff0c\u5982\u679c\u6709\u4e9b\u529f\u80fd\u767c\u73fe\u6c92\u6709\u7684\u8a71\uff0c\u518d\u63db\u6210\u7528 <code>ansible.builtin.command</code> \u6216 <code>ansible.builtin.shell</code> \u53bb\u547c\u53eb Azure CLI \u4f86\u9032\u884c\u64cd\u4f5c</p> azure-on-ansible.yml<pre><code>---\n- name: Playbook - Ansible on Azure\n  hosts: bastion\n  collections:\n    - azure.azcollection\n\n  tasks:\n    #\n    # Option 1: Use azure.azcollection to create a resource group\n    #\n    - name: Create resource group rg-demo in {{ location }}\n      azure_rm_resourcegroup:\n        name: rg-demo\n        location: \"{{ location }}\"\n\n    #\n    # Option 2: Use ansible.builtin.command to get Azure Red Hat OpenShift versions\n    #\n    - name: Query Azure Red Hat OpenShift\n      ansible.builtin.command: |\n        az aro get-versions\n          --location \"{{ location }}\"\n      register: aro_versions\n\n    #\n    # Option 3: Use ansible.builtin.shell to create Azure Container Registry\n    #\n    - name: Create Azure Container Registry - {{ acr_name }}\n      ansible.builtin.shell: |\n        az acr create\n          --location \"{{ location }}\"\n          --resource-group \"{{ acr_resource_group }}\"\n          --name \"{{ acr_name }}\"\n          --sku Premium\n          --admin-enabled true\n          --default-action Deny\n          --zone-redundancy Enabled\n          &gt; /dev/null\n</code></pre>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#when-ansible-azure","title":"When: \u4f55\u6642\u8a72\u7528 Ansible \u7ba1\u7406 Azure?","text":"<p>\u53ea\u8981\u4f60\u7684\u5de5\u4f5c\u6a21\u5f0f\u5f88\u5f37\u70c8\u6709\u6d41\u7a0b\u63a7\u5236\u7684\u9700\u6c42\u6216\u8005\u662f\u5c0d\u65bc\u65e2\u6709 Shell Script \u6216 azure-cli \u9010\u6b65\u64cd\u4f5c\u6709\u5f37\u70c8\u9700\u6c42\u7684\u4eba\uff0c\u5c31\u5225\u8003\u616e\u4e86\uff0c\u76f4\u63a5\u7528\u5427</p> <p>\u597d\u8655\u5c31\u4e0b\u9762 3 \u9ede:</p> <ol> <li>\u662f\u9700\u8981\u53ef\u4ee5\u88ab\u91cd\u8907</li> <li>\u57f7\u884c\u524d\u9700\u8981\u9810\u6e2c\u7d50\u679c</li> <li>\u9700\u8981\u505a\u7248\u672c\u63a7\u5236</li> </ol>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#where-ansible-azure","title":"Where: \u5728\u54ea\u88e1\u53ef\u4ee5\u7528 Ansible \u7ba1\u7406 Azure?","text":"<ol> <li>Red Hat Ansible Automation Platform: \u9700\u8981 RBAC \u7ba1\u63a7, audit log \u7d00\u9304, workflow, event driven \u80fd\u529b\u8981\u9078\u9019\u500b\uff0c\u8a73\u7d30\u53ef\u627e Red Hat \u696d\u52d9\u804a\u804a</li> <li>Azure Cloud Shell: \u9810\u8a2d\u6709\u63d0\u4f9b Ansible core 2.15.8 \u53ef\u7528</li> <li>Localhost: \u8ddf Azure Cloud Shell \u908f\u8f2f\u5dee\u4e0d\u591a\uff0c\u53ea\u662f\u8981\u81ea\u5df1\u5b89\u88dd Ansible \u548c\u7dad\u8b77\u5e33\u5bc6</li> </ol>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#azureazcollection","title":"\u6b63\u78ba\u5730\u5b89\u88dd azure.azcollection","text":"<p>\u6211\u7fd2\u6163\u6703\u56fa\u5b9a\u7248\u672c\u5b89\u88dd\uff0c\u56e0\u70ba\u4e4b\u524d\u6709\u9047\u904e\u4e0d\u5beb\u7684\u6642\u5019\uff0c\u6703\u63a1\u6700\u65b0\u7248\u672c\uff0c\u4e0a\u9031\u7528 1.9.1 \u7684\u7248\u672c\uff0c\u7136\u5f8c\u8981\u6e96\u5099\u4ea4\u5dee\u7684\u6642\u5019\u5ffd\u7136\u8b8a\u6210 2.0.0 \u7684\u7248\u672c\uff0c\u7136\u5f8c\u6574\u500b Ansible Playbook \u5c31\u7206\u70b8\u4e86</p> <p>\u4e0b\u9762\u63d0\u4f9b\u4e00\u500b\u6211\u6700\u8fd1\u5e38\u7528\u7684\u5b89\u88dd\u65b9\u5f0f\uff0c\u5982\u679c\u662f\u5728 Azure Cloud Shell \u5167\u57f7\u884c\u7684\u6642\u5019\uff0c\u901a\u5e38\u90fd\u9700\u8981\u57f7\u884c\u4e0b\u5217\u5167\u5bb9\u624d\u6703\u6b63\u5e38</p> <pre><code>#\n# Please consider use venv for each Ansible project\n#\npython3 -m venv .venv\nsource .venv/bin/actiavte\npip3 install --upgrade pip\n\n#\n# Install azure.azcollection and kubernetes.core\n#\nansible-galaxy collection install azure.azcollection:2.1.1 --force\npip install -r ~/.ansible/collections/ansible_collections/azure/azcollection/requirements-azure.txt\npip install ansible[azure]\nansible-galaxy collection install kubernetes.core:3.0.0 --force\npip install -r ~/.ansible/collections/ansible_collections/kubernetes/core/requirements.txt\n</code></pre>","tags":["ansible","azure"]},{"location":"20240124-ansible-on-azure.html#references","title":"References","text":"<ul> <li>Ansible Docs - Microsoft Azure Guide</li> <li>Microsoft Docs - Ansible on Azure documentation</li> <li>Microsoft Docs - Quickstart: Create an Azure service principal for Ansible</li> <li>Material for MkDocs</li> </ul>","tags":["ansible","azure"]},{"location":"20240125-k8sgpt-joined-sandbox-project.html","title":"k8sGPT \u52a0\u5165 CNCF Sandbox Project!","text":"<p>\u53bb\u5e74\u958b\u59cb Cloud Native Computing Foundation \u91dd\u5c0d AI \u9818\u57df\u6709\u958b\u59cb\u8457\u58a8\uff0c\u5728 2023/12/19 <code>k8sGPT</code> \u6b63\u5f0f\u88ab\u653e\u5165\u5230 Sandbox Project \u5167\uff0c\u9019\u5c08\u6848\u76ee\u7684\u662f\u5354\u52a9\u4f60\u4e00\u884c <code>k8sgpt analyze --explain --anonymize</code> \u5206\u6790\u4f60\u73fe\u5728\u767b\u5165\u7684 Kubernetes \u72c0\u6cc1\uff0c\u8b93\u4f60\u64fa\u812b\u89c0\u843d\u9670\u7684\u8f2a\u8ff4\u4e2d</p> <p>\u6709\u8da3\u7684\u4e8b\u60c5\u662f\uff0c\u4ed6\u662f\u88ab\u5206\u985e\u5230 <code>TAG Observability</code> \u7bc4\u7587\u5167...</p> <p></p>","tags":["kubernetes","azureopenai"]},{"location":"20240125-k8sgpt-joined-sandbox-project.html#k8sgpt-azure-openai","title":"k8sgpt \u73fe\u884c\u652f\u63f4 Azure OpenAI","text":"<p>\u4f9d\u64da LLM AI Backends \u6e05\u55ae\uff0c\u9664\u4e86 OpenAI \u4ee5\u5916\uff0c\u4e5f\u6709\u652f\u63f4 Azure OpenAI</p> k8sgpt-azureopenai-install.sh<pre><code>#\n# Prerequisites\n#\nAOAI_ENDPOINT=\"https://pichuang.openai.azure.com/\"\nDEPLOYMNET_NAME=\"deployment-gpt35-turbo-16k\" # It's a deployment name, not a model name\nMODEL_NAME=\"gpt-35-turbo-16k\"\nAOAI_API_KEY=\"pichuangishandsome\"\n\n#\n# Add Azure OpenAI backend\n#\n$ k8sgpt auth add --backend azureopenai --baseurl $AOAI_ENDPOINT --engine $DEPLOYMNET_NAME --model $MODEL_NAME --password $AOAI_API_KEY\nazureopenai added to the AI backend provider list\n\n# Set Azure OpenAI backend as default\n$ k8sgpt auth default -p azureopenai\nDefault provider set to azureopenai\n\n# List all backends\n$ k8sgpt auth list\nDefault:\n&gt; azureopenai\nActive:\n&gt; azureopenai\n\n# Check you can reach Kubernetes cluster, and here I use OpenShift Local v4.14.7\n$ oc version\nClient Version: 4.14.7\nKustomize Version: v5.0.1\nServer Version: 4.14.7\nKubernetes Version: v1.27.8+4fab27b\n\n$ kubectl version\nClient Version: v1.29.1\nKustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3\nServer Version: v1.27.8+4fab27b\n\n$ kubectl cluster-info\nKubernetes control plane is running at https://api.crc.testing:6443\n\n# Test k8sgpt with Azure OpenAI backend\n$ k8sgpt analyze --explain --anonymize\n 100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| (3/3, 31 it/min)\nAI Provider: azureopenai\n...omit...\n</code></pre> <p></p> <p>\u9019\u908a\u6211\u5c31\u62ff\u6211\u96fb\u8166\u4e0a\u9762\u6709\u7684 Red Hat OpenShift Local \u4f86\u9032\u884c\u4f7f\u7528\uff0c\u7576\u7136\u4f60\u5982\u679c\u662f\u7528 Azure Kubernetes Service / Tanzu Kubernetes Grid \u7684\u4e5f\u9069\u7528\u9019\u500b\u4f5c\u6cd5\uff0ck8sgpt \u57fa\u672c\u4e0a\u5c31\u5f9e API \u90a3\u908a\u6488\u6771\u897f\u56de\u4f86\u5f8c\uff0c\u5e6b\u4f60\u722c Log \u4ee5\u5916\uff0c\u9084\u53ef\u4ee5\u91dd\u5c0d\u932f\u8aa4\u7d66\u4e00\u9ede Solution \u8b93\u4f60\u6709\u4e00\u500b\u65b9\u5411\u53ef\u4ee5\u89e3\u6c7a\u554f\u984c</p>","tags":["kubernetes","azureopenai"]},{"location":"20240125-k8sgpt-joined-sandbox-project.html#k8sgpt","title":"[\u7121\u95dc k8sgpt] \u63d0\u5347\u67e5\u8a62\u901f\u5ea6\u548c\u8cc7\u6599\u96b1\u853d\u6027","text":"<p>\u57fa\u65bc Azure OpenAI - Use Private Endpoints\uff0c\u53ef\u4ee5\u5c07\u50b3\u8f38\u901f\u5ea6\u548c\u96b1\u853d\u6027\u900f\u904e Private Endpoint \u7684\u8def\u7dda\u4f86\u5927\u5e45\u63d0\u5347</p> <p>\u4e0b\u9762\u7684 VM \u548c Azure OpenAI \u53ca\u5176 Private Endpoint \u90fd\u5728 East US 2\uff0c\u5149\u5728\u540c\u5340\u6e2c\u8a66\u9019\u6a23\u5c31\u6709\u5dee 0.5 ~ 1 \u500b ms \u4e86</p> private-versus-public-routing<pre><code>#\n# via Public Internet (Microsoft Routing)\n#\n$ sudo hping3 -S pichuang.openai.azure.com -p 443 -c 5\nHPING pichuang.openai.azure.com (eth0 20.119.156.137): S set, 40 headers + 0 data bytes\nlen=44 ip=20.119.156.137 ttl=58 DF id=0 sport=443 flags=SA seq=0 win=64240 rtt=3.7 ms\nlen=44 ip=20.119.156.137 ttl=56 DF id=0 sport=443 flags=SA seq=1 win=64240 rtt=3.6 ms\nlen=44 ip=20.119.156.137 ttl=58 DF id=0 sport=443 flags=SA seq=2 win=64240 rtt=3.5 ms\nlen=44 ip=20.119.156.137 ttl=58 DF id=0 sport=443 flags=SA seq=3 win=64240 rtt=3.4 ms\nlen=44 ip=20.119.156.137 ttl=56 DF id=0 sport=443 flags=SA seq=4 win=64240 rtt=3.3 ms\n\n--- pichuang.openai.azure.com hping statistic ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 3.3/3.5/3.7 ms\n\n#\n# via Private Endpoint\n#\n$ sudo hping3 -S 10.0.0.9 -p 443 -c 5\nHPING 10.0.0.9 (eth0 10.0.0.9): S set, 40 headers + 0 data bytes\nlen=44 ip=10.0.0.9 ttl=64 id=391 sport=443 flags=SA seq=0 win=64800 rtt=2.7 ms\nlen=44 ip=10.0.0.9 ttl=64 id=392 sport=443 flags=SA seq=1 win=64800 rtt=2.6 ms\nlen=44 ip=10.0.0.9 ttl=64 id=393 sport=443 flags=SA seq=2 win=64800 rtt=2.5 ms\nlen=44 ip=10.0.0.9 ttl=64 id=394 sport=443 flags=SA seq=3 win=64800 rtt=2.4 ms\nlen=44 ip=10.0.0.9 ttl=64 id=395 sport=443 flags=SA seq=4 win=64800 rtt=2.3 ms\n\n--- 10.0.0.9 hping statistic ---\n5 packets transmitted, 5 packets received, 0% packet loss\nround-trip min/avg/max = 2.3/2.5/2.7 ms\n</code></pre> <p>\u56e0\u70ba Azure OpenAI \u662f\u5df2 https \u70ba\u4e3b\u7684\u670d\u52d9\uff0c\u6240\u4ee5\u8981\u6b63\u78ba\u4f7f\u7528\uff0c\u4e0d\u8df3\u904e TLS \u9a57\u8b49\u7684\u8a71\uff0c\u5efa\u8b70\u8981\u5c07 Azure Private DNS Resolver \u548c Azure Private DNS \u76f8\u95dc\u7684\u67b6\u69cb\u5f04\u597d\uff0c\u624d\u80fd\u6b63\u78ba\u904b\u884c</p> without-private-dns<pre><code>#\n# Inside VM with Azure Private Link\n#\n$ cat /etc/resolv.conf\n# Generated by NetworkManager\nsearch salqh4dnbine5ngi3moox0djkd.cx.internal.cloudapp.net divecode.intranet\nnameserver 168.63.129.16\n\n# Without Azure Private DNS\n# Verify Azure Private DNS is working\n#\n$ dig pichuang.openai.azure.com\n\n; &lt;&lt;&gt;&gt; DiG 9.16.23-RH &lt;&lt;&gt;&gt; pichuang.openai.azure.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11405\n;; flags: qr rd ra; QUERY: 1, ANSWER: 4, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1224\n;; QUESTION SECTION:\n;pichuang.openai.azure.com.      IN      A\n\n;; ANSWER SECTION:\npichuang.openai.azure.com. 900   IN      CNAME   pichuang.privatelink.openai.azure.com.\npichuang.privatelink.openai.azure.com. 900 IN CNAME eastus2.prod.vnet.cog.trafficmanager.net.\neastus2.prod.vnet.cog.trafficmanager.net. 60 IN CNAME vnetproxyv3-use2-prod.eastus2.cloudapp.azure.com.\nvnetproxyv3-use2-prod.eastus2.cloudapp.azure.com. 10 IN A 20.119.156.137\n\n;; Query time: 5 msec\n;; SERVER: 168.63.129.16#53(168.63.129.16)\n;; WHEN: Wed Jan 24 23:06:46 CST 2024\n;; MSG SIZE  rcvd: 210\n</code></pre> with-private-dns<pre><code>#\n# After setting up Azure Private DNS and Private Link\n# Verify Azure Private DNS is working\n#\n$ dig pichuang.openai.azure.com\n\n; &lt;&lt;&gt;&gt; DiG 9.16.23-RH &lt;&lt;&gt;&gt; pichuang.openai.azure.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20469\n;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1224\n;; QUESTION SECTION:\n;pichuang.openai.azure.com.      IN      A\n\n;; ANSWER SECTION:\npichuang.openai.azure.com. 900   IN      CNAME   pichuang.privatelink.openai.azure.com.\npichuang.privatelink.openai.azure.com. 10 IN A   10.0.0.9\n\n;; Query time: 3 msec\n;; SERVER: 168.63.129.16#53(168.63.129.16)\n;; WHEN: Wed Jan 24 21:37:47 CST 2024\n;; MSG SIZE  rcvd: 103\n</code></pre>","tags":["kubernetes","azureopenai"]},{"location":"20240125-k8sgpt-joined-sandbox-project.html#_1","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u4eca\u5929\u5e6b\u5ba2\u6236\u5f04 Microsoft Server \u55ac DNS Forwarder\uff0c\u7d50\u679c\u88ab\u770b\u51fa\u4f86\u4e0d\u662f\u5f88\u719f Windows Server \u64cd\u4f5c\uff0c\u88ab\u554f\u600e\u9ebc\u9032\u5fae\u8edf\u7684 (\u7159)\uff0c\u4f86\u5fae\u8edf\u4e0a\u73ed\u4e00\u5e74\u534a\uff0c\u7d42\u65bc\u8a8d\u771f\u5beb\u5230\u4e00\u6b21 Powershell\uff0c\u53ea\u80fd\u6176\u5e78\u4e0d\u6127\u662f\u5fae\u8edf\u672c\u5bb6\uff0cPoweshell SDK \u63d0\u4f9b\u7684\u7b97\u5b8c\u6574\uff0c\u642d\u500b GitHub Copilot \u5c31\u88ab\u6211\u7cca\u88e1\u7cca\u5857\u5730\u5beb\u5b8c\u4e86</p>","tags":["kubernetes","azureopenai"]},{"location":"20240125-k8sgpt-joined-sandbox-project.html#references","title":"References","text":"<ul> <li>k8sgpt.ai</li> <li>Cloud Native Landscape - k8sgpt</li> <li>Azure \u79c1\u4eba\u7aef\u9ede\u79c1\u4eba DNS \u5340\u57df\u503c</li> </ul>","tags":["kubernetes","azureopenai"]},{"location":"20240127-azure-aztfexport.html","title":"aztfexport - \u5f9e\u65e2\u6709\u74b0\u5883\u5c0e\u51fa Azure \u8cc7\u6e90\u72c0\u614b","text":"<p>A tool to bring existing Azure resources under Terraform's management</p> <p>\u56e0\u70ba\u9019\u500b Microsoft Azure Export for Terraform \u5c0f\u5de5\u5177\u662f\u4ee5 <code>Resource Group</code> \u70ba\u6700\u5927\u7bc4\u570d\u800c <code>Resource</code> \u70ba\u6700\u5c0f\u7bc4\u570d Export\uff0c\u800c\u4e0d\u662f\u4ee5 <code>Subscription</code>\uff0c\u6240\u4ee5\u5728\u7528\u7684\u6642\u5019\u8981\u5148\u5207\u63db\u5230\u5c0d\u61c9\u7684 <code>Subscription</code></p> <p>\u5fae\u8edf\u5b98\u7db2\u6587\u4ef6\u6709\u5c08\u9580\u7684\u9801\u9762\u5728\u4ecb\u7d39\u600e\u9ebc\u7528 Microsoft Learn - \u9069\u7528\u65bc Terraform \u7684 Azure \u5c0e\u51fa\u6982\u89c0</p> <p></p>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#azure","title":"\u7372\u5f97\u7576\u524d Azure \u8cc7\u6e90\u72c0\u614b","text":"<p>\u7576\u521d\u770b\u5230\u9019\u500b\u5de5\u5177\u7684\u6642\u5019\uff0c\u6211\u4e00\u958b\u59cb\u89ba\u5f97\u4ed6\u9069\u5408\u62ff\u4f86\u7576\u4f5c\u6bcf\u9031\u57fa\u790e\u72c0\u614b\u5099\u4efd\u4e4b\u7528\uff0c\u4f46\u5f8c\u4f86\u6293\u4e86\u597d\u5e7e\u500b\u8cc7\u6e90\u5f8c\uff0c\u89ba\u5f97\u53cd\u800c\u6bd4\u8f03\u9069\u5408\u4e0b\u5217 2 \u500b\u60c5\u5883</p> <ol> <li>\u8f49\u63db\u90e8\u7f72\u6a21\u5f0f: \u7576\u4f60\u60f3\u8981\u5c07\u8cc7\u6e90\u90e8\u7f72\u6a21\u5f0f\u8f49\u6210\u4ee5 Terraform \u70ba\u4e3b\u7684 IaC \u7684\u6a21\u5f0f`\uff0c\u9019\u500b\u6211\u731c\u61c9\u8a72\u662f\u6bd4\u8f03\u5c11\u898b...</li> <li>\u7814\u7a76\u7576\u524d\u72c0\u614b: \u5c0d\u65bc\u4e00\u500b\u525b\u63a5\u89f8\u5230\u7684\u74b0\u5883\uff0c\u5b8c\u5168\u4e0d\u77e5\u9053\u5728\u5e79\u561b\u7684\u6642\u5019\uff0c\u53ef\u4ee5\u5148\u900f\u904e\u9019\u7a0b\u5f0f\u6293\u7576\u524d\u8cc7\u6e90\u72c0\u614b\u7814\u7a76\uff0c\u5ee0\u5546\u505a\u6848\u5b50\u7684\u6642\u5019\u53ef\u4ee5\u8003\u616e\u51fa\u9996\u5148\u4f7f\u7528\uff0c\u4e0d\u7528\u6162\u6162\u9ede\u6ed1\u9f20</li> </ol> get-azure-tfstate.sh<pre><code>#!/usr/bin/env bash\nSUBSCRIPTION_ID=\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\nRG_NAME=\"rg-azure-openai\"\nTF_DIRNAME=\"tfstate-${RG_NAME}-$(date +%Y%m%d)\"\n\nmkdir $TF_DIRNAME\naz account set --subscription ${SUBSCRIPTION_ID}\naztfexport resource-group --non-interactive --continue --subscription-id ${SUBSCRIPTION_ID} --provider-version 3.89.0 --plain-ui --output-dir ${TF_DIRNAME} ${RG_NAME}\ntar -zcvf ${TF_DIRNAME}.tar.gz ${TF_DIRNAME}\n</code></pre>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#azure-openai","title":"\u6aa2\u8996\u7279\u5b9a\u8cc7\u6e90\u72c0\u614b\uff0c\u4ee5 Azure OpenAI \u70ba\u4f8b","text":"<p>\u4e0b\u9762\u662f\u7528 terraform \u4f86\u6aa2\u8996\u7279\u5b9a\u8cc7\u6e90\u72c0\u614b\uff0c\u4f46\u5be6\u969b\u4e0a\u4f60\u53ef\u4ee5\u76f4\u63a5\u958b vim \u6216 vscode \u4f86\u6aa2\u8996\uff0c\u4e5f\u662f\u5f88\u65b9\u4fbf</p> <p>\u9806\u4fbf\u4e00\u63d0\uff0c\u5176\u5be6 Azure OpenAI \u9019\u500b\u670d\u52d9\u662f\u7b97\u5728 <code>Microsoft.CognitiveServices/accounts</code> \u8cc7\u6e90\u7bc4\u570d\u5167\uff0c\u5982\u679c\u8981\u5206\u8fa8\u662f\u4e0d\u662f OpenAI \u7684\u8cc7\u6e90\uff0c\u53ef\u4ee5\u770b <code>kind</code> \u7684\u6b04\u4f4d</p> <pre><code>$ cd tfstate-rg-azure-openai-20240126\n$ terraform init\n$ terraform state list\nazurerm_cognitive_account.res-1\nazurerm_cognitive_account.res-6\nazurerm_cognitive_deployment.res-2\nazurerm_cognitive_deployment.res-3\nazurerm_resource_group.res-0\nazurerm_search_service.res-7\n\n#\n# Display the current state of Azure OpenAI resource\n#\n$ terraform state show azurerm_cognitive_account.res-1\n# azurerm_cognitive_account.res-1:\nresource \"azurerm_cognitive_account\" \"res-1\" {\n    custom_subdomain_name              = \"pichuang\"\n    dynamic_throttling_enabled         = false\n    endpoint                           = \"https://pichuang.openai.azure.com/\"\n    fqdns                              = []\n    id                                 = \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/rg-azure-openai/providers/Microsoft.CognitiveServices/accounts/pichuang\"\n    kind                               = \"OpenAI\"\n    local_auth_enabled                 = true\n    location                           = \"eastus2\"\n    name                               = \"pichuang\"\n    outbound_network_access_restricted = false\n    primary_access_key                 = (sensitive value)\n    public_network_access_enabled      = true\n    resource_group_name                = \"rg-azure-openai\"\n    secondary_access_key               = (sensitive value)\n    sku_name                           = \"S0\"\n    tags                               = {\n        \"Environment\" = \"production\"\n    }\n\n    network_acls {\n        default_action = \"Allow\"\n        ip_rules       = []\n    }\n}\n</code></pre>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#azure_1","title":"\u56de\u5fa9\u7279\u5b9a Azure \u8cc7\u6e90\u72c0\u614b","text":"<p>\u6709\u6642\u5019\u9700\u8981\u628a\u8cc7\u6e90\u72c0\u614b\u4ee5\u7279\u5b9a\u6642\u6a5f\u9ede\u84cb\u56de\u53bb\uff0c\u9019\u6642\u5019\u4f60\u5c31\u8981\u900f\u904e <code>terraform plan</code> \u4f86\u6aa2\u8996\u5dee\u7570\uff0c\u7136\u5f8c\u518d\u900f\u904e <code>terraform apply</code> \u4f86\u56de\u5fa9\u72c0\u614b</p> <p>\u57fa\u65bc How Azure Export for Terraform Works - Limitations \u6240\u8ff0\uff0c\u9019\u5de5\u5177\u5c0d\u65bc <code>Write-only</code> \u5c6c\u6027\u7684\u53c3\u6578\u90fd\u4e0d\u6703\u88ab\u532f\u51fa\u6216\u8005\u662f\u88ab\u986f\u793a\uff0c\u8b6c\u5982\u50cf\u662f\u5bc6\u78bc\u4e0d\u6703\u88ab\u532f\u51fa\uff0c\u4f60\u5f97\u8981\u81ea\u5df1\u7d00\u9304\uff0e\u6b64\u5916\u5982\u679c\u6709\u670d\u52d9\u525b\u597d\u4e0d\u5728 Terraform Azure Provider \u6240\u5b9a\u7fa9\u7684\u7bc4\u570d\u5167\uff0c\u90a3\u9ebc\u9019\u500b\u670d\u52d9\u4e5f\u4e0d\u6703\u88ab\u532f\u51fa\uff0e\u56e0\u70ba\u6709\u53ef\u80fd\u525b\u597d\u8a72\u670d\u52d9\u9084\u6c92\u6709\u5be6\u8e10\u5230 Terraform Azure Provider \u4e0a</p> <p>\u7d50\u8ad6\u4f86\u8aaa\uff0c\u8981\u7dca\u6025\u6062\u5fa9\u8cc7\u6e90\u72c0\u614b\uff0c\u5e73\u6642\u8981\u6392\u9664\u5c0d\u65bc <code>terraform plan</code> \u5df2\u77e5\u8cc7\u6e90\u7684\u5dee\u7570\uff0c\u8981\u80fd\u5feb\u901f\u8fa8\u8b58\u8b70\u984c\u548c\u624b\u52d5\u4fee\u5fa9\uff0c\u4e0d\u7136\u9047\u5230\u6703\u5f88\u9ebb\u7169</p> <pre><code>#\n# Found Error\n#\n$ terraform plan\n\u2577\n\u2502 Error: Missing required argument\n\u2502\n\u2502   with azurerm_cognitive_account.res-6,\n\u2502   on main.tf line 56, in resource \"azurerm_cognitive_account\" \"res-6\":\n\u2502   56: resource \"azurerm_cognitive_account\" \"res-6\" {\n\u2502\n\u2502 \"network_acls\": all of `custom_subdomain_name,network_acls` must be specified\n\n#\n# Before\n#\n$ cd tfstate-rg-azure-openai-20240124\n$ terraform state show azurerm_cognitive_account.res-6\n# azurerm_cognitive_account.res-6:\nresource \"azurerm_cognitive_account\" \"res-6\" {\n    dynamic_throttling_enabled         = false\n    endpoint                           = \"https://japaneast.api.cognitive.microsoft.com/\"\n    fqdns                              = []\n    id                                 = \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/rg-azure-openai/providers/Microsoft.CognitiveServices/accounts/stt-pichuang\"\n    kind                               = \"SpeechServices\"\n    local_auth_enabled                 = true\n    location                           = \"japaneast\"\n    name                               = \"stt-pichuang\"\n    outbound_network_access_restricted = false\n    primary_access_key                 = (sensitive value)\n    public_network_access_enabled      = true\n    resource_group_name                = \"rg-azure-openai\"\n    secondary_access_key               = (sensitive value)\n    sku_name                           = \"F0\"\n    tags                               = {\n        \"Environment\" = \"production\"\n    }\n\n    network_acls {\n        default_action = \"Allow\"\n        ip_rules       = []\n    }\n}\n\n#\n# After\n#\n# Fix the error from above and re-run `terraform plan`\n# https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cognitive_account\n#\n$ terraform plan\nTerraform will perform the following actions:\n  # azurerm_cognitive_account.res-6 will be updated in-place\n  ~ resource \"azurerm_cognitive_account\" \"res-6\" {\n        id                                 = \"/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/rg-azure-openai/providers/Microsoft.CognitiveServices/accounts/stt-pichuang\"\n        name                               = \"stt-pichuang\"\n        tags                               = {\n            \"Environment\" = \"production\"\n        }\n        # (12 unchanged attributes hidden)\n\n      - network_acls {\n          - default_action = \"Allow\" -&gt; null\n          - ip_rules       = [] -&gt; null\n        }\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n</code></pre>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#qa","title":"Q&amp;A","text":"","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#q1","title":"Q1: \u4f7f\u7528\u7d93\u9a57\u5982\u4f55?","text":"<p>\u4e0d\u662f\u6bcf\u4e00\u500b Resource \u90fd\u5012\u7684\u51fa\u4f86\uff0c\u532f\u51fa\u4f86\u5f8c\uff0c\u8981\u771f\u7684\u8981 Import \u9084\u662f\u8981\u4e00\u500b\u4e00\u500b\u4fee\u88dc\u7f3a\u5c11\u7684\u5167\u5bb9\uff0c\u51e1\u8209\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u7f3a\u6b04\u4f4d\u3001\u5bc6\u78bc\u3001\u6216\u8005\u662f\u4e0d\u5728 Terraform Azure Provider \u6240\u5b9a\u7fa9\u7684\u7bc4\u570d\u5167\u7684\u670d\u52d9\uff0c\u90fd\u9700\u8981\u88ab\u8655\u7406</p>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#q2-tfstate","title":"Q2: \u6211\u53ef\u4ee5\u62ff\u4f86\u7576 tfstate \u6a94\u6848\u7684\u5e38\u898f\u5099\u4efd\u7528\u55ce?","text":"<p>\u50be\u5411\u4e0d\u8981\uff0c\u7576\u7136\u5982\u679c\u4f60\u7684\u8cc7\u6e90\u4e0d\u5177\u5099 Nested Resource Group \u4e4b\u985e\u7684\u7279\u6027\uff0c\u53ef\u4ee5\u8003\u616e\u8a66\u8a66\u770b\uff0c\u4f46\u5982\u679c\u50cf Azure Kubernetes Service \u6216\u8005\u662f Azure Red Hat OpenShift \u5efa\u7acb\u670d\u52d9\u7684\u6642\u5019\u90fd\u6703\u984d\u5916\u518d\u5efa\u7acb\u4e00\u500b Resource Group \u653e\u7f6e\u4e00\u5806\u8cc7\u6e90\u7684\u8a71\uff0c\u90a3\u53ef\u80fd\u5728 aztfexport \u7684\u6642\u5019\u6703\u6709\u554f\u984c\uff0c\u4f30\u8a08\u8981\u624b\u52d5\u4e00\u500b\u4e00\u500b\u4e0b terraform import \u4fee\u88dc</p>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#_1","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u9019\u5e7e\u5929\u5929\u6c23\u592a\u51b7\u4e86\uff0c\u5df2\u7d93\u51b7\u5230\u9ede\u9999\u6c1b\u881f\u71ed\u53d6\u6696\u4e0a\u73ed\u4e86</p> <p></p>","tags":["kubernetes","terraform"]},{"location":"20240127-azure-aztfexport.html#references","title":"References","text":"<ul> <li>Microsoft Azure Export for Terraform</li> <li>How Azure Export for Terraform Works - Limitations</li> <li>Terraform Azure Provider</li> </ul>","tags":["kubernetes","terraform"]},{"location":"20240130-ssh-tunneling.html","title":"\u4e0a\u73ed\u57fa\u672c\u529f: SSH \u6df7\u642d Azure Firewall","text":"<p>\u672c\u7bc7\u5206\u4eab\u4e00\u4e0b\u6211\u500b\u4eba\u4e0a\u73ed\u5e38\u7528 SSH \u6df7\u642d Azure Firewall \u670d\u7528\u7684\u8df3\u677f\u57fa\u672c\u529f</p> <p></p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#azure","title":"\u4eba\u5728\u6c5f\u6e56\uff0c\u60f3\u9023\u56de Azure\uff0c\u6709\u4f55\u9078\u64c7?","text":"<p>\u6b63\u5e38\u7ba1\u63a7\u72c0\u6cc1\u4e0b\uff0c\u4f60\u7684\u670d\u52d9\u90fd\u653e\u5728 Azure Virtual Network \u5167\uff0c\u4f60\u4eba\u5728\u5916\u9762\u60f3\u8981\u9023\u9032\u53bb\uff0c\u9019\u6642\u5019\u6709\u5e7e\u7a2e\u505a\u6cd5</p> <ol> <li>\u512a\u9078 - Azure Bastion: \u539f\u751f\u8df3\u677f\u670d\u52d9\uff0c\u4e0d\u7528\u81ea\u5df1\u7dad\u8b77\uff0c\u53ef\u4ee5 <code>az network bastion ssh</code> \u6216 <code>az network bastion rdp</code> \u7528 Native Client \u9023\u5230\u5167\u7db2\u4e3b\u6a5f</li> <li>\u4e2d\u9078 - Azure VPN Gateway: \u7121\u8ad6\u900f\u904e S2S VPN \u6216 P2S VPN\uff0c\u90fd\u53ef\u4ee5\u9023\u5230\u5167\u7db2\u4e3b\u6a5f\uff0c\u5e38\u898b\u90fd\u662f\u770b\u5230 S2S\uff0c\u800c\u5f8c\u8005\u9700\u8981\u5728\u96fb\u8166\u5b89\u88dd Azure VPN Client\uff0c\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u6bd4\u8f03\u5c11\u51fa\u73fe\u5728\u9078\u9805\u4e2d\uff0c\u4e0d\u7136\u5176\u5be6\u9019\u500b\u9078\u64c7\u883b\u5b89\u5168</li> <li>\u666e\u9078 - \u628a\u73a9 SSH: \u4eca\u5929\u6587\u7ae0\u5c31\u662f\u8981\u8b1b\u9019\u500b\uff0c\u56de\u6b78\u5230\u7db2\u8def\u57fa\u672c\u529f\uff0c\u5982\u4f55\u642d\u914d\u65e2\u6709\u7684 Azure Firewall\u3001\u4e00\u53f0\u5177\u6709 SSH Server \u7684\u865b\u64ec\u6a5f\u548c\u7db2\u8def\u77e5\u8b58\u4f86\u505a\u5230\u5404\u7a2e\u5e38\u898f\u7684\u958b\u767c\u6e2c\u8a66</li> </ol>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#_1","title":"\u5e38\u898b\u67b6\u69cb","text":"<ol> <li>\u4f60\u7684\u500b\u4eba\u96fb\u8166: \u57fa\u672c\u4e0a\u5c31\u662f\u4e00\u53f0\u6709 SSH Client \u7684\u96fb\u8166\uff0c\u53ef\u4ee5\u662f Windows\u3001Mac\u3001Linux\uff0c\u7136\u5f8c\u9019\u908a\u4f60\u53ef\u4ee5\u5148\u6c7a\u5b9a\u4e00\u500b Port \u4f86\u4f5c\u70ba\u5f85\u6703\u7684 <code>Dynamic Port Forwarding</code> \u7684\u4f7f\u7528\uff0c\u500b\u4eba\u5e38\u7528\u662f <code>1080</code></li> <li>Azure Firewall: \u9019\u908a\u5047\u8a2d\u4f60\u5df2\u7d93\u6709\u4e00\u500b Azure Firewall\uff0c\u7121\u8ad6\u662f Basic\u3001Standard\u3001Premium \u90fd\u53ef\u4ee5\uff0c\u4e09\u500b\u90fd\u652f\u63f4 SNAT + DNAT \u7684\u80fd\u529b\uff0c\u7136\u5f8c\u4f60\u5c0d\u5916\u7684 Public IP \u6703\u7d81\u5728 Azure Firewall \u4e0a\uff0c\u6700\u591a\u53ef\u4ee5\u5728 1 \u53f0 Azure Firewall \u4e0a\u7d81 250 \u500b Public IP</li> <li>Azure Firewall Policy: \u9019\u908a\u6703\u9700\u8981\u64b0\u5beb DNAT Policy \u548c Network Policy (for SNAT)\uff0c\u7b2c\u4e00\u6b21\u5beb\u61c9\u8a72\u90fd\u6703\u88ab\u6b04\u4f4d\u641e\u6df7\u548c Azure Virtual Network Transit \u7684\u8655\u7406\u65b9\u5f0f\u641e\u6df7\uff0c\u8b6c\u5982\u8aaa 3 Virtual Network \u9023\u518d\u4e00\u8d77\u7684\u6642\u5019\uff0c\u662f\u8def\u7531\u4e0d\u904e\u53bb\u7684\u4e4b\u985e\u8b70\u984c</li> <li>Azure Virtual Machine: \u9019\u53f0\u89d2\u8272\u5c31\u662f\u5167\u7db2\u8df3\u677f\u6a5f\uff0c\u53ea\u8981\u6709 SSH Server \u5373\u53ef\uff0c\u9019\u908a\u6709\u4e00\u4e9b\u9632\u79a6\u6a5f\u5236\uff0c\u4f46\u6703\u96e2\u984c\u5c31\u4e0d\u5728\u9019\u908a\u8a73\u8ff0\u4e86</li> <li>Web Service: \u6beb\u7121\u61f8\u5ff5\uff0c\u5c31\u662f\u4e00\u53f0\u5728\u5167\u7db2\u7684 Web Server\uff0c\u6211\u81ea\u5df1\u6703\u9047\u5230\u7684\u72c0\u6cc1\u662f Azure Red Hat OpenShift \u6709\u81ea\u5df1\u7684 Web Console\uff0c\u6240\u4ee5\u5f97\u8981\u7279\u5225\u7528\u9019\u500b\u6587\u7ae0\u7684\u505a\u6cd5\u8df3 SOCKS5 \u51fa\u4f86</li> <li>Azure Route Table \u7d66 Spoke VNET: \u8def\u7531\u8868\uff0c\u5982\u679c\u5728\u88e1\u9762\u64b0\u5beb\u7279\u5b9a\u7684\u8def\u7531\uff0c\u9019\u500b\u884c\u70ba\u53c8\u7a31 UDR (User Defined Routes)\uff0c\u4ed6\u7d81\u5b9a\u7684\u55ae\u4f4d\u662f\u57fa\u65bc <code>Subnet</code>\uff0c\u4e0d\u662f <code>Virtual Network</code> \uff0e\u5982\u679c\u60f3\u8981\u8b93\u5f9e Internet \u9032\u53bb\u7684\u8def\u7531\u80fd\u5920\u6b63\u78ba\u5730\u56de\u53bb\uff0c\u9019\u908a\u5c31\u9700\u8981\u64b0\u5beb UDR \u5c07\u8def\u7531\u6307\u56de\u53bb Azure Firewall\uff0c\u610f\u65e8 0.0.0.0/0 \u7684\u4e0b\u4e00\u8df3\u70ba Network Virtual Appliances (Azure Firewall) \u7684 Private IP <code>10.99.99.4</code></li> <li>Azure Route Table \u7d66 Azure Firewall: \u9019\u908a\u4e3b\u8981\u5c31\u662f\u8981\u8a2d\u5b9a\u8b93 Azure Firewall \u53ef\u4ee5\u9023 Internet \u7684\u80fd\u529b</li> </ol> <p>\u6211\u500b\u4eba\u883b\u63a8\u85a6\u7b2c\u4e00\u6b21\u63a5\u89f8\u9019\u500b\u67b6\u69cb\u7684\u4eba\u53ef\u4ee5\u770b The Azure\ud83c\udf0d hub-and-spoke-playground \u5716\u6587\u76f8\u7576\u8a73\u7d30\uff0c\u6975\u63a8\u85a6\uff01</p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#case-1-ssh","title":"Case 1: \u5f9e\u5916\u9762\u5b89\u5168\u5730\u900f\u904e SSH \u8df3\u9032\u53bb\u5167\u7db2\u4e3b\u6a5f","text":"<p>\u6838\u5fc3\u6280\u8853: DNAT</p> <p></p> <p>\u5728\u958b\u59cb\u8a2d\u5b9a DNAT \u4e4b\u524d\uff0c\u4f60\u5f97\u8981\u5148\u78ba\u5b9a Spoke to Spoke \u53ef\u4ee5\u4e92\u76f8\u900f\u904e Azure Firewall \u50b3\u8f38\uff0c\u8a73\u7d30\u53ef\u53c3\u8003 SOLUTION: Allows machines in ANY spoke to communicate with ANY machine in ANY other spoke (Azure Firewall)\uff0c\u9019\u908a\u5c31\u4e0d\u8d05\u8ff0</p> <p>\u4e0b\u9762\u5c31\u662f\u5be6\u969b\u4e0a\u7684 DNAT \u898f\u5247\uff0c\u76f8\u7576\u7d93\u5178</p> priority collection name rule name src port protocol destination translated address translated port action 1000 coll01 ssh-restrict-to-rhel9 4.5.6.7 5566 TCP 1.2.3.4 10.0.0.4 22 Dnat <p>\u4e0a\u9762\u7684\u898f\u5247\u767d\u8a71\u5c31\u662f: \u9650\u5236 IP \u4f86\u6e90 4.5.6.7 \u9023\u7dda\u5230 Firewall Public IP \u7684 5566 Port \u4e0a\uff0c\u505a DNAT \u5230 10.0.0.4 \u7684 22 Port</p> <p>\u5047\u8a2d\u6709\u8a2d\u5b9a\u597d\u7684\u8a71\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u4f60\u7684\u96fb\u8166\u4e0a\u57f7\u884c\u4e0b\u9762\u7684\u6307\u4ee4\uff0c\u53ea\u8981\u662f\u5728 4.5.6.7 \u4ee5\u5167\uff0c\u5c31\u53ef\u4ee5\u6b63\u78ba\u7684\u9023\u7dda\u5230\u4f60\u7684\u5167\u7db2\u4e3b\u6a5f\u4e86</p> <pre><code>ssh pichuang@1.2.3.4 -p 5566\n</code></pre> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4f60\u7684\u96fb\u8166\u7684\u5c0d\u5916 IP \u70ba\u4f55\uff0c\u53ef\u4ee5\u7528\u4e0b\u5217\u6307\u4ee4\u67e5\u8a62</p> <pre><code>$ curl ifconfig.me\n4.5.6.7\n</code></pre> <p>\u82e5\u4f60\u4e0d\u60f3\u6bcf\u6b21\u767b\u5165\u90fd\u8981\u6253\u4e00\u5927\u4e32\uff0c\u5efa\u8b70\u53ef\u4ee5\u5beb <code>~/.ssh/config</code> \u4f86\u8b93\u4f60\u66f4\u65b9\u4fbf\u7684\u9023\u7dda</p> ~/.ssh/config<pre><code>Host azhome\n    HostName 1.2.3.4\n    Port 5566\n    User pichuang\n    IdentityFile ~/.ssh/id_rsa\n</code></pre> <p>\u9019\u6a23\u5c31\u53ef\u4ee5\u7528 <code>ssh azhome</code> \u4f86\u9023\u7dda\u4e86</p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#case-2-web-httpswebpichuanginfra","title":"Case 2: \u6211\u60f3\u8981\u770b\u5230 Web \u9801\u9762 https://web.pichuang.infra\uff0c\u4f46\u6211\u5167\u7db2\u6a5f\u5668\u90fd\u6c92\u6709\u700f\u89bd\u5668\uff0c\u8a72\u600e\u9ebc\u8fa6?","text":"<p>\u6838\u5fc3\u6280\u8853: DNAT + SOCKS5</p> <p></p> <p>ssh \u5176\u5be6\u6709\u5167\u5efa SOCKS5 Proxy \u7684\u80fd\u529b\uff0c\u53ea\u662f\u8981\u4e0a\u53c3\u6578 <code>-D</code> \u7d66\u4ed6\uff0c\u610f\u65e8 <code>Dynamic Port Forwarding</code>\uff0c\u9019\u908a\u6211\u5011\u5c31\u7528 <code>1080</code> \u9019\u500b Port \u4f86\u7576\u4f5c Proxy \u7684 Port</p> socks5-command-using-ssh<pre><code>ssh -D 1080 pichuang@1.2.3.4 -p 5566\n# or\n# ssh -D localhost:1080 pichuang@1.2.3.4 -p 5566\n# or\n# ssh -D 0.0.0.0:1080 pichuang@1.2.3.4 -p 5566\n</code></pre> <p>\u767b\u5165\u9032\u53bb\u5f8c\uff0c\u4f60\u9700\u8981\u958b\u555f\u4f60\u7684\u700f\u89bd\u5668\uff0c\u4fee\u6539 Proxy \u8a2d\u5b9a\uff0c\u6211\u500b\u4eba\u6b77\u5e74\u90fd\u662f\u7528 <code>SwitchyOmega</code> \u9019\u500b Chrome Extension\uff0c\u4ed6\u53ef\u4ee5\u8b93\u4f60\u5728\u700f\u89bd\u5668\u4e0a\u5feb\u901f\u5207\u63db Proxy\uff0c\u540c\u6642\u4e5f\u9069\u7528\u65bc Edge\uff0c\u9019\u908a\u5c31\u7528 <code>socks5://127.0.0.1:1080</code> \u4f86\u7576\u4f5c Proxy \u7684\u8a2d\u5b9a\uff0c\u8a2d\u5b9a\u756b\u9762\u5982\u4e0b</p> <p></p> <p>\u9019\u6a23\u4f60\u5c31\u53ef\u4ee5\u5728\u4f60\u672c\u5730\u7684\u700f\u89bd\u5668\u53ef\u4ee5\u770b\u5230 <code>https://web.pichuang.infra</code> \u7684\u9801\u9762\u4e86</p> <p>\u7576\u7136\u4e5f\u53ef\u4ee5\u628a\u8a2d\u5b9a\u5beb\u5230 <code>~/.ssh/config</code> \u56c9\uff0c\u591a\u4e00\u884c <code>DynamicForward 1080</code> \u5373\u53ef</p> <pre><code>Host azhome\n    HostName 1.2.3.4\n    Port 5566\n    User pichuang\n    IdentityFile ~/.ssh/id_rsa\n    DynamicForward 1080\n</code></pre> <p>\u53e6\u5916\uff0c\u7e3d\u662f\u6709\u4e9b\u670d\u52d9\u4ed6\u9810\u8a2d\u5c31\u662f\u4e0d\u8d70 IP \u70ba\u4e3b\u7684\uff0c\u800c\u662f\u4ee5 HTTP \u70ba\u4e3b\uff0c\u56e0\u70ba SOCKS5 \u4e26\u4e0d\u6703\u5e6b\u5fd9\u505a DNS \u89e3\u6790\u548c\u5c0e\u6d41\uff0c\u5018\u82e5\u4f60\u6709\u9700\u8981\u5728\u672c\u6a5f\u505a DNS \u89e3\u6790\u7684\u8a71\uff0c\u4f60\u5f97\u8981\u81ea\u5df1\u5728 <code>/etc/hosts</code> \u628a\u5c0d\u61c9\u7684 IP \u548c FQDN \u5beb\u9032\u53bb\u662f\u4e00\u500b\u6bd4\u8f03\u7c21\u6613\u52d9\u5be6\u7684\u505a\u6cd5\uff0c\u5982\u4e0b\u5716\u7684\u5c0d\u7167</p> <p></p> /etc/hosts<pre><code>10.252.12.62     console-openshift-console.apps.dr.aro.divecode.intranet\n</code></pre>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#case-3-azure-firewall-public-ip","title":"Case 3: \u6211\u60f3\u8981\u900f\u904e Azure Firewall \u7684 Public IP \u4f86\u9023\u7dda\u5230\u5916\u9762","text":"<p>\u6838\u5fc3\u6280\u8853: DNAT + SOCKS5 + SNAT</p> <p>\u5018\u82e5\u4f60\u900f\u904e\u9019\u500b\u65b9\u5f0f\u53bb\u8a2a\u554f <code>https://ifconfig.me</code> \u7684\u8a71\uff0c\u56e0\u70ba\u51fa Internet \u6703\u53d7 Azure Firewall SNAT \u7684\u5f71\u97ff\uff0c\u6545\u6703\u7372\u5f97\u5230 Azure Firewall \u7684 Public IP: 1.2.3.4\uff0c\u5982\u4e0b\u5716</p> <p></p> <p>\u5982\u679c\u4f60\u6709\u958b Azure Firewall IDPS \u7684\u529f\u80fd\u7684\u8a71\uff0c\u6d41\u91cf\u90fd\u6703\u88ab\u6aa2\u67e5\u5230</p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#case-4-ssh","title":"Case 4: SSH \u591a\u6bb5\u8df3\u8e8d","text":"<p>\u6838\u5fc3\u6280\u8853: DNAT + SSH ProxyCommand</p> <p>\u9019\u500b\u6703\u7528\u5230 ssh \u5167\u5efa\u7684 <code>ProxyCommand</code> \u7684\u529f\u80fd\uff0c\u4e5f\u7b97\u5be6\u7528\u6280\u5de7\uff0c\u500b\u4eba\u5efa\u8b70\u662f\u597d\u597d\u5beb <code>~/.ssh/config</code> \u4f86\u7ba1\u7406\uff0c\u4e0d\u7136\u8df3\u5230\u5f8c\u9762\u6703\u5f88\u4e82</p> <pre><code>Host azhome\n    HostName 1.2.3.4\n    Port 5566\n    User pichuang\n    IdentityFile ~/.ssh/id_rsa\n    DynamicForward 1080\n\nHost target-vm\n    HostName 10.0.0.5\n    User pichuang\n    Port 22\n    ProxyCommand ssh -W %h:%p azhome\n</code></pre> <p>\u5982\u679c\u4f60\u662f Ansible \u7684\u611b\u7528\u8005\uff0c\u4e5f\u53ef\u4ee5\u57fa\u65bc\u6b64\u6587\uff0c\u591a\u65b0\u589e <code>ansible_ssh_common_args: '-o ProxyCommand=\"ssh -W %h:%p -q pichuang@1.2.3.4\"'</code> \u4f86\u8df3</p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#_2","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u56e0\u70ba\u8fd1\u671f\u773c\u775b\u9178\u901a\uff0c\u6628\u65e5\u53bb\u770b\u773c\u79d1\uff0c\u91ab\u751f\u8aaa\u6211\u773c\u775b\u90fd\u5145\u6eff\u8457\u8840\u7d72\uff0c\u662f\u4e0d\u662f\u58d3\u529b\u592a\u5927\u4e86?</p> <p>OS: \u6c92\u60f3\u5230\u9023\u773c\u79d1\u91ab\u751f\u90fd\u770b\u5f97\u51fa\u4f86 (?)</p>","tags":["networking","ssh","azure"]},{"location":"20240130-ssh-tunneling.html#references","title":"References","text":"<ul> <li>Azure Bastion SKU</li> <li>The Azure\ud83c\udf0d hub-and-spoke-playground</li> <li>Ansible - How do I configure a jump host to access servers that I have no direct access to?</li> </ul>","tags":["networking","ssh","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html","title":"\u60f3\u8981\u81ea\u5efa ChatGPT \u670d\u52d9\u55ce?","text":"<p>\u8981\u8a02\u95b1 OpenAI ChatGPT Plus \u4e00\u500b\u6708\u4e00\u500b\u4eba\u8cbb\u7528\u9700\u8981 20 \u7f8e\u5143, \u96a8\u8457\u4e00\u5e74\u5167 Azure OpenAI \u670d\u52d9\u5df2\u7d93\u9678\u9678\u7e8c\u7e8c\u5c0d\u9f4a\u63d0\u4f9b\u4e86, \u6211\u60f3\u4e5f\u662f\u6642\u5019\u8981\u628a ChatGPT Plus \u9000\u8a02\u63db\u6210\u81ea\u5df1\u7528 Azure OpenAI \u67b6\u7684 ChatGPT \u670d\u52d9\u8d77\u4f86\u81ea\u7528\u4e86, \u540c\u6642\u4e5f\u89c0\u5bdf\u4e00\u4e0b\u6210\u672c\u7bc0\u7d04\u7684\u72c0\u6cc1, \u7d93\u904e\u9069\u7576\u8a2d\u8a08\u4e0b, \u55ae\u7d14\u81ea\u7528\u7684\u8a71, \u9084\u883b\u51fa\u4e4e\u610f\u6599\u7684\u4fbf\u5b9c, \u4e00\u500b\u6708\u9084\u4e0d\u5230 1 \u7f8e\u5143</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#3-1","title":"\u53ea\u9700\u8981 3 + 1 \u500b\u5fc5\u8981\u6750\u6599","text":"<ol> <li>\u9078\u64c7 ChatGPT WebUI Project</li> <li>\u7533\u8acb Azure OpenAI Service</li> <li>\u90e8\u7f72 Azure Container App</li> <li>(Optional) \u8a2d\u5b9a Custom Domain Name</li> </ol> <p>\u5c31\u80fd\u8a95\u751f\u51fa\u4e0b\u9762\u7684\u670d\u52d9\u5594~</p> <p></p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#_1","title":"\u90e8\u7f72\u6d41\u7a0b\u91cd\u9ede\u63d0\u793a","text":"<p>\u56e0\u70ba\u6b63\u5e38\u6c92\u4eba\u6703\u60f3\u8981\u770b\u4e00\u500b\u52d5\u4f5c\u4e00\u500b\u622a\u5716, \u6240\u4ee5\u4e0b\u9762\u7684\u6d41\u7a0b\u53ea\u622a\u91cd\u8981\u90e8\u5206, \u8f14\u4ee5\u6587\u5b57\u8aaa\u660e, \u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u8a66\u8a66</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#1-chatgpt-webui-project","title":"1. \u9078\u64c7 ChatGPT WebUI Project","text":"<p>\u9019\u908a\u5efa\u8b70\u53ef\u4ee5\u5f9e GitHub Toptics - chatgpt-ui \u4e0a\u627e\u5230\u4e00\u500b\u4f60\u559c\u6b61\u4e14\u6709\u652f\u63f4 Azure OpenAI Service \u7684\u5c08\u6848, \u6211\u500b\u4eba\u9078\u64c7\u63a1\u7528 ChatGPTNextWeb/ChatGPT-Next-Web \u9019\u500b\u5c08\u6848, \u4e5f\u7528\u4e86\u4e00\u6bb5\u6642\u9593\u4e86, \u652f\u63f4\u7684\u529f\u80fd\u4e5f\u76f8\u7576\u591a\u6a23, \u53ef\u4ee5\u900f\u904e\u8a72\u7db2\u7ad9\u770b\u4e00\u4e0b\u5c55\u793a app.nextchat.dev</p> <p>\u53e6\u5916\u9078\u64c7\u5c08\u6848\u7684\u6642\u5019, \u8981\u6ce8\u610f\u90a3\u500b Endpoint \u548c Key \u662f\u4e0d\u662f\u8981\u6bcf\u4e00\u500b User \u81ea\u5df1\u586b\u9032\u53bb, \u5efa\u8b70\u9084\u662f\u653e\u5230 Backend \u585e\u5230\u74b0\u5883\u8b8a\u6578\u8655\u7406\u6bd4\u8f03\u597d, \u4e0d\u8981\u8b93 User \u81ea\u5df1\u586b, \u56e0\u70ba\u5149\u91d1\u9470\u7ba1\u7406\u5c31\u6703\u6709\u4e00\u5806\u554f\u984c</p> <p>\u7576\u7136\u9084\u6709\u4e00\u4e9b\u985e\u4f3c\u7684\u5c08\u6848\u4e5f\u53ef\u4ee5\u505a\u5230\u4e00\u6a23\u7684\u4e8b\u60c5</p> <ul> <li>mckaywrigley/chatbot-ui: \u9019\u500b\u5f9e\u4fdd\u54e5\u90a3\u908a\u770b\u5230\u7684, \u770b\u8d77\u4f86\u4e5f\u53ef\u53c3\u8003</li> <li>blrchen/chatgpt-lite: \u9019\u5c08\u6848\u5370\u8c61\u6c92\u932f\u7684\u8a71, \u61c9\u8a72\u662f\u5fae\u8edf\u540c\u4e8b\u5beb\u7684, \u4e5f\u53ef\u4ee5\u7528</li> </ul>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#2-azure-openai-service","title":"2. \u7533\u8acb Azure OpenAI Service","text":"<p>\u9996\u5148, \u4f60\u5f97\u8981\u5148\u7533\u8acb\u5230 Azure OpenAI \u7684\u670d\u52d9, \u7121\u8ad6\u662f gpt-35 \u9084\u662f gpt-4 \u90fd\u53ef\u4ee5, \u56e0\u70ba\u6700\u8fd1\u6211\u624d\u62ff\u5230 <code>gpt-4-32k</code> \u7684\u984d\u5ea6, \u6240\u4ee5\u5c31\u8d81\u5347\u7d1a\u7cfb\u7d71\u7684\u6642\u5019\u9806\u4fbf\u5beb\u4e86\u6b64\u7bc7\u6587\u7ae0</p> <p>\u9019\u908a\u8981\u6ce8\u610f\u7684\u662f<code>\u90e8\u7f72\u540d\u7a31 (Deployment Name)</code>\u548c<code>\u6a21\u578b\u540d\u7a31 (Model Name)</code>\u7684\u5dee\u7570, \u6211\u500b\u4eba\u7fd2\u6163\u6703\u628a\u547d\u540d\u505a\u5340\u9694\u7684\u8a71, \u4e0d\u7136\u6df7\u518d\u4e00\u8d77\u5f88\u96e3\u5224\u65b7\u662f\u8ab0\u6709\u554f\u984c, \u5982\u524d\u8005\u70ba <code>deploymnet-gpt-4-32k</code>, \u5f8c\u8005\u70ba <code>gpt-4-32k</code></p> <p>\u6839\u64da Azure OpenAI Service REST API reference, \u90a3\u4f60\u8981\u8f38\u5165 <code>AZURE_URL</code> \u7684\u8b8a\u6578\u5247\u6703\u8b8a\u6210\u4e0b\u5217\u683c\u5f0f, \u800c\u4e0d\u9700\u4f7f\u7528\u5230 <code>Model Name</code>, \u9019\u9ede\u61c9\u8a72\u662f\u5927\u90e8\u5206\u5f9e OpenAI \u8f49\u63db\u5230 Azure OpenAI \u7684\u4eba\u90fd\u6703\u649e\u5230\u7684\u7b2c\u4e00\u500b\u554f\u984c</p> <pre><code># POST https://YOUR_RESOURCE_NAME.openai.azure.com/openai/deployments/YOUR_DEPLOYMENT_NAME/\nhttps://pichuang.openai.azure.com/openai/deployments/deploymnet-gpt-4-32k\n</code></pre> <p>\u554a\u5982\u679c\u4f60\u6709\u770b\u5230\u7db2\u5740\u5f8c\u9762\u63a5 <code>Model Name</code> \u7684\u8a71, \u90a3\u500b\u662f\u4e00\u500b\u8aa4\u6703, \u56e0\u70ba\u8a2d\u5b9a\u7684\u4eba <code>Deployment Name</code> \u53d6\u8ddf <code>Model Name</code> \u4e00\u6a23\u7684\u540d\u5b57, \u5982\u5716\u7684 <code>gpt-35-turbo-16k</code></p> <pre><code># POST https://YOUR_RESOURCE_NAME.openai.azure.com/openai/deployments/YOUR_DEPLOYMENT_NAME/\nhttps://pichuang.openai.azure.com/openai/deployments/gpt-35-turbo-16k\n</code></pre>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#3-azure-container-app","title":"3. \u65b0\u589e Azure Container App","text":"","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#31-basic","title":"3.1 Basic","text":"<p>\u95dc\u65bc <code>3</code>, \u9078\u64c7\u9130\u8fd1\u5340\u57df, \u9019\u500b\u6709 2 \u500b\u9078\u64c7, \u4e00\u500b\u662f\u96e2 End user \u8fd1, \u53e6\u4e00\u500b\u662f\u9078\u96e2 Azure OpenAI Endpoint \u7684\u9ede\u8fd1, \u6211\u500b\u4eba\u662f\u9078\u64c7\u96e2 End user \u8fd1\u7684, \u56e0\u70ba\u6211\u500b\u4eba\u76f8\u4fe1 Microsoft Backbone (MSBB) \u7684\u80fd\u529b, \u7cbe\u78ba\u7684\u6578\u5b57\u53ef\u4ee5\u53c3\u8003\u6b64\u6587 Azure network round-trip latency statistics</p> <p>\u95dc\u65bc <code>4</code>, \u88e1\u9762\u6709\u76f8\u7576\u591a\u53ef\u4ee5\u9078\u7684\u5730\u65b9, \u5f37\u70c8\u5efa\u8b70\u53c3\u8003 Azure Container Apps environments \u9032\u884c\u9078\u64c7, \u7c21\u55ae\u5206\u985e\u5c31\u662f\u81ea\u5df1\u4e0a\u73ed\u7528\u9078 <code>Consumption only</code>, \u9810\u671f\u4e00\u5806\u4eba\u8981\u7528\u5f97\u9078 <code>Workload profile</code> \u6216\u8005\u662f\u4f60\u53ef\u4ee5\u8003\u616e\u63db\u6210 Azure Kuberenetes Service \u67b6\u69cb</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#32-container","title":"3.2 Container","text":"<p>\u95dc\u65bc <code>3 ~ 6</code>, \u56e0\u70ba\u6211\u4f7f\u7528\u7684 ChatGPT WebUI \u5c08\u6848\u662f\u7528 ChatGPTNextWeb/ChatGPT-Next-Web, \u800c\u4ed6\u7684 Container Images \u662f\u4f4d\u65bc <code>docker.io/yidadaa/chatgpt-next-web:latest</code>, \u5982\u679c\u662f\u500b\u4eba\u7528\u5247\u628a\u8a72\u586b\u5beb\u7684\u6b04\u4f4d\u586b\u9032\u53bb\u5373\u53ef, \u4f46\u5982\u679c\u662f\u4f01\u696d\u7528\u6216\u8005\u662f\u4e00\u5806\u4eba\u7528\u7684\u8a71, \u7562\u7adf\u9084\u662f\u6709\u5b89\u5168\u7591\u616e\u9700\u8981\u8655\u7406, \u5efa\u8b70\u53e6\u5916\u62c9\u53bb Azure Container Registry \u7528 Microsoft Defender for Container \u6383\u4e00\u6383\u5f8c\u518d\u62c9\u4e0b\u4f86\u7528</p> <p>\u95dc\u65bc container image tag <code>latest</code>, \u56e0\u70ba\u500b\u4eba\u61f6\u5f97\u76ef\u8457\u7248\u672c\u865f, \u6240\u4ee5\u624d\u7528 <code>latest</code>, \u5982\u679c\u662f\u4f01\u696d\u7528\u6216\u8005\u662f\u7d66\u4e00\u5806\u4eba\u7528\u7684\u8a71, \u5efa\u8b70\u9084\u662f\u7528\u7248\u672c\u865f, \u548c\u5efa\u7acb Dev \u74b0\u5883, \u78ba\u4fdd\u5347\u7d1a\u4e0d\u6703\u6709\u554f\u984c</p> <p>\u95dc\u65bc Image Tags \u53ef\u4ee5\u53bb Docker Hub \u67e5\u770b, \u6216\u8005\u662f\u53ef\u4ee5\u4f7f\u7528 <code>skopeo</code> \u6307\u4ee4\u7684\u65b9\u5f0f\u4f86\u770b</p> skopeo-inspect.sh<pre><code>$ skopeo inspect docker://docker.io/yidadaa/chatgpt-next-web:latest --override-os linux --override-arch amd64 | jq '.RepoTags'\n[\n  \"1.7.2\",\n  \"latest\",\n  \"v1.5\",\n  \"v1.6\",\n  ...\n</code></pre> <p>\u82e5\u628a <code>8~9</code> \u4e5f\u653e\u9032\u53bb\u53c3\u8003\u7684\u8a71, \u4ee5 Kubernetes \u8868\u793a\u65b9\u5f0f\u4f86\u770b, \u4e0b\u9762\u7684\u8a2d\u5b9a\u6703\u7b49\u50f9\u65bc\u756b\u9762\u4e0a\u6240\u9700\u7684\u8a2d\u5b9a</p> pod-container-app.yaml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: container-nextchat\nspec:\n  containers:\n  - name: container-nextchat\n    image: docker.io/yidadaa/chatgpt-next-web:latest\n      requests:\n        cpu: \"1\"\n        memory: \"2Gi\"\n    env:\n    - name: AZURE_URL\n      value: \"https://pichuang.openai.azure.com/openai/deployments/deploymnet-gpt-4-32k\"\n    - name: AZURE_API_VERSION\n      value: \"2023-05-15\"\n</code></pre>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#33-ingress","title":"3.3 Ingress","text":"<p>\u95dc\u65bc <code>2</code>, \u56e0\u70ba\u672c\u6587\u6703\u628a\u670d\u52d9\u653e\u5728 Internet \u4e4b\u4e0a, \u6240\u4ee5 <code>Ingress Traffic</code> \u7684\u9078\u9805\u9078\u64c7 \"Accepting traffic from anywhere\", \u5982\u679c\u4f60\u4e0d\u8981\u8b93\u9019\u500b\u670d\u52d9\u653e\u5728\u5916\u7db2\u7684\u8a71, \u5247\u9700\u8981\u56de\u5230\u7b2c\u4e00\u9801\u7684 <code>Container Apps Environment</code> \u8981\u9032\u884c\u7db2\u8def\u4fee\u6539\u70ba <code>Internal</code> \u548c\u7d81\u4e0a\u7279\u5b9a\u7684 <code>Virtual Network</code></p> <p>\u95dc\u65bc <code>3</code>, ChatGPTNextWeb/ChatGPT-Next-Web \u670d\u52d9\u662f HTTP \u70ba\u4e3b\u7684, \u6240\u4ee5\u9078\u64c7 <code>HTTP</code> \u5373\u53ef</p> <p>\u95dc\u65bc <code>6</code>, \u5efa\u8b70\u95dc\u6389 <code>Insecure connections</code> \u9019\u500b\u9078\u9805, \u9019\u6a23\u53ef\u4ee5\u78ba\u4fdd\u9023\u7dda\u90fd\u662f\u8d70 HTTPs \u70ba\u4e3b</p> <p>\u95dc\u65bc <code>7</code>, <code>Target Port</code> \u9700\u8981\u586b\u5beb\u7684\u662f\u6703\u88ab Expose \u51fa\u4f86\u7684 Port, \u901a\u5e38\u53ef\u4ee5\u5f9e Dockefile \u4e0a\u627e\u5230\u7b54\u6848, \u6216\u8005\u662f\u770b docker-compose \u4e0a\u7684 ports \u4e5f\u53ef\u4ee5</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#4-azure-openai-key-next-chat","title":"4. \u8a2d\u5b9a Azure OpenAI Key \u548c Next Chat \u901a\u95dc\u5bc6\u8a9e","text":"<p>\u82e5\u8981\u5728 Azure Container App \u4e0a\u8a2d\u5b9a Secrets, \u5982\u8a2d\u5b9a Azure OpenAI Key \u548c\u901a\u95dc\u5bc6\u8a9e\u7b49, \u9700\u8981\u7b49\u5efa\u7acb\u8d77\u4f86\u5f8c\u624d\u80fd\u8a2d\u5b9a</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#41-add-secrets","title":"4.1 Add Secrets","text":"<p>\u9019\u908a\u5efa\u8b70\u6703\u8a2d\u5b9a 2 \u500b Secrets, \u540d\u5b57\u53ef\u4ee5\u5148\u4e82\u53d6, \u5206\u5225\u662f:</p> <ol> <li>azure-api-key: \u76ee\u7684\u9023\u63a5 Azure OpenAI Service \u6642\u9700\u8981\u4f7f\u7528\u7684\u91d1\u9470</li> <li>entry-code: \u901a\u95dc\u5bc6\u8a9e, \u5982\u679c\u4e0d\u8a2d\u5b9a\u6216\u8005\u662f\u4e0d\u4f7f\u7528 Authentication and authorization in Azure Container Apps, \u5247\u6703\u6709\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u76f4\u63a5\u53bb\u6478\u5230\u9019\u500b\u7db2\u7ad9, \u5c0e\u81f4 GPT Token \u6703\u88ab\u5feb\u901f\u6d88\u8017, \u8a73\u7d30\u8a2d\u5b9a\u53ef\u53c3\u8003 ChatGPT-Next-Web - CODE</li> </ol> <p>\u9019\u500b\u756b\u9762\u7684\u8a2d\u5b9a\u6548\u679c, \u8ddf\u5728 Kubernetes \u4e0a\u5efa\u7acb secret \u8a2d\u5b9a Opaque Secrets \u7684\u52d5\u4f5c\u662f\u7b49\u50f9\u7684, \u5982\u4e0b\u9762\u8868\u793a:</p> <pre><code>$ kubectl create secret generic secret-continaer-app \\\n    --from-literal=azure-api-key=YOUR_AZURE_OPENAI_KEY \\\n    --from-literal=entry-code=YOUR_ENTRY_CODE\n</code></pre>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#42-add-environment-variables","title":"4.2 Add Environment Variables","text":"<p>\u63a5\u4e0b\u4f86\u9700\u8981\u628a <code>4.1 Add Secrets</code> \u6240\u5efa\u7acb\u7684\u5bc6\u9470, \u653e\u5230 <code>Environment Variables</code> \u88e1\u9762, \u9019\u6a23\u624d\u80fd\u8b93 Container App \u4f7f\u7528\u5230\u9019\u5e7e\u500b\u53c3\u6578, \u5982\u679c\u7528 Kubernetes \u8868\u793a\u65b9\u5f0f\u4f86\u770b, \u4e0b\u9762\u7684\u8a2d\u5b9a\u6703\u7b49\u50f9\u65bc\u756b\u9762\u4e0a\u6240\u9700\u7684\u8a2d\u5b9a:</p> pod-container-app.yaml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  name: container-nextchat\nspec:\n  containers:\n  - name: container-nextchat\n    image: docker.io/yidadaa/chatgpt-next-web:latest\n      requests:\n        cpu: \"1\"\n        memory: \"2Gi\"\n    env:\n    - name: AZURE_URL\n      value: \"https://pichuang.openai.azure.com/openai/deployments/deploymnet-gpt-4-32k\"\n    - name: AZURE_API_VERSION\n      value: \"2023-05-15\"\n    - name: AZURE_API_KEY\n      valueFrom:\n        secretKeyRef:\n          name: secret-continaer-app\n          key: azure-api-key\n    - name: AZURE_ENTRY_CODE\n      valueFrom:\n        secretKeyRef:\n          name: secret-continaer-app\n          key: entry-code\n</code></pre>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#5-optional-add-custom-domain-name","title":"5. (Optional) Add Custom Domain Name","text":"<p>\u70ba\u4e86\u8b93\u5927\u5bb6\u65b9\u4fbf\u597d\u5b58\u53d6, \u5efa\u8b70\u90fd\u6703\u653e\u81ea\u5df1\u7684 Domain \u4e0a\u53bb, \u9019\u6a23\u53ef\u4ee5\u8b93\u5927\u5bb6\u66f4\u5bb9\u6613\u8a18\u4f4f, Domain \u7684\u4f86\u6e90\u4e0d\u4e00\u5b9a\u662f\u8981\u5f9e Azure \u4e0a\u8cb7, \u6216\u8005\u662f\u8a3b\u518a\u5230 Azure Public DNS Zone \u7684\u670d\u52d9, \u4f60\u53ea\u8981\u78ba\u4fdd\u8a72 Domain \u662f\u7531\u4f60\u63a7\u5236\u7684\u5373\u53ef</p> <p>\u6211\u9084\u662f\u5f88\u63a8\u85a6 Domain \u6216 Sub-domain \u59d4\u6d3e (Delegation) \u7d66 Azure Public DNS \u7ba1\u7406, \u8981\u653e\u5c0d\u5916\u670d\u52d9\u7684\u6642\u5019, \u4fbf\u5b9c\u65b9\u4fbf\u9084\u5b89\u5168, \u9084\u662f\u552f\u4e00\u4e00\u500b SLA 100% \u7684\u670d\u52d9</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#51-setting-up-dns","title":"5.1 Setting Up DNS","text":"<p>\u95dc\u65bc <code>4</code>, \u57fa\u65bc Custom domain names and free managed certificates in Azure Container Apps (preview), Azure Container App \u6703\u514d\u8cbb\u63d0\u4f9b\u4e00\u5f35\u53d7 Azure \u63a7\u7ba1\u7684 SSL \u6191\u8b49</p> <p>\u95dc\u65bc <code>5</code>, \u9019\u908a\u9700\u8981\u6c7a\u5b9a\u4f60\u7684\u7db2\u7ad9\u540d\u7a31\u8981\u53eb\u4ec0\u9ebc, \u5982 <code>helloworld.pichuang.com.tw</code>, \u4e4b\u5f8c\u8981\u4f7f\u7528\u8a72\u670d\u52d9\u7684\u8a71\u5247\u6703\u9700\u8981\u4f7f\u7528 <code>https://helloworld.pichuang.com.tw</code> \u4f86\u5b58\u53d6</p> <p>\u95dc\u65bc <code>7~8</code>, \u9019\u500b\u662f\u4f60\u9700\u8981\u53bb\u4f60\u7ba1\u7406\u7684 Domain \u90a3\u908a, \u5206\u5225\u628a CNAME \u548c TXT \u52a0\u9032\u53bb\u5230 Zone File \u5167, \u7136\u5f8c\u7b49\u5f85 DNS \u7684\u66f4\u65b0\u5f8c, \u518d\u6309 Validate \u624d\u6703\u751f\u6548</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#52-check-dns-validation","title":"5.2 Check DNS validation","text":"<p>\u6574\u9ad4\u751f\u6548\u6642\u9593\u5927\u6982\u7d04\u7565 15 \u5206\u9418, \u6b63\u78ba\u904b\u4f5c\u7684\u8a71\u4f60\u61c9\u8a72\u6703\u770b\u5230\u4e0a\u9762\u7684\u756b\u9762, \u9019\u6a23\u5c31\u53ef\u4ee5\u7528 <code>https://helloworld.pichuang.com.tw</code> \u4f86\u5b58\u53d6\u4f60\u7684 ChatGPT \u670d\u52d9\u4e86</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#qa","title":"Q&amp;A","text":"","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#q1-container-azure-red-hat-openshift-azure-kubernetes-service","title":"Q1: \u65e2\u7136\u662f Container \u670d\u52d9, \u70ba\u4f55\u4e0d\u8981\u7528 Azure Red Hat OpenShift \u6216 Azure Kubernetes Service?","text":"<p>\u6280\u8853\u4e0a\u5169\u8005\u7686\u53ef\u4ee5, \u4f46\u6211\u9019\u500b\u670d\u52d9\u662f\u8a2d\u8a08\u6210\u7368\u7acb\u670d\u52d9\u4f7f\u7528, \u4e0d\u9700\u8981\u4f7f\u7528\u5230 Kubernetes API \u6216 Ingress \u76f8\u95dc\u7684\u80fd\u529b, \u6240\u4ee5\u4e0d\u9078 Azure Kubernetes Serivce \u6216 Azure Red Hat OpenShift. \u53e6\u4e00\u500b\u7406\u7531\u5c31\u662f\u516c\u53f8\u6c92\u767c\u7d66\u6211\u9019\u9ebc\u591a\u984d\u5ea6\u53ef\u4ee5\u7528, \u8d85\u904e\u6703\u76f4\u63a5\u5c01\u5e33\u865f...\u56e0\u70ba\u6211 2023/12/31 \u88ab\u5c01\u4e86\u4e00\u6b21</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#q2-domain-name","title":"Q2: \u6211\u6c92\u6709\u81ea\u5df1\u7684 Domain Name, \u9084\u53ef\u4ee5\u7528\u9019\u500b\u505a\u6cd5\u55ce?","text":"<p>\u53ef\u4ee5, Azure Container App \u6703\u63d0\u4f9b\u7d66\u4f60 <code>http://&lt;projectname&gt;.&lt;\u6211\u4e5f\u4e0d\u77e5\u9053\u662f\u4ec0\u9ebc\u610f\u601d\u7684\u57df\u540d&gt;.&lt;\u5340\u57df&gt;.azurecontainerapps.io</code> \u7684\u7db2\u5740, \u4f60\u53ef\u4ee5\u76f4\u63a5\u7528\u9019\u500b\u7db2\u5740\u4f86\u4f7f\u7528\u4f60\u7684 ChatGPT. \u9806\u4fbf\u4e00\u63d0, \u4ed6\u6709\u5305\u542b SSL \u6191\u8b49, \u6240\u4ee5\u4f60\u7684\u9023\u7dda\u662f\u5b89\u5168\u7684</p> <p>\u5012\u662f\u9019\u5e74\u982d\u8cb7\u4e00\u500b\u81ea\u5df1\u7684 Domain \u5f88\u4fbf\u5b9c\u5440, \u627e Gandi \u9084\u662f\u54ea\u5bb6\u8cb7\u4e00\u500b, \u7136\u5f8c nameserver \u6307\u5230 Azure Public DNS \u4e0a, \u5927\u90e8\u5206 Azure \u670d\u52d9\u6709 Custom Domain \u7684\u80fd\u529b, \u6709\u9700\u8981 TLS \u7684\u8a71, \u90fd\u6703\u9806\u4fbf\u5e6b\u4f60\u7528 DigiCert \u7c3d\u4e0a\u53bb, \u63a8\u85a6\u8cb7\u4e00\u500b\u653e\u4e0a\u53bb\u6216\u8005\u662f\u5207\u4e00\u500b subdomain ns \u6307\u4e0a\u53bb\u4e5f\u53ef\u4ee5</p> <p></p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#q3-nextchatgpt","title":"Q3: \u6211\u89ba\u5f97 NextChatGPT \u7684\u901a\u95dc\u5bc6\u8a9e\u592a\u5f31\u4e86, \u6709\u6c92\u6709\u66f4\u597d\u7684\u505a\u6cd5?","text":"<p>\u57fa\u65bc Authentication and authorization in Azure Container Apps, \u4f60\u53ef\u4ee5\u639b Microsoft Entra ID \u7684\u8a8d\u8b49\u65b9\u5f0f\u4e0a\u53bb, \u9019\u6a23\u5c31\u53ef\u4ee5\u7528\u516c\u53f8\u7684\u5e33\u865f\u5bc6\u78bc\u624d\u80fd\u767b\u5165, \u9019\u6a23\u5c31\u4e0d\u7528\u64d4\u5fc3\u5bc6\u78bc\u592a\u5f31\u7684\u554f\u984c\u4e86</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#q4-nexchatgpt","title":"Q4: \u5982\u679c\u6211\u4e0d\u7528 NexChatGPT \u9019\u500b\u5c08\u6848, \u60f3\u63db\u6210\u5225\u7684\u5c08\u6848, \u6709\u4ec0\u9ebc\u9700\u8981\u6ce8\u610f\u7684\u5730\u65b9\u55ce?","text":"<p>\u4e00\u822c\u4f86\u8aaa, \u9664\u4e86\u8981\u5148\u77e5\u9053\u8a72\u5c08\u6848\u662f\u5426\u6709\u652f\u63f4 Azure OpenAI \u4ee5\u5916, \u5176\u6b21\u9084\u6703\u627e\u770b\u6709\u6c92\u6709 <code>docker-compose.yaml</code> \u53ef\u4ee5\u770b, \u6240\u6709\u555f\u52d5\u6240\u9700\u8981\u7684\u8cc7\u8a0a\u90fd\u6703\u5beb\u5728\u88e1\u9762, \u5982 Environment Variables, port, volume \u7b49, \u518d\u4e0d\u884c\u7684\u8a71, \u5c31\u662f\u8981\u5206\u6790 Dockerfile \u548c\u4ed6\u7684\u74b0\u5883\u8b8a\u6578, \u7136\u5f8c\u8a55\u4f30\u662f\u4e0d\u662f\u6709\u4e9b\u8b8a\u6578\u904e\u65bc\u654f\u611f, \u5982 API Key \u7b49, \u9700\u8981\u653e\u5728 Azure Container App \u7684 Secret \u6216\u63a1\u7528 Azure Key Vault \u4f86\u5b58\u653e, \u63d0\u5347\u5b89\u5168\u6027</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#q5","title":"Q5: \u8cbb\u7528\u5f88\u8cb4\u55ce?","text":"<p>\u6211\u7528\u91cf\u4e0d\u662f\u5f88\u5927\u7684\u90a3\u7a2e, \u4e0d\u662f\u5929\u5929\u90fd\u5728\u7814\u7a76 OpenAI \u7684\u4f7f\u7528\u6280\u8853, \u6240\u4ee5\u6bcf\u500b\u6708\u6574\u9ad4\u7528\u91cf\u5f88\u5c11, \u5982\u679c\u4f60\u8ddf\u6211\u6709\u4e00\u6a23\u7684\u884c\u70ba\u6a21\u5f0f, \u53ef\u4ee5\u53c3\u8003\u4e0b\u9762 2 \u500b 2024/01 \u7684\u5be6\u969b\u8cbb\u7528, \u4ee5\u7f8e\u91d1\u8a08\u50f9</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#azure-container-app","title":"Azure Container App","text":"","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#azure-openai-service","title":"Azure OpenAI Service","text":"","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#_2","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u904e\u5e74\u4f86\u4e86, \u9019\u5e7e\u5e74\u7684\u904e\u5e74\u8003\u984c\u5f9e \"\u5973\u53cb\u5462?\", \"\u8001\u5a46\u5728\u54ea\u88e1\", \"\u5c0f\u670b\u53cb\u5728\u54ea\u88e1?\" \u8b8a\u6210 \"\u5c0f\u670b\u53cb\u5148\u6709, \u5176\u4ed6\u5f8c\u9762\u88dc\u6c92\u95dc\u4fc2 (\u7591?)\", \u771f\u842c\u842c\u6c92\u60f3\u5230\u5c11\u5b50\u5316\u554f\u984c\u5df2\u7d93\u9ad8\u904e\u4e00\u5207\u4e86</p> <p>\u56e0\u70ba\u5831\u5c0e\u8005\u4e4b\u524d\u6709\u51fa\u904e\u4e00\u7bc7 \u3010\u6536\u990a\u70ba\u4f55\u90a3\u9ebc\u96e3\u3011\u4e00\u5e74\u534a\u7684\u7b49\u5f85\u3001\u55ae\u8eab\u548c\u5e74\u9f61\u6f5b\u898f\u5247\uff0c\u6536\u990a\u5c64\u5c64\u95dc\u5361\u7684\u60c5\u8207\u7406 \u7684\u5831\u5c0e, \u624d\u767c\u73fe\u6536\u990a\u9019\u9084\u771f\u7684\u662f\u4e0d\u5bb9\u6613</p>","tags":["chatgpt","openai","azure"]},{"location":"20240203-own-chatgpt-ui-with-azure-openai.html#references","title":"References","text":"<ul> <li>ChatGPTNextWeb/ChatGPT-Next-Web</li> <li>Authentication and authorization in Azure Container Apps</li> <li>GitHub - ChatGPT</li> </ul>","tags":["chatgpt","openai","azure"]},{"location":"20240206-podman-desktop-on-mac-m3.html","title":"Apple M3 \u4e0a\u7684 Podman Desktop \u7d42\u65bc\u53ef\u4ee5\u7528\u5566!","text":"<p>\u5982\u679c\u4f60\u8ddf\u6211\u4e00\u6a23\u662f Apple M3 \u7cfb\u5217\u7684\u4f7f\u7528\u8005\uff0c\u5e73\u6642\u6709\u4e0d\u5c11\u5de5\u4f5c\u9700\u8981\u4ef0\u8cf4\u8dd1 Container \u4f86\u5b8c\u6210\u7684\uff0c\u90a3\u6211\u76f8\u4fe1\u4f60\u4e00\u5b9a\u6703\u5c0d 2024/1/24 Podman Desktop Release 1.7 \u7684\u91cb\u51fa\u611f\u5230\u958b\u5fc3\uff0c\u9019\u500b\u7248\u672c\u4fee\u5fa9\u4e86 QEMU on Apple M3 \u7684\u554f\u984c\uff0c\u8b93\u6211\u5011\u53ef\u4ee5\u5728 M3 \u4e0a\u4f7f\u7528 Podman \u8dd1 Container \u4e86!</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#podman-desktop","title":"Podman Desktop \u4f7f\u7528\u5834\u666f","text":"<p>\u5e38\u898b\u4f7f\u7528\u5834\u666f:</p> <ol> <li>\u55ae\u7368\u628a\u4e00\u500b Container \u653e\u5230 Podman Container Engine \u4e0a\u904b\u884c</li> <li>\u628a Container \u8f49\u6210 Pod \u653e\u5230 Local Kubernetes \u74b0\u5883\u4e0a\u904b\u884c, \u5982 OpenShift Local / KIND / Minikube \u4e0a\u904b\u884c</li> <li>\u628a Container \u8f49\u6210 Pod \u653e\u5230 Podman Container Engine \u74b0\u5883\u4e0a\u904b\u884c\uff0c\u7136\u5f8c\u518d\u90e8\u7f72\u5230 Kubernetes \u4e0a</li> <li>\u4f7f\u7528 Docker Desktop Extension \u5e38\u898b\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u6383\u63cf\u6f0f\u6d1e\u7b49</li> <li>\u7de8\u8b6f Container Images</li> </ol>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#1-container","title":"1. \u55ae\u7368\u8dd1\u4e00\u500b Container","text":"<p>\u4e00\u500b\u76f8\u7576\u7d93\u5178\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u9019\u908a\u4ee5\u6211\u81ea\u5df1\u7dad\u8b77\u7684 pichuang/debug-container \u70ba\u4f8b\uff0c\u4e0a\u5716\u7684\u64cd\u4f5c\u6703\u7b49\u540c\u65bc\u4e0b\u9762\u6307\u4ee4</p> podman-run<pre><code>$ docker pull ghcr.io/pichuang/debug-container:master\n$ podman pull ghcr.io/pichuang/debug-container:master\n\n$ docker images --filter reference=debug-container\n$ podman images --filter reference=debug-container\nREPOSITORY                        TAG         IMAGE ID      CREATED       SIZE\nghcr.io/pichuang/debug-container  master      127df4e7af3f  12 hours ago  713 MB\n\n$ docker run -it --privileged --rm ghcr.io/pichuang/debug-container:master\n$ podman run -it --privileged --rm ghcr.io/pichuang/debug-container:master\n[root@2ae1a1c62ba3 ~]#\n</code></pre> <p></p> <p>\u662f\u6beb\u7121\u61f8\u5ff5\u5730\u4f7f\u7528\u65b9\u5f0f\uff0c\u8ddf\u6307\u4ee4\u7684\u5dee\u7570\u5c31\u662f\u6709 Desktop \u53ef\u4ee5\u7528\u6ed1\u9f20\u9ede\u4e00\u9ede\u64cd\u4f5c\u5c31\u5b8c\u6210\u4e86</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#2-container-pod-kubernetes-cluster","title":"2. \u628a Container \u8f49\u63db Pod \u585e\u5230 <code>Kubernetes cluster</code> \u74b0\u5883\u4e0a\u904b\u884c","text":"<p>\u5dee\u7570\u5c31\u662f\u628a\u5b9a\u7fa9\u597d\u7684 <code>debug-container.yaml</code> \u7528 <code>kubectl apply -f</code> \u585e\u5230\u6307\u5b9a\u7684 <code>Kubernetes cluster</code> \u4e0a\u904b\u884c\uff0c\u8981\u7559\u610f\u7684\u4e8b\u60c5\u662f\uff0c\u9019\u908a Podman Desktop \u4e0d\u6703\u986f\u793a Kubernetes \u4e0a\u7684\u8cc7\u8a0a\uff0c\u4f60\u5f97\u8981\u7528 <code>kubectl get pods</code> \u4f86\u67e5\u770b\uff0c\u4e0a\u5716\u7684\u64cd\u4f5c\u6703\u7b49\u540c\u65bc\u4e0b\u9762\u6307\u4ee4</p> kubectl-apply<pre><code>$ kind get clusters\nenabling experimental podman provider\nkind-cluster\n\n$ kubectl cluster-info\nKubernetes control plane is running at https://127.0.0.1:63290\nCoreDNS is running at https://127.0.0.1:63290/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\n$ kubectl apply -f debug-container.yaml\npod/debug-container configured\n\n$ kubectl get pods -n default\nNAME              READY   STATUS    RESTARTS   AGE\ndebug-container   1/1     Running   0          2m15s\n</code></pre>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#3-container-pod-podman-container-engine","title":"3. \u628a Container \u8f49\u63db Pod \u585e\u5230 <code>Podman Container Engine</code> \u74b0\u5883\u4e0a\u904b\u884c","text":"","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#31-kubernetes-yaml-podman-containe-enginer","title":"3.1 \u5148\u628a Kubernetes YAML \u5728\u672c\u6a5f\u7528 Podman Containe Enginer \u904b\u884c\u8d77\u4f86","text":"<p>\u95dc\u65bc <code>4</code>\uff0cpodman \u5168\u540d\u61c9\u70ba Pod Manager\uff0c\u4ed6\u672c\u8eab\u8a2d\u8a08\u57fa\u790e\u662f\u4ee5 Pod \u70ba\u55ae\u4f4d\u4f5c\u70ba\u8a2d\u8a08\u7684\uff0c\u6240\u4ee5\u4ed6\u53ef\u4ee5\u652f\u63f4\u628a Kubernetes \u7684 YAML \u8f49\u63db\u6210 Pod \u4e26\u4e14\u76f4\u63a5\u7528 Podman Container Engine \u904b\u884c\u8d77\u4f86\uff0c\u76f8\u7576\u9069\u5408\u4f60\u5c1a\u672a\u628a\u670d\u52d9\u653e\u5230 Kubernetes \u4e4b\u524d\uff0c\u55ae\u7d14\u60f3\u8981\u5c0d Pod \u9019\u500b\u7bc4\u570d\u5167\u7684\u64cd\u4f5c\u9032\u884c\u9846\u7c92\u5ea6\u8f03\u7d30\u7684\u8abf\u6559\uff0c\u9019\u6703\u7bc0\u7701\u5f88\u591a\u6642\u9593\uff0c\u4e0a\u5716\u7684\u64cd\u4f5c\u6703\u7b49\u540c\u65bc\u4e0b\u9762\u6307\u4ee4</p> podman-play-kube<pre><code>$ podman play kube ./debug-container.yaml\nPod:\n90f1cc5b5affd866a360118f65bfaa840396e74f6bd6294b12e743ad0660d77b\nContainer:\n1b092b950e1c2fbdb8b896dfc22a4b3d23c0ffe902c39d95a363cd098086e781\n\n$ podman pod ps --ctr-names --ctr-ids\nPOD ID        NAME             STATUS      CREATED         INFRA ID      IDS                        NAMES\n90f1cc5b5aff  debug-container  Running     12 minutes ago  b08f52f1aab7  b08f52f1aab7,1b092b950e1c  90f1cc5b5aff-infra,debug-container-debug-container\n\n$ podman exec -it 1b092b950e1c /bin/bash\n[root@debug-container ~]#\n</code></pre>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#32-pod-deployment-kubernetes","title":"3.2 \u518d\u628a Pod \u8f49\u63db\u6210 Deployment \u90e8\u7f72\u5230 Kubernetes \u4e0a","text":"<p>\u95dc\u65bc <code>5-6</code>\uff0c\u5728 Pod \u7684\u6b04\u4f4d\u5167\uff0c\u6709\u652f\u63f4\u5c07\u7576\u524d\u7684 Pod \u76f4\u63a5<code>\u7522\u751f Pod YAML</code> \u548c<code>\u90e8\u7f72\u5230\u6307\u5b9a\u7684 Kubernetes \u4e4b\u4e0a</code>\uff0c\u5982\u679c\u4f60\u662f\u672c\u6a5f\u958b\u767c\u7684\u8a71\uff0c\u6703\u662f\u4e00\u500b\u76f8\u7576\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u9ede\u4e00\u9ede\u5c31\u53ef\u4ee5\u8dd1\u5230 Kubernetes \u70ba\u5e95\u7684\u74b0\u5883\u904b\u884c\u4e86</p> <p></p> <p>\u5728<code>\u90e8\u7f72\u5230\u6307\u5b9a\u7684 Kuberentes \u4e4b\u4e0a</code> \u9019\u500b\u968e\u6bb5\uff0c\u96d6\u7136\u80fd\u505a\u7684\u4e8b\u60c5\u4e0d\u50cf <code>kubectl apply</code> \u81ea\u5df1\u4e0b\u6307\u4ee4\u4f86\u7684\u591a\u6a23\uff0c\u4f46\u5c31\u4ee5 Pod \u9019\u500b\u7bc4\u570d\u7684\u6e2c\u8a66\u958b\u767c\u4f86\u8b1b\uff0c\u662f\u53ef\u4ee5\u8003\u616e\u4f7f\u7528\u7684\u8def\u7dda\uff0c\u771f\u4e0d\u884c\u7684\u8a71\uff0c\u4f60\u5c31\u81ea\u5df1\u7522\u751f Deployment YAML \u4f86\u90e8\u7f72\u5c31\u597d\u4e86</p> podman-generate-kube-pod<pre><code># podman generate kube podID\n# https://docs.podman.io/en/latest/markdown/podman-kube-generate.1.html\n$ podman generate kube --type pod debug-container\n# Save the output of this file and use kubectl create -f to import\n# it into Kubernetes.\n#\n# Created with podman-4.8.3\napiVersion: v1\nkind: Pod\nmetadata:\n  creationTimestamp: \"2024-02-05T17:49:38Z\"\n  labels:\n    app: debug-container\n  name: debug-container\nspec:\n  containers:\n  - args:\n    - while true; do sleep 30; done;\n    command:\n    - /bin/bash\n    - -c\n    - --\n    image: ghcr.io/pichuang/debug-container:master\n    name: debug-container-debug-container\n    securityContext: {}\n  restartPolicy: Always\n</code></pre> <p>\u5018\u82e5\u4f60\u89ba\u5f97\u9019\u500b Pod \u8dd1\u8d77\u4f86\u6c92\u5565\u554f\u984c\uff0c\u60f3\u8981\u63db\u6210\u7528 Deployment \u7684\u65b9\u5f0f\u8dd1\uff0c\u90a3\u4f60\u53ef\u4ee5\u7528\u4e0b\u9762\u6307\u4ee4\uff0c\u6539\u4e00\u4e0b <code>--type deployment</code> \u5c31\u53ef\u4ee5\u6216\u5f97\u5230\u4e00\u500b\u6703\u52d5\u7684 Deployment YAML\uff0c\u7136\u5f8c\u518d\u96a8\u9700\u6c42\u7d30\u4fee\u53c3\u6578\u5373\u53ef</p> podman-generate-kube-deployment<pre><code>$ podman generate kube --type deployment debug-container --service\n# Save the output of this file and use kubectl create -f to import\n# it into Kubernetes.\n#\n# Created with podman-4.8.3\napiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: \"2024-02-05T17:47:00Z\"\n  labels:\n    app: debug-container\n  name: debug-container\nspec:\n  selector:\n    app: debug-container\n  type: NodePort\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: \"2024-02-05T17:47:00Z\"\n  labels:\n    app: debug-container\n  name: debug-container-deployment\nspec:\n  selector:\n    matchLabels:\n      app: debug-container\n  template:\n    metadata:\n      creationTimestamp: \"2024-02-05T17:47:00Z\"\n      labels:\n        app: debug-container\n      name: debug-container\n    spec:\n      containers:\n      - args:\n        - while true; do sleep 30; done;\n        command:\n        - /bin/bash\n        - -c\n        - --\n        image: ghcr.io/pichuang/debug-container:master\n        name: debug-container-debug-container\n        securityContext: {}\n      restartPolicy: Always\n</code></pre>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#4-oci-extenstion","title":"4. \u5b89\u88dd\u76f8\u5bb9 OCI \u683c\u5f0f\u7684 Extenstion","text":"<p>Podman Desktop \u5167\u5efa\u5176\u5be6\u6c92\u9019 Aqua Trivy \u529f\u80fd\uff0c\u9700\u8981\u53e6\u5916\u88dd\uff0c\u6545\u6211\u60f3\u5f37\u8abf\u7684\u4e8b\u60c5\u662f\uff0c\u9019\u5de5\u5177\u4e5f\u652f\u63f4\u5b89\u88dd\u65e2\u6709 Docker Desktop Extenstion\uff0c\u53ef\u4ee5\u53bb Dockerhub \u9019\u908a\u627e\u5230\u9700\u8981\u7684\u670d\u52d9\u7db2\u5740\u5f8c\u88dd\u9032\u53bb</p> <p></p> <p></p> <p></p> <p></p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#5-container-images","title":"5. \u7de8\u8b6f Container Images","text":"<p>\u4e5f\u662f\u7d93\u5178\u4f7f\u7528\u65b9\u5f0f\uff0c\u4f46\u6211\u9084\u6c92\u7814\u7a76\u600e\u9ebc\u5728\u7b46\u96fb\u540c\u6642\u7de8\u51fa aarch64 \u548c x86_64 \u60f3\u5230\u518d\u4f86\u88dc</p> <pre><code>$ podman build -t my-custom-image -f Dockerfile\n</code></pre>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#qa","title":"Q&amp;A","text":"","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q1-docker-desktop-podman-desktop","title":"Q1: Docker Desktop \u548c Podman Desktop \u600e\u9ebc\u6311?","text":"<p>\u6211\u7684\u770b\u6cd5\u9084\u4ee5<code>\u539f\u5ee0\u552e\u5f8c\u652f\u63f4</code> \u548c <code>\u529f\u80fd\u652f\u63f4</code> \u5169\u500b\u89d2\u5ea6\u4f86\u770b</p> <ol> <li> <p>\u552e\u5f8c\u7522\u54c1\u652f\u63f4</p> <ul> <li>\u4f60\u5982\u679c\u662f\u4ee5 Docker \u70ba\u4e3b\u6216\u8005\u662f\u6709\u611b\u597d\u7684\u4eba\uff0c\u5efa\u8b70\u4ee5 Docker / Docker Desktop \u9ad4\u7cfb\u70ba\u4e3b\uff0cDocker \u539f\u5ee0 (\u8207 Mirantis \u7121\u95dc) \u6709\u63d0\u4f9b Docker Desktop \u539f\u5ee0\u7522\u54c1\u552e\u5f8c\u652f\u63f4</li> <li>\u4f60\u5982\u679c\u662f\u4ee5 Red Hat \u9ad4\u7cfb\u6216\u5f88\u6e05\u695a\u5bb9\u5668\u904b\u4f5c\u7684\u4eba\uff0c\u5efa\u8b70\u4ee5 Podman / Podman Desktop \u9ad4\u7cfb\u70ba\u4e3b\uff0c\u8ddf\u524d\u8005\u4e0d\u592a\u4e00\u6a23\u7684\u662f\uff0cRed Hat \u652f\u63f4\u662f\u4ee5 Red Hat Enterprise Linux \u7522\u54c1\u89d2\u5ea6\u652f\u63f4\uff0c\u6709\u4e2d\u6587\u652f\u63f4</li> </ul> </li> <li> <p>\u529f\u80fd\u652f\u63f4</p> <p>\u57fa\u65bc\u6b64\u6587 Missing commands, \u6bd4\u8f03 <code>Missing commands in podman</code> \u548c <code>Missing commands in docker</code> \u5167\u6709\u6c92\u6709\u4f60\u672c\u4f86\u5c31\u5728\u7528\u7684\u6307\u4ee4\uff0c\u5982\u679c\u6709\u7684\u8a71\uff0c\u5c31\u53ef\u4ee5\u7528\u529f\u80fd\u6027\u8a55\u4f30\u9032\u884c\u9078\u64c7\uff0c\u56e0\u70ba\u6b77\u53f2\u5178\u6545\uff0c\u6240\u4ee5\u90fd\u662f\u770b <code>Missing commands in podman</code> \u9019\u500b\u8868\u683c\u5c31\u597d\uff0c\u53ea\u8981\u88e1\u9762\u4f60\u770b\u5b8c\u90fd\u6c92\u6709\u4f60\u8981\u7528\u7684\u6307\u4ee4\uff0c\u606d\u559c\u4f60\uff0c\u4f60\u5169\u908a\u90fd\u53ef\u4ee5\u9078\uff0c\u4f7f\u7528\u8d77\u4f86\u6c92\u5dee</p> </li> </ol>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q2-podman-docker","title":"Q2: \u5982\u679c\u521d\u6b21\u4f7f\u7528 podman, \u4f46\u6211\u6307\u4ee4\u6216\u7a0b\u5f0f\u90fd\u5beb docker \u8a72\u600e\u9ebc\u8fa6?","text":"<pre><code>$ alias docker=podman\n$ which docker\ndocker: aliased to podman\n</code></pre> <p>\u9019\u4e0d\u662f\u958b\u73a9\u7b11\u7684\uff0c\u8a8d\u771f\u9019\u6a23\u505a</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q3-podman-desktop-vs-docker-desktop-vs-lens-vs-k9s","title":"Q3: Podman Desktop v.s. Docker Desktop v.s. Lens v.s. k9s?","text":"<p>\u4f60\u5982\u679c\u662f\u7dad\u8b77 Kubernetes \u7684\u4eba\uff0c\u8acb\u770b Lens / k9s \u662f\u4f60\u7684\u597d\u9078\u64c7\uff0c\u4e3b\u8981\u4ed6\u5011\u90fd\u662f\u91dd\u5c0d Kubernetes API \u9032\u884c\u64cd\u4f5c\u7ba1\u7406 \u4f60\u5982\u679c\u662f\u958b\u767c\u6216\u6253\u5305 Container \u7a0b\u5f0f\u90e8\u7f72\u7684\u4eba\uff0c\u8acb\u770b Podman Desktop / Docker Desktop \u70ba\u4e3b</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q4","title":"Q4: \u73fe\u884c\u8edf\u786c\u9ad4\u7248\u672c\u8cc7\u8a0a?","text":"<p>\u65bc 20240206 \u5feb\u7167\u7248\u672c\u8cc7\u8a0a</p> <ul> <li>Apple M3 Pro</li> <li>macOS 14.3</li> <li>Podman Desktop v1.7.0</li> <li>Podman v4.9.0</li> <li>OpenShift Local v2.32.0</li> </ul>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q5-podman-desktop","title":"Q5: \u5982\u4f55\u5b89\u88dd Podman Desktop \u548c\u4ed6\u7684\u76f8\u4f9d\u6027\u5957\u4ef6?","text":"<p>\u5f37\u70c8\u5efa\u8b70\u5f9e\u5b98\u7db2\u4e0a\u5148\u628a Podman Desktop \u5b89\u88dd\u597d\uff0c\u7136\u5f8c\u518d\u900f\u904e\u9019\u500b\u4ecb\u9762\u53bb\u5b89\u88dd\u5176\u4ed6\u7684\uff0c\u4e0d\u7136\u53ef\u80fd\u6703\u9047\u5230\u4e00\u4e9b\u9748\u7570\u73fe\u8c61</p> <p>https://podman-desktop.io/downloads</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q6-mirantis-docker","title":"Q6: Mirantis \u548c Docker \u7684\u95dc\u4fc2?","text":"<p>\u96d6\u7136 2019/11/13\uff0cMiratnis \u4f75\u8cfc Docker\uff0c\u4f46\u76ee\u524d\u5169\u5bb6\u9084\u662f\u4e0d\u4e00\u6a23\u7684\u516c\u53f8\uff0c\u56e0\u70ba\u7522\u54c1\u7dda\u4e0d\u4e00\u6a23</p> <p>\u57fa\u65bc Discover Mirantis Products Learn\uff0cMirantis \u4e3b\u8981\u63d0\u4f9b\u4e0b\u5217\u7522\u54c1\u548c\u5c08\u6848</p> <ul> <li>Mirantis Container Cloud</li> <li>Mirantis Kubernetes Engine</li> <li>Mirantis Container Runtime (\u524d\u8eab\u70ba Docker Engine - Enterprise)</li> <li>Mirantis Secure Registry</li> <li>Mirantis OpenStack for OpenStack</li> <li>Lens IDE</li> <li>k0s</li> <li>Lagon</li> </ul> <p>\u57fa\u65bc Docker subscriptions and features\uff0cDocker \u4e3b\u8981\u63d0\u4f9b\u4e0b\u5217\u7522\u54c1\u548c\u5c08\u6848</p> <ul> <li>Docker Engine</li> <li>Docker compose</li> <li>Docker Kubernetes</li> <li>Docker Hub</li> <li>Docker Desktop</li> </ul> <p>\u7576\u4e2d\u5c31\u662f Docker Engine \u7684\u652f\u63f4\u554f\u984c\uff0c\u6309\u7167 Docker Support \u7684\u6587\u4ef6\u63cf\u8ff0\u76f8\u7576\u5999</p> <p><code>Docker doesn't provide support for Docker Engine. Docker provides support for Docker products, including Docker Desktop, which uses Docker Engine as one of its components.</code></p> <p>\u6240\u4ee5\u7121\u8ad6\u662f Docker Engine \u9084\u662f Docker Compose \u7684\u652f\u63f4\uff0c\u90fd\u61c9\u8a72\u53bb\u627e Docker \u539f\u5ee0\uff0c\u800c\u4e0d\u662f Mirantis \u539f\u5ee0</p> <p>\u7e3d\u7d50</p> <ul> <li>\u4f60\u662f\u958b\u767c\u8005\uff0c\u9700\u8981 <code>Docker Desktop</code> \u548c <code>Docker Engine</code> \u7684\u4f7f\u7528\u652f\u63f4\uff0c\u9700\u8981\u627e Docker \u539f\u5ee0\u8a02\u95b1\u670d\u52d9</li> <li>\u4f60\u662f\u7dad\u904b\u8005\uff0c\u9700\u8981\u53d7\u4f01\u696d\u652f\u63f4\u7684 Container Rutime\uff0c\u90a3\u4f60\u61c9\u8a72\u8981\u627e <code>Mirantis Container Runtime</code> \u4e5f\u5c31\u662f Docker-EE \u8def\u7dda\uff0c\u53ef\u53c3\u8003 Mirantis Container Runtime \u7684\u5b89\u88dd\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u627e Docker \u539f\u5ee0</li> </ul>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#q7-dev-container-docker-podman","title":"Q7: Dev Container \u9810\u8a2d\u7528 Docker \u8a92\uff0c\u600e\u9ebc\u6539\u6210 Podman?","text":"<p>\u5f88\u7c21\u55ae, \u4e0b\u9762\u4e00\u767c\u89e3\u6c7a</p> <pre><code>$ sudo vim /usr/local/bin/docker\n#!/bin/bash\nexec podman \"$@\"\n\n$ sudo chmod +x /usr/local/bin/docker\n</code></pre> <p>\u7136\u5f8c\u91cd\u958b VSCode \u5c31\u597d\u4e86</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#_1","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u6700\u8fd1\u770b\u9999\u683c\u91cc\u62c9\u00b7\u958b\u62d3\u7570\u5883\uff0c\u6839\u672c\u5c31\u662f\u9b42\u7cfb\u5217\u904a\u6232\u7684\u52d5\u756b\u5316\uff0c\u5c31\u60f3\u5230\u5176\u5be6\u6211\u5de5\u4f5c\u4e5f\u662f\u5e38\u9047\u5230\u5f88\u591a\u5ba2\u6236\u7684\u7279\u898f\u9700\u6c42\uff0c\u5e38\u5e38\u52a0\u73ed\u7528\u4e00\u4e9b\u602a\u62db\u7814\u7a76\u6e2c\u8a66\u534a\u5929\uff0c\u6700\u7d42\u901a\u904e\u96e3\u95dc\uff0c\u5ffd\u7136\u89ba\u5f97\u6211\u662f\u500b\u5145\u6eff\u8457\u9b42\u7cbe\u795e\u7684\u7cfb\u7d71\u67b6\u69cb\u5e2b: \u9ad8\u81ea\u7531\u5ea6 (\u602a\u62db\u591a)\u3001\u9ad8\u96e3\u5ea6 (\u5ba2\u6236\u8981\u6c42\u901a\u5e38\u6587\u4ef6\u4e0a\u90fd\u6c92\u5beb)\u3001\u9ad8\u6311\u6230 (\u81ea\u5df1\u6311\u71c8\u591c\u6230\u641e\u51fa\u4f86)</p>","tags":["kubernetes","podman"]},{"location":"20240206-podman-desktop-on-mac-m3.html#reference","title":"Reference","text":"<ul> <li>Podman Desktop Release 1.7</li> <li>pichuang/debug-container</li> <li>Discover Mirantis Products Learn</li> </ul>","tags":["kubernetes","podman"]},{"location":"20240227-azure-firewall-policy-design.html","title":"Azure Firewall Policy Rule \u8a2d\u8a08\u548c\u57f7\u884c\u908f\u8f2f","text":"<p>\u8a18\u9304\u4e00\u4e0b\uff0c\u5e6b\u52a9\u4e00\u4e0b\u66fe\u7d93\u8ddf\u6211\u4e00\u6a23\u9677\u5165\u4ee5\u4eba\u985e\u4e4b\u8ec0\u5c0d\u904e Azure Firewall Policy \u898f\u5247\u7684\u5049\u5927\u6230\u58eb\u5011</p> <p></p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#azure-firewall-policy-project","title":"Azure Firewall Policy \u5178\u578b\u7bc4\u4f8b: \u4ee5 Project \u5c0e\u5411","text":"","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#firewall-policy","title":"\u95dc\u65bc Firewall Policy","text":"<ol> <li>1 \u500b Azure Firewall \u53ea\u80fd\u8ddf 1 \u500b Firewall Policy \u9032\u884c\u95dc\u806f</li> <li>\u53ef\u4ee5\u7528 Parent Policy \u95dc\u806f\u591a\u500b Child Policy\uff0c\u4ee5\u505a\u5230\u7e7c\u627f\u7684\u6548\u679c</li> </ol>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#rule-collection-group","title":"\u95dc\u65bc Rule Collection Group","text":"<ol> <li>1 \u500b Firewall Policy \u53ef\u4ee5\u5305\u542b 3 ~ 90 \u500b Rule Collection Group</li> <li>\u9810\u8a2d\u6703\u6709 3 \u500b Rule Collection Group: 100 DNAT Rule Collection Group, 200 Network Rule Collection Group, 300 Application Rule Collection Group \u4e14\u4e0d\u53ef\u522a\u9664\uff0c\u4f46\u53ef\u4ee5\u9078\u64c7\u4e0d\u8981\u7528\u5b83</li> <li>\u512a\u5148\u6b0a\u865f\u78bc\u5f9e 100 ~ 65000 \u7686\u53ef\u4f7f\u7528\uff0c\u4f46\u4e0d\u53ef\u91cd\u8907</li> <li>(\u5efa\u8b70) \u4ee5 Project \u6216\u7279\u5b9a\u7684\u61c9\u7528\u7a0b\u5f0f\u70ba\u6700\u5c0f\u55ae\u4f4d\uff0c\u9032\u884c\u660e\u78ba\u5206\u985e</li> <li>(\u5efa\u8b70) \u4e0d\u540c\u5c08\u6848\u8df3\u865f\uff0c\u4ee5 100 \u70ba\u55ae\u4f4d\u4f5c\u70ba\u8df3\u865f\u57fa\u790e</li> </ol>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#rule-collecition","title":"\u95dc\u65bc Rule Collecition","text":"<ol> <li>1 \u500b Rule Collection Group \u53ef\u4ee5\u5305\u542b 1 ~ N \u500b Rule Collection\uff0c\u6a94\u6848\u4e0a\u9650\u70ba 2MB</li> <li>\u6bcf 1 \u500b Rule Collection \u6709 3 \u7a2e\u985e\u578b\u9078\u64c7: DNAT Rule, Network Rule, Application Rule</li> <li>\u6bcf 1 \u500b Rule Collection \u6709 2 \u500b\u52d5\u4f5c (Action) \u9078\u64c7\uff0cAllow \u6216 Deny\uff0c\u7121\u6cd5\u540c\u6642\u9078\u64c7</li> <li>\u512a\u5148\u6b0a\u865f\u78bc\u5f9e 100 ~ 65000 \u7686\u53ef\u4f7f\u7528\uff0c\u4f46\u4e0d\u53ef\u91cd\u8907</li> <li>\u96d6\u7136\u4e0d\u540c Rule Collection Group \u4e0d\u53ef\u4ee5\u6709\u76f8\u540c\u7684\u512a\u5148\u6b0a\u865f\u78bc\uff0c\u4f46\u65d7\u4e0b\u7684\u4e0d\u540c\u7684 Rule Collection \u53ef\u4ee5\u6709\u76f8\u540c\u7684\u512a\u5148\u6b0a\u865f\u78bc</li> <li>\u57fa\u65bc\u6578\u5b57\u5c0f\u7684\u512a\u5148\u6b0a\u9ad8\uff0c\u6578\u5b57\u5927\u7684\u512a\u5148\u6b0a\u4f4e\uff0c\u6240\u4ee5\u6bcf\u4e00\u500b\u5206\u985e\u9700\u7279\u5225\u62c6\u5206 Deny \u548c Allow \u7684 Rule Collection\uff0c\u4e26\u7528\u512a\u5148\u6b0a\u78ba\u4fdd\u57f7\u884c\u9806\u5e8f</li> </ol>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#rule","title":"\u95dc\u65bc Rule","text":"<p>DNAT \u5c31\u662f Port Forwarding \u9032\u4f86\uff0c\u9019\u500b\u6c92\u4ec0\u9ebc\u7279\u6b8a\u53ef\u4ee5\u8a0e\u8ad6\u7684\uff0c\u60f3\u8981\u77e5\u9053\u4f7f\u7528\u65b9\u5f0f\u7684\u8a71\u53ef\u4ee5\u53c3\u8003 \u4e0a\u73ed\u57fa\u672c\u529f: SSH \u6df7\u642d Azure Firewall</p> <p>\u4e3b\u8981\u5206\u70ba Network Rules\uff0c\u7d93\u5178\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u53ea\u8981\u662f\u4ee5 L4 \u5354\u5b9a\u70ba\u4e3b\u7684 TCP / UDP / ICMP \u898f\u5247\u90fd\u53ef\u4ee5\u63a1\u7528\uff0c\u6703\u6709\u660e\u78ba\u7684\u5354\u8b70\u548c Port \u8a2d\u5b9a</p> <p></p> <p>\u5176\u6b21\u70ba Application Rules\uff0c\u4e3b\u8981\u91dd\u5c0d L7 \u5354\u5b9a\u7684 HTTP / HTTPS \u898f\u5247\uff0c\u6703\u6709\u660e\u78ba\u7684 URL \u8a2d\u5b9a\uff0c\u652f\u63f4 Wildcard \u548c\u6539 Port \u8a2d\u5b9a\uff0c\u4e5f\u652f\u63f4 TLS inspection</p> <p></p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#azure-firewall-policy","title":"Azure Firewall Policy \u57f7\u884c\u908f\u8f2f","text":"<ol> <li>\u4ee5 \u985e\u5225 (Type): DNAT Rules &gt; Network Rules &gt; Application Rules</li> <li>\u4ee5 \u7e7c\u627f (Hierarchy): Parent Policy &gt; Child Policy</li> <li>\u4ee5 \u512a\u5148\u6b0a (Priority): \u6578\u5b57\u5c0f\u7684\uff0c\u512a\u5148\u6b0a\u9ad8\uff0c\u6578\u5b57\u5927\u7684\uff0c\u512a\u5148\u6b0a\u4f4e</li> </ol> <p>\u767d\u8a71\u4f86\u8aaa\uff0c\u7121\u8ad6 Parenet Policy \u6216 Child Policy\uff0c\u90fd\u6703\u5148\u57f7\u884c DNAT Rules \u985e\u5225\uff0c\u4f9d\u64da\u512a\u5148\u6b0a\u4f86\u6c7a\u5b9a\u57f7\u884c\u9806\u5e8f\uff0c\u5176\u6b21\u518d\u4f86\u662f Network Rules \u985e\u5225\uff0c\u4f9d\u64da\u512a\u5148\u6b0a\u4f86\u6c7a\u5b9a\u57f7\u884c\u9806\u5e8f\uff0c\u6700\u5f8c\u624d\u662f Application Rules \u985e\u5225\uff0c\u4f9d\u64da\u512a\u5148\u6b0a\u4f86\u6c7a\u5b9a\u57f7\u884c\u9806\u5e8f</p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#1-dnat-rules","title":"1. \u5148\u6bd4 DNAT Rules \u9806\u5e8f","text":"","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#2-network-rules","title":"2. \u518d\u6bd4 Network Rules \u9806\u5e8f","text":"","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#3-application-rules","title":"3. \u6700\u5f8c\u6bd4 Application Rules \u9806\u5e8f","text":"","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#4","title":"4. \u5168\u90e8\u90fd\u6c92\u4e2d","text":"<p>\u9810\u8a2d\u62d2\u7d55 (Deny All) \u7684\u898f\u5247\uff0c\u6703\u5728\u6700\u5f8c\u57f7\u884c\uff0c\u6240\u4ee5\u5982\u679c\u6c92\u6709\u4efb\u4f55\u4e00\u500b\u898f\u5247\u7b26\u5408\uff0c\u5c31\u6703\u88ab\u62d2\u7d55</p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#_1","title":"\u500b\u4eba\u826f\u5fc3\u5efa\u8b70","text":"","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#1-rule-collections","title":"1. \u4e0d\u8981\u62ff Rule Collections \u4f86\u53c3\u8003\u908f\u8f2f\u6392\u5e8f","text":"<p>\u9019\u9801\u5176\u5be6\u5b8c\u5168\u6c92\u6709\u7167\u6392\u5e8f\u53c3\u8003\uff0c\u5982\u679c\u4f60\u7b2c\u4e00\u773c\u770b\u9019\u500b\uff0c\u4fdd\u8b49\u6703\u641e\u5230\u660f\u6389\uff0c\u5176\u6b21\u5be6\u969b\u4e0a\u57f7\u884c\u9806\u5e8f\u4e5f\u4e0d\u662f\u7167\u9019\u500b\u6392\u5e8f\uff0c\u6240\u4ee5\u770b\u9019\u500b\u6c92\u4ec0\u9ebc\u7279\u6b8a\u8def\u7528</p> <p>\u5efa\u8b70\u9084\u662f\u76f4\u63a5\u9ede\u65c1\u908a\u7684 DNAT Rules, Network Rules, Application Rules \u4f86\u770b\u6bd4\u8f03\u6e05\u695a</p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#2","title":"2. \u8003\u8003\u81ea\u5df1","text":"<p>\u9019\u662f\u5b98\u65b9\u6587\u4ef6 Rule processing using Firewall Policy\uff0c\u6211\u76f8\u4fe1\u4f60\u61c9\u8a72\u6b64\u6642\u77e5\u9053\u4ed6\u5230\u5e95\u5728\u5e79\u561b\u4e86\uff0c\u5982\u679c\u9084\u662f\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u7684\u8a71\uff0c\u8acb\u518d\u91cd\u770b\u4e00\u6b21\u6587\u7ae0</p> <p></p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#_2","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>2024 \u5e74\u958b\u5e74\u5c31\u6b77\u7d93\u4eba\u751f\u53f2\u4e0a\u6700\u6158\u611f\u5192\u548c\u6d41\u611f\uff0c\u660f\u8ff7\u8db3\u8db3\u4e00\u9031\u4ee5\u4e0a\uff0c\u52a0\u9001 2 \u9031\u91cd\u611f\u5192\uff0c\u6bd4 COVID \u9084\u6158</p>","tags":["azure","firewall"]},{"location":"20240227-azure-firewall-policy-design.html#references","title":"References","text":"<ul> <li>Azure Firewall Policy Limitation</li> </ul>","tags":["azure","firewall"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html","title":"Azure Networking \u4e4b BGP \u666e\u901a\u5e38\u8b58","text":"<p>\u96a8\u8457\u96f2\u5730\u6df7\u5408\u7db2\u8def\u7684\u9700\u6c42\u63d0\u5347\uff0c\u9664\u4e86\u8001\u62db Static Route \u7684\u62db\u6578\u4f9d\u7136\u53ef\u4ee5\u7528\u4ee5\u5916\uff0c\u70ba\u4e86\u8b93\u6574\u9ad4\u8def\u7531\u7ba1\u7406\u8b8a\u5f97\u6bd4\u8f03\u50cf\u6a23\u4e00\u9ede\uff0c\u904e\u5f80\u53ef\u80fd\u591a\u6578\u4eba\u6216\u516c\u53f8\u5f88\u5c11\u63a5\u89f8\u7684 BGP \u7db2\u8def\u67b6\u69cb\u8a2d\u8a08\uff0c\u5f9e\u73fe\u5728\u958b\u59cb\u8981\u628a BGP \u9019\u500b\u52d5\u614b\u8def\u7531\u5354\u8b70\u7576\u4f5c\u662f\u4e00\u822c\u5e38\u8b58\u4f86\u770b\u5f85\u4e86</p> <p></p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#azure-bgp","title":"Azure \u6240\u4fdd\u7559\u7684 BGP \u865f\u78bc\u5011","text":"<p>\u57fa\u65bc IANA \u548c Azure \u4fdd\u7559 ASN\uff0c\u4e0b\u5217\u6574\u7406\u51fa\u57fa\u65bc 16 bit \u7684\u9810\u8a2d\u4ee5\u4fdd\u7559\u7684 ASN \u548c\u5176\u529f\u7528\uff0c\u5efa\u8b70\u5728\u914d Private ASN \u7d66\u5730\u7aef\u8a2d\u5099\u6642\u4e0d\u8981\u8ddf\u4e0b\u9762\u7684 ASN \u6709\u6240\u885d\u7a81\uff0c\u6b64\u5916\u6211\u9019\u908a\u7279\u5225\u628a Microsoft \u8ddf Azure \u7279\u5225\u62c6\u958b\u89e3\u91cb\uff0c\u6b63\u78ba\u5206\u985e\u90fd\u662f Microsoft Corporation \u624d\u5c0d\uff0c\u4f46\u70ba\u4e86\u8fa8\u8b58\u76ee\u7684\u7684\u4e0d\u540c\uff0c\u7279\u6b64\u62c6\u958b</p> Reserved by Public / Private ASN Comment Microsoft Public 8074 \u672a\u516c\u958b\u7528\u9014 Microsoft Public 8075 Microsoft Global Network\uff0c\u4f60\u9019\u4e00\u751f\u90fd\u6703\u7528\u5230\u4ed6\u7684 Azure Public 12076 \u9810\u8a2d\u7d66 ExpressRoute \u4f7f\u7528\uff0e\u5982\u679c\u4f60\u63a5\u5c08\u7dda\u7684\u8a71\uff0c\u624d\u6703\u9047\u5230\u9019\u500b IANA Public 23456 \u57fa\u65bc RFC6793\uff0c\u9019\u500b\u662f\u7d66 AS_TRANS \u4e4b\u7528\u7684 IANA Private 64496-64511 \u57fa\u65bc RFC5398\uff0c\u63d0\u4f9b\u7d66\u64b0\u5beb\u6587\u4ef6\u548c\u7a0b\u5f0f\u78bc\u4e4b\u7528 Azure Private 65515 \u5c0d\u7db2\u8def\u5718\u968a\u4f86\u8aaa\u6700\u91cd\u8981\u7684\u865f\u78bc\uff0c\u9810\u8a2d Azure Private ASN\uff0c\u7121\u8ad6\u662f Azure Route Server / Azure vWAN / Azure VPN Gateway \u5efa\u8b70\u90fd\u9810\u8a2d\u9078\u64c7\u4ed6\u4f86\u4f7f\u7528 N/A Private 65516 \u96d6\u7136\u6280\u8853\u4e0a\u5730\u7aef\u53ef\u4ee5\u7528\uff0c\u4f46\u500b\u4eba\u5efa\u8b70\u4e0d\u8981\u9078\u9019\u500b\uff0c\u4f60\u770b\u770b\u4e0a\u9762\u518d\u770b\u770b\u4e0b\u9762\uff0c\u6c92\u5fc5\u8981\u64e0\u9019\u500b Azure Private 65517 \u672a\u516c\u958b\u7528\u9014\uff0c\u5982\u679c\u5f37\u5236\u8981\u7528\u7684\u8a71\uff0c\u90e8\u7f72 Local Network Gateway \u670d\u52d9\u6703\u5931\u6557 Azure Private 65518 \u672a\u516c\u958b\u7528\u9014\uff0c\u5982\u679c\u5f37\u5236\u8981\u7528\u7684\u8a71\uff0c\u90e8\u7f72 Local Network Gateway \u670d\u52d9\u6703\u5931\u6557 Azure Private 65519 \u672a\u516c\u958b\u7528\u9014\uff0c\u5982\u679c\u5f37\u5236\u8981\u7528\u7684\u8a71\uff0c\u90e8\u7f72 Local Network Gateway \u670d\u52d9\u6703\u5931\u6557 Azure Private 65520 \u9810\u8a2d\u7d66 Azure vWAN \u4e2d\u7684 vHub \u4ea4\u63db\u8def\u7531\u7528\u7684 IANA Private 65535 \u57fa\u65bc RFC7300\uff0c\u4fdd\u7559\u6700\u5f8c\u4e00\u500b ASN <p>\u6b64\u5916 Azure VPN Gateway \u53ef\u4ee5\u6536 32-bit \u7684 ASN\uff0c\u4f46 Microsoft \u9810\u8a2d\u6c92\u6709\u91dd\u5c0d\u9019\u500b\u9032\u884c\u4fdd\u7559\uff0c\u57fa\u65bc RFC6996\uff0c\u4f60\u53ef\u4ee5\u5f9e <code>4200000000-4294967294</code> \u4e2d\u9593\u9078\u64c7\u79c1\u6709 ASN \u4f86\u4f7f\u7528</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#azure-asn","title":"\u8a73\u7d30\u89e3\u6790\u88ab Azure \u4fdd\u7559\u7684 ASN \u5011","text":"","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#as8075-asn","title":"\u95dc\u65bc AS8075 - \u4f60\u9019\u4e00\u751f\u90fd\u6703\u9047\u5230\u7684 ASN","text":"<p>\u7c21\u7a31 Microsoft Global Network\uff0c\u8209\u51e1\u4f60\u7528 XBox Game Pass \u9023\u4e0a\u7db2\u3001Windows \u8981\u66f4\u65b0\u3001\u6216\u8005\u662f\u9023\u7dda\u5230 Azure Portal \u90fd\u6703\u8d70\u5230\u9019\u500b <code>AS8075</code>\uff0c\u81f3\u65bc\u8def\u7531\u7684\u8ddd\u96e2\u63a7\u5236\u53ef\u4ee5\u9760\u9078\u64c7 Public IP \u4e2d\u7684\u8def\u7531\u504f\u597d\uff0c\u8a73\u7d30\u53ef\u4ee5\u53c3\u8003\u4e4b\u524d\u5beb\u7684\u7c21\u5831 20221220 Azure Public IP \u8def\u7531\u504f\u597d\u6559\u6230\u624b\u518a</p> <p>\u9019\u500b\u7bc4\u570d\u5167\u7684\u8def\u7531\u4ea4\u63db\u90fd\u7b97\u662f\u5728 Microsoft Backbone (MSBB) \u7684\u7bc4\u7587\u5167\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u60f3\u50cf\u5982\u679c\u6709\u670d\u52d9\u653e\u5728 Azure \u4e0a\u5c0d\u5916\uff0c\u4f46\u662f\u540c\u6642\u8981\u8ddf\u5176\u4ed6 Azure \u5c0d\u5916\u7684\u670d\u52d9\u6e9d\u901a\uff0c\u5c31\u7b97\u8d70\u516c\u7db2\uff0c\u4ed6\u9084\u662f\u6703\u5728 <code>AS8075</code> \u7684\u7bc4\u570d\u5167\uff0c\u4e0d\u6703\u7e5e\u51fa\u53bb\u5230\u5225\u5bb6\u7684 IX\uff0c\u4f46\u56e0\u70ba IP \u7bc4\u570d\u773e\u591a\uff0c\u9019\u908a Azure \u6709\u7279\u5225\u505a\u4e86\u4e00\u500b <code>Service Tag</code> \u6a5f\u5236\u8b93\u4f60\u4e0a\u9632\u706b\u7246\u8a2d\u5b9a\u6216\u5176\u4ed6\u8a2d\u5b9a\u7684\u6642\u5019\u6bd4\u8f03\u597d\u8a2d\u5b9a</p> <p></p> <p>\u5982\u679c\u50cf\u6211\u662f\u5f9e\u5225\u7684\u5730\u65b9\u9023\u5230 Azure \u670d\u52d9\uff0c\u5982\u4e0b\u5716\uff0c\u4e2d\u9593\u9700\u8981\u7d93\u904e\u5176\u4ed6 PNI \u624d\u80fd\u5230 <code>AS8075</code></p> <p></p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#as12076-azure","title":"\u95dc\u65bc AS12076 - \u5c31\u662f\u689d\u9023\u5411 Azure \u7684\u5c08\u7dda","text":"<p>\u9019\u500b\u865f\u78bc\u53ea\u6709\u4f60\u5728\u8981\u958b\u59cb\u63a5\u5f80 Microsoft \u7684\u5c08\u7dda\uff0c\u4e5f\u5c31\u662f Azure ExpressRoute \u7684\u6642\u5019\u624d\u6703\u51fa\u73fe\uff0c\u4e4b\u524d\u5176\u5be6\u6211\u4e5f\u6709\u4e00\u7bc7\u6587\u7ae0\u5728\u5c08\u9580\u8b1b ExpressRoute\uff0c\u53ef\u53c3\u8003 \u6ed1\u9f20\u9ede\u9ede(?)\u4e4b\u8de8\u570b Azure ExpressRoute \u7db2\u8def\u67b6\u69cb</p> <p>\u57fa\u65bc\u5f37\u8005 Toni Pasanen \u5927\u5927\u7684\u5716\uff0c\u6211\u6539\u6210\u53f0\u7063\u6bd4\u8f03\u5e38\u898b\u7684\u67b6\u69cb</p> <p></p> <p>\u6709\u8da3\u7684\u4e8b\u60c5\u662f 12076 Peering \u7684\u9ede\u662f\u5728 MSEE \u8eab\u4e0a\uff0c\u800c\u4e0d\u662f\u5728 ExpressRoute Gateway \u8eab\u4e0a\uff0c\u610f\u601d\u662f\u5c31\u7b97\u4f60\u6c92\u6709\u628a ExpressRoute Gateway \u958b\u8d77\u4f86\uff0c\u4f60\u9084\u662f\u80fd\u628a 12076 \u8ddf\u4f60\u7684\u5730\u7aef\u8a2d\u5099\u505a BGP Peering</p> <p>\u6b64\u5916\u9019\u689d\u7dda\u82e5\u898f\u683c\u6709\u5230\u7684\u72c0\u6cc1\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u8b93 Microsoft 365 \u548c Dynamic 365 \u7684\u670d\u52d9\u53ef\u4ee5\u8d70\u5c08\u7dda\u8ddf\u5730\u7aef\u9023\u7dda\uff0c\u800c\u4e0d\u662f\u8d70 AS8075 \u51fa\u53bb</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#as65515-azure-networking-private-asn","title":"\u95dc\u65bc AS65515 - Azure Networking \u67b6\u69cb\u8a2d\u8a08\u4e0a\u6700\u91cd\u8981\u7684 Private ASN","text":"<p><code>AS65515</code> \u5728 Azure \u4f86\u8aaa\u662f\u4e00\u500b\u76f8\u7576\u91cd\u8981\u7684 ASN\uff0c\u53cd\u8209 Azure Route Server\u3001Azure vWAN \u9810\u8a2d\u90fd\u6703\u4f7f\u7528\u5230\u9019\u500b\u6578\u5b57\uff0c\u96d6\u7136 Azure VPN Gateway \u53ef\u4ee5\u81ea\u884c\u4fee\u6539\u6210\u60f3\u8981\u7684 Private ASN\uff0c\u4f46\u6211\u500b\u4eba\u5f37\u70c8\u5efa\u8b70\u5982\u679c\u6c92\u6709\u7279\u5225\u9700\u6c42\uff0c\u8acb\u4e00\u7387\u4f7f\u7528 AS65515 \u7576\u6210\u9810\u8a2d Private ASN</p> <p>\u9019\u5f35\u5716\u7b97\u662f\u5e38\u9047\u5230\u7684\u7db2\u8def\u67b6\u69cb\uff0c\u8b6c\u5982\u8aaa\u5bb6\u88e1\u53ea\u6709\u4e00\u500b PPPoE \u53ea\u80fd\u7d81 Static IP \u6216\u8005\u662f\u5916\u5730 Branch Office \u53ea\u6709 1 \u500b WAN IP \u53ef\u7528\u7686\u9069\u7528\u6b64\u5716\uff0c\u5982\u679c\u6709 2 \u500b WAN Port \u5c0d\u4e0a\u4e0d\u540c ISP \u7684\u8a71\uff0c\u5c31\u662f\u5225\u5f35\u67b6\u69cb\u5716\uff0c\u4f46\u5927\u9ad4\u4e0a\u5927\u540c\u5c0f\u7570</p> <p>\u9019\u908a\u6709\u500b\u6709\u8da3\u7684\u5730\u65b9\uff0c\u9019\u5716\u662f\u63a1\u7528 Active-Active Mode \u7684 VPN Gateway \u548c\u555f\u7528 BGP \u72c0\u614b\uff0c\u5982\u679c\u4f60\u63a1\u7528 Loopback \u4ecb\u9762\u4f5c\u70ba BGP Peer Update Source \u7684\u8a71\uff0c\u5176\u5be6\u5c31\u7b97 IPSec Tunnel \u6709 2 \u689d\u53ef\u4ee5\u8d70\uff0c\u4f60\u9084\u662f\u53ef\u4ee5\u7528 Static Route \u4f86\u63a7\u5236 BGP Peering \u7684\u8def\u5f91\uff0c\u4ee5\u4e0a\u5716\u4f86\u770b\u6700\u591a\u53ef\u4ee5\u6253 4 \u689d Static Route \u4e0a\u53bb\u78ba\u4fdd\u4efb\u4e00\u689d IPSec Tunnel \u7dda\u8def\u65b7\u6389\u7684\u6642\u5019\uff0cBGP Peering \u9084\u662f\u53ef\u4ee5\u8fc5\u901f\u6062\u5fa9\u6210 Establish \u72c0\u614b\uff0c\u5be6\u6e2c\u904e\u7684\u78ba\u883b\u6709\u6548\u679c\u7684</p> No. VPN GW Insntace Destination Interface Comment 1 IN_0 10.0.0.4/32 VTI 1 \u5e38\u898b\u9023\u7dda\u8def\u7dda 2 IN_1 10.0.0.5/32 VTI 2 \u5e38\u898b\u9023\u7dda\u8def\u7dda 3 IN_0 10.0.0.4/32 VTI 2 \u53ef\u8d70 IPSec Tunnel 2 \u9023\u7dda\u5230 IN_0 \u800c\u4e0d\u662f IN_1 4 IN_1 10.0.0.5/32 VTI 1 \u53ef\u8d70 IPSec Tunnel 1 \u9023\u7dda\u5230 IN_1 \u800c\u4e0d\u662f IN_0 <p>\u4e0b\u8868\u662f\u5730\u7aef\u8a2d\u5099 BGP Summary \u7684\u9577\u76f8</p> <pre><code>VRF 0 BGP router identifier Y.Y.Y.Y, local AS number 64500\nBGP table version is 132\n2 BGP AS-PATH entries\n0 BGP community entries\n\nNeighbor    V         AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n10.0.0.4    4      65515   32816   32873      131    0    0 03:40:13        5\n10.0.0.5    4      65515   26617   26697      130    0    0 1d20h26m        5\n\nTotal number of neighbors 2\n</code></pre>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#as65520-","title":"\u95dc\u65bc AS65520 - \u6211\u5176\u5be6\u4e5f\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u6587\u4ef6\u6c92\u89e3\u91cb","text":"<p>\u96d6\u7136\u6587\u4ef6\u6c92\u5beb\uff0c\u9019\u500b\u865f\u78bc\u53ea\u6703\u51fa\u73fe\u5728\u4f60\u7528 vWAN \u7136\u5f8c\u6709 vHub to vHub \u7684\u6642\u5019\u624d\u6703\u5728\u8def\u7531\u8868\u4e0a\u9762\u8df3\u51fa\u4f86 AS65520 \u9019\u500b\u865f\u78bc\uff0c\u5927\u9ad4\u4e0a\u4f60\u4e5f\u6c92\u8fa6\u6cd5\u63a7\u5236\u4ed6\uff0c\u9019\u908a\u53ea\u662f\u89e3\u91cb\u4e00\u4e0b\u6709\u5b83\u7684\u5b58\u5728\uff0c\u770b\u8def\u7531\u8868\u7684\u6642\u5019\u624d\u4e0d\u6703\u89ba\u5f97\u88ab BGP Hijacking \u4e86</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#qa","title":"Q&amp;A","text":"","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q1-tldr","title":"Q1: TL;DR","text":"<p>A1: \u53cd\u6b63\u8a18\u5f97\u9078\u64c7 <code>65515</code> \u7576\u4f5c\u4f60\u5728\u96f2\u7aef\u7684 Private ASN \u5c31\u5c0d\u4e86</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q2-as65515-ibgp","title":"Q2: \u90a3\u6211\u53ef\u4ee5\u628a AS65515 \u5ef6\u4f38\u5230\u5730\u7aef\u505a iBGP \u55ce?","text":"<p>A2: \u4e0d\u884c\uff0c\u90e8\u7f72 Local Network Gateway \u670d\u52d9\u6703\u5931\u6557</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q3-as12076-as65515","title":"Q3: \u5982\u679c\u6211\u5c0d AS12076 \u548c AS65515 \u653e\u540c\u4e00\u6bb5\u8def\u7531\uff0c\u4ed6\u6703\u8d70\u54ea\u4e00\u689d?","text":"<p>A3: \u9019\u500b\u554f\u984c\u6bd4\u8f03\u8907\u96dc\uff0c\u626f\u5230\u8def\u7531\u6700\u4f73\u5316\u7684\u9078\u64c7\uff0c\u4e4b\u5f8c\u518d\u4f86\u5beb\u6587\u7ae0\u89e3\u91cb</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q4-azure-vpn-gateway-2-public-ip-public-ip","title":"Q4: Azure VPN Gateway \u65e2\u7136\u53ef\u4ee5\u8a2d\u5b9a 2 \u500b Public IP\uff0c\u90a3\u9069\u7528\u65bc Public IP \u8def\u7531\u504f\u597d\u55ce?","text":"<p>A4: \u53ef\u4ee5\uff0c\u4f46\u4f60\u9700\u8981\u65bc\u5efa\u7acb VPN Gateway \u4e4b\u524d\u5148\u628a 2 \u500b Public IP \u5148\u6e96\u5099\u597d\uff0c\u9810\u8a2d\u90fd\u662f\u504f\u597d Microsoft \u70ba\u4e3b\uff0c\u8b93\u4f7f\u7528\u8005\u8d8a\u5feb\u63a5\u5230 Azure \u7db2\u8def\u8d8a\u597d</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q5-azure-vpn-gateway-gatewaysubnet-azure-expressroute-gateway","title":"Q5: \u5982\u679c\u6211\u6709\u4e00\u500b Azure VPN Gateway \u7684\u8a71\uff0c\u5df2\u7d93\u4f7f\u7528\u4e86 GatewaySubnet\uff0c\u82e5\u5f8c\u7e8c\u9700\u8981\u518d\u958b\u4e00\u500b Azure ExpressRoute Gateway \u7684\u8a71\uff0c\u9700\u8981\u91cd\u65b0\u914d\u7db2\u6bb5\u55ce?","text":"<p>A5: \u4e0d\u7528\uff0c\u9810\u8a2d\u90fd\u6703\u628a\u670d\u52d9\u653e\u5728 GatewaySubnet \u7db2\u6bb5\u5167</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#q6-active-active-vpn-gateway-ecmp-equal-cost-multi-path","title":"Q6: Active-Active \u72c0\u614b\u7684 VPN Gateway \u6709\u6c92\u6709\u652f\u63f4 ECMP (Equal Cost Multi-Path)?","text":"<p>A6: \u6709\uff0c\u50c5\u9650\u63a1\u7528 BGP \u6a21\u5f0f\uff0cStatic Route \u662f\u6c92\u652f\u63f4\u7684\uff0c\u6b64\u5916\u4f60\u5730\u7aef\u8a2d\u5099\u7121\u8ad6\u662f\u9632\u706b\u7246\u6216 VPN \u8a2d\u5099\u8981\u81ea\u5df1\u8655\u7406\u975e\u5c0d\u7a31\u8def\u7531 (Asymmetric Routing) \u7684\u554f\u984c\uff0c\u4e0d\u7136\u56de\u4f86\u525b\u597d\u8d70\u4e0d\u540c\u8def\uff0cFirewall \u6c92\u7279\u5225\u8a2d\u5b9a\u7684\u8a71\u6703\u4e1f\u6389\u5c01\u5305</p>","tags":["azure","vpn","bgp"]},{"location":"20240302-general-bgp-common-sense-in-azure-networking.html#_1","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u6700\u8fd1\u4e0a\u5de5\u6392\u6642\u9593\uff0c\u5df2\u7d93\u9700\u8981\u770b\u8fb2\u6c11\u66c6\u9078\u65e5\u5b50\u7684\u968e\u6bb5\u4e86...\u5982\u679c\u641e\u5176\u4ed6\u670d\u52d9\u6211\u662f\u89ba\u5f97\u53ef\u4ee5\u53c3\u8003<code>\u71df\u5efa\u985e</code>\uff0c\u8b6c\u5982\u8aaa\u4ec0\u9ebc\u5b89\u9580\u3001\u52d5\u571f\u3001\u4e0a\u6a11\uff0c\u8c4e\u4e95\u4ec0\u9ebc\u7684\uff0c\u4f46\u4f60\u5982\u679c\u662f\u52d5\u7db2\u8def\u7684\u8a71\uff0c\u6211\u6700\u8fd1\u7684\u5fc3\u5f97\u662f\u8981\u770b<code>\u796d\u7940\u985e</code>\u7684\uff0c\u8b6c\u5982\u8aaa\u7948\u798f\u3001\u958b\u5149\u3001\u666e\u6e21\u3001\u796d\u7940\u4e4b\u985e\u7684</p> <p>\u6709\u4e9b\u6642\u5019\u5c31\u662f\u4f60\u6e96\u5099 100 \u5206\uff0c\u4f46\u7e3d\u6703\u6709\u500b\u4f60\u60f3\u90fd\u6c92\u60f3\u904e\u7684\u4e8b\u60c5\u767c\u751f</p>","tags":["azure","vpn","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html","title":"Azure VPN Gateway \u5be6\u8e10 BGP + ECMP: \u4ee5 FortiGate \u70ba\u4f8b","text":"<p>\u672c\u6587\u63d0\u4f9b\u5982\u4f55\u5efa\u7acb IPSec VPN \u53ca BGP \u9023\u7dda\u8def\u7531\uff0c\u5f9e\u5730\u7aef ForiGate \u5230 Azure VPN Gateway (Active-Active + BGP + ECMP) \u904e\u7a0b</p> <p></p> <p>\u6211\u9019\u5929\u60f3\u4e86\u4e00\u4e0b\u5982\u679c\u7528 Tifa \u7684\u5716\uff0c\u53ef\u80fd\u6d89\u53ca\u5230 D&amp;I \u689d\u6b3e\uff0c\u70ba\u4e86\u6211\u6241\u6241\u7684\u8377\u5305\u8457\u60f3\uff0c\u5404\u4f4d\u56de\u5bb6\u81ea\u5df1\u770b\u96fb\u8166</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#kubernetes-community-days-taipei-2024","title":"(\u793e\u7fa4\u5de5\u5546\u6642\u9593) Kubernetes Community Days Taipei 2024","text":"<p>\u6700\u8fd1\u6b63\u5728\u958b\u59cb\u7c4c\u5099 Kubernetes Community Days Taipei 2024\uff0c\u4e0b\u9762\u662f\u5e7e\u500b\u660e\u78ba\u7684\u6642\u7a0b\u8868:</p> <ul> <li>KCD Taipei 2024 CFP \u958b\u59cb: 2024/3/31</li> <li>KCD Taipei 2024 CFP \u7d50\u675f: 2024/5/9</li> <li>KCD Taipei 2024 \u8b70\u7a0b\u767c\u5e03: 2024/7/7</li> <li>COSCUP 2024 \u6d3b\u52d5\u8209\u8fa6: 2024/8/3 - 2024/8/4</li> </ul> <p>\u6211\u5011\u6700\u8fd1 \u4e00\u7fa4\u7528\u611b\u767c\u96fb\u7684\u963f\u5b85\u5011\u6301\u7e8c\u6293\u982d\u627e\u8d0a\u52a9\u4e2d\uff0c\u5982\u679c\u6709\u5404\u5927\u516c\u53f8\u9858\u610f\u7576 Kubernetes Community Days Taipei 2024 \u4e7e\u7239\u4e7e\u5abd\u7684\u8a71\uff0c\u53ef\u4ee5\u806f\u7e6b organizers [at] cloudnative.tw</p> <p>\u904e\u5f80\u6d3b\u52d5\u7d00\u9304 KCD Taiwan 2023</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#_1","title":"\u7e3d\u9ad4\u67b6\u69cb\u5716","text":"<p>\u5efa\u8b70\u4e0b\u8f09\u9019\u5f35\u5716\u5c0d\u7167\u4e0b\u9762\u8a2d\u5b9a\uff0cIP \u548c\u540d\u7a31\u662f\u53ef\u4ee5\u5c0d\u9f4a\u4e0b\u9762\u7684\u6240\u6709\u5167\u5bb9\u548c\u8a2d\u5b9a</p> <p></p> <p>\u7136\u5f8c\u5206\u70ba 2 \u500b\u89d2\u5ea6\u8655\u7406</p> <ol> <li>\u96f2\u7aef Azure \u65b9</li> <li>\u5730\u7aef FortiGate \u65b9</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#a-azure","title":"A. \u96f2\u7aef Azure \u65b9","text":"","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#1","title":"1. \u9078\u5927\u672c\u71df\uff0c\u958b\u59cb\u6316\u7db2\u8def","text":"<p>\u4f60\u9700\u8981\u5148\u9078\u5b9a\u5176\u4e2d\u4e00\u500b Azure Region \u5340\u57df\uff0c\u4e26\u4e14\u5efa\u7acb\u4e00\u500b\u65b0\u7684 Virtual Network \u7db2\u6bb5\uff0c\u4e26\u4e14\u5728\u88e1\u9762\u5efa\u7acb\u4e00\u500b\u4fdd\u7559\u5b50\u7db2\u6bb5 GatewaySubnet\uff0c\u4e14\u6700\u5c0f\u7684\u7db2\u6bb5\u5927\u5c0f\u70ba /27</p> <p>\u5982\u672c\u5716\u662f\u5728 Azure Region: Japan East \u5efa\u7acb Virtual Network \u540d\u7a31\u70ba vnet-hub-japaneast 10.0.0.0/24\uff0c\u6839\u64da Visual Subnet Calculator (Azure Edition) \u7684\u8a08\u7b97\uff0c\u53ef\u4ee5\u5728\u9019\u500b\u7db2\u6bb5\u5167\u518d\u5efa\u7acb\u4e00\u500b 10.0.0.0/27 \u7684\u5b50\u7db2\u6bb5\uff0c\u4e14\u4f7f\u7528\u4fdd\u7559\u5b50\u7db2\u6bb5\u540d\u7a31\u70ba <code>GatewaySubnet</code></p> <p>\u4e00\u822c\u6211\u90fd\u6703\u8aaa\u9019\u6a23\u5b50\u7684\u74b0\u5883\u5c31\u662f Hub-Spoke \u7db2\u8def\u67b6\u69cb\u7684 Hub \u90e8\u5206</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#2-azure-vpn-gateway","title":"2. \u5efa\u7acb Azure VPN Gateway","text":"<p>\u56e0\u70ba Azure VPN Gateway \u7684\u53c3\u6578\u9078\u64c7\u6703\u5f71\u97ff\u5230\u5f8c\u7e8c\u67b6\u69cb\u7684\u8a2d\u8a08\uff0c\u6211\u5efa\u8b70\u5148\u5f9e\u4e0b\u9762\u9019\u7a2e\u6b63\u5e38\u65b9\u5f0f\u958b\u5c40\uff0e\u4e5f\u662f\u6700\u901a\u7528\u7684\u67b6\u69cb</p> <ul> <li>2 \u500b Public IP \u53ef\u4ee5\u8b93\u4f60\u5efa\u7acb IPSec Tunnel</li> <li>\u555f\u7528 BGP \u4e26\u4e14\u8a2d\u5b9a <code>AS65515</code> \u70ba\u96f2\u7aef\u7684 AS Number\uff0c\u7406\u7531\u53ef\u53c3\u8003\u6b64\u6587 Azure Networking \u4e4b BGP \u666e\u901a\u5e38\u8b58</li> </ul> <p></p> <p>\u6309\u7167\u9019\u500b\u8a2d\u5b9a\u4f86\u8aaa\uff0c\u56e0 GatewaySubnet \u662f 10.0.0.0/27\uff0c\u53ef\u4ee5\u5206\u6790\u4e00\u4e0b\u9019\u7db2\u6bb5\u5728\u5e79\u561b</p> \u670d\u52d9 IP \u4f5c\u7528 Azure 10.0.0.1 Gateway IP Azure 10.0.0.2 \u4fdd\u7559\u7d66 DNS \u7528 Azure 10.0.0.3 \u4fdd\u7559\u7d66 DNS \u7528 VPN IN_O 10.0.0.4 IN_0 \u7684 BGP Peering IP\uff0c\u9019\u665a\u4e00\u9ede\u6703\u7528\u5230 VPN IN_1 10.0.0.5 IN_1 \u7684 BGP Peering IP\uff0c\u9019\u665a\u4e00\u9ede\u6703\u7528\u5230","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#3-local-network-gateway","title":"3. \u5efa\u7acb Local Network Gateway","text":"<p>1 \u500b Local Network Gateay \u53ea\u80fd\u63cf\u8ff0 1 \u500b\u5730\u7aef\u5c0d\u5916 IP \u548c 1 \u500b BGP Peering \u8cc7\u8a0a</p> <p></p> <p>\u9019\u9801\u8a2d\u5b9a\u662f\u8981\u4f86\u63cf\u8ff0\u5730\u7aef\u8a2d\u5099\u7684\u57fa\u672c\u53c3\u6578\uff0c\u4f60\u9700\u8981\u5148\u77e5\u9053\u4f60</p> <p>Local Network Gateway \u500b\u6578 = \u6709\u591a\u5c11 WAN Port \u8981\u9023\u4e0a\u4f86 * \u8a72\u8a2d\u5099\u6709\u591a\u5c11\u500b BGP \u9700\u8981\u8ddf Azure Peering * \u7ad9\u9ede\u6578\u91cf</p> <p>\u8b6c\u5982\u8aaa\u4e0a\u5716\u5c31\u662f\uff0c\u6211\u53ea\u6709 1 \u500b WAN Port \u5c0d\u5916\uff0c\u6211\u4e5f\u53ea\u6709\u4e00\u500b BGP 65510 \u9700\u8981\u8ddf Azure Peering\uff0c\u7ad9\u53f0\u6578\u91cf\u7e3d\u5171\u4e5f\u624d 1 \u500b\uff0c\u6240\u4ee5\u6211\u53ea\u9700\u8981\u5efa\u7acb\u4e00\u500b Local Network Gateway \u5373\u53ef</p> <p>\u6211\u77e5\u9053\u6709\u4eba\u5bb6\u88e1\u662f 2 \u500b WAN Port \u7136\u5f8c\u4e0d\u540c ISP\uff0c\u6240\u4ee5\u6309\u7167\u4e0a\u9762\u908f\u8f2f\uff0c\u4f60\u9700\u8981\u5efa\u7acb 2 \u500b Local Network Gateway</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#4-connection-local-network-gateway-azure-vpn-gateway","title":"4. \u7528 Connection \u9023\u63a5 Local Network Gateway \u548c Azure VPN Gateway","text":"<p>\u9019\u9801\u4e3b\u8981\u662f\u5728\u63cf\u8ff0 Azure VPN Gateway \u7684\u5177\u9ad4\u53c3\u6578\u8981\u600e\u9ebc\u8ddf\u5730\u7aef\u8a2d\u5099\u9023\u63a5\uff0c\u57fa\u672c\u4e0a\u6c92\u610f\u5916\u90fd\u662f\u9810\u8a2d\u503c\uff0c\u5982\u679c\u6709\u554f\u984c\u7684\u8a71\uff0c\u5efa\u8b70\u770b\u4f60\u5730\u7aef\u8a2d\u5099\u7684 IPsec / IKE policy \u6709\u6c92\u6709\u4ec0\u9ebc\u9577\u5f97\u5f88\u4e0d\u4e00\u6a23\u7684\u8981\u7279\u5225\u8abf\u6574\uff0c\u901a\u5e38\u5efa\u7acb\u4e0d\u8d77\u4f86\u7684\u4e3b\u8981\u539f\u56e0\u662f\u5169\u908a\u7684\u52a0\u5bc6\u9078\u64c7\u5c0d\u4e0d\u8d77\u4f86\uff0c\u8981\u7279\u5225\u8abf\u6574</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#b-fortigate","title":"B. \u5730\u7aef FortiGate \u65b9","text":"<p>\u56e0\u70ba\u6211\u5bb6\u53ea\u6709 FortiGate \u53ef\u4ee5\u7528\uff0c\u6240\u4ee5\u4e0b\u9762\u5c31\u4ee5 FortiGate \u7684\u8a2d\u5099\u70ba\u4e3b\uff0c\u5982\u679c\u4f60\u662f\u5176\u4ed6\u5bb6\u7684\u8a2d\u5099\u4e5f\u53ef\u4ee5\u81ea\u884c\u53c3\u8003\uff0c\u6211\u90fd\u662f\u7528\u57fa\u672c\u8a2d\u5b9a\uff0c\u5927\u90e8\u5206\u61c9\u8a72\u90fd\u6c92\u7528\u4ec0\u9ebc\u7279\u6b8a\u7684\u9ed1\u9b54\u6cd5</p> <p>\u6b64\u5916\uff0c\u56e0\u70ba\u6211\u672c\u8eab\u4e5f\u4e0d\u662f\u5c08\u7cbe FortiGate\uff0c\u90fd\u662f\u53d7\u5ba2\u6236\u9a45\u52d5\u624d\u53bb\u8cb7\u4e86\u4e00\u53f0\u56de\u5bb6\u81ea\u5df1\u641e\uff0c\u5982\u679c\u6709\u4efb\u4f55\u8a2d\u5b9a\u4e0d\u5408\u7406\u6216\u8005\u662f\u6f0f\u4e86\uff0c\u6b61\u8fce\u6307\u6b63\uff0c\u6211\u6703\u975e\u5e38\u611f\u8b1d\u4f60\uff0c\u53f0\u7063\u5f88\u591a\u7532\u65b9\u540c\u884c\u4e5f\u6703\u5f88\u591a\u4eba\u6703\u611f\u8b1d\u4f60</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#0","title":"0. \u7248\u672c\u8cc7\u8a0a","text":"<ul> <li>ForiOS v6.4</li> </ul>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#1_1","title":"1. \u76e4\u4e00\u4e0b\u4ecb\u9762","text":"system-interface<pre><code>homecloud-fgt # show system interface\nconfig system interface\n    edit \"wan1\"\n        set vdom \"root\"\n        set mode pppoe\n        set allowaccess ping\n        set type physical\n        set lldp-reception disable\n        set monitor-bandwidth enable\n        set role wan\n        set snmp-index 1\n        set username \"pinhuang@ip.microsoft.com\"\n        set password ENC tifaismywife\n    next\n    edit \"loopback\" # (1)\n        set vdom \"root\"\n        set ip 1.2.3.4 255.255.255.255 # (4)\n        set allowaccess ping https ssh http\n        set bfd enable # (5)\n        set type loopback\n        set role lan\n        set snmp-index 15\n    next\n    edit \"azure-tunnel-1\" # (2)\n        set vdom \"root\"\n        set allowaccess ping\n        set type tunnel\n        set snmp-index 19\n        set interface \"wan1\"\n    next\n    edit \"azure-tunnel-2\" # (3)\n        set vdom \"root\"\n        set allowaccess ping\n        set type tunnel\n        set snmp-index 20\n        set interface \"wan1\"\n    next\n</code></pre> <ol> <li>\u5229\u7528 loopback interface \u6c38\u9060\u90fd\u662f UP \u7684\u7279\u6027\u548c\u63d0\u4f9b\u591a\u689d\u5be6\u9ad4\u6216\u865b\u64ec\u7dda\u8def\u4e2d\u9032\u884c\u8ca0\u8f09\u5e73\u8861\u6216\u5197\u9918\u7684\u7279\u6027\uff0c\u4f86\u63d0\u4f9b BGP Peering \u7684 IP \u4f4d\u7f6e\uff0c\u800c\u975e\u63a1\u7528 Interface IP \u4f86\u63d0\u4f9b</li> <li>\u9019\u500b\u9700\u8981\u7b49 IPsec \u5efa\u7acb\u4e4b\u5f8c\u624d\u6703\u51fa\u73fe</li> <li>\u9019\u500b\u9700\u8981\u7b49 IPsec \u5efa\u7acb\u4e4b\u5f8c\u624d\u6703\u51fa\u73fe</li> <li>\u6211\u60f3\u5927\u5bb6\u90fd\u5c08\u696d\u7684\uff0c\u4f60\u4e5f\u77e5\u9053\u6211\u9019\u662f\u4e82\u5beb\u7684\uff0c\u4e0d\u8981\u8a8d\u771f</li> <li>Azure VPN Gateway \u672c\u8eab\u6c92\u652f\u63f4 BFD\uff0c\u4f46 ExpressRoute Gateway \u6709</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#2-ipsec-tunnel","title":"2. \u6316 IPsec Tunnel","text":"<p>\u5c31\u662f\u7167\u8457\u5b98\u65b9\u6587\u4ef6\u5beb FortiGate - IPsec VPN to Azure with virtual network gateway \u8a2d\u5b9a\u5373\u53ef\uff0c\u57fa\u672c\u4e0a\u6c92\u5565\u592a\u5927\u554f\u984c</p> phase 1<pre><code>homecloud-fgt # show vpn ipsec phase1-interface\nconfig vpn ipsec phase1-interface\n    edit \"azure-tunnel-1\"\n        set interface \"wan1\"\n        set ike-version 2\n        set keylife 28800\n        set peertype any\n        set net-device disable\n        set proposal aes256-sha1 3des-sha1 aes256-sha256\n        set dpd on-idle\n        set dhgrp 2\n        set nattraversal disable\n        set remote-gw &lt;Azure VPN Public IP IN_0&gt;\n        set psksecret ENC n0gam3n0l1f3\n    next\n    edit \"azure-tunnel-2\"\n        set interface \"wan1\"\n        set ike-version 2\n        set keylife 28800\n        set peertype any\n        set net-device disable\n        set proposal aes256-sha1 3des-sha1 aes256-sha256\n        set dpd on-idle\n        set dhgrp 2\n        set nattraversal disable\n        set remote-gw &lt;Azure VPN Public IP IN_1&gt;\n        set psksecret ENC n0gam3n0l1f3\n    next\nend\n</code></pre> phase 2<pre><code>homecloud-fgt # show vpn ipsec phase2-interface\nconfig vpn ipsec phase2-interface\n    edit \"azure-tunnel-1\"\n        set phase1name \"azure-tunnel-1\"\n        set proposal aes256-sha1 3des-sha1 aes256-sha256\n        set pfs disable\n        set auto-negotiate enable # (1)\n        set keylifeseconds 27000\n    next\n    edit \"azure-tunnel-2\"\n        set phase1name \"azure-tunnel-2\"\n        set proposal aes256-sha1 3des-sha1 aes256-sha256\n        set pfs disable\n        set auto-negotiate enable # (2)\n        set keylifeseconds 27000\n    next\nend\n</code></pre> <ol> <li>\u9019\u500b\u5b98\u65b9\u6587\u4ef6\u6c92\u5beb\uff0c\u4f46\u6211\u6709\u52a0\uff0c\u4e3b\u8981\u662f\u70ba\u4e86 keepalive enable\uff0c\u9019\u500b\u770b\u8d77\u4f86\u662f\u85cf\u8d77\u4f86\u7684\u53c3\u6578</li> <li>\u9019\u500b\u5b98\u65b9\u6587\u4ef6\u6c92\u5beb\uff0c\u4f46\u6211\u6709\u52a0\uff0c\u4e3b\u8981\u662f\u70ba\u4e86 keepalive enable\uff0c\u9019\u500b\u770b\u8d77\u4f86\u662f\u85cf\u8d77\u4f86\u7684\u53c3\u6578</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#3-firewall-policy","title":"3. \u958b\u901a Firewall Policy","text":"<p>\u6bcf\u4e00\u689d Tunnel \u6700\u5c11\u90fd\u8981\u6709 2 \u500b Policy\uff0c\u53bb\u8ddf\u56de\u90fd\u8981\uff0c\u56e0\u70ba Azure VPN Gateway \u6709 2 \u500b Public IP \u53ef\u4ee5\u5efa\u7acb Tunnel\uff0c\u6240\u4ee5\u4f60\u6700\u5c11\u9700\u8981\u5efa\u7acb 4 \u500b Policy</p> Firewall Policy<pre><code>homecloud-fgt # show firewall policy\nconfig firewall policy\n    edit 7\n        set name \"toAzure-over-azure-tunnel-1\"\n        set srcintf \"Zone-BigSwitch\"\n        set dstintf \"azure-tunnel-1\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set action accept\n        set schedule \"always\"\n        set service \"ALL\"\n        set tcp-mss-sender 1350 # (1)\n        set tcp-mss-receiver 1350 # (2)\n    next\n    edit 11\n        set name \"toAzure-over-azure-tunnel-2\"\n        set srcintf \"Zone-BigSwitch\"\n        set dstintf \"azure-tunnel-2\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set action accept\n        set schedule \"always\"\n        set service \"ALL\"\n        set tcp-mss-sender 1350\n        set tcp-mss-receiver 1350\n    next\n    edit 10\n        set name \"FromAzure-over-azure-tunnel-1\"\n        set srcintf \"azure-tunnel-1\"\n        set dstintf \"Zone-BigSwitch\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set action accept\n        set schedule \"always\"\n        set service \"ALL\"\n        set tcp-mss-sender 1350\n        set tcp-mss-receiver 1350\n    next\n    edit 12\n        set name \"FromAzure-over-azure-tunnel-2\"\n        set srcintf \"azure-tunnel-2\"\n        set dstintf \"Zone-BigSwitch\"\n        set srcaddr \"all\"\n        set dstaddr \"all\"\n        set action accept\n        set schedule \"always\"\n        set service \"ALL\"\n        set tcp-mss-sender 1350\n        set tcp-mss-receiver 1350\n    next\nend\n</code></pre> <ol> <li>TCP MSS \u8981 1350\uff0c\u5982\u679c\u6c92\u652f\u63f4\u7684\u53c3\u6578\u7684\u8a71\uff0c\u627e\u4e00\u4e0b MTU \u8981 1400 bytes</li> <li>TCP MSS \u8981 1350\uff0c\u5982\u679c\u6c92\u652f\u63f4\u7684\u53c3\u6578\u7684\u8a71\uff0c\u627e\u4e00\u4e0b MTU \u8981 1400 bytes</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#4-ipsec-tunnel","title":"4. \u4e2d\u5834\u6aa2\u67e5\u4e00\u4e0b IPSec Tunnel \u72c0\u614b","text":"<p>\u7562\u7adf BGP Peering \u662f\u57fa\u65bc IPsec Tunnel \u800c\u6210\uff0c\u5982\u679c\u6c92\u6709\u5148\u628a IPsec \u5148\u641e\u597d\u7684\u8a71\uff0c\u5f8c\u9762\u4e0d\u7528\u505a\uff0c\u6240\u4ee5\u9019\u908a\u8981\u9032\u884c\u6aa2\u67e5\u78ba\u8a8d</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#fortigate","title":"\u5f9e FortiGate \u89d2\u5ea6\u770b","text":"<p>\u770b\u5230 <code>selectors(total,up): 1/1</code> \u5c31\u662f\u6b63\u5e38\u7684</p> Get VPN IPsec Tunnel Summary<pre><code>homecloud-fgt # get vpn ipsec tunnel summary\n'azure-tunnel-2' &lt;Azure VPN Public IP IN_1&gt;:0  selectors(total,up): 1/1  rx(pkt,err): 98031/0  tx(pkt,err): 157394/0\n'azure-tunnel-1' &lt;Azure VPN Public IP IN_0&gt;:0  selectors(total,up): 1/1  rx(pkt,err): 111535/0  tx(pkt,err): 223401/1\n</code></pre>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#azure","title":"\u5f9e Azure \u7684\u89d2\u5ea6\u770b","text":"<p>\u770b\u5230 Local Network Gateway \u4e2d Status \u90a3\u4e00\u6b04\u5448\u73fe <code>Connected</code> \u624d\u662f\u6b63\u78ba\u7684</p> <p></p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#5-bgp","title":"5. \u4f7f\u51fa\u666e\u901a BGP \u653b\u64ca\u9b54\u6cd5","text":"<p>\u6211\u9084\u662f\u9700\u8981\u7533\u660e\u4e00\u4e0b\uff0c\u4e0b\u9762\u8a2d\u5b9a\u662f\u6211\u500b\u4eba\u5bb6\u88e1\u7684\u8a2d\u5b9a\uff0c\u53ef\u80fd\u4e0d\u9069\u7528\u65bc\u4f60\u7684\u74b0\u5883\uff0c\u53ef\u81ea\u884c\u8abf\u6574\uff0c\u9019\u908a\u53ea\u662f\u63d0\u4f9b\u53c3\u8003\uff0c\u4f46\u5982\u679c\u4f60\u89ba\u5f97\u54ea\u88e1\u8a2d\u5b9a\u602a\u602a\u7684\u6216\u6709\u6f0f\u7684\uff0c\u76f8\u7576\u6b61\u8fce\u8ddf\u6211\u8b1b\uff0c\u6211\u6703\u4fee\u6b63\u4f86\u5e6b\u52a9\u66f4\u591a\u8f9b\u82e6\u7684\u7db2\u8def\u5de5\u7a0b\u5e2b</p> Config BGP<pre><code>homecloud-fgt # show router bgp\nconfig router bgp\n    set as 65510\n    set router-id 1.2.3.4\n    set keepalive-timer 5 # (1)\n    set holdtime-timer 10 # (2)\n    set ebgp-multipath enable # (3)\n    set multipath-recursive-distance enable # (4)\n    set graceful-restart enable\n    set fast-external-failover enable # (9)\n    config neighbor\n        edit \"10.0.0.5\" # (5)\n            set advertisement-interval 1 # (6)\n            set ebgp-enforce-multihop enable # (7)\n            set link-down-failover enable # (8)\n            set soft-reconfiguration enable\n            set interface \"azure-tunnel-2\" # (10)\n            set remote-as 65515 # (11)\n            set update-source \"loopback\" # (12)\n        next\n        edit \"10.0.0.4\"\n            set advertisement-interval 1\n            set ebgp-enforce-multihop enable\n            set link-down-failover enable\n            set soft-reconfiguration enable\n            set interface \"azure-tunnel-1\"\n            set remote-as 65515\n            set update-source \"loopback\"\n        next\n    end\n    config redistribute \"connected\"\n        set status enable\n    end\n    config redistribute \"rip\"\n    end\n    config redistribute \"ospf\"\n    end\n    config redistribute \"static\"\n        set status enable # (13)\n    end\n    config redistribute \"isis\"\n    end\n    config redistribute6 \"connected\"\n    end\n    config redistribute6 \"rip\"\n    end\n    config redistribute6 \"ospf\"\n    end\n</code></pre> <ol> <li>\u76ee\u524d\u6709\u5f37\u8005\u6211\u5ba2\u6236\u5be6\u6e2c\u8abf\u5230\u9019\u6578\u5b57 Failover \u6642\u9593\u5f88\u597d\uff0c\u6211\u4e4b\u524d\u662f\u8a2d\u5b9a 10</li> <li>\u76ee\u524d\u6709\u5f37\u8005\u6211\u5ba2\u6236\u5be6\u6e2c\u8abf\u5230\u9019\u6578\u5b57 Failover \u6642\u9593\u5f88\u597d\uff0c\u6211\u4e4b\u524d\u662f\u8a2d\u5b9a 30</li> <li>\u56e0\u70ba\u6211\u662f\u7528 Loopback IP \u800c\u4e0d\u662f Interface IP\uff0c\u5982\u679c\u4e0d\u9ede\u7684\u8a71\uff0c\u9810\u8a2d eBGP TTL \u662f 1\uff0c\u8ddf\u73fe\u884c\u67b6\u69cb\u81f3\u5c11\u8df3 2 \u8df3\u6703\u5c0e\u81f4\u9023\u4e0d\u4e0a\uff0c\u5f97\u958b\uff0c\u8a73\u7d30\u8acb\u6d3d Forti \u6587\u4ef6</li> <li>\u56e0\u70ba\u6211\u63a1\u7528 BGP ECMP \u8def\u7531\uff0c\u6709\u7279\u5225\u958b\u9019\u500b\uff0c\u8a73\u7d30\u8acb\u6d3d Forti \u6587\u4ef6</li> <li>\u9019\u500b\u5c31\u662f Azure VPN Gateway \u63d0\u4f9b\u7684\u5176\u4e2d\u4e00\u500b BGP Peer IP</li> <li>MRAI \u6211\u662f\u7528\u9810\u8a2d\u503c, \u6c92\u7279\u5225\u6539, \u4f46\u4f60\u60f3\u8981\u8a2d\u5b9a 0 \u4e5f\u662f\u53ef\u4ee5</li> <li>\u9019\u500b\u6703\u5f71\u97ff ebgp-multihop-ttl \u5f9e\u9810\u8a2d\u503c 1 \u8b8a\u6210 255</li> <li>\u4e00\u65e6 VPN Tunnel \u4e0d\u5c0f\u5fc3\u8df3\u8d77\u4f86\u7684\u8a71\uff0cForti \u6703\u81ea\u52d5\u95dc\u9589 BGP Neighbor \u4e26\u4e14\u522a\u9664\u76f8\u95dc\u8def\u7531\uff0c\u907f\u514d\u8d70\u932f\u8def</li> <li>\u9019\u500b\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u4e0d\u6703\u51fa\u73fe\u5728\u8a2d\u5b9a\u6a94\u5167\uff0c\u4f46\u770b\u8d77\u4f86\u662f\u6709\u555f\u52d5\uff0c\u6211\u81ea\u5df1\u88dc\u5beb\u4e0a\u53bb</li> <li>\u9019\u500b\u5c31\u662f\u8d70 azure-tunnel-2 \u8def\u7dda\u53bb BGP Peering</li> <li>Azure VPN Gateway \u6240\u8a2d\u5b9a\u7684 BGP ASN</li> <li>\u8981\u7279\u5225\u6307\u5b9a loopback \u4f5c\u70ba BGP Peer \u7684 Update Source</li> <li>BGP Peering \u8def\u7531\u6211\u662f\u7528 Static Route \u653e\u7684\uff0c\u6240\u4ee5\u9019\u500b\u8981\u52fe\uff0c\u4f60\u5982\u679c\u662f\u5225\u7684\u65b9\u5f0f redistribute \u8def\u7531\uff0c\u5c31\u81ea\u884c\u8abf\u6574</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#6-static-route","title":"6. \u4e0a Static Route","text":"<p>\u9019\u908a\u662f\u70ba\u4e86\u8981\u505a BGP Peering \u4e4b\u7528\uff0c\u6211\u9700\u8981\u653e\u8def\u7531\u6307\u5411\u7279\u5b9a\u7684 Interface\uff0c\u5982\u679c\u4f60\u6709\u5176\u4ed6\u719f\u6089\u7684\u65b9\u5f0f\u53ef\u4ee5\u9054\u5230\u540c\u6a23\u7684\u6548\u679c\uff0c\u4e5f\u53ef\u4ee5\u7528\u5176\u4ed6\u65b9\u5f0f\uff0c\u9019\u908a\u53ea\u662f\u63d0\u4f9b\u53c3\u8003</p> Check Static Route<pre><code>homecloud-fgt # show router static\nconfig router static\n    edit 1\n        set dst 10.0.0.4 255.255.255.255\n        set device \"azure-tunnel-1\"\n    next\n    edit 2\n        set dst 10.0.0.5 255.255.255.255\n        set device \"azure-tunnel-2\"\n    next\n    edit 3\n        set dst 10.0.0.4 255.255.255.255\n        set device \"azure-tunnel-2\"\n    next\n    edit 4\n        set dst 10.0.0.5 255.255.255.255\n        set device \"azure-tunnel-1\"\n    next\nend\n</code></pre>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#7-asymmetric-routing","title":"7. \u975e\u5c0d\u7a31\u8def\u7531 (Asymmetric Routing)","text":"<p>\u57fa\u65bc Technical Tip: Differences between asymmetric routing and auxiliary sessions\uff0c\u6211\u662f\u6709\u628a\u8a2d\u5b9a\u5beb\u4e0a\u53bb\uff0c\u56e0\u70ba\u6211\u5730\u7aef\u6c92\u6709 IPS \u670d\u52d9\uff0c\u6240\u4ee5\u6211\u958b\u8d77\u4f86\u662f\u6c92\u5565\u95dc\u4fc2\u7684\uff0c\u4f46\u5982\u679c\u4f60\u6709\u7684\u8a71\uff0c\u5c31\u8981\u81ea\u884c\u659f\u914c\u662f\u5426\u8981\u7528\uff0c\u56e0\u70ba\u4f60\u61c9\u8a72\u6c92\u8fa6\u6cd5\u505a\u6210 ECMP \u67b6\u69cb\uff0c\u4f60\u53ea\u80fd\u540c\u6642\u8d70\u4e00\u689d\u7dda\u800c\u5df2 (\u53bb\u56de\u4e00\u81f4)</p> <p>\u4f46\u6211\u9019\u500b\u597d\u50cf\u6c92\u6709\u5f88\u597d\u7684\u6e2c\u8a66\u624b\u6bb5\uff0c\u56e0\u70ba\u90fd\u6703\u901a\uff0c\u6709\u4eba\u5982\u679c\u77e5\u9053\u600e\u9ebc\u6e2c\u8a66\u7684\u8a71\u53ef\u4ee5\u8ddf\u6211\u5206\u4eab\u4e00\u4e0b</p> Check BGP Info<pre><code>homecloud-fgt # show system settings\nconfig system settings\n    set auxiliary-session enable # (2)\n    set asymroute enable # (1)\n    set sip-expectation enable\n    set allow-subnet-overlap enable\n    set ecmp-max-paths 10 # (3)\n    set gui-dns-database enable\n    set gui-explicit-proxy enable\n    set gui-dynamic-routing enable\n    set gui-sslvpn-personal-bookmarks enable\n    set gui-sslvpn-realms enable\n    set gui-policy-based-ipsec enable\n    set gui-wireless-controller disable\n    set gui-switch-controller disable\n    set gui-fortiextender-controller disable\n    set gui-advanced-policy enable\nend\n</code></pre> <ol> <li>\u9810\u8a2d\u72c0\u6cc1\u662f\u6703\u95dc\u9589\uff0c\u5982\u679c\u4e0d\u958b\u7684\u8a71\uff0c\u56e0\u70ba\u9047\u5230\u975e\u5c0d\u7a31\u8def\u7531\u554f\u984c\uff0c\u8d70\u53e6\u4e00\u689d\u8def\u7684\u6642\u5019\u5c31\u6703\u88ab Firewall \u4e1f\u6389</li> <li>ECMP \u555f\u7528\u7684\u72c0\u6cc1\u4e0b\uff0c\u628a\u9019\u500b\u958b\u8d77\u4f86\uff0c\u540c\u4e00\u500b TCP Session \u53ef\u4ee5\u5f9e\u4e0d\u540c Interface \u9032\u51fa</li> <li>\u9810\u8a2d 255, \u4f46\u6211\u6539 10</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#8-bgp-establish","title":"8. \u6aa2\u67e5 BGP Establish \u72c0\u614b","text":"","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#fortigate_1","title":"\u5f9e FortiGate \u89d2\u5ea6\u770b","text":"Check BGP Info<pre><code>homecloud-fgt # get router info bgp summary\nVRF 0 BGP router identifier 1.2.3.4, local AS number 65510\nBGP table version is 132\n2 BGP AS-PATH entries\n0 BGP community entries\n\nNeighbor    V         AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n10.0.0.4    4      65515   58875   58884      131    0    0 2d19h11m        5\n10.0.0.5    4      65515   52628   52682      130    0    0 4d11h58m        5\n\nTotal number of neighbors 2\n\nhomecloud-fgt # get router info bgp neighbors 10.0.0.4\nVRF 0 neighbor table:\nBGP neighbor is 10.0.0.4, remote AS 65515, local AS 65510, external link\n  BGP version 4, remote router ID 10.0.0.4\n  BGP state Established, up for 2d19h21m # (1)\n  Last read 00:00:08, hold time is 30, keepalive interval is 10 seconds\n  Configured hold time is 10, keepalive interval is 5 seconds\n  Neighbor capabilities:\n    Route refresh: advertised and received (new)\n    Address family IPv4 Unicast: advertised and received\n    Address family IPv6 Unicast: advertised and received\n  Received 58944 messages, 0 notifications, 0 in queue\n  Sent 58945 messages, 10 notifications, 0 in queue\n  Route refresh request: received 0, sent 0\n  Minimum time between advertisement runs is 1 seconds\n  Update source is loopback\n\nhomecloud-fgt # get router info bgp neighbors 10.0.0.5\nVRF 0 neighbor table:\nBGP neighbor is 10.0.0.5, remote AS 65515, local AS 65510, external link\n  BGP version 4, remote router ID 10.0.0.5\n  BGP state = Established, up for 4d12h09m # (2)\n  Last read 00:00:01, hold time is 30, keepalive interval is 10 seconds\n  Configured hold time is 10, keepalive interval is 5 seconds\n  Neighbor capabilities:\n    Route refresh: advertised and received (new)\n    Address family IPv4 Unicast: advertised and received\n    Address family IPv6 Unicast: advertised and received\n  Received 52707 messages, 0 notifications, 0 in queue\n  Sent 52747 messages, 13 notifications, 0 in queue\n  Route refresh request: received 0, sent 0\n  Minimum time between advertisement runs is 1 seconds\n  Update source is loopback\n</code></pre> <ol> <li>BGP \u72c0\u614b\u9700\u70ba Established \u624d\u662f\u6b63\u78ba\u7684</li> <li>BGP \u72c0\u614b\u9700\u70ba Established \u624d\u662f\u6b63\u78ba\u7684</li> </ol>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#azure_1","title":"\u5f9e Azure \u7684\u89d2\u5ea6\u770b","text":"","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#9","title":"9. \u6aa2\u67e5\u8def\u7531\u8868","text":"","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#fortigate_2","title":"\u5f9e FortiGate \u89d2\u5ea6\u770b","text":"Check RIB from FortiGate<pre><code>homecloud-fgt # get router info routing-table database\nCodes: K - kernel, C - connected, S - static, R - RIP, B - BGP\n       O - OSPF, IA - OSPF inter area\n       N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2\n       E1 - OSPF external type 1, E2 - OSPF external type 2\n       i - IS-IS, L1 - IS-IS level-1, L2 - IS-IS level-2, ia - IS-IS inter area\n       &gt; - selected route, * - FIB route, p - stale info\n\nRouting table for VRF=0\nS    *&gt; 0.0.0.0/0 [5/0] via 5.6.7.254, ppp1 # (1)\nB    *&gt; 10.56.0.0/24  [20/0] via 10.0.0.5 (recursive is directly connected, azure-tunnel-2), 2d19h56m # (2)\n     *&gt;               [20/0] via 10.0.0.4 (recursive is directly connected, azure-tunnel-1), 2d19h56m\nB    *&gt; 10.0.0.0/24   [20/0] via 10.0.0.5 (recursive is directly connected, azure-tunnel-2), 2d19h56m # (3)\n     *&gt;               [20/0] via 10.0.0.4 (recursive is directly connected, azure-tunnel-1), 2d19h56m\nS    *&gt; 10.0.0.4/32   [10/0] is directly connected, azure-tunnel-1 # (4)\n     *&gt;               [10/0] is directly connected, azure-tunnel-2\nS    *&gt; 10.0.0.5/32   [10/0] is directly connected, azure-tunnel-2\n     *&gt;               [10/0] is directly connected, azure-tunnel-1\nC    *&gt; 5.6.7.8/32 is directly connected, ppp1 # (5)\nC    *&gt; 5.6.7.254/32 is directly connected, ppp1 # (6)\nC    *&gt; 192.168.200.0/24 is directly connected, vlan200\nC    *&gt; 1.2.3.4/32 is directly connected, loopback # (7)\n</code></pre> <ol> <li>\u9019\u500b\u662f\u6211\u5bb6 PPPoE \u51fa\u53bb\u7684\u8def\u7531\uff0c\u4e0d\u7528\u7406\u6703</li> <li>\u9019\u500b\u662f Spoke \u7db2\u6bb5\u7684\u8def\u7531\uff0c\u53ef\u4ee5\u5f9e azure-tunnel-2 \u6216 azure-tunnel-1 \u8d70</li> <li>\u9019\u500b\u662f Hub \u7db2\u6bb5\u7684\u8def\u7531\uff0c\u53ef\u4ee5\u5f9e azure-tunnel-2 \u6216 azure-tunnel-1 \u8d70</li> <li>\u4e0b\u9762\u56db\u689d\u90fd\u662f\u505a IPsec Tunnel \u7b49\u7d1a\u7684 Redundancy \u8def\u7531\uff0c\u7576\u7136\u5982\u679c WAN Port \u70b8\u4e86\uff0c\u9019\u56db\u689d\u5c31\u6c92\u7528\u4e86</li> <li>WAN IP</li> <li>WAN Gateway IP</li> <li>Loopback IP</li> </ol> Show BGP info for network<pre><code>homecloud-fgt # get router info bgp network\nVRF 0 BGP table version is 132, local router ID is 1.2.3.4\nStatus codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal,\n              S Stale\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight RouteTag Path\n*&gt; 0.0.0.0/0        5.6.7.254                          32768        0 ? &lt;-/1&gt;\n*  10.0.0.0/24      10.0.0.4              0             0           0 65515 i &lt;-/-&gt;\n*&gt;                  10.0.0.5              0             0           0 65515 i &lt;-/1&gt;\n*  10.56.0.0/24     10.0.0.4              0             0           0 65515 i &lt;-/-&gt;\n*&gt;                  10.0.0.5              0             0           0 65515 i &lt;-/1&gt;\n*&gt; 10.0.0.4/32      0.0.0.0                            32768        0 ? &lt;-/1&gt;\n*&gt; 10.0.0.5/32      0.0.0.0                            32768        0 ? &lt;-/1&gt;\n*&gt; 5.6.7.8/32       0.0.0.0                            32768        0 ? &lt;-/1&gt;\n*&gt; 5.6.7.254/32     0.0.0.0                            32768        0 ? &lt;-/1&gt;\n*&gt; 192.168.200.0    0.0.0.0                            32768        0 ? &lt;-/1&gt;\n*&gt; 1.2.3.4/32       0.0.0.0                            32768        0 ? &lt;-/1&gt;\n\nTotal number of prefixes 15\n</code></pre> Check BGP info for route<pre><code>homecloud-fgt # get router info bgp network-longer-prefixes 10.56.0.0/24\nVRF 0 BGP table version is 132, local router ID is 1.2.3.4\nStatus codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal,\n              S Stale\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight RouteTag Path\n*  10.56.0.0/24     10.0.0.4                 0             0        0 65515 i &lt;-/-&gt;\n*&gt;                  10.0.0.5                 0             0        0 65515 i &lt;-/1&gt;\n\nTotal number of prefixes 1\n</code></pre>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#azure_2","title":"\u5f9e Azure \u7684\u89d2\u5ea6\u770b","text":"<p>\u826f\u5fc3\u5efa\u8b70...\u4f60\u76f4\u63a5\u4e0b\u8f09 Learned routed \u7528 Excel \u770b\u6bd4\u8f03\u5feb</p> <p></p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#qa","title":"Q&amp;A","text":"","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q1","title":"Q1: \u65b7\u7dda\u4e86, \u9023\u7dda\u6aa2\u67e5\u6b65\u9a5f\u662f\u5982\u4f55?","text":"<p>A1:</p> <ol> <li>\u6aa2\u67e5\u96f2\u7aef IPsec Tunnel \u72c0\u614b\uff0c\u56e0\u70ba\u9ede Azure Portal \u5f88\u5bb9\u6613\u4e00\u7ffb\u5169\u77aa\u773c\uff0c\u53ea\u8981\u4e0d\u662f Connected \u5c31\u662f\u6709\u554f\u984c</li> <li>\u6aa2\u67e5\u5730\u7aef IPsec Tunnel \u72c0\u614b\uff0c\u61c9\u70ba Up</li> <li>\u6aa2\u67e5\u662f\u4e0d\u662f\u88ab Firewall \u64cb\u4e0b\u4f86\u4e86</li> <li>\u6aa2\u67e5 BGP \u72c0\u614b\u662f\u5426\u70ba Established</li> <li>\u6aa2\u67e5\u8def\u7531\u8868\uff0c\u770b\u90a3\u689d\u8def\u7531\u5230\u5e95\u98db\u53bb\u54ea\u88e1</li> </ol> <p>\u56e0\u70ba\u5927\u6982 9 \u6210\u554f\u984c\u90fd\u662f\u88ab\u64cb\u5728 Firewall \u6f0f\u5beb\u898f\u5247...</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q2-active-standby","title":"Q2: \u5982\u679c\u6211\u4e0d\u8981\u8b93\u9019\u5169\u689d\u8def\u540c\u6642\u901a\uff0c\u6211\u53ea\u60f3\u505a Active Standby \u7684\u8a71\u5462?","text":"<p>A2: \u57fa\u65bc FortiGate - BGP path selection process \u548c BGP Attributes and Path Selection\uff0c\u4e0b\u9762\u6709\u5e7e\u500b BGP Best Path Selection \u7684\u65b9\u5f0f\u53ef\u4f9b\u53c3\u8003:</p> Priority Attribute Note Personal Comment 1 Highest weight this attribute is local to the FortiGate Azure VPN Gateway \u6c92\u652f\u63f4 2 Highest local preference Applicable within AS \u5df2\u77e5\u4f7f\u7528\u983b\u7387\u7b2c 1\uff0c\u4f46\u9019\u500b\u5c6c\u6027\u6c92\u8fa6\u6cd5\u900f\u904e eBGP \u8f49\u51fa\u53bb 3 Route originated by the local router next hop = 0.0.0.0 4 Shortest AS path length \u5df2\u77e5\u4f7f\u7528\u983b\u7387\u7b2c 2\uff0c\u53ef\u4ee5\u7528 AS Path Prepanding \u63a7\u5236\u9577\u5ea6\uff0c\u53ef\u7528\uff0c\u4f46\u5efa\u8b70\u7528 BGP Communites \u66ff\u4ee3 5 lowest origin code IGP &gt; EGP &gt; incomplete \u5df2\u77e5\u4f7f\u7528\u983b\u7387\u7b2c 3 6 lowest MED Exchanged between autonomous systems \u5df2\u77e5\u4f7f\u7528\u983b\u7387\u7b2c 4\uff0cAzure VPN Gateway \u6c92\u652f\u63f4 7 eBGP path over iBGP path 8 Path through the closest IGP neighbor 9 Oldest route for EBGP paths 10 the lowest neighbor BGP router ID 11 the lowest neighbor IP address <p>\u76ee\u524d Azure \u9019\u908a\u8a2d\u8a08\u5e38\u898f\u90fd\u662f\u7528 AS Path Prepatnding \u4f86\u63a7\u5236\uff0c\u5176\u6b21 Local Preference</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q3-azure-azure-firewall-azure-firewall","title":"Q3: \u5982\u679c\u6211\u5728 Azure \u4e0a\u958b Azure Firewall\uff0c\u4e14\u6211\u9700\u8981\u5730\u7aef\u4e0a\u96f2\u90fd\u8981\u7d93\u904e Azure Firewall \u7684\u8a71\uff0c\u6211\u9084\u9700\u8981\u52d5\u5730\u7aef\u8def\u7531\u55ce?","text":"<p>A3: \u5730\u7aef\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u8b8a\u52d5\uff0c\u82e5\u8981\u52d5\u8def\u7531\u7684\u90e8\u5206\uff0c\u662f\u8981\u52d5\u96f2\u7aef\u7684</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q4-azure-vpn-gateway-bgp-bfd-bidirectional-forwarding-detection","title":"Q4: Azure VPN Gateway \u958b\u555f BGP \u7684\u72c0\u614b\u4e0b\uff0c\u652f\u63f4 BFD (Bidirectional Forwarding Detection) \u55ce?","text":"<p>A4: \u4e0d\u652f\u63f4\uff0c\u958b\u4e86\u6c92\u4f5c\u7528\uff0c\u66ff\u4ee3\u65b9\u6848\u662f\u4f7f\u7528 <code>keepalives</code> \u4f46 ExpressRoute Gateway \u6709\u652f\u63f4\uff0c\u6240\u4ee5\u9084\u662f\u53ef\u4ee5\u5728 Loopback \u4e0a\u958b BFD \u8d77\u4f86</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q5-azure-vpn-gateway-routing-weight","title":"Q5: Azure VPN Gateway \u652f\u4e0d\u652f\u63f4 Routing Weight \u5c6c\u6027?","text":"<p>A5: \u4e0d\u652f\u63f4\uff0c\u4f46 ExpressRoute Gateway \u6709\u652f\u63f4</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#q6-azure-vpn-gateway-bgp-med-multi-exit-discriminator","title":"Q6: Azure VPN Gateway \u652f\u4e0d\u652f\u63f4 BGP MED (Multi-Exit Discriminator) \u5c6c\u6027?","text":"<p>A6: \u4e0d\u652f\u63f4</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#_2","title":"\u6587\u5f8c\u5ee2\u8a00","text":"<p>\u4e0d\u77e5\u9053\u70ba\u4ec0\u9ebc\u6211\u4f86 Microsoft \u4e0a\u73ed\uff0c\u90fd\u6bd4\u8f03\u719f\u5225\u4eba\u5bb6\u7522\u54c1\uff0c\u7562\u7adf\u4e0a\u73ed\u4e94\u5929\uff0c\u4e09\u5929\u5168\u90e8\u90fd\u4f86\u554f\u6211 Forti \u6280\u8853\u554f\u984c\uff0c\u5be6\u5728\u662f...</p> <p>\u770b\u770b\u4e0b\u6b21\u54ea\u5bb6\u8981\u4f86\u5de5\u5546\u4e00\u4e0b\u5730\u7aef\u8a2d\u5099\u8b93\u6211\u63a5</p>","tags":["azure","fortigate","bgp"]},{"location":"20240306-azure-aa-vpn-with-fortigate.html#references","title":"References","text":"<ul> <li>FortiGate - IPsec VPN to Azure with virtual network gateway</li> <li>Visual Subnet Calculator (Azure Edition)</li> <li>Azure Networking \u4e4b BGP \u666e\u901a\u5e38\u8b58</li> <li>About VPN devices and IPsec/IKE parameters for Site-to-Site VPN Gateway connections</li> <li>Technical Tip: Differences between asymmetric routing and auxiliary sessions</li> <li>How to Win at the BGP Best Path Selection Algorithm and Influence Neighbors</li> </ul>","tags":["azure","fortigate","bgp"]},{"location":"wiki/index.html","title":"One Stop","text":""},{"location":"wiki/index.html#special-topics","title":"Special Topics","text":"<ul> <li>One Stop: Azure Networking</li> <li>One Stop: Linux</li> <li>One Stop: Kubernetes</li> <li>One Stop: OpenAI</li> <li>One Stop: Azure Life</li> </ul>"},{"location":"wiki/index.html#architecture-design-and-implementation","title":"Architecture Design and Implementation","text":"<ul> <li>[One Stop: Azure Architecture Design and Implementation]</li> <li>[One Stop: Red Hat OpenShift 4 Architecture Design and Implementation]</li> </ul>"},{"location":"wiki/index.html#troubleshooting-collections","title":"Troubleshooting Collections","text":"<ul> <li>VMware vSphere Troubleshooting Collections</li> </ul>"},{"location":"wiki/azure-life-onestop.html","title":"Azure Life \u76f8\u95dc\u8cc7\u8a0a\u7e3d\u532f","text":"","tags":["One Stop","azure"]},{"location":"wiki/azure-life-onestop.html#azure-netorking-engineer","title":"Azure Netorking Engineer","text":"<ul> <li>Azure/review-checklists: \u5c0d\u5176\u8a2d\u8a08\u9032\u884c\u96d9\u91cd\u6aa2\u67e5\uff0c\u4ee5\u78ba\u4fdd\u9075\u5faa\u6700\u4f73\u5be6\u8e10\u3002 Microsoft \u63d0\u4f9b\u6b64\u985e\u8a2d\u8a08\u5be9\u67e5\u548c\u6307\u5c0e\u7684\u5718\u968a\u4e4b\u4e00\u662f FastTrack for Azure (FTA)\uff0c\u5b83\u662f Microsoft Azure Engineering \u7684\u4e00\u90e8\u5206</li> </ul>","tags":["One Stop","azure"]},{"location":"wiki/azure-life-onestop.html#azure-developer","title":"Azure Developer","text":"<ul> <li>Microsoft OpenSource \u4e3b\u7ad9</li> <li>CSE Code-With Engineering Playbook: Microsoft CSE (Commercial Software Engineering) \u958b\u767c\u6307\u5c0e\u624b\u518a</li> </ul>","tags":["One Stop","azure"]},{"location":"wiki/azure-life-onestop.html#azure-devops-engineer","title":"Azure DevOps Engineer","text":"","tags":["One Stop","azure"]},{"location":"wiki/azure-life-onestop.html#azure-networking","title":"Azure Networking","text":"<p>\u56e0\u70ba\u5167\u5bb9\u592a\u591a\uff0c\u62c6\u4e00\u500b\u5b50\u4e3b\u984c\u6b78\u985e</p> <ul> <li>One Stop: Azure Networking</li> </ul>","tags":["One Stop","azure"]},{"location":"wiki/azure-networking-onestop.html","title":"Azure Networking \u76f8\u95dc\u8cc7\u8a0a\u7e3d\u532f","text":"","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-networking-fundamentals","title":"Azure Networking Fundamentals","text":"<ul> <li>Azure Networking is not like your on-onprem network: \u63a8\u85a6\u95b1\u8b80\uff0c\u53ef\u4ee5\u89e3\u91cb\u76f8\u7576\u591a Azure Networking \u6709\u4e9b\u884c\u70ba\u70ba\u4ec0\u9ebc\u6703\u8ddf\u5730\u7aef\u76f8\u7576\u4e0d\u4e00\u6a23</li> <li>Episode #2: VM Routing NIC Routing &amp; Azure routes: \u63a8\u85a6\u95b1\u8b80\uff0c\u5c0d\u65bc Azure Routes \u7684\u7406\u89e3\u548c\u89e3\u91cb\u883b\u6e05\u695a\u7684</li> <li>Onboarding Guide to Routing in Azure - Intro &amp; Structure: \u53ef\u4ee5\u89c0\u5bdf\u5404\u7d44\u4ef6\u7684 Routing \u72c0\u614b</li> <li>Cross-region private network load balancing in Azure</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-networking-architecture","title":"Azure Networking Architecture \u5be6\u4f8b\u4ecb\u7d39","text":"<ul> <li>kaysalawu/azure-network-terraform: <code>Azure Network Architecture - Terraform Examples</code> \u5e38\u898b\u67b6\u69cb\u90fd\u6709, \u6c92\u6709\u63a1\u7528 Firewall \u7684\u8a71\u53ef\u53c3\u8003</li> <li>DIY vWAN: double Hub VNET and Azure Route Server: Azure vWAN \u4e0d\u80fd\u7528\u7684\u8a71\uff0c\u53ef\u4ee5\u53c3\u8003\u9019\u500b DIY \u4f5c\u6cd5</li> <li>The why behind networking design and the art of the possible: \u88e1\u9762\u6709\u4e0d\u5c11\u4ee5 draw.io \u7e6a\u88fd\u800c\u6210\u7684\u67b6\u69cb\u5716\uff0c\u53ef\u4ee5\u6cbf\u7528</li> <li>jwrightazure/lab</li> <li>Traffic Flows in Common Azure Networking Patterns</li> <li>A Journey through Azure Networking</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-vnet","title":"Azure VNet \u76f8\u95dc","text":"<ul> <li>Azure \u7db2\u6bb5\u8a2d\u8a08\u9808\u77e5</li> <li>fguerri/AzureVNetIntegrationPatterns</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-expressroute","title":"Azure ExpressRoute \u76f8\u95dc","text":"<ul> <li>Benefits of ExpressRoute cross-connections (bow-tie) in standard Hub&amp;Spoke vs. VirtualWAN-based environments: ExpressRoute \u9023\u63a5\u53ca\u65b7\u7dda\u5dee\u7570\u6bd4\u8f03</li> <li>Marc Kean - Azure ExpressRoute demystified</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-firewall","title":"Azure Firewall \u76f8\u95dc","text":"<ul> <li>Danieleg82/AzFireWallPremium-MH</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-public-ip","title":"Azure Public IP","text":"<ul> <li>How To: Azure Public IP \u9078\u7528\u6307\u5357</li> <li>How To: \u67e5\u8a62\u53ca\u9a57\u8b49\u81ea\u8eab Public IP</li> <li>How To: \u5efa\u7acb\u53ca\u9a57\u8b49 ICMP/TCP/UDP \u9023\u7dda</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#private-linkendpoint-dns-integration","title":"Private Link/Endpoint DNS Integration","text":"<ul> <li>Private Link/Endpoint DNS Integration Resources</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#private-dns-zone","title":"Private DNS Zone","text":"<ul> <li> <p>Appendix G.  Private DNS Namespaces</p> <ul> <li>.intranet.</li> <li>.internal.</li> <li>.private.</li> <li>.corp.</li> <li>.home.</li> <li>.lan.</li> </ul> </li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-network-security","title":"Azure Network Security","text":"<ul> <li>Azure/Azure-Network-Security</li> <li>\u61c9\u7528\u7a0b\u5f0f\u9598\u9053\u5728\u9632\u706b\u7246\u524d\u9762: \u770b\u7684\u5230 XFF Header</li> <li>\u61c9\u7528\u7a0b\u5f0f\u9598\u9053\u5728\u9632\u706b\u7246\u5f8c\u9762: \u770b\u4e0d\u5230 XFF Header</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#traffic-load-balancing","title":"Traffic Load Balancing","text":"<ul> <li>How To: \u9078\u64c7\u9069\u7576\u7684 Azure \u8ca0\u8f09\u5747\u8861\u670d\u52d9</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-load-balancer","title":"Azure Load Balancer","text":"<p>\u7d50\u8ad6: \u4e00\u822c\u72c0\u6cc1\u5c31\u662f\u9078 Azure Load Balancer (Standard/Regional) \u5c31\u5c0d\u4e86</p> <ul> <li>SKU comparison</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#spoke-to-spoke-networking","title":"Spoke to Spoke Networking","text":"<ul> <li>Using Azure Firewall as a Network Virtual Appliance (NVA)</li> <li>Hub-spoke network topology in Azure</li> <li>Spoke-to-spoke networking</li> <li>Azure Networking - Hub-Spoke with NVA and Azure Firewall</li> <li>Example Hub &amp; Spoke Azure Firewall</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-application-gateway","title":"Azure Application Gateway","text":"<p>\u7d50\u8ad6: \u5927\u591a\u6578\u72c0\u6cc1\u9078 Azure Application Gateway (v2 SKU)</p> <ul> <li>Feature comparison between v1 SKU and v2 SKU</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-web-application-firewall","title":"Azure Web Application Firewall","text":"<ul> <li>Tutorial Overview: Azure Web Application Firewall Security Protection and Detection Lab</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-networking-specilist","title":"Azure Networking Specilist","text":"<ul> <li>adtork</li> <li>dmauser</li> <li>adstuart</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#azure-network-virtual-application-nva","title":"Azure Network Virtual Application (NVA)","text":"<ul> <li>OPNsense Firewall on FreeBSD VM</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-networking-onestop.html#misc","title":"Misc","text":"<ul> <li>How to: \u627e\u5230 Azure Publisher / Offer / SKU \u4e4b\u6b63\u78ba\u540d\u7a31</li> <li>TCP Throughput Calculator - Network performance depends on more than only available bandwidth</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/azure-subnet-cidr-pratices.html","title":"Azure \u7db2\u6bb5\u8a2d\u8a08\u9808\u77e5","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230205</p>","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#azure","title":"Azure \u7db2\u6bb5\u8a2d\u8a08\u9808\u77e5","text":"","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#_1","title":"\u7db2\u8def\u5207\u5272\u5927\u5c0f\u5efa\u8b70","text":"<p>\u6839\u64da Services that can be deployed into a virtual network\uff0c\u689d\u5217\u5e38\u898b\u670d\u52d9</p>","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#azure-subnet","title":"Azure Subnet \u4fdd\u7559\u540d\u7a31","text":"<p>\u4e0b\u9762\u70ba Azure \u5c08\u7528 Subnet \u4fdd\u7559\u540d\u7a31\uff0c\u4e0d\u80fd\u4fee\u6539</p> Subnet \u4fdd\u7559\u540d\u7a31 \u6700\u5c0f Subnet \u6700\u5927 Subnet \u751f\u7522\u74b0\u5883\u5efa\u8b70 Subnet \u76f8\u95dc\u670d\u52d9 GatewaySubnet /29 /27 /27 Azure VPN Gateway / ExpressRoute / S2S VPN RouteServerSubnet /27 /24 /27 Azure Route Server AzureBastionSubnet /26 /24 /26 Azure Bastion AzureFirewallSubnet /26 /26 /26 Azure Firewall AzureFirewallManagementSubnet /26 /16 /26 Azure Firewall Manager <p>\u5efa\u8b70\u642d\u914d\u670d\u7528 Visual Subnet Calculator\uff0cGitHub: davidc/subnets</p> <p>\u7bc4\u4f8b\u5982\u4e0b</p> <p></p>","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#azure-services","title":"Azure Services \u76f8\u95dc","text":"Azure PaaS \u6700\u5c0f Subnet \u6700\u5927 Subnet \u751f\u7522\u74b0\u5883\u5efa\u8b70 Subnet \u9700\u8981 Dedicated Subnet? Azure Virtual WAN Hub /24 N/A /24 Yes Azure Application Gateway /26  (Standard or WAF) SKU N/A /24  (Standard_v2 or WAF_v2 SKU) Yes Azure AD Domain Services (AADDS) ? N/A ? No Azure SQL Managed Instance (SQL MI) /27 N/A N/A Yes App Services (Web Apps, Functions, API Apps) /28 N/A /26 Yes Azure API Management ? N/A ? Yes Azure Container Instances (ACI) ? N/A ? Yes Azure VMware Solution /22 /22 /22 Yes Azure Spring Cloud /28 N/A Depends on Requirement Yes Azure Red Hat OpenShift Master Subnet /27 /27 /27 Yes Azure Red Hat OpenShift Worker Subnet /27 /24 /25 Yes","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#subnet-ip","title":"Subnet \u9810\u8a2d\u4fdd\u7559\u7684 IP","text":"<p>\u5047\u8a2d 192.168.1.0/24\uff0c\u8ddf\u50b3\u7d71\u7db2\u8def\u6709\u4e9b\u4e0d\u4e00\u6a23\uff0c\u65bc Azure Subnet \u4e2d\u4fdd\u7559 2+3 \u500b Azure IP\uff0c\u6545\u5be6\u969b\u80fd\u7528\u7684\u7bc4\u570d\u662f <code>192.168.1.4 ~ 192.168.1.253</code>\uff0c\u5171 250 \u500b\u53ef\u5206\u914d IP</p> IP Description \u53ef\u4e0d\u53ef\u4ee5 Ping? 192.168.1.0  \u4fdd\u7559\u7d66 \u7db2\u8def\u4f4d\u5740 (Network ID) 192.168.1.1  \u4fdd\u7559\u7d66 Gateway 192.168.1.2  \u4fdd\u7559\u7d66 Azure DNS \u4f7f\u7528 192.168.1.3  \u4fdd\u7559\u7d66 Azure DNS \u4f7f\u7528 192.168.1.4  \u521d\u59cb\u53ef\u6307\u6d3e\u4e14\u4f7f\u7528\u7684 IP 192.168.1.254  \u6700\u672b\u53ef\u6307\u6d3e\u4e14\u4f7f\u7528\u7684 IP 192.168.1.255  \u4fdd\u7559\u7d66\u7db2\u8def\u5ee3\u64ad\u4f4d\u5740 (Broadcast IP) <p>\u5047\u8a2d 192.168.1.0/29\uff0c\u8ddf\u50b3\u7d71\u7db2\u8def\u6709\u4e9b\u4e0d\u4e00\u6a23\uff0c\u65bc Azure Subnet \u4e2d\u4fdd\u7559 2+3 \u500b Azure IP\uff0c\u6545\u5be6\u969b\u80fd\u7528\u7684\u7bc4\u570d\u662f <code>192.168.1.4 ~ 192.168.1.6</code>\uff0c\u5171 3 \u500b\u53ef\u5206\u914d IP</p> IP Description \u53ef\u4e0d\u53ef\u4ee5 Ping? 192.168.1.0  \u4fdd\u7559\u7d66 \u7db2\u8def\u4f4d\u5740 (Network ID) 192.168.1.1  \u4fdd\u7559\u7d66 Azure IP Gateway 192.168.1.2  \u4fdd\u7559\u7d66 Azure DNS \u4f7f\u7528 192.168.1.3  \u4fdd\u7559\u7d66 Azure DNS \u4f7f\u7528 192.168.1.4  \u521d\u59cb\u53ef\u6307\u6d3e\u4e14\u4f7f\u7528\u7684 IP 192.168.1.6  \u6700\u672b\u53ef\u6307\u6d3e\u4e14\u4f7f\u7528\u7684 IP 192.168.1.7  \u4fdd\u7559\u7d66 \u7db2\u8def\u5ee3\u64ad\u4f4d\u5740 (Network Broadcast IP)","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#azure-subnet-ipv4-cidr","title":"Azure Subnet IPv4 \u6700\u5927\u548c\u6700\u5c0f\u7684 CIDR \u503c","text":"Desription Mask \u53ef\u7528 Hosts IP \u6700\u5c0f (smallest) /29 3 (=6-3) \u5e38\u898b /24 253 (=256-3) \u6700\u5927 (largest) /2 1,073,741,819 (=1,073,741,822-3)","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#azure-vnet","title":"Azure VNet \u5167\u7684\u901a\u8a0a\u5354\u8b70\u652f\u63f4","text":"Packat Communication \u652f\u63f4\u5426? Unicast Multicast Broadcast Protocols \u53ef\u7528\u5426? Note TCP UDP ICMP VLAN \u56e0\u70ba Azure VNet \u662f L3 Overlay\uff0c\u4e0d\u652f\u63f4 L2 IPinIP GRE \u56e0\u70ba\u4e0d\u652f\u63f4 Multicast VXLAN \u56e0\u70ba\u4e0d\u652f\u63f4 Multicast Virtual Router Redundancy Protocol (VRRP) \u56e0\u70ba\u4e0d\u652f\u63f4 Multicast Hot Standby Router Protocol (HSRP) \u56e0\u70ba\u4e0d\u652f\u63f4 Multicast DHCP relay DHCP via Unicast","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/azure-subnet-cidr-pratices.html#references","title":"References","text":"<ul> <li>Azure \u865b\u64ec\u7db2\u8def\u7684\u5e38\u898b\u554f\u984c (FAQ)</li> <li>Azure Naming Tool</li> <li>Services that can be deployed into a virtual network</li> </ul>","tags":["vnet","subnet","sizing","azure"]},{"location":"wiki/cloud-native-security.html","title":"Cloud Native Security","text":"","tags":["observability"]},{"location":"wiki/cloud-native-security.html#goat","title":"Goat","text":"<ul> <li>Metarget is a framework providing automatic constructions of vulnerable infrastructures.</li> <li>Vulhub is an open-source collection of pre-built vulnerable docker environments. No pre-existing knowledge of docker is required, just execute two simple commands and you have a vulnerable environment.</li> <li>Kubernetes Goat Interactive Kubernetes Security Learning Playground</li> </ul>","tags":["observability"]},{"location":"wiki/istio-and-aks-managed-path.html","title":"Tips and Trick: Istio and Azure Kubernetes Service (Managed Path)","text":"Istio Compenets Managed by istiod Azure Managed istio-ingressgateway Azure Managed istio-egressgateway N/A prometheus Azure Managed grafana Azure Managed jaeger OSS","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-managed-path.html#enable-istio-ingress-gateway","title":"Enable istio-ingress-gateway","text":"<pre><code>az aks mesh enable-ingress-gateway --resource-group rg-poc-aks --name poc-aks --ingress-gateway-type external\n</code></pre> <pre><code>export INGRESS_HOST_INTERNAL=$(kubectl -n aks-istio-ingress get service aks-istio-ingressgateway-external -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\nexport INGRESS_PORT_INTERNAL=$(kubectl -n aks-istio-ingress get service aks-istio-ingressgateway-external -o jsonpath='{.spec.ports[?(@.name==\"http2\")].port}')\nexport GATEWAY_URL_INTERNAL=$INGRESS_HOST_INTERNAL:$INGRESS_PORT_INTERNAL\necho $GATEWAY_URL_INTERNAL\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-managed-path.html#dashboard","title":"Dashboard","text":"Jaeger<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/jaeger.yaml -O aks-jaeger.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-jaeger.yaml\n$ kubectl apply -f aks-jaeger.yaml\ndeployment.apps/jaeger created\nservice/tracing created\nservice/zipkin created\nservice/jaeger-collector created\n\n$ istioctl -i aks-istio-system dashboard jaeger -n aks-istio-system\nhttp://localhost:16686\n</code></pre> Kiali<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/kiali.yaml -O aks-kiali.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-kiali.yaml\n$ grep istio-system aks-kiali.yaml\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n      namespace: aks-istio-system\n        root_namespace: aks-istio-system\n    istio_namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n\n# https://kiali.io/docs/configuration/kialis.kiali.io/\n  spec:\n    external_services:\n      custom_dashboards:\n        enabled: true\n      istio:\n        root_namespace: \"aks-istio-system\"\n        config_map_name: \"istio-asm-1-17\"\n        istio_api_enabled: true\n        istiod_deployment_name: \"istiod-asm-1-17\"\n        istiod_pod_monitoring_port: 15014\n        component_status:\n          enabled: true\n          components:\n          - app_label: \"istiod\"\n            is_core: true\n            namespace: aks-istio-system\n          - app_label: \"aks-istio-ingressgateway-external\"\n            is_core: true\n            namespace: aks-istio-ingress\n          - app_label: \"istio-egressgateway\"\n            is_core: false\n            namespace: aks-istio-system\n      prometheus:\n        auth:\n          insecure_skip_verify: false\n\n        health_check_url: \"\"\n        url: https://amw-poc-aks-ji0z.eastus.prometheus.monitor.azure.com\n      tracing:\n        enabled: true\n        health_check_url: http://tracing.aks-istio-system:14269/\n        in_cluster_url: http://tracing.aks-istio-system:16685/\n        url: http://tracing.aks-istio-system:16685/\n      grafana:\n        in_cluster_url: http://grafana.aks-istio-system:3000/\n        health_check_url: http://grafana.aks-istio-system:3000/api/health\n        url: http://grafana.aks-istio-system:3000/\n        enabled: true\n\n$ kubectl apply -f aks-kiali.yaml\nserviceaccount/kiali created\nconfigmap/kiali created\nclusterrole.rbac.authorization.k8s.io/kiali-viewer created\nclusterrole.rbac.authorization.k8s.io/kiali created\nclusterrolebinding.rbac.authorization.k8s.io/kiali created\nrole.rbac.authorization.k8s.io/kiali-controlplane created\nrolebinding.rbac.authorization.k8s.io/kiali-controlplane created\nservice/kiali created\ndeployment.apps/kiali created\n\n$ kubectl -n aks-istio-system rollout restart deployment/kiali\ndeployment.apps/kiali restarted\n\n$ istioctl -i aks-istio-system dashboard kiali -n aks-istio-system\nhttp://localhost:20001/kiali\nFailed to open browser; open http://localhost:20001/kiali in your browser.\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-managed-path.html#overall-health-check","title":"Overall Health Check","text":"Istio Version<pre><code>$ istioctl -i aks-istio-system version\nclient version: 1.18.1\ncontrol plane version: 1.17-dev\ndata plane version: 1.17.2-distroless (6 proxies)\n</code></pre> Verifying connectivity to Istiod<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/master/samples/sleep/sleep.yaml\n\n$ kubectl create namespace foo\nnamespace/foo created\n\n$ kubectl apply -f &lt;(istioctl kube-inject -f ./sleep.yaml -i aks-istio-system -r asm-1-17) -n foo\nserviceaccount/sleep created\nservice/sleep created\ndeployment.apps/sleep created\n\n$ kubectl exec $(kubectl get pod -l app=sleep -n foo -o jsonpath={.items..metadata.name}) -c sleep -n foo -- curl -sS istiod-asm-1-17.aks-istio-system:15014/version\n1.17-dev-3e857775086a061d12ee445f32a0b35ea17c8488-Clean\n</code></pre> Get an overview of your mesh<pre><code># Usage: istioctl proxy-status [&lt;type&gt;/]&lt;name&gt;[.&lt;namespace&gt;] [flags]\n$ istioctl -i aks-istio-system proxy-status\nNAME                                       CLUSTER        CDS        LDS        EDS        RDS        ECDS         ISTIOD                               VERSION\ndetails-v1-7c7dbcb4b5-8v2dh.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nproductpage-v1-6c5c9c9d9-plq9r.default     Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nratings-v1-844796bf85-tbshm.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-vqrq8     1.17.2-distroless\nreviews-v1-5cf854487-6qg5p.default         Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nreviews-v2-955b74755-gq8r5.default         Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nreviews-v3-797fc48bc9-svx59.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\n</code></pre> analyze your current live Kubernetes cluster by running<pre><code>$ istioctl -i aks-istio-system analyze --revision 1-17 --namespace default\n\n\u2714 No validation issues found when analyzing namespace: default.\n\n$ istioctl -i aks-istio-system analyze --revision 1-17 --all-namespaces\nInfo [IST0102] (Namespace aks-command) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-command istio-injection=enabled' to enable it, or 'kubectl label namespace aks-command istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace aks-istio-ingress) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-istio-ingress istio-injection=enabled' to enable it, or 'kubectl label namespace aks-istio-ingress istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace aks-istio-system) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-istio-system istio-injection=enabled' to enable it, or 'kubectl label namespace aks-istio-system istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace foo) The namespace is not enabled for Istio injection. Run 'kubectl label namespace foo istio-injection=enabled' to enable it, or 'kubectl label namespace foo istio-injection=disabled' to explicitly mark it as not needing injection.\n</code></pre> Analyzing live clusters, local files, or both<pre><code>$ ls\napp-v1.yaml  app-v2.yaml  gateway.yaml  grafana-ab-testing.png  README.md  virtualservice-match.yaml  virtualservice-weight.yaml  virtualservice-wildcard.yaml\n\n$ istioctl analyze ./*\nSkipping file ./grafana-ab-testing.png, recognized file extensions are: [.json .yaml .yml]\nSkipping file ./README.md, recognized file extensions are: [.json .yaml .yml]\n\n\u2714 No validation issues found when analyzing ./app-v1.yaml\n./app-v2.yaml\n./gateway.yaml\n./virtualservice-match.yaml\n./virtualservice-weight.yaml\n./virtualservice-wildcard.yaml.\n</code></pre> Verify sidecar injection<pre><code># Pod\n$ istioctl -i aks-istio-system experimental check-inject productpage-v1-6c5c9c9d9-plq9r.default\nWEBHOOK                                           REVISION  INJECTED      REASON\nistio-sidecar-injector-asm-1-17-aks-istio-system  asm-1-17  \u2714             Namespace label istio.io/rev=asm-1-17 matches\n\n# Deployment\n$ istioctl -i aks-istio-system experimental check-inject deployment/productpage-v1.default\nWEBHOOK                                           REVISION  INJECTED      REASON\nistio-sidecar-injector-asm-1-17-aks-istio-system  asm-1-17  \u2714             Namespace label istio.io/rev=asm-1-17 matches\n</code></pre> Understand your Mesh with Istioctl Describe<pre><code>$ istioctl -i aks-istio-system experimental describe pod productpage-v1-6c5c9c9d9-plq9r.default\nPod: productpage-v1-6c5c9c9d9-plq9r\n   Pod Revision: asm-1-17\n   Pod Ports: 9080 (productpage), 15090 (istio-proxy)\n--------------------\nService: productpage\n   Port: http 9080/HTTP targets pod port 9080\n--------------------\nEffective PeerAuthentication:\n   Workload mTLS mode: PERMISSIVE\nSkipping Gateway information (no ingress gateway pods)\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-managed-path.html#deep-dive-into-envoy-configuration","title":"Deep dive into Envoy configuration","text":"What Envoy version is Istio using?<pre><code>$ kubectl exec -it productpage-v1-6c5c9c9d9-plq9r -c istio-proxy -n default -- pilot-agent request GET server_info --log_as_json | jq {version}\n{\n  \"version\": \"d799381810ae54f1cccb2a9ae79d9c6191ca2c83/1.25.4-dev/Clean/RELEASE/BoringSSL\"\n}\n</code></pre> Retrieve summary about cluster configuration for a given pod from Envoy.<pre><code># istioctl proxy-config clusters &lt;pod-name[.namespace]&gt;\n$ istioctl -i aks-istio-system proxy-config cluster productpage-v1-6c5c9c9d9-plq9r.default\nSERVICE FQDN                                                  PORT      SUBSET     DIRECTION     TYPE             DESTINATION RULE\n                                                              9080      -          inbound       ORIGINAL_DST\nBlackHoleCluster                                              -         -          -             STATIC\nInboundPassthroughClusterIpv4                                 -         -          -             ORIGINAL_DST\nPassthroughCluster                                            -         -          -             ORIGINAL_DST\nagent                                                         -         -          -             STATIC\nama-metrics-ksm.kube-system.svc.cluster.local                 8080      -          outbound      EDS\ndetails.default.svc.cluster.local                             9080      -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            443       -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15010     -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15012     -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15014     -          outbound      EDS\nkube-dns.kube-system.svc.cluster.local                        53        -          outbound      EDS\nkubernetes.default.svc.cluster.local                          443       -          outbound      EDS\nmetrics-server.kube-system.svc.cluster.local                  443       -          outbound      EDS\nnpm-metrics-cluster-service.kube-system.svc.cluster.local     9000      -          outbound      EDS\nproductpage.default.svc.cluster.local                         9080      -          outbound      EDS\nprometheus_stats                                              -         -          -             STATIC\nratings.default.svc.cluster.local                             9080      -          outbound      EDS\nreviews.default.svc.cluster.local                             9080      -          outbound      EDS\nsds-grpc                                                      -         -          -             STATIC\nxds-grpc                                                      -         -          -             STATIC\nzipkin                                                        -         -          -             STRICT_DNS\n``````\n\n```bash title=\"Retrieve summary about route configuration for a given pod from Envoy\"\n# istioctl proxy-config routes &lt;pod-name[.namespace]&gt;\n$ istioctl -i aks-istio-system proxy-config route productpage-v1-6c5c9c9d9-plq9r.default\nNAME                                                               VHOST NAME                                                         DOMAINS                                           MATCH                  VIRTUAL SERVICE\n8080                                                               ama-metrics-ksm.kube-system.svc.cluster.local:8080                 ama-metrics-ksm.kube-system, 10.0.21.168          /*\n9080                                                               details.default.svc.cluster.local:9080                             details, details.default + 1 more...              /*\n9080                                                               productpage.default.svc.cluster.local:9080                         productpage, productpage.default + 1 more...      /*\n9080                                                               ratings.default.svc.cluster.local:9080                             ratings, ratings.default + 1 more...              /*\n9080                                                               reviews.default.svc.cluster.local:9080                             reviews, reviews.default + 1 more...              /*\nmetrics-server.kube-system.svc.cluster.local:443                   metrics-server.kube-system.svc.cluster.local:443                   *                                                 /*\n15010                                                              istiod-asm-1-17.aks-istio-system.svc.cluster.local:15010           istiod-asm-1-17.aks-istio-system, 10.0.98.209     /*\n15014                                                              istiod-asm-1-17.aks-istio-system.svc.cluster.local:15014           istiod-asm-1-17.aks-istio-system, 10.0.98.209     /*\nnpm-metrics-cluster-service.kube-system.svc.cluster.local:9000     npm-metrics-cluster-service.kube-system.svc.cluster.local:9000     *                                                 /*\nInboundPassthroughClusterIpv4                                      inbound|http|0                                                     *                                                 /*\nInboundPassthroughClusterIpv4                                      inbound|http|0                                                     *                                                 /*\ninbound|9080||                                                     inbound|http|9080                                                  *                                                 /*\n                                                                   backend                                                            *                                                 /healthz/ready*\ninbound|9080||                                                     inbound|http|9080                                                  *                                                 /*\n                                                                   backend                                                            *                                                 /stats/prometheus*\n``````\n\n\n\n```bash title=\"Retrieve summary about listener configuration for a given pod from Envoy\"\n$ istioctl -i aks-istio-system proxy-config listeners details-v1-7c7dbcb4b5-8v2dh.default\nADDRESS     PORT  MATCH                                                                                           DESTINATION\n10.0.0.10   53    ALL                                                                                             Cluster: outbound|53||kube-dns.kube-system.svc.cluster.local\n10.0.0.1    443   ALL                                                                                             Cluster: outbound|443||kubernetes.default.svc.cluster.local\n10.0.154.2  443   Trans: raw_buffer; App: http/1.1,h2c                                                            Route: metrics-server.kube-system.svc.cluster.local:443\n10.0.154.2  443   ALL                                                                                             Cluster: outbound|443||metrics-server.kube-system.svc.cluster.local\n10.0.98.209 443   ALL                                                                                             Cluster: outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n0.0.0.0     8080  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 8080\n0.0.0.0     8080  ALL                                                                                             PassthroughCluster\n10.0.34.198 9000  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: npm-metrics-cluster-service.kube-system.svc.cluster.local:9000\n10.0.34.198 9000  ALL                                                                                             Cluster: outbound|9000||npm-metrics-cluster-service.kube-system.svc.cluster.local\n0.0.0.0     9080  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 9080\n0.0.0.0     9080  ALL                                                                                             PassthroughCluster\n0.0.0.0     15001 ALL                                                                                             PassthroughCluster\n0.0.0.0     15001 Addr: *:15001                                                                                   Non-HTTP/Non-TCP\n0.0.0.0     15006 Addr: *:15006                                                                                   Non-HTTP/Non-TCP\n0.0.0.0     15006 Trans: tls; App: istio-http/1.0,istio-http/1.1,istio-h2; Addr: 0.0.0.0/0                        InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: raw_buffer; App: http/1.1,h2c; Addr: 0.0.0.0/0                                           InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; App: TCP TLS; Addr: 0.0.0.0/0                                                       InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: raw_buffer; Addr: 0.0.0.0/0                                                              InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; Addr: 0.0.0.0/0                                                                     InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; App: istio,istio-peer-exchange,istio-http/1.0,istio-http/1.1,istio-h2; Addr: *:9080 Cluster: inbound|9080||\n0.0.0.0     15006 Trans: raw_buffer; Addr: *:9080                                                                 Cluster: inbound|9080||\n0.0.0.0     15010 Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 15010\n0.0.0.0     15010 ALL                                                                                             PassthroughCluster\n10.0.98.209 15012 ALL                                                                                             Cluster: outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n0.0.0.0     15014 Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 15014\n0.0.0.0     15014 ALL                                                                                             PassthroughCluster\n0.0.0.0     15021 ALL                                                                                             Inline Route: /healthz/ready*\n0.0.0.0     15090 ALL                                                                                             Inline Route: /stats/prometheus*\n</code></pre> Check the listener configuration on a pod<pre><code>$ istioctl -i aks-istio-system proxy-config listeners details-v1-7c7dbcb4b5-8v2dh.default --port 15001 -o json\n[\n    {\n        \"name\": \"virtualOutbound\",\n        \"address\": {\n            \"socketAddress\": {\n                \"address\": \"0.0.0.0\",\n                \"portValue\": 15001\n            }\n        },\n        \"filterChains\": [\n            {\n                \"filterChainMatch\": {\n                    \"destinationPort\": 15001\n                },\n                \"filters\": [\n                    {\n                        \"name\": \"istio.stats\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                            \"typeUrl\": \"type.googleapis.com/stats.PluginConfig\",\n                            \"value\": {}\n                        }\n                    },\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"BlackHoleCluster\",\n                            \"cluster\": \"BlackHoleCluster\"\n                        }\n                    }\n                ],\n                \"name\": \"virtualOutbound-blackhole\"\n            },\n            {\n                \"filters\": [\n                    {\n                        \"name\": \"istio.stats\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                            \"typeUrl\": \"type.googleapis.com/stats.PluginConfig\",\n                            \"value\": {}\n                        }\n                    },\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"PassthroughCluster\",\n                            \"cluster\": \"PassthroughCluster\"\n                        }\n                    }\n                ],\n                \"name\": \"virtualOutbound-catchall-tcp\"\n            }\n        ],\n        \"useOriginalDst\": true,\n        \"trafficDirection\": \"OUTBOUND\"\n    }\n]\n</code></pre> Retrieve full endpoint configuration for a given pod from Envoy<pre><code>$ istioctl -i aks-istio-system proxy-config endpoint productpage-v1-6c5c9c9d9-plq9r.default\nENDPOINT                                                STATUS      OUTLIER CHECK     CLUSTER\n10.240.0.5:10091                                        HEALTHY     OK                outbound|9000||npm-metrics-cluster-service.kube-system.svc.cluster.local\n10.241.0.11:9080                                        HEALTHY     OK                outbound|9080||ratings.default.svc.cluster.local\n10.241.0.12:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.14:53                                          HEALTHY     OK                outbound|53||kube-dns.kube-system.svc.cluster.local\n10.241.0.15:8080                                        HEALTHY     OK                outbound|8080||ama-metrics-ksm.kube-system.svc.cluster.local\n10.241.0.19:4443                                        HEALTHY     OK                outbound|443||metrics-server.kube-system.svc.cluster.local\n10.241.0.20:53                                          HEALTHY     OK                outbound|53||kube-dns.kube-system.svc.cluster.local\n10.241.0.38:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.40:4443                                        HEALTHY     OK                outbound|443||metrics-server.kube-system.svc.cluster.local\n10.241.0.43:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.44:9080                                        HEALTHY     OK                outbound|9080||productpage.default.svc.cluster.local\n10.241.0.53:9080                                        HEALTHY     OK                outbound|9080||details.default.svc.cluster.local\n10.241.0.8:15010                                        HEALTHY     OK                outbound|15010||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15012                                        HEALTHY     OK                outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15014                                        HEALTHY     OK                outbound|15014||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15017                                        HEALTHY     OK                outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15010                                        HEALTHY     OK                outbound|15010||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15012                                        HEALTHY     OK                outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15014                                        HEALTHY     OK                outbound|15014||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15017                                        HEALTHY     OK                outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n127.0.0.1:15000                                         HEALTHY     OK                prometheus_stats\n127.0.0.1:15020                                         HEALTHY     OK                agent\n20.62.140.71:443                                        HEALTHY     OK                outbound|443||kubernetes.default.svc.cluster.local\nunix://./etc/istio/proxy/XDS                            HEALTHY     OK                xds-grpc\nunix://./var/run/secrets/workload-spiffe-uds/socket     HEALTHY     OK                sds-grpc\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-managed-path.html#references","title":"References","text":"<ul> <li>Testing the Istio-based service mesh add-on for Azure Kubernetes Service</li> <li>istioctl</li> <li>Debugging Envoy and Istiod</li> <li>Diagnose your Configuration with Istioctl Analyze</li> <li>Understand your Mesh with Istioctl Describe</li> <li>istioctl cheatsheet</li> </ul>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html","title":"Tips and Trick: Istio and Azure Kubernetes Service (Unmanaged Path)","text":"Istio Compenets Managed by istiod Azure Managed istio-ingressgateway Azure Managed istio-egressgateway N/A prometheus OSS grafana OSS jaeger OSS","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html#enable-istio-ingress-gateway","title":"Enable istio-ingress-gateway","text":"<pre><code>az aks mesh enable-ingress-gateway --resource-group rg-poc-aks --name poc-aks --ingress-gateway-type external\n</code></pre> <pre><code>export INGRESS_HOST_INTERNAL=$(kubectl -n aks-istio-ingress get service aks-istio-ingressgateway-external -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\nexport INGRESS_PORT_INTERNAL=$(kubectl -n aks-istio-ingress get service aks-istio-ingressgateway-external -o jsonpath='{.spec.ports[?(@.name==\"http2\")].port}')\nexport GATEWAY_URL_INTERNAL=$INGRESS_HOST_INTERNAL:$INGRESS_PORT_INTERNAL\necho $GATEWAY_URL_INTERNAL\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html#dashboard","title":"Dashboard","text":"ControlZ<pre><code>$ kubectl get pods -n aks-istio-system\nNAME                               READY   STATUS    RESTARTS   AGE\nistiod-asm-1-17-6889d9d6c5-mkwsd   1/1     Running   0          131m\nistiod-asm-1-17-6889d9d6c5-vqrq8   1/1     Running   0          132m\n$ istioctl -i aks-istio-system dashboard controlz istiod-asm-1-17-6889d9d6c5-mkwsd --browser false -n aks-istio-system\nhttp://localhost:9876\nFailed to open browser; open http://localhost:9876 in your browser.\n</code></pre> Envoy<pre><code># istioctl dashboard envoy [&lt;type&gt;/]&lt;name&gt;[.&lt;namespace&gt;] [flags]\n$ istioctl -i aks-istio-system dashboard envoy details-v1-7c7dbcb4b5-8v2dh.default\nhttp://localhost:15000\nFailed to open browser; open http://localhost:15000 in your browser.\n</code></pre> Prometheus<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/prometheus.yaml -O aks-prometheus.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-prometheus.yaml\n$ grep istio-system aks-prometheus.yaml\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n    namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n\n$ kubectl apply -f aks-prometheus.yaml\nserviceaccount/prometheus created\nconfigmap/prometheus created\nclusterrole.rbac.authorization.k8s.io/prometheus unchanged\nclusterrolebinding.rbac.authorization.k8s.io/prometheus configured\nservice/prometheus created\ndeployment.apps/prometheus created\n\n$ kubectl get svc -n aks-istio-system\nNAME              TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)                                 AGE\nistiod-asm-1-17   ClusterIP   10.0.98.209   &lt;none&gt;        15010/TCP,15012/TCP,443/TCP,15014/TCP   10h\nprometheus        ClusterIP   10.0.219.2    &lt;none&gt;        9090/TCP                                43s\n\n$ istioctl -i aks-istio-system dashboard prometheus -n aks-istio-system\nhttp://localhost:9090\n</code></pre> Grafana<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/grafana.yaml -O aks-grafana.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-grafana.yaml\n$ kubectl apply -f aks-grafana.yaml\nserviceaccount/grafana created\nconfigmap/grafana created\nservice/grafana created\ndeployment.apps/grafana created\nconfigmap/istio-grafana-dashboards created\nconfigmap/istio-services-grafana-dashboards created\n\n$ istioctl -i aks-istio-system dashboard grafana -n aks-istio-system\nhttp://localhost:3000\n``````\n\n```bash title=\"Jaeger\"\n$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/jaeger.yaml -O aks-jaeger.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-jaeger.yaml\n$ kubectl apply -f aks-jaeger.yaml\ndeployment.apps/jaeger created\nservice/tracing created\nservice/zipkin created\nservice/jaeger-collector created\n\n$ istioctl -i aks-istio-system dashboard jaeger -n aks-istio-system\nhttp://localhost:16686\n</code></pre> Kiali<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/release-1.17/samples/addons/kiali.yaml -O aks-kiali.yaml\n$ sed -i 's/istio-system/aks-istio-system/g' aks-kiali.yaml\n$ grep istio-system aks-kiali.yaml\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n      namespace: aks-istio-system\n        root_namespace: aks-istio-system\n    istio_namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n  namespace: aks-istio-system\n\n# https://kiali.io/docs/configuration/kialis.kiali.io/\n  spec:\n    external_services:\n      custom_dashboards:\n        enabled: true\n      istio:\n        root_namespace: \"aks-istio-system\"\n        config_map_name: \"istio-asm-1-17\"\n        istio_api_enabled: true\n        istiod_deployment_name: \"istiod-asm-1-17\"\n        istiod_pod_monitoring_port: 15014\n        component_status:\n          enabled: true\n          components:\n          - app_label: \"istiod\"\n            is_core: true\n            namespace: aks-istio-system\n          - app_label: \"aks-istio-ingressgateway-external\"\n            is_core: true\n            namespace: aks-istio-ingress\n          - app_label: \"istio-egressgateway\"\n            is_core: false\n            namespace: aks-istio-system\n      prometheus:\n        health_check_url: http://prometheus.aks-istio-system:9090/-/healthy\n        url: http://prometheus.aks-istio-system:9090/\n      tracing:\n        enabled: true\n        health_check_url: http://tracing.aks-istio-system:14269/\n        in_cluster_url: http://tracing.aks-istio-system:16685/\n        url: http://tracing.aks-istio-system:16685/\n      grafana:\n        in_cluster_url: http://grafana.aks-istio-system:3000/\n        health_check_url: http://grafana.aks-istio-system:3000/api/health\n        url: http://grafana.aks-istio-system:3000/\n        enabled: true\n        dashboards:\n        - name: \"Istio Service Dashboard\"\n          variables:\n            namespace: \"var-namespace\"\n            service: \"var-service\"\n        - name: \"Istio Workload Dashboard\"\n          variables:\n            namespace: \"var-namespace\"\n            workload: \"var-workload\"\n        - name: \"Istio Mesh Dashboard\"\n        - name: \"Istio Control Plane Dashboard\"\n        - name: \"Istio Performance Dashboard\"\n        - name: \"Istio Wasm Extension Dashboard\"\n\n$ kubectl apply -f aks-kiali.yaml\nserviceaccount/kiali created\nconfigmap/kiali created\nclusterrole.rbac.authorization.k8s.io/kiali-viewer created\nclusterrole.rbac.authorization.k8s.io/kiali created\nclusterrolebinding.rbac.authorization.k8s.io/kiali created\nrole.rbac.authorization.k8s.io/kiali-controlplane created\nrolebinding.rbac.authorization.k8s.io/kiali-controlplane created\nservice/kiali created\ndeployment.apps/kiali created\n\n$ kubectl -n aks-istio-system rollout restart deployment/kiali\ndeployment.apps/kiali restarted\n\n$ istioctl -i aks-istio-system dashboard kiali -n aks-istio-system\nhttp://localhost:20001/kiali\nFailed to open browser; open http://localhost:20001/kiali in your browser.\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html#overall-health-check","title":"Overall Health Check","text":"Istio Version<pre><code>$ istioctl -i aks-istio-system version\nclient version: 1.18.1\ncontrol plane version: 1.17-dev\ndata plane version: 1.17.2-distroless (6 proxies)\n</code></pre> Verifying connectivity to Istiod<pre><code>$ wget https://raw.githubusercontent.com/istio/istio/master/samples/sleep/sleep.yaml\n\n$ kubectl create namespace foo\nnamespace/foo created\n\n$ kubectl apply -f &lt;(istioctl kube-inject -f ./sleep.yaml -i aks-istio-system -r asm-1-17) -n foo\nserviceaccount/sleep created\nservice/sleep created\ndeployment.apps/sleep created\n\n$ kubectl exec $(kubectl get pod -l app=sleep -n foo -o jsonpath={.items..metadata.name}) -c sleep -n foo -- curl -sS istiod-asm-1-17.aks-istio-system:15014/version\n1.17-dev-3e857775086a061d12ee445f32a0b35ea17c8488-Clean\n</code></pre> Get an overview of your mesh<pre><code># Usage: istioctl proxy-status [&lt;type&gt;/]&lt;name&gt;[.&lt;namespace&gt;] [flags]\n$ istioctl -i aks-istio-system proxy-status\nNAME                                       CLUSTER        CDS        LDS        EDS        RDS        ECDS         ISTIOD                               VERSION\ndetails-v1-7c7dbcb4b5-8v2dh.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nproductpage-v1-6c5c9c9d9-plq9r.default     Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nratings-v1-844796bf85-tbshm.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-vqrq8     1.17.2-distroless\nreviews-v1-5cf854487-6qg5p.default         Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nreviews-v2-955b74755-gq8r5.default         Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\nreviews-v3-797fc48bc9-svx59.default        Kubernetes     SYNCED     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-asm-1-17-6889d9d6c5-mkwsd     1.17.2-distroless\n</code></pre> analyze your current live Kubernetes cluster by running<pre><code>$ istioctl -i aks-istio-system analyze --revision 1-17 --namespace default\n\n\u2714 No validation issues found when analyzing namespace: default.\n\n$ istioctl -i aks-istio-system analyze --revision 1-17 --all-namespaces\nInfo [IST0102] (Namespace aks-command) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-command istio-injection=enabled' to enable it, or 'kubectl label namespace aks-command istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace aks-istio-ingress) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-istio-ingress istio-injection=enabled' to enable it, or 'kubectl label namespace aks-istio-ingress istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace aks-istio-system) The namespace is not enabled for Istio injection. Run 'kubectl label namespace aks-istio-system istio-injection=enabled' to enable it, or 'kubectl label namespace aks-istio-system istio-injection=disabled' to explicitly mark it as not needing injection.\nInfo [IST0102] (Namespace foo) The namespace is not enabled for Istio injection. Run 'kubectl label namespace foo istio-injection=enabled' to enable it, or 'kubectl label namespace foo istio-injection=disabled' to explicitly mark it as not needing injection.\n</code></pre> Analyzing live clusters, local files, or both<pre><code>$ ls\napp-v1.yaml  app-v2.yaml  gateway.yaml  grafana-ab-testing.png  README.md  virtualservice-match.yaml  virtualservice-weight.yaml  virtualservice-wildcard.yaml\n\n$ istioctl analyze ./*\nSkipping file ./grafana-ab-testing.png, recognized file extensions are: [.json .yaml .yml]\nSkipping file ./README.md, recognized file extensions are: [.json .yaml .yml]\n\n\u2714 No validation issues found when analyzing ./app-v1.yaml\n./app-v2.yaml\n./gateway.yaml\n./virtualservice-match.yaml\n./virtualservice-weight.yaml\n./virtualservice-wildcard.yaml.\n</code></pre> Verify sidecar injection<pre><code># Pod\n$ istioctl -i aks-istio-system experimental check-inject productpage-v1-6c5c9c9d9-plq9r.default\nWEBHOOK                                           REVISION  INJECTED      REASON\nistio-sidecar-injector-asm-1-17-aks-istio-system  asm-1-17  \u2714             Namespace label istio.io/rev=asm-1-17 matches\n\n# Deployment\n$ istioctl -i aks-istio-system experimental check-inject deployment/productpage-v1.default\nWEBHOOK                                           REVISION  INJECTED      REASON\nistio-sidecar-injector-asm-1-17-aks-istio-system  asm-1-17  \u2714             Namespace label istio.io/rev=asm-1-17 matches\n</code></pre> Understand your Mesh with Istioctl Describe<pre><code>$ istioctl -i aks-istio-system experimental describe pod productpage-v1-6c5c9c9d9-plq9r.default\nPod: productpage-v1-6c5c9c9d9-plq9r\n   Pod Revision: asm-1-17\n   Pod Ports: 9080 (productpage), 15090 (istio-proxy)\n--------------------\nService: productpage\n   Port: http 9080/HTTP targets pod port 9080\n--------------------\nEffective PeerAuthentication:\n   Workload mTLS mode: PERMISSIVE\nSkipping Gateway information (no ingress gateway pods)\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html#deep-dive-into-envoy-configuration","title":"Deep dive into Envoy configuration","text":"What Envoy version is Istio using?<pre><code>$ kubectl exec -it productpage-v1-6c5c9c9d9-plq9r -c istio-proxy -n default -- pilot-agent request GET server_info --log_as_json | jq {version}\n{\n  \"version\": \"d799381810ae54f1cccb2a9ae79d9c6191ca2c83/1.25.4-dev/Clean/RELEASE/BoringSSL\"\n}\n</code></pre> Retrieve summary about cluster configuration for a given pod from Envoy.<pre><code># istioctl proxy-config clusters &lt;pod-name[.namespace]&gt;\n$ istioctl -i aks-istio-system proxy-config cluster productpage-v1-6c5c9c9d9-plq9r.default\nSERVICE FQDN                                                  PORT      SUBSET     DIRECTION     TYPE             DESTINATION RULE\n                                                              9080      -          inbound       ORIGINAL_DST\nBlackHoleCluster                                              -         -          -             STATIC\nInboundPassthroughClusterIpv4                                 -         -          -             ORIGINAL_DST\nPassthroughCluster                                            -         -          -             ORIGINAL_DST\nagent                                                         -         -          -             STATIC\nama-metrics-ksm.kube-system.svc.cluster.local                 8080      -          outbound      EDS\ndetails.default.svc.cluster.local                             9080      -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            443       -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15010     -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15012     -          outbound      EDS\nistiod-asm-1-17.aks-istio-system.svc.cluster.local            15014     -          outbound      EDS\nkube-dns.kube-system.svc.cluster.local                        53        -          outbound      EDS\nkubernetes.default.svc.cluster.local                          443       -          outbound      EDS\nmetrics-server.kube-system.svc.cluster.local                  443       -          outbound      EDS\nnpm-metrics-cluster-service.kube-system.svc.cluster.local     9000      -          outbound      EDS\nproductpage.default.svc.cluster.local                         9080      -          outbound      EDS\nprometheus_stats                                              -         -          -             STATIC\nratings.default.svc.cluster.local                             9080      -          outbound      EDS\nreviews.default.svc.cluster.local                             9080      -          outbound      EDS\nsds-grpc                                                      -         -          -             STATIC\nxds-grpc                                                      -         -          -             STATIC\nzipkin                                                        -         -          -             STRICT_DNS\n``````\n\n```bash title=\"Retrieve summary about route configuration for a given pod from Envoy\"\n# istioctl proxy-config routes &lt;pod-name[.namespace]&gt;\n$ istioctl -i aks-istio-system proxy-config route productpage-v1-6c5c9c9d9-plq9r.default\nNAME                                                               VHOST NAME                                                         DOMAINS                                           MATCH                  VIRTUAL SERVICE\n8080                                                               ama-metrics-ksm.kube-system.svc.cluster.local:8080                 ama-metrics-ksm.kube-system, 10.0.21.168          /*\n9080                                                               details.default.svc.cluster.local:9080                             details, details.default + 1 more...              /*\n9080                                                               productpage.default.svc.cluster.local:9080                         productpage, productpage.default + 1 more...      /*\n9080                                                               ratings.default.svc.cluster.local:9080                             ratings, ratings.default + 1 more...              /*\n9080                                                               reviews.default.svc.cluster.local:9080                             reviews, reviews.default + 1 more...              /*\nmetrics-server.kube-system.svc.cluster.local:443                   metrics-server.kube-system.svc.cluster.local:443                   *                                                 /*\n15010                                                              istiod-asm-1-17.aks-istio-system.svc.cluster.local:15010           istiod-asm-1-17.aks-istio-system, 10.0.98.209     /*\n15014                                                              istiod-asm-1-17.aks-istio-system.svc.cluster.local:15014           istiod-asm-1-17.aks-istio-system, 10.0.98.209     /*\nnpm-metrics-cluster-service.kube-system.svc.cluster.local:9000     npm-metrics-cluster-service.kube-system.svc.cluster.local:9000     *                                                 /*\nInboundPassthroughClusterIpv4                                      inbound|http|0                                                     *                                                 /*\nInboundPassthroughClusterIpv4                                      inbound|http|0                                                     *                                                 /*\ninbound|9080||                                                     inbound|http|9080                                                  *                                                 /*\n                                                                   backend                                                            *                                                 /healthz/ready*\ninbound|9080||                                                     inbound|http|9080                                                  *                                                 /*\n                                                                   backend                                                            *                                                 /stats/prometheus*\n``````\n\n\n\n```bash title=\"Retrieve summary about listener configuration for a given pod from Envoy\"\n$ istioctl -i aks-istio-system proxy-config listeners details-v1-7c7dbcb4b5-8v2dh.default\nADDRESS     PORT  MATCH                                                                                           DESTINATION\n10.0.0.10   53    ALL                                                                                             Cluster: outbound|53||kube-dns.kube-system.svc.cluster.local\n10.0.0.1    443   ALL                                                                                             Cluster: outbound|443||kubernetes.default.svc.cluster.local\n10.0.154.2  443   Trans: raw_buffer; App: http/1.1,h2c                                                            Route: metrics-server.kube-system.svc.cluster.local:443\n10.0.154.2  443   ALL                                                                                             Cluster: outbound|443||metrics-server.kube-system.svc.cluster.local\n10.0.98.209 443   ALL                                                                                             Cluster: outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n0.0.0.0     8080  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 8080\n0.0.0.0     8080  ALL                                                                                             PassthroughCluster\n10.0.34.198 9000  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: npm-metrics-cluster-service.kube-system.svc.cluster.local:9000\n10.0.34.198 9000  ALL                                                                                             Cluster: outbound|9000||npm-metrics-cluster-service.kube-system.svc.cluster.local\n0.0.0.0     9080  Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 9080\n0.0.0.0     9080  ALL                                                                                             PassthroughCluster\n0.0.0.0     15001 ALL                                                                                             PassthroughCluster\n0.0.0.0     15001 Addr: *:15001                                                                                   Non-HTTP/Non-TCP\n0.0.0.0     15006 Addr: *:15006                                                                                   Non-HTTP/Non-TCP\n0.0.0.0     15006 Trans: tls; App: istio-http/1.0,istio-http/1.1,istio-h2; Addr: 0.0.0.0/0                        InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: raw_buffer; App: http/1.1,h2c; Addr: 0.0.0.0/0                                           InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; App: TCP TLS; Addr: 0.0.0.0/0                                                       InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: raw_buffer; Addr: 0.0.0.0/0                                                              InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; Addr: 0.0.0.0/0                                                                     InboundPassthroughClusterIpv4\n0.0.0.0     15006 Trans: tls; App: istio,istio-peer-exchange,istio-http/1.0,istio-http/1.1,istio-h2; Addr: *:9080 Cluster: inbound|9080||\n0.0.0.0     15006 Trans: raw_buffer; Addr: *:9080                                                                 Cluster: inbound|9080||\n0.0.0.0     15010 Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 15010\n0.0.0.0     15010 ALL                                                                                             PassthroughCluster\n10.0.98.209 15012 ALL                                                                                             Cluster: outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n0.0.0.0     15014 Trans: raw_buffer; App: http/1.1,h2c                                                            Route: 15014\n0.0.0.0     15014 ALL                                                                                             PassthroughCluster\n0.0.0.0     15021 ALL                                                                                             Inline Route: /healthz/ready*\n0.0.0.0     15090 ALL                                                                                             Inline Route: /stats/prometheus*\n</code></pre> Check the listener configuration on a pod<pre><code>$ istioctl -i aks-istio-system proxy-config listeners details-v1-7c7dbcb4b5-8v2dh.default --port 15001 -o json\n[\n    {\n        \"name\": \"virtualOutbound\",\n        \"address\": {\n            \"socketAddress\": {\n                \"address\": \"0.0.0.0\",\n                \"portValue\": 15001\n            }\n        },\n        \"filterChains\": [\n            {\n                \"filterChainMatch\": {\n                    \"destinationPort\": 15001\n                },\n                \"filters\": [\n                    {\n                        \"name\": \"istio.stats\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                            \"typeUrl\": \"type.googleapis.com/stats.PluginConfig\",\n                            \"value\": {}\n                        }\n                    },\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"BlackHoleCluster\",\n                            \"cluster\": \"BlackHoleCluster\"\n                        }\n                    }\n                ],\n                \"name\": \"virtualOutbound-blackhole\"\n            },\n            {\n                \"filters\": [\n                    {\n                        \"name\": \"istio.stats\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                            \"typeUrl\": \"type.googleapis.com/stats.PluginConfig\",\n                            \"value\": {}\n                        }\n                    },\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"PassthroughCluster\",\n                            \"cluster\": \"PassthroughCluster\"\n                        }\n                    }\n                ],\n                \"name\": \"virtualOutbound-catchall-tcp\"\n            }\n        ],\n        \"useOriginalDst\": true,\n        \"trafficDirection\": \"OUTBOUND\"\n    }\n]\n</code></pre> Retrieve full endpoint configuration for a given pod from Envoy<pre><code>$ istioctl -i aks-istio-system proxy-config endpoint productpage-v1-6c5c9c9d9-plq9r.default\nENDPOINT                                                STATUS      OUTLIER CHECK     CLUSTER\n10.240.0.5:10091                                        HEALTHY     OK                outbound|9000||npm-metrics-cluster-service.kube-system.svc.cluster.local\n10.241.0.11:9080                                        HEALTHY     OK                outbound|9080||ratings.default.svc.cluster.local\n10.241.0.12:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.14:53                                          HEALTHY     OK                outbound|53||kube-dns.kube-system.svc.cluster.local\n10.241.0.15:8080                                        HEALTHY     OK                outbound|8080||ama-metrics-ksm.kube-system.svc.cluster.local\n10.241.0.19:4443                                        HEALTHY     OK                outbound|443||metrics-server.kube-system.svc.cluster.local\n10.241.0.20:53                                          HEALTHY     OK                outbound|53||kube-dns.kube-system.svc.cluster.local\n10.241.0.38:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.40:4443                                        HEALTHY     OK                outbound|443||metrics-server.kube-system.svc.cluster.local\n10.241.0.43:9080                                        HEALTHY     OK                outbound|9080||reviews.default.svc.cluster.local\n10.241.0.44:9080                                        HEALTHY     OK                outbound|9080||productpage.default.svc.cluster.local\n10.241.0.53:9080                                        HEALTHY     OK                outbound|9080||details.default.svc.cluster.local\n10.241.0.8:15010                                        HEALTHY     OK                outbound|15010||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15012                                        HEALTHY     OK                outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15014                                        HEALTHY     OK                outbound|15014||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.8:15017                                        HEALTHY     OK                outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15010                                        HEALTHY     OK                outbound|15010||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15012                                        HEALTHY     OK                outbound|15012||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15014                                        HEALTHY     OK                outbound|15014||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n10.241.0.9:15017                                        HEALTHY     OK                outbound|443||istiod-asm-1-17.aks-istio-system.svc.cluster.local\n127.0.0.1:15000                                         HEALTHY     OK                prometheus_stats\n127.0.0.1:15020                                         HEALTHY     OK                agent\n20.62.140.71:443                                        HEALTHY     OK                outbound|443||kubernetes.default.svc.cluster.local\nunix://./etc/istio/proxy/XDS                            HEALTHY     OK                xds-grpc\nunix://./var/run/secrets/workload-spiffe-uds/socket     HEALTHY     OK                sds-grpc\n</code></pre>","tags":["kubernetes","istio","asm"]},{"location":"wiki/istio-and-aks-unmanaged-path.html#references","title":"References","text":"<ul> <li>Testing the Istio-based service mesh add-on for Azure Kubernetes Service</li> <li>istioctl</li> <li>Debugging Envoy and Istiod</li> <li>Diagnose your Configuration with Istioctl Analyze</li> <li>Understand your Mesh with Istioctl Describe</li> <li>istioctl cheatsheet</li> </ul>","tags":["kubernetes","istio","asm"]},{"location":"wiki/kubernetes-onestop.html","title":"One Stop: Kubernetes","text":"","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#deployment-sample","title":"Deployment Sample","text":"<ul> <li>Gist - pichuang/deployment-sample.yml</li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#service-mesh","title":"Service Mesh","text":"<ul> <li>Welcome to #70DaysOfServiceMesh!!!</li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#azure-kubernetes","title":"Azure Kubernetes","text":"<ul> <li>Accessing AKS private clusters with Azure Bastion and VS Code</li> <li>How To: \u8a2d\u5b9a Resolve \u65bc Azure Kubernetes Service</li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#container-images","title":"Container Images","text":"<ul> <li>Azure JAVA \u5bb9\u5668\u5316\u7b56\u7565</li> <li>Windows \u5bb9\u5668\u5316</li> <li>Building Smaller Container Images</li> <li>pichuang/debug-container</li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#copilot","title":"Copilot","text":"<ul> <li>feiskyer/kube-copilot<ul> <li>Integrating Azure AI and Azure Kubernetes Service to build intelligent apps</li> </ul> </li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/kubernetes-onestop.html#cloud-testing","title":"Cloud Testing","text":"<ul> <li>Contoso Traders - Cloud testing tools demo app<ul> <li>Deep dive on Azure Load Testing in CI/CD</li> <li>Application reliability with Azure Load Testing and Chaos Studio, Q&amp;A</li> </ul> </li> </ul>","tags":["One Stop","kubernetes","cncf"]},{"location":"wiki/linux-onestop.html","title":"Linux \u76f8\u95dc\u8cc7\u8a0a\u7e3d\u532f","text":"","tags":["One Stop","linux"]},{"location":"wiki/linux-onestop.html#openssh","title":"OpenSSH","text":"<ul> <li>A Visual Guide to SSH Tunnels: Local and Remote Port Forwarding: SSH Tunnel \u5947\u6deb\u6280\u5de7\u4f7f\u7528\u5716\u89e3</li> </ul>","tags":["One Stop","linux"]},{"location":"wiki/linux-onestop.html#wsl2","title":"WSL2","text":"<ul> <li>How To: \u8a2d\u5b9a WSL2</li> </ul>","tags":["One Stop","linux"]},{"location":"wiki/observability-onestop.html","title":"One Stop: Observability","text":"","tags":["One Stop","observability"]},{"location":"wiki/ocpp-survey.html","title":"OCPP (Open Charge Point Protocol) Survey","text":"","tags":["One Stop","azure"]},{"location":"wiki/ocpp-survey.html#protocols","title":"Protocols","text":"<ol> <li>(\u4e3b\u6d41) \u4ee5 Websocket \u70ba\u4e3b\u7684 OCPP-J</li> <li>\u4ee5 SOAP \u70ba\u4e3b\u7684 OCPP-S: 2.0 \u4e0d\u652f\u63f4 SOAP \u4e86\uff0c\u50c5\u5269 1.6 \u624d\u6709</li> </ol>","tags":["One Stop","azure"]},{"location":"wiki/ocpp-survey.html#spec","title":"Spec","text":"<ul> <li>OCPP 2.0.1</li> <li>(\u4e3b\u6d41) OCPP 1.6</li> </ul> <p>2.0.1 \u7121\u6cd5\u5411\u5f8c\u517c\u5bb9 1.6</p>","tags":["One Stop","azure"]},{"location":"wiki/ocpp-survey.html#appendix","title":"Appendix","text":"","tags":["One Stop","azure"]},{"location":"wiki/ocpp-survey.html#_1","title":"\u5145\u96fb\u982d\u898f\u683c","text":"<ul> <li>AC</li> <li>(\u4e3b\u6d41) J1772</li> <li>TPC</li> <li>Mennekes</li> <li>DC</li> <li>(\u4e3b\u6d41) CCS2</li> <li>TPC</li> <li>CCS1</li> <li>CHAdeMO</li> </ul>","tags":["One Stop","azure"]},{"location":"wiki/ocpp-survey.html#references","title":"References","text":"<ul> <li>[Collaborator\u7522\u7d93\u5171\u5b78\u793e3</li> <li>mobilityhouse/ocpp</li> </ul>","tags":["One Stop","azure"]},{"location":"wiki/openai-onestop.html","title":"One Stop: Prompt Engineering","text":"","tags":["One Stop","openai"]},{"location":"wiki/openai-onestop.html#prompt","title":"\u6536\u96c6\u5492\u8a9e (Prompt)","text":"<ul> <li>ChatGPT cheatsheet</li> <li>ChatGPT \u6307\u4ee4\u5927\u5168</li> </ul>","tags":["One Stop","openai"]},{"location":"wiki/openai-onestop.html#azure-openai","title":"Azure OpenAI","text":"<ul> <li>#30DaysOfAzureAI</li> </ul>","tags":["One Stop","openai"]},{"location":"wiki/openai-onestop.html#openai","title":"OpenAI \u76f8\u95dc\u6280\u8853","text":"<ul> <li>OpenAI API \u670d\u52d9\u4f4d\u7f6e</li> </ul>","tags":["One Stop","openai"]},{"location":"wiki/openai-onestop.html#act-as-an-english-translator-spelling-corrector-and-improver","title":"Act as an English translator, spelling corrector and improver","text":"<pre><code>I want you to act as an English translator, spelling corrector and improver. I will speak to you in any language and you will detect the language, translate it and answer in the corrected and improved version of my text, in English. I want you to replace my simplified A0-level words and sentences with more beautiful and elegant, upper level English words and sentences. Keep the meaning same, but make them more literary. I want you to only reply the correction, the improvements and nothing else, do not write explanations.\n</code></pre>","tags":["One Stop","openai"]},{"location":"wiki/vector-db-options-available-in-azure.html","title":"Vector DB Options Available in Azure","text":"","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#vector-db-options","title":"Vector DB Options","text":"<ol> <li>How to enable and use pgvector on Azure Database for PostgreSQL - Flexible Server</li> <li>Using vector search on embeddings in Azure Cosmos DB for MongoDB vCore</li> <li>Azure Cognitive Search (Private Preview)</li> <li>Azure Cache for Redis Enterprise</li> </ol>","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#azure-database-for-postgresql-flexible-server","title":"Azure Database for PostgreSQL - Flexible Server","text":"","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#azure-cosmos-db-for-mongodb-vcore","title":"Azure Cosmos DB for MongoDB vCore","text":"","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#azure-cognitive-search","title":"Azure Cognitive Search","text":"","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#azure-cache-for-redis-enterprise","title":"Azure Cache for Redis Enterprise","text":"","tags":["vector database"]},{"location":"wiki/vector-db-options-available-in-azure.html#references","title":"References","text":"<ul> <li>How to use the Azure OpenAI Embedding model to find the most relevant documents</li> <li>\u7ec8\u4e8e\u5377\u5b8c\u4e86\uff01Redis \u6253\u602a\u5347\u7ea7\u8fdb\u9636\u6210\u795e\u4e4b\u8def\uff082023 \u6700\u65b0\u7248\uff09\uff01</li> <li>\u786c\u5377\u5b8c\u4e86\uff01MongoDB \u6253\u602a\u5347\u7ea7\u8fdb\u9636\u6210\u795e\u4e4b\u8def\uff08 2023 \u6700\u65b0\u7248 \uff09\uff01</li> </ul>","tags":["vector database"]},{"location":"wiki/vmware-vsphere-troubleshooting.html","title":"VMware vSphere Troubleshooting Collections","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230223</p>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#vmware-vsphere-troubleshooting-collections","title":"VMware vSphere Troubleshooting Collections","text":"","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#vcenter-received-disconnect-too-many-authentication-failures","title":"vCenter Received Disconnect - Too Many Authentication Failures","text":"<p>Use <code>-o PubkeyAuthentication=no</code> to disable public key authentication.</p> <pre><code>$ ssh admin@vcenter.pichuang.local\n\nVMware vCenter Server 7.0.3.01000\n\nType: vCenter Server with an embedded Platform Services Controller\n\nReceived disconnect from 192.168.78.248 port 22:2: Too many authentication failures\nDisconnected from 192.168.78.248 port 22\n\n$ ssh -o PubkeyAuthentication=no root@vcenter.pichuang.local\n\nVMware vCenter Server 7.0.3.01000\n\nType: vCenter Server with an embedded Platform Services Controller\n\nroot@vcenter.pichuang.local's password:\nConnected to service\n\n    * List APIs: \"help api list\"\n    * List Plugins: \"help pi list\"\n    * Launch BASH: \"shell\"\n\nCommand&gt;\n</code></pre> <ul> <li>vCenter Received Disconnect - Too Many Authentication Failures</li> </ul>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#use-vsphere-certificate-manager-to-replace-ssl-certificates","title":"Use vSphere Certificate Manager to Replace SSL Certificates","text":"<p>Use <code>/usr/lib/vmware-vmca/bin/certificate-manager</code> and type 8 to reset all certificates.</p> <pre><code>root@vcenter [ ~ ]# /usr/lib/vmware-vmca/bin/certificate-manager\n                 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n                |                                                                     |\n                |      *** Welcome to the vSphere 6.8 Certificate Manager  ***        |\n                |                                                                     |\n                |                   -- Select Operation --                            |\n                |                                                                     |\n                |      1. Replace Machine SSL certificate with Custom Certificate     |\n                |                                                                     |\n                |      2. Replace VMCA Root certificate with Custom Signing           |\n                |         Certificate and replace all Certificates                    |\n                |                                                                     |\n                |      3. Replace Machine SSL certificate with VMCA Certificate       |\n                |                                                                     |\n                |      4. Regenerate a new VMCA Root Certificate and                  |\n                |         replace all certificates                                    |\n                |                                                                     |\n                |      5. Replace Solution user certificates with                     |\n                |         Custom Certificate                                          |\n                |         NOTE: Solution user certs will be deprecated in a future    |\n                |         release of vCenter. Refer to release notes for more details.|\n                |                                                                     |\n                |      6. Replace Solution user certificates with VMCA certificates   |\n                |                                                                     |\n                |      7. Revert last performed operation by re-publishing old        |\n                |         certificates                                                |\n                |                                                                     |\n                |      8. Reset all Certificates                                      |\n                |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _|\nNote : Use Ctrl-D to exit.\nOption[1 to 8]: 8\nDo you wish to generate all certificates using configuration file : Option[Y/N] ? : y\n</code></pre> <ul> <li>How to use vSphere Certificate Manager to Replace SSL Certificates (2097936)</li> <li>\u5173\u4e8e vCenter Server \u4e2d\u201cCertificate Status\u201d\u544a\u8b66\u7684\u5904\u7406</li> </ul>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#upgrade-esxi-hosts","title":"Upgrade ESXi hosts","text":"<p>Before: <code>VMware ESXi, 7.0.3, 19482537</code> After: <code>7.0.3 build-20328353</code></p> <ol> <li>Download Packages - VMware vSphere Hypervisor (ESXi) Offline Bundle - VMware-ESXi-7.0U3g-20328353-depot.zip</li> <li>Put the Zip file into the datastore.</li> <li>Mount the Zip file to the ESXi host.</li> <li>Run the following command to upgrade the ESXi host.</li> </ol> <pre><code>[root@esxi:~] esxcli software vib update -d /vmfs/volumes/iso_datastore/VMware-ESXi-7.0U3g-20328353-depot.zip\nInstallation Result\n   Message: The update completed successfully, but the system needs to be rebooted for the changes to be effective.\n   Reboot Required: true\n...omit...\n\n[root@esxi:~] esxcli system maintenanceMode set --enable=true\n[root@esxi:~] esxcli system shutdown reboot -r \"Update ESXi\"\n\n# After reboot\n[root@esxi:~] vmware -vl\nVMware ESXi 7.0.3 build-20328353\nVMware ESXi 7.0 Update 3\n[root@esxi:~] esxcli system maintenanceMode set --enable=false\n[root@esxi:~] esxcli system maintenanceMode get\nDisabled\n</code></pre>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#get-vmware-esxi-version-from-command-line","title":"Get VMware ESXi Version From Command Line","text":"<pre><code>[root@esxi:~] vmware -vl\nVMware ESXi 7.0.3 build-20328353\nVMware ESXi 7.0 Update 3\n</code></pre>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#reset-esxi-root-password-with-host-profile-via-vcenter","title":"Reset ESXi Root Password with Host Profile via vCenter","text":"<p>Reset ESXi Root Password with Host Profile (68079)</p>","tags":["vmware"]},{"location":"wiki/vmware-vsphere-troubleshooting.html#access-vmca-appliance","title":"Access VMCA Appliance","text":"<p>Open Browser and type <code>https://&lt;vCenter IP/FQDN&gt;:5480</code> to access vCenter Server Management</p>","tags":["vmware"]},{"location":"wiki/wireshark.html","title":"Wireshark Tips","text":"","tags":["observability"]},{"location":"wiki/wireshark.html#usefule-filters","title":"Usefule Filters","text":"<ul> <li>Find Server Error</li> <li>500 Internal Server Error</li> <li>501 Not Implemented</li> <li>502 Bad Gateway</li> <li>503 Service Unavailable</li> <li>504 Gateway Timeout</li> </ul> <pre><code>response.status &gt;= 500\n</code></pre> <ul> <li>Find Client Error</li> <li>400 Bad Request</li> <li>401 Unauthorized</li> <li>403 Forbidden</li> <li>404 Not Found</li> </ul> <pre><code>response.status &gt;= 400 and response.status &lt; 500\n</code></pre> <ul> <li>Find Server Error or Client Error</li> </ul> <pre><code>response.status &gt;= 400 or response.status &gt;= 500\n</code></pre>","tags":["observability"]},{"location":"wiki/howto/howto-azure-routing-preferences.html","title":"How To: Azure Public IP \u9078\u7528\u6307\u5357","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230130</p>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#how-to-azure-public-ip","title":"How To: Azure Public IP \u9078\u7528\u6307\u5357","text":"","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#microsoft-routing-preference-2","title":"Microsoft Routing Preference \u7684 2 \u7a2e\u985e\u578b","text":"<ul> <li> <p>\u71b1\u99ac\u9234\u85af\u8def\u7531 (Hot-potato Routing):</p> <ul> <li>Routing via the Internet with transit ISP network</li> <li>\u4e00\u822c\u7684 Public IP \u90fd\u662f Hot-potato Routing\uff0c\u5e0c\u671b\u80fd\u8d8a\u5feb\u7684\u5c07\u5c01\u5305\u50b3\u905e\u7d66\u5176\u4ed6 AS \u8655\u7406\uff0c\u6e1b\u5c11\u7559\u5728\u81ea\u5bb6\u7684\u6642\u9593</li> </ul> </li> </ul> <p></p> <ul> <li> <p>\u51b7\u99ac\u9234\u85af\u8def\u7531 (Cold-potato Routing):</p> <ul> <li>Routing via the premium Microsoft global network</li> <li>\u5e0c\u671b\u5c07\u5c01\u5305\u7559\u5728\u81ea\u5bb6\u7db2\u8def\u4e45\u4e00\u9ede\uff0c\u53ef\u4ee5\u6e1b\u5c11\u5c01\u5305\u5728\u7db2\u8def\u4e0a\u7684\u8df3\u8e8d\u6b21\u6578\uff0c\u6e1b\u5c11\u5ef6\u9072</li> </ul> </li> </ul> <p></p>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#performance","title":"Performance","text":"<p>\u5b98\u65b9\u63d0\u4f9b\u6578\u64da\u5982\u4e0b</p> <p></p> <p>\u4f46\u73fe\u5be6\u662f\u4e0d\u4e00\u5b9a\uff0c\u53ef\u4ee5\u53c3\u8003\u4e4b\u524d\u6211\u9304\u88fd\u7684\u5f71\u7247 <code>Latency Measurement of Azure Backbone Network</code> \u548c\u6295\u5f71\u7247 - 20221220 Azure Public IP \u8def\u7531\u504f\u597d\u6559\u6230\u624b\u518a</p>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#sample-code-block","title":"Sample Code Block","text":"","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#using-terraform","title":"Using Terraform","text":"<p>\u63a1\u7528 Terraform \u64b0\u5beb\u6642\uff0c\u63a7\u5236 Routing Preference \u7684\u9078\u9805\u662f\u7528 ip_tags \u4f86\u8868\u793a\uff0c\u5728\u9810\u8a2d\u6c92\u505a\u4efb\u4f55\u8a2d\u5b9a\u72c0\u6cc1\u4e0b\uff0cRoutingPreference \u6703\u63a1\u7528 <code>Microsoft</code></p> pip-routing-preferences.tf<pre><code>resource \"azurerm_public_ip\" \"pip-msbb-centralus\" {\n  name                = \"pip-msbb-centralus\" # (1)\n  location            = \"centralus\"\n  resource_group_name = var.lab-rg\n  allocation_method   = \"Static\"\n  sku                 = \"Standard\"\n  sku_tier            = \"Regional\"\n  idle_timeout_in_minutes = 4\n  zones               = [\"1\", \"2\", \"3\"]\n\n  # ip_tags = {\n  #   RoutingPreference  = \"Microsoft\" # (2)\n  # }\n}\n\nresource \"azurerm_public_ip\" \"pip-internet-centralus\" {\n  name                = \"pip-internet-centralus\"\n  location            = \"centralus\"\n  resource_group_name = var.lab-rg\n  allocation_method   = \"Static\"\n  sku                 = \"Standard\"\n  sku_tier            = \"Regional\"\n  idle_timeout_in_minutes = 4\n  zones               = [\"1\", \"2\", \"3\"]\n  ip_tags = {\n    RoutingPreference  = \"Internet\"\n  }\n}\n</code></pre> <ol> <li>MSBB: Microsoft BackBone</li> <li>DO NOT use ip_tags for RoutingPreference = \"Microsoft\", the setting is default</li> <li>Need to use ip_tags and set value <code>Internet</code></li> </ol>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#_1","title":"\u6aa2\u6e2c\u65b9\u5f0f","text":"","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#my-traceroute","title":"My TraceRoute","text":"command<pre><code>mtr -z -b &lt;Public IP&gt;\n</code></pre> output<pre><code>rhel8-wsl$ mtr -z -b microsoft.com\n\nrhel8 (172.29.1.64)\n2023-01-30T18:38:25+0800\nKeys:  Help   Display mode   Restart statistics   Order of fields   quit\n                                                                                  Packets               Pings\n Host                                                                           Loss%   Snt   Last   Avg  Best  Wrst StDev\n 1. AS???    _gateway (172.29.0.1)                                               0.0%     9    0.7   0.5   0.3   0.7   0.2\n 2. AS???    192.168.100.254 (192.168.100.254)                                   0.0%     9    2.8   3.0   2.6   3.3   0.3\n 3. AS3462   h254.s198.ts.hinet.net (168.95.198.254)                             0.0%     9   17.0  17.1  13.4  22.8   3.1\n 4. AS3462   tpdb-3332.hinet.net (168.95.83.102)                                 0.0%     9   13.3  12.4  11.6  13.3   0.5\n 5. AS???    220-128-1-30.hinet-ip.hinet.net (220.128.1.30)                      0.0%     9   11.5  12.3  11.0  15.3   1.4\n 6. ???\n 7. AS???    pcpd-4101.hinet.net (220.128.12.37)                                 0.0%     9   12.8  12.9  10.7  25.1   4.6\n 8. AS???    pcpd-4001.hinet.net (220.128.6.137)                                 0.0%     9   12.1  12.7  11.5  15.1   1.3\n 9. AS3491   63-218-56-101.static.pccwglobal.net (63.218.56.101)                 0.0%     9   35.2  34.3  33.7  35.2   0.5\n1.  AS3491   BE42.br04.hkg12.pccwbtn.net (63.218.174.134)                        0.0%     9   34.0  34.5  33.8  36.4   0.8\n2.  AS3491   63-216-176-146.static.pccwglobal.net (63.216.176.146)               0.0%     9   29.7  30.4  28.8  32.4   1.2\n3.  AS8075   ae26-0.icr02.hkg20.ntwk.msn.net (104.44.236.221)                    0.0%     9   38.3  32.2  28.8  40.7   4.2\n4.  AS8075   be-102-0.ibr01.hkg20.ntwk.msn.net (104.44.11.131)                   0.0%     9  158.6 158.7 158.0 160.1   0.7\n5.  AS8075   be-1-0.ibr01.hkg31.ntwk.msn.net (104.44.7.253)                      0.0%     9  158.4 158.4 157.9 159.2   0.4\n6.  AS8075   be-11-0.ibr01.tyo79.ntwk.msn.net (104.44.17.134)                   11.1%     9  157.7 158.2 157.0 160.9   1.2\n7.  AS8075   be-7-0.ibr01.pdx30.ntwk.msn.net (104.44.18.167)                     0.0%     9  157.8 158.6 157.1 164.8   2.4\n8.  AS8075   be-2-0.ibr01.pdx31.ntwk.msn.net (104.44.7.101)                      0.0%     9  158.3 158.9 157.5 166.0   2.7\n9.  AS8075   be-5-0.ibr01.mwh01.ntwk.msn.net (104.44.30.65)                     11.1%     9  158.1 158.5 158.1 159.1   0.3\n10. AS8075   ae102-0.icr02.mwh01.ntwk.msn.net (104.44.21.142)                   11.1%     9  160.3 163.0 157.0 168.4   4.2\n11. ???\n</code></pre>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#costs-for-internet-egress","title":"Costs for Internet Egress","text":"<p>\u6839\u64da Azure Bandwidth pricing\uff0crouted via Microsoft Premium Global Network \u6210\u672c\u6703\u5927\u65bc Routed via Routing preference transit ISP network</p>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#asns-for-microsoft","title":"ASNs for Microsoft","text":"<ul> <li> <p>ASN 12076</p> <ul> <li>\u900f\u904e Azure ExpressRoute \u9023\u7dda\u7684 ASN</li> </ul> </li> <li> <p>ASN 8075</p> <ul> <li>\u9810\u8a2d\u72c0\u6cc1\u4e0b\uff0cMicrosoft \u5927\u591a\u6578\u5c0d\u5916\u670d\u52d9\u7684 ASN\uff0c\u4f8b\u5982 Windows Update\u3001Office 365 \u7b49</li> </ul> </li> </ul>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-azure-routing-preferences.html#references","title":"References","text":"<ul> <li>Configure routing preference for a public IP address using the Azure portal</li> <li>Architect and optimize your internet traffic with Azure routing preference</li> <li>20221220 Azure Public IP \u8def\u7531\u504f\u597d\u6559\u6230\u624b\u518a</li> <li>Azure Bandwidth pricing</li> </ul>","tags":["azure","terraform","public ip","howto"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html","title":"How to: \u90e8\u7f72 Azure Red Hat OpenShift","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230204 \u6e2c\u8a66\u7248\u672c: 4.10.50</p>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#azure-red-hat-openshift","title":"\u5982\u4f55\u90e8\u7f72 Azure Red Hat OpenShift","text":"<p>\u56e0\u70ba\u73fe\u884c terraform module \u5c1a\u672a\u5408\u4f75\u5b8c\u6210\uff0c\u4e14 ansible \u91dd\u5c0d aro module \u6709\u9ede\u904e\u671f\uff0c\u6545\u63a1\u7528 <code>ansible + azure cli</code> \u7684\u65b9\u5f0f\u90e8\u7f72</p>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#_1","title":"\u6a19\u6e96\u6d41\u7a0b","text":"","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#requried-sa","title":"(Requried) \u6e96\u5099 sa \u5e33\u865f","text":"<p>\u6e96\u5099 1 \u500b Service Priciple Account</p>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#optional-domain-name","title":"(Optional) \u6e96\u5099 Domain Name","text":"<p>\u5982\u679c\u4f60\u6c92\u6709\u81ea\u5df1\u7684 DNS \u8981\u5957\u4e0a\u4f86\u7684\u8a71\uff0c\u53ef\u4ee5\u8df3\u904e\u6b64\u6b65\u9a5f</p> <p>\u82e5\u4f7f\u7528 Azure Red Hat OpenShift \u60f3\u8981\u7372\u5f97\u5230\u4ee5\u4e0b URL</p> <ul> <li>Web Console: https://console-openshift-console.apps.aro.aliez.tw/</li> <li>OpenShift API Service: api.aro.aliez.tw</li> </ul> <p>\u9700\u81ea\u5099 DNS Domain\uff0c\u4f8b\u5982 <code>aro.aliez.tw</code>\uff0c\u53ef\u4ee5\u653e\u7f6e\u65bc Azure DNS Zone \u6216\u8005\u662f\u5176\u4ed6 DNS \u8a17\u7ba1\u670d\u52d9</p> <p>\u5b89\u88dd\u9014\u4e2d\u9700\u4f7f\u7528\u4e0b\u5217\u6307\u4ee4\u7372\u5f97 OpenShift API Service \u548c Web Console \u6703\u4f7f\u7528\u5230\u7684 ingressProfile</p> command.sh<pre><code>az aro show -n $ARO_NAME -g $RESOURCE_GROUP --query \"'{api:apiserverProfile.ip,ingress:ingressProfiles[0].ip}'\"\n</code></pre> output<pre><code>$ az aro show -n one -g rg-aro-eastus --query '{api:apiserverProfile.ip, ingress:ingressProfiles[0].ip}'\n{\n  \"api\": \"x.x.x.x\",\n  \"ingress\": \"y.y.y.y\"\n}\n</code></pre> <p>\u7576\u62ff\u5230\u9019\u5169\u500b IP \u7684\u6642\u5019\uff0c\u5247\u9700\u8981\u53bb <code>aro.aliez.tw</code> Zone \u88e1\u9762\u586b\u5beb 2 \u500b A Record\uff0c\u8981\u6ce8\u610f Name \u88e1\u9762\u5167\u5bb9\u90fd\u4e0d\u80fd\u4fee\u6539</p> Name Type TTL Value api A Record 3600 x.x.x.x *.apps A Record 3600 y.y.y.y <p>\u9019\u908a\u8981\u6ce8\u610f $ARO_NAME \u4e26\u4e0d\u6703\u5f71\u97ff\u7cfb\u7d71\u64cd\u4f5c\uff0c\u4ed6\u53ea\u662f Azure Resource Manager \u4e0a\u7684\u4e00\u500b\u540d\u7a31\u800c\u5df2</p>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#kubeadmin","title":"\u67e5\u8a62 kubeadmin \u5e33\u865f","text":"command.sh<pre><code>az aro list-credentials \\\n  --name $ARO_NAME \\\n  --resource-group $RESOURCE_GROUP\n</code></pre> output<pre><code>$ az aro list-credentials -n one -g rg-aro-eastus\n{\n  \"kubeadminPassword\": \"xxxx-yyyy-oooo-ffff\",\n  \"kubeadminUsername\": \"kubeadmin\"\n}\n</code></pre>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#web-console-url","title":"\u67e5\u8a62 Web Console URL","text":"command.sh<pre><code>az aro show \\\n    --name $CLUSTER \\\n    --resource-group $RESOURCEGROUP \\\n    --query \"consoleProfile.url\" -o tsv\n</code></pre> output<pre><code>$ az aro show --name one --resource-group rg-aro-eastus --query \"consoleProfile.url\" -o tsv\nhttps://console-openshift-console.apps.aro.aliez.tw/\n</code></pre>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#openshift-api-server-url","title":"\u67e5\u8a62 OpenShift API Server URL","text":"command.sh<pre><code>az aro show \\\n    --name $CLUSTER \\\n    --resource-group $RESOURCEGROUP \\\n    --query \"apiserverProfile.url\" -o tsv\n</code></pre> output<pre><code>$ az aro show --name one --resource-group rg-aro-eastus --query \"apiserverProfile.url\" -o tsv\nhttps://api.aro.aliez.tw:6443/\n</code></pre>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#oc-azure-red-hat-openshift","title":"\u7528 oc \u767b\u5165 Azure Red Hat OpenShift","text":"command.sh<pre><code>oc login https://{OpenShift API Server URL}:6443/ --username kubeadmin\n</code></pre> output<pre><code>$ oc login https://api.aro.aliez.tw:6443/ --username kubeadmin\nThe server uses a certificate signed by an unknown authority.\nYou can bypass the certificate check, but any data you send to the server could be intercepted by others.\nUse insecure connections? (y/n): y\n\nAuthentication required for https://api.aro.aliez.tw:6443 (openshift)\nUsername: kubeadmin\nPassword:\nLogin successful.\n</code></pre>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#tips","title":"Tips","text":"","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-deployment-azure-redhat-openshift.html#load-balancer","title":"Load Balancer","text":"<p>\u9810\u8a2d\u72c0\u6cc1\u4e0b\u6703\u5b89\u88dd 2 \u500b Azure Load Balancer\uff0c\u7686\u70ba SKU: Standard / Tier: Regional</p> <p>\u4e00\u500b\u662f\u5c0d\u5916\uff0c\u4e00\u500b\u662f\u5c0d\u5167</p>","tags":["howto","azure redhat openshift","openshift4"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html","title":"How To: \u5efa\u7acb\u53ca\u9a57\u8b49 ICMP/TCP/UDP \u9023\u7dda","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230202</p>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#how-to-icmptcpudp","title":"How To: \u5efa\u7acb\u53ca\u9a57\u8b49 ICMP/TCP/UDP \u9023\u7dda","text":"","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#icmp","title":"\u95dc\u65bc ICMP","text":"","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#ping","title":"\u4f7f\u7528 ping","text":"command.sh<pre><code>ping -c2 www.microsoft.com\n</code></pre> success_output<pre><code>$ ping -c2 www.microsoft.com\nPING e13678.dscb.akamaiedge.net (23.208.81.153) 56(84) bytes of data.\n64 bytes from a23-208-81-153.deploy.static.akamaitechnologies.com (23.208.81.153): icmp_seq=1 ttl=59 time=12.10 ms\n64 bytes from a23-208-81-153.deploy.static.akamaitechnologies.com (23.208.81.153): icmp_seq=2 ttl=59 time=10.10 ms\n\n--- e13678.dscb.akamaiedge.net ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 10.950/11.974/12.998/1.024 ms\n</code></pre> failed_output<pre><code>$ ping -c2 ww.microsoft.com\nping: ww.microsoft.com: Name or service not known\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#mtr","title":"\u4f7f\u7528 mtr","text":"command.sh<pre><code>mtr www.microsoft.com\n</code></pre> output<pre><code>$ mtr www.microsoft.com\nrhel8 (172.29.13.134)                                                                                                   2023-01-31T14:22:12+0800\nKeys:  Help   Display mode   Restart statistics   Order of fields   quit\n                                                                                                        Packets               Pings\n Host                                                                                                 Loss%   Snt   Last   Avg  Best  Wrst StDev\n 1. _gateway                                                                                           0.0%     5    0.3   0.3   0.2   0.4   0.1\n 2. 192.168.100.254                                                                                    0.0%     5    2.9   2.9   2.6   3.3   0.3\n 3. h254.s98.ts.hinet.net                                                                              0.0%     4   21.5  16.0  12.3  21.5   4.1\n 4. tpdb-3332.hinet.net                                                                                0.0%     4   12.0  12.7  11.9  14.1   1.0\n 5. 210.59.225.230                                                                                     0.0%     4   17.5  27.8  11.4  66.0  25.6\n 6. a23-208-81-153.deploy.static.akamaitechnologies.com                                                0.0%     4   10.7  11.1  10.6  11.7   0.5\n</code></pre> failed_output<pre><code>$ mtr ww.microsoft.com\nmtr: Failed to resolve host: ww.microsoft.com: Name or service not known\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#tcp","title":"\u95dc\u65bc TCP","text":"<p>\u6383 <code>80/TCP, 443/TCP</code></p>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#nmap","title":"\u4f7f\u7528 Nmap","text":"command.sh<pre><code>nmap -sT -p 80,443 www.microsoft.com\n</code></pre> success_output<pre><code>$ nmap -sT -p 80,443 www.microsoft.com\nStarting Nmap 7.70 ( https://nmap.org ) at 2023-01-31 14:25 CST\nNmap scan report for www.microsoft.com (23.208.81.153)\nHost is up (0.014s latency).\nOther addresses for www.microsoft.com (not scanned): 2001:b034:1c:388::356e 2001:b034:1c:384::356e 2001:b034:1c:381::356e 2001:b034:1c:385::356e 2001:b034:1c:383::356e\nrDNS record for 23.208.81.153: a23-208-81-153.deploy.static.akamaitechnologies.com\n\nPORT    STATE SERVICE\n80/tcp  open  http\n443/tcp open  https\n\nNmap done: 1 IP address (1 host up) scanned in 0.09 seconds\n</code></pre> failed_output<pre><code>$ nmap -sT -p 22 www.microsoft.com\nStarting Nmap 7.70 ( https://nmap.org ) at 2023-01-31 14:31 CST\nNmap scan report for www.microsoft.com (23.208.81.153)\nHost is up (0.011s latency).\nOther addresses for www.microsoft.com (not scanned): 2001:b034:1c:389::356e 2001:b034:1c:388::356e 2001:b034:1c:387::356e 2001:b034:1c:382::356e\nrDNS record for 23.208.81.153: a23-208-81-153.deploy.static.akamaitechnologies.com\n\nPORT   STATE    SERVICE\n22/tcp filtered ssh\n\nNmap done: 1 IP address (1 host up) scanned in 0.27 seconds\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#netcat","title":"\u4f7f\u7528 Netcat","text":"command.sh<pre><code># z: zero-I/O mode which is used for scanning\n# v: for verbose output\n# w3: timeout wait 10 seconds\n\nnc -zvw3 www.microsoft.com 80\nnc -zvw3 www.microsoft.com 443\n</code></pre> success_output<pre><code>$ nc -zvw3 www.microsoft.com 80\nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Connected to 23.208.81.153:80.\nNcat: 0 bytes sent, 0 bytes received in 0.04 seconds.\n\n$ nc -zvw3 www.microsoft.com 443\nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Connected to 23.208.81.153:443.\nNcat: 0 bytes sent, 0 bytes received in 0.04 seconds.\n</code></pre> failed_output<pre><code>$ nc -zvw3 www.microsoft.com 22\nNcat: Version 7.70 ( https://nmap.org/ncat )\nNcat: Connection to 23.208.81.153 failed: Connection timed out.\nNcat: Trying next address...\nNcat: Connection to 2001:b034:1c:383::356e failed: Network is unreachable.\nNcat: Trying next address...\nNcat: Connection to 2001:b034:1c:382::356e failed: Network is unreachable.\nNcat: Trying next address...\nNcat: Connection to 2001:b034:1c:38a::356e failed: Network is unreachable.\nNcat: Trying next address...\nNcat: Connection to 2001:b034:1c:381::356e failed: Network is unreachable.\nNcat: Trying next address...\nNcat: Network is unreachable.\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#curl","title":"\u4f7f\u7528 curl","text":"command.sh<pre><code>curl www.cs.nycu.edu.tw:80 --connect-timeout 3\ncurl www.cs.nycu.edu.tw:443 --connect-timeout 3\n</code></pre> success_output<pre><code>$ curl www.cs.nycu.edu.tw:80 --connect-timeout 3\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;\n&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n$ curl www.cs.nycu.edu.tw:443 --connect-timeout 3\n&lt;html&gt;\n&lt;head&gt;&lt;title&gt;400 The plain HTTP request was sent to HTTPS port&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;\n&lt;center&gt;The plain HTTP request was sent to HTTPS port&lt;/center&gt;\n&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> failed_output<pre><code>$ curl www.cs.nycu.edu.tw:81 --connect-timeout 3\ncurl: (7) Failed to connect to www.cs.nycu.edu.tw port 81: No route to host\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#telnet","title":"\u4f7f\u7528 Telnet","text":"<p>TBD</p>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#udp","title":"\u95dc\u65bc UDP","text":"<p>\u6383 <code>53/UDP</code></p>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-establish-and-test-port-scanning.html#nmap_1","title":"\u4f7f\u7528 Nmap","text":"command.sh<pre><code>sudo nmap -sU -p 53 168.95.1.1\nsudo nmap -sU -p 53 168.63.129.16 # (1)\n</code></pre> <ol> <li>Azure-provided DNS servic</li> </ol> success_output<pre><code>$ sudo nmap -sU -p 53 168.95.1.1\nStarting Nmap 7.70 ( https://nmap.org ) at 2023-01-31 15:11 CST\nNmap scan report for dns.hinet.net (168.95.1.1)\nHost is up (0.016s latency).\n\nPORT   STATE SERVICE\n53/udp open  domain\n\nNmap done: 1 IP address (1 host up) scanned in 0.78 seconds\n</code></pre> failed_output<pre><code>$ sudo nmap -sU -p 80 168.95.1.1\nStarting Nmap 7.70 ( https://nmap.org ) at 2023-01-31 15:11 CST\nNmap scan report for dns.hinet.net (168.95.1.1)\nHost is up (0.014s latency).\n\nPORT   STATE         SERVICE\n80/udp open|filtered http\n\nNmap done: 1 IP address (1 host up) scanned in 0.81 seconds\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html","title":"How to: \u627e\u5230 Azure Publisher / Offer / SKU \u4e4b\u6b63\u78ba\u540d\u7a31","text":"","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#_1","title":"\u7c21\u6613\u904e\u7a0b","text":"<ul> <li>\u4f9d\u5e8f\u627e Publisher &gt; Offer &gt; SKU &gt; Version</li> <li>\u91dd\u5c0d\u7279\u5b9a Version \u63a5\u53d7 Terms</li> <li>urn \u683c\u5f0f\u70ba <code>publisher:offer:sku:version</code></li> </ul>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#azure-cli","title":"\u4f7f\u7528 Azure CLI \u6307\u4ee4","text":"command<pre><code># \u627e\u5168\u90e8\u7684\u5167\u5bb9 (\u6703\u8dd1\u5f88\u4e45)\naz vm image list --location southeastasia --output table --all\n\n# \u5217\u8209 Publishers\naz vm image list-publishers --location southeastasia --output table\n\n# \u5217\u8209\u7279\u5b9a Publisher \u6240\u6709\u7684 Offers\naz vm image list-offers --location southeastasia --publisher Canonical --output table\n\n# \u5217\u8209\u7279\u5b9a Publisher \u7279\u5b9a Offer \u6240\u6709\u7684 SKUs\naz vm image list-skus --location southeastasia --publisher Canonical --offer UbuntuServer --output table\n\n# \u5217\u8209\u7279\u5b9a Publisher \u7279\u5b9a Offer \u7279\u5b9a\u7684 SKU \u6240\u6709\u7684 Version\naz vm image list --location southeastasia --publisher Canonical --offer UbuntuServer --sku 18.04-LTS --all --output table\n\n# \u5217\u51fa\u7279\u5b9a Image \u7684\u8cc7\u8a0a\naz vm image show --location westus --urn Canonical:UbuntuServer:18.04-LTS:latest\naz vm image show --location westus --urn bitnami:rabbitmq:rabbitmq:latest\n\n# \u540c\u610f\u689d\u6b3e\naz vm image terms accept --urn bitnami:rabbitmq:rabbitmq:latest\n</code></pre>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#exmample","title":"Exmample","text":"","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#f5-bigip-virtual-edition-25m-better-hourly-po-f5","title":"\u5c0b\u627e f5-bigip-virtual-edition-25m-better-hourly-po-f5 \u65c5\u7a0b","text":"output_f5<pre><code># \u65bc eastus \u5217\u8209 Publishers - f5-networks\n$ az vm image list-publishers --location eastus --output tsv | grep f5-networks\nNone    /Subscriptions/xxxx/Providers/Microsoft.Compute/Locations/eastus/Publishers/f5-networks    eastus  f5-networks     None\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: f5-networks \u6240\u6709\u7684 Offers\n$ az vm image list-offers --location eastus --publisher f5-networks --output table\nLocation    Name\n----------  ---------------------------------------------\neastus      f5-big-ip-advanced-waf\neastus      f5-big-ip-best\neastus      f5-big-ip-better\neastus      f5-big-ip-byol\neastus      f5-big-ip-cloud-edition\neastus      f5-big-ip-good\neastus      f5-big-ip-per-app-ve\neastus      f5-big-iq\neastus      f5-distributed-cloud-bot-defense-service-node\neastus      f5-web-application-firewall\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: f5-networks \u7279\u5b9a Offer: f5-big-ip-better \u6240\u6709\u7684 SKUs\n$ az vm image list-skus --location eastus --publisher f5-networks --offer f5-big-ip-better --output table\nLocation    Name\n----------  -------------------------------------------------\neastus      f5-bigip-virtual-edition-10g-better-hourly\neastus      f5-bigip-virtual-edition-10g-better-hourly-po-0\neastus      f5-bigip-virtual-edition-10g-better-hourly-po-f5\neastus      f5-bigip-virtual-edition-1g-better-hourly\neastus      f5-bigip-virtual-edition-1g-better-hourly-po-0\neastus      f5-bigip-virtual-edition-1g-better-hourly-po-f5\neastus      f5-bigip-virtual-edition-200m-better-hourly\neastus      f5-bigip-virtual-edition-200m-better-hourly-po-0\neastus      f5-bigip-virtual-edition-200m-better-hourly-po-f5\neastus      f5-bigip-virtual-edition-25m-better-hourly\neastus      f5-bigip-virtual-edition-25m-better-hourly-po-0\neastus      f5-bigip-virtual-edition-25m-better-hourly-po-f5\neastus      f5-bigip-virtual-edition-5g-better-hourly\neastus      f5-bigip-virtual-edition-5g-better-hourly-po-0\neastus      f5-bigip-virtual-edition-5g-better-hourly-po-f5\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: f5-networks \u7279\u5b9a Offer: f5-big-ip-better \u7279\u5b9a\u7684 SKU: f5-bigip-virtual-edition-25m-better-hourly \u4e4b\u6240\u6709 Version\n$ az vm image list --location eastus --publisher f5-networks --offer f5-big-ip-better --sku f5-bigip-virtual-edition-25m-better-hourly --all --output tsv --query '[].[version, urn]'\n...omit...\n16.1.303000     f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000\n\n# \u65bc eastus \u91dd\u5c0d f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000 \u7684\u8a73\u7d30\u8cc7\u8a0a\n$ az vm image show --location westus --urn f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000\n...omit...\n  \"location\": \"westus\",\n  \"name\": \"16.1.303000\",\n  \"osDiskImage\": {\n    \"operatingSystem\": \"Linux\",\n    \"sizeInGb\": 84\n  },\n  \"plan\": {\n    \"name\": \"f5-bigip-virtual-edition-25m-better-hourly-po-f5\",\n    \"product\": \"f5-big-ip-better\",\n    \"publisher\": \"f5-networks\"\n  },\n  \"tags\": null\n}\n\n# \u65bc eastus \u91dd\u5c0d f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000 \u986f\u793a terms\n$ az vm image terms show --urn f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000\n{\n  \"accepted\": false,\n  \"id\": \"/subscriptions/xxx-xxx-xxx-xxx/providers/Microsoft.MarketplaceOrdering/offerTypes/VirtualMachine/publishers/f5-networks/offers/f5-big-ip-better/plans/f5-bigip-virtual-edition-25m-better-hourly-po-f5/agreements/current\",\n  \"licenseTextLink\": \"https://mpcprodsa.blob.core.windows.net/legalterms/3E5ED_legalterms_F5%253a2DNETWORKS%253a24F5%253a2DBIG%253a2DIP%253a2DBETTER%253a24F5%253a2DBIGIP%253a2DVIRTUAL%253a2DEDITION%253a2D25M%253a2DBETTER%253a2DHOURLY%253a2DPO%253a2DF5%253a2463C3BUMZYGUOLK2SDGIYAGMKS77MROGH7QWV7EKNJ6LVIF4OVWCKPZ75H2Y6ZMAHU6TO3RX6Z7WNE5HATUMEJ5SZRWMV2FPX3JKBGDI.txt\",\n  \"marketplaceTermsLink\": \"https://mpcprodsa.blob.core.windows.net/marketplaceterms/3EDEF_marketplaceterms_VIRTUALMACHINE%253a24AAK2OAIZEAWW5H4MSP5KSTVB6NDKKRTUBAU23BRFTWN4YC2MQLJUB5ZEYUOUJBVF3YK34CIVPZL2HWYASPGDUY5O2FWEGRBYOXWZE5Y.txt\",\n  \"name\": \"f5-bigip-virtual-edition-25m-better-hourly-po-f5\",\n  \"plan\": \"f5-bigip-virtual-edition-25m-better-hourly-po-f5\",\n  \"privacyPolicyLink\": \"https://www.f5.com/company/policies/privacy-policy\",\n  \"product\": \"f5-big-ip-better\",\n  \"publisher\": \"f5-networks\",\n  \"retrieveDatetime\": \"2023-02-04T17:28:39.2281171Z\",\n  \"signature\": \"EDOLYKRW5JATE332QVMIVK77B6CFV7MTQ6TWVWNWTSFVCCMYAQAWOHI3LTUQY4HZAFHXNOG4KT45UMUSRNNULDMAJRPXAPCMTZI2LGQ\",\n  \"systemData\": {\n    \"createdAt\": \"2023-02-04T17:28:39.353095+00:00\",\n    \"createdBy\": \"xxx-xxx-xxx-xxx\",\n    \"createdByType\": \"ManagedIdentity\",\n    \"lastModifiedAt\": \"2023-02-04T17:28:39.353095+00:00\",\n    \"lastModifiedBy\": \"xxx-xxx-xxx-xxx\",\n    \"lastModifiedByType\": \"ManagedIdentity\"\n  },\n  \"type\": \"Microsoft.MarketplaceOrdering/offertypes\"\n}\n\n# \u65bc eastus \u91dd\u5c0d f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000 \u63a5\u53d7 Terms\n$ az vm image terms accept --urn f5-networks:f5-big-ip-better:f5-bigip-virtual-edition-25m-better-hourly-po-f5:16.1.303000\n{\n  \"accepted\": true,\n...omit...\n</code></pre>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#rhel-payg","title":"\u5c0b\u627e RHEL (PAYG) \u65c5\u7a0b","text":"output_rhel<pre><code># \u65bc eastus \u5217\u8209 Publishers - redhat\n$ az vm image list-publishers --location eastus --output tsv --query '[].[name]' | grep redhat -i\nRedHat &lt;- \u9019\u500b\u624d\u662f\u5c0d\u7684\nredhat-limited\nredhat-rhel\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: redhat \u6240\u6709\u7684 Offers\n$ az vm image list-offers --location eastus --publisher redhat --output table\nLocation    Name\n----------  ------------------------\neastus      alfredtestoffer\neastus      osa\neastus      rh-ocp-worker\neastus      rh-oke-worker\neastus      rh-opp-worker\neastus      rh-rhel\neastus      RHEL\neastus      rhel-arm64\neastus      rhel-byos\neastus      rhel-byos-test\neastus      rhel-cpp-test\neastus      RHEL-HA\neastus      rhel-raw\neastus      RHEL-SAP\neastus      RHEL-SAP-APPS\neastus      RHEL-SAP-HA\neastus      rhel-sig-publishing-test\neastus      RHEL-TEST\neastus      rhel_test_offers\neastus      rh_rhel_7_latest\neastus      rh_rhel_7_vm\neastus      rh_rhel_8_latest\neastus      rh_rhel_8_main_1\neastus      rh_rhel_8_vm\neastus      test_offer_china\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: redhat \u7279\u5b9a Offer: rhel \u6240\u6709\u7684 SKUs\n$ az vm image list-skus --location eastus --publisher redhat --offer rhel --output table\nLocation    Name\n----------  ----------\neastus      6.10\neastus      7-LVM\neastus      7-RAW\neastus      7-RAW-CI\neastus      7.2\neastus      7.3\neastus      7.3-DAILY\neastus      7.4\neastus      7.5\neastus      7.6\neastus      7.7\neastus      7.8\neastus      74-gen2\neastus      75-gen2\neastus      76-gen2\neastus      77-gen2\neastus      78-gen2\neastus      79-gen2\neastus      7lvm-gen2\neastus      7_9\neastus      8\neastus      8-BETA\neastus      8-gen2\neastus      8-LVM\neastus      8-lvm-gen2\neastus      8.1\neastus      8.1-ci\neastus      8.2\neastus      81-ci-gen2\neastus      81gen2\neastus      82gen2\neastus      83-gen2\neastus      84-gen2\neastus      85-gen2\neastus      86-gen2\neastus      87-gen2\neastus      8_3\neastus      8_4\neastus      8_5\neastus      8_6\neastus      8_7\neastus      9-lvm\neastus      9-lvm-gen2\neastus      90-gen2\neastus      91-gen2\neastus      9_0\neastus      9_1\n\n# \u65bc eastus \u5217\u8209\u7279\u5b9a Publisher: redhat \u7279\u5b9a Offer: rhel \u7279\u5b9a\u7684 SKU: 8_6 \u4e4b\u6240\u6709 Version\n$ az vm image list --location eastus --publisher redhat --offer rhel --sku 8_6 --all --output tsv --query '[].[version, urn]'\n8.6.2022052401  RedHat:RHEL:8_6:8.6.2022052401\n8.6.2022070801  RedHat:RHEL:8_6:8.6.2022070801\n8.6.2022103101  RedHat:RHEL:8_6:8.6.2022103101\n8.6.2023010501  RedHat:RHEL:8_6:8.6.2023010501\n8.6.2022060901  RedHat:rhel-arm64:8_6-arm64:8.6.2022060901\n8.6.2022052401  RedHat:rhel-raw:8_6:8.6.2022052401\n8.6.2022052401  RedHat:RHEL-SAP-APPS:8_6:8.6.2022052401\n8.6.2022081801  RedHat:RHEL-SAP-APPS:8_6:8.6.2022081801\n8.6.2022052401  RedHat:RHEL-SAP-HA:8_6:8.6.2022052401\n8.6.2022081801  RedHat:RHEL-SAP-HA:8_6:8.6.2022081801\n8.6.2022111601  RedHat:RHEL-SAP-HA:8_6:8.6.2022111601\n8.6.202301301   RedHat:RHEL-SAP-HA:8_6:8.6.202301301\n\n# \u65bc eastus \u91dd\u5c0d RedHat:RHEL:8_6:8.6.2023010501 \u986f\u793a terms\n$ az vm image terms show --urn RedHat:RHEL:8_6:8.6.2023010501\nImage 'RedHat:RHEL:8_6:8.6.2023010501' has no terms to accept.\n</code></pre>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#vmware-sd-wan","title":"\u5c0b\u627e\u4e26\u63a5\u53d7 VMware SD-WAN \u65c5\u7a0b","text":"output_vmware<pre><code>$ az vm image list-publishers --location eastus --output tsv --query '[].[name]' | grep vmware-inc -i\nvmware-inc\n\n$ az vm image list-offers --location eastus --publisher vmware-inc --output table\nLocation    Name\n----------  -------------------------------\neastus      euc-hcs-edgegw\neastus      euc-hcs-jumpbox\neastus      euc-hcs-jumpbox-sig-test\neastus      euc-hcs-podmgr\neastus      euc-hcs-sn-sig-test\neastus      euc-hcs-uag\neastus      euc-hcs-uag-sig-test\neastus      nsx-cloud-service-manager\neastus      nsx-cloud-service-manager-test\neastus      nsx-csm-trial\neastus      nsx-mgr-trial\neastus      nsx-pcg-trial\neastus      nsx-policy-manager\neastus      nsx-policy-manager-test\neastus      nsx-public-cloud-gateway\neastus      nsx-public-cloud-gateway-test\neastus      sol-42222-bbj\neastus      tkg-capi\neastus      tkg-capi-2022-06-24\neastus      vmware_blockchain_node\neastus      vmware_blockchain_orchestrator\neastus      vrealize-operations-cloud-proxy\n\n$ az vm image list-skus --location eastus --publisher vmware-inc --offer sol-42222-bbj --output table\nLocation    Name\n----------  ---------------\neastus      vmware_sdwan_4x\n\n$ az vm image list --location eastus --publisher vmware-inc --offer sol-42222-bbj --sku vmware_sdwan_4x --all --output tsv --query '[].[version, urn]'\n4.2.1   vmware-inc:sol-42222-bbj:vmware_sdwan_4x:4.2.1\n\n$ az vm image terms show --urn vmware-inc:sol-42222-bbj:vmware_sdwan_4x:4.2.1\n{\n  \"accepted\": false,\n\n$ az vm image terms accept --urn vmware-inc:sol-42222-bbj:vmware_sdwan_4x:4.2.1\n{\n  \"accepted\": true,\n</code></pre>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-azure-marketplace-image-information.html#reference","title":"Reference","text":"<ul> <li>Find Azure Marketplace image information using the Azure CLI</li> </ul>","tags":["howto","azure marketplace"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html","title":"How to: \u5728\u5bb9\u5668\u6620\u50cf\u6a94\u627e\u5230\u5df2\u5b89\u88dd\u7684\u5957\u4ef6\u6e05\u55ae","text":"","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#steps","title":"Steps","text":"<p>\u4ee5 <code>mcr.microsoft.com/azure-functions/dotnet:4.22.0</code> \u70ba\u4f8b</p>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#0-run-container-images","title":"0. Run Container Images","text":"<pre><code>$ docker run -it --rm --name debug mcr.microsoft.com/azure-functions/dotnet:4.22.0 bash\nroot@b6c53359372d:/#\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#1-check-base-images-from-cli","title":"1. Check Base Images from CLI","text":"<p>You should use <code>cat /etc/os-realese</code> to check the base images instead of <code>uname -a</code></p> <ul> <li>Correct</li> </ul> <pre><code>root@b6c53359372d:/# cat /etc/os-release\nPRETTY_NAME=\"Debian GNU/Linux 11 (bullseye)\"\nNAME=\"Debian GNU/Linux\"\nVERSION_ID=\"11\"\nVERSION=\"11 (bullseye)\"\nVERSION_CODENAME=bullseye\nID=debian\nHOME_URL=\"https://www.debian.org/\"\nSUPPORT_URL=\"https://www.debian.org/support\"\nBUG_REPORT_URL=\"https://bugs.debian.org/\"\n</code></pre> <ul> <li>Incorrect: The kernel version is shown from the host machine, not container images</li> </ul> <pre><code>root@b6c53359372d:/# uname -a\nLinux b6c53359372d 5.15.90.1-microsoft-standard-WSL2 #1 SMP Fri Jan 27 02:56:13 UTC 2023 x86_64 GNU/Linux\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#2-check-installed-packages","title":"2. Check Installed Packages","text":"<pre><code>root@b6c53359372d:/# apt list --installed\nListing... Done\nadduser/oldstable,now 3.118 all [installed,automatic]\napt/oldstable,now 2.2.4 amd64 [installed,automatic]\nbase-files/oldstable,now 11.1+deb11u7 amd64 [installed,automatic]\nbase-passwd/oldstable,now 3.5.51 amd64 [installed,automatic]\nbash/oldstable,now 5.1-2+deb11u1 amd64 [installed,automatic]\nbsdutils/oldstable,oldstable-security,now 1:2.36.1-8+deb11u1 amd64 [installed,automatic]\nca-certificates/oldstable,now 20210119 all [installed]\ncoreutils/oldstable,now 8.32-4+b1 amd64 [installed,automatic]\ndash/oldstable,now 0.5.11+git20200708+dd9ef66-5 amd64 [installed,automatic]\ndebconf/oldstable,now 1.5.77 all [installed,automatic]\ndebian-archive-keyring/oldstable,now 2021.1.1+deb11u1 all [installed,automatic]\n...omit...\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#3-list-package-dependencies-with-apt-depends","title":"3. List Package Dependencies with apt depends","text":"<pre><code>root@b6c53359372d:/# apt depends bash\nbash\n  PreDepends: libc6 (&gt;= 2.25)\n  PreDepends: libtinfo6 (&gt;= 6)\n  Depends: base-files (&gt;= 2.1.12)\n  Depends: debianutils (&gt;= 2.15)\n  Conflicts: bash-completion (&lt;&lt; 20060301-0)\n  Recommends: bash-completion (&gt;= 20060301-0)\n  Suggests: bash-doc\n  Replaces: bash-completion (&lt;&lt; 20060301-0)\n  Replaces: bash-doc (&lt;= 2.05-1)\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#4-list-package-information-with-apt-show","title":"4. List Package Information with apt show","text":"<pre><code>root@b6c53359372d:/# apt show linux-libc-dev\nPackage: linux-libc-dev\nVersion: 5.10.179-1\nPriority: optional\nSection: devel\nSource: linux\nMaintainer: Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;\nInstalled-Size: 6025 kB\nHomepage: https://www.kernel.org/\nDownload-Size: 1618 kB\nAPT-Manual-Installed: no\nAPT-Sources: http://deb.debian.org/debian-security bullseye-security/main amd64 Packages\nDescription: Linux support headers for userspace development\n\nroot@b6c53359372d:/#\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-find-the-installed-packages-within-container-images.html#5-known-which-package-can-be-upgrade","title":"5. Known which package can be upgrade","text":"<pre><code>root@b6c53359372d:/# apt update\nHit:1 http://deb.debian.org/debian bullseye InRelease\nGet:2 http://deb.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [246 kB]\nFetched 339 kB in 1s (431 kB/s)\nReading package lists... Done\nBuilding dependency tree... Done\nReading state information... Done\n2 packages can be upgraded. Run 'apt list --upgradable' to see them.\nroot@b6c53359372d:/# apt list --upgradeable\nListing... Done\nlibx11-6/oldstable-security 2:1.7.2-1+deb11u1 amd64 [upgradable from: 2:1.7.2-1]\nlibx11-data/oldstable-security 2:1.7.2-1+deb11u1 all [upgradable from: 2:1.7.2-1]\nroot@b6c53359372d:/#\n</code></pre>","tags":["howto","container"]},{"location":"wiki/howto/howto-personal-wsl2.html","title":"How To: \u8a2d\u5b9a WSL2","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230216</p>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#how-to-wsl2","title":"How To: \u8a2d\u5b9a WSL2","text":"","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#environment","title":"Environment","text":"wsl --version<pre><code>wsl --version\nWSL \u7248\u672c\uff1a 1.0.3.0\n\u6838\u5fc3\u7248\u672c\uff1a 5.15.79.1\nWSLg \u7248\u672c\uff1a 1.0.47\nMSRDC \u7248\u672c\uff1a 1.2.3575\nDirect3D \u7248\u672c\uff1a 1.606.4\nDXCore \u7248\u672c\uff1a 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp\nWindows\u7248\u672c\uff1a 10.0.22621.1265\n</code></pre> /etc/os-release<pre><code>NAME=\"Red Hat Enterprise Linux\"\nVERSION=\"8.7 (Ootpa)\"\nID=\"rhel\"\nID_LIKE=\"fedora\"\nVERSION_ID=\"8.7\"\nPLATFORM_ID=\"platform:el8\"\nPRETTY_NAME=\"Red Hat Enterprise Linux 8.7 (Ootpa)\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:redhat:enterprise_linux:8::baseos\"\nHOME_URL=\"https://www.redhat.com/\"\nDOCUMENTATION_URL=\"https://access.redhat.com/documentation/red_hat_enterprise_linux/8/\"\nBUG_REPORT_URL=\"https://bugzilla.redhat.com/\"\n\nREDHAT_BUGZILLA_PRODUCT=\"Red Hat Enterprise Linux 8\"\nREDHAT_BUGZILLA_PRODUCT_VERSION=8.7\nREDHAT_SUPPORT_PRODUCT=\"Red Hat Enterprise Linux\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"8.7\"\n</code></pre>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#configurations","title":"Configurations","text":"/etc/wsl.conf<pre><code>## This is the file content\n## Replace the username\n## Source for the options: https://docs.microsoft.com/en-us/windows/wsl/wsl-config#configure-per-distro-launch-settings-with-wslconf\n[automount]\nenabled = true\nmountfstab = true\nroot = /mnt/\noptions = metadata,uid=1000,gid=1000,umask=0022,fmask=11,case=off\n\n[network]\ngeneratehosts = true\ngenerateResolvConf = false\nhostname = rhel8\n\n[interop]\nenabled = true\nappendwindowspath = true\n\n[boot]\nsystemd = true\ncommand = \"cp -rup /etc/resolv.conf.dist /etc/resolv.conf\"\n\n[user]\n# Need to change if you have a different username\ndefault = pinhuang\n</code></pre> /etc/resolv.conf.dist<pre><code>nameserver 168.95.1.1\nnameserver 8.8.8.8\n</code></pre>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#troublshooting","title":"Troublshooting","text":"","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#1-wsl2-dns-resolver","title":"1. WSL2 DNS Resolver","text":"<p>\u95dc\u65bc <code>generateResolvConf = false</code> \u8a2d\u5b9a\uff0c\u56e0\u70ba\u7d93\u5e38\u63db\u5730\u65b9\u5de5\u4f5c\u592a\u5e38\u9047\u5230 WSL2 \u7684 DNS Resolver \u4e0d\u660e\u554f\u984c\uff0c\u6240\u4ee5\u5f8c\u4f86\u6c7a\u5b9a\u628a\u5b83\u95dc\u6389\uff0c\u6539\u7528 <code>cp -rup /etc/resolv.conf.dist /etc/resolv.conf</code> \u7684\u65b9\u5f0f\u4f86\u78ba\u4fdd DNS \u89e3\u6790\u904b\u4f5c\u6b63\u5e38\uff0c\u7121\u4efb\u4f55\u526f\u4f5c\u7528</p>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#2-wsl2-clock-is-out-of-sync-with-windows","title":"2. WSL2 Clock is out of sync with Windows","text":"<p>\u95dc\u65bc Clock out of sync \u7684\u554f\u984c\uff0c\u9019\u662f\u4e00\u500b Bug: WSL2 date incorrect after waking from sleep #5324\uff0c\u66ab\u89e3\u65b9\u5f0f\u5c31\u662f\u5728 WSL2 \u4e2d\u57f7\u884c <code>sudo hwclock -s</code>\uff0c\u6216\u8005\u662f <code>wsl --shutdown; wsl</code> \u91cd\u958b WSL2 Instance</p> <p>\u8a72\u554f\u984c\u4e3b\u56e0\u662f Linux Kernel Bug\uff0c\u96d6\u7136 Servicing the Windows Subsystem for Linux (WSL) 2 Linux kernel \u865f\u7a31\u6709\u89e3\u6c7a\uff0c\u4f46\u6211\u76ee\u524d\u9084\u662f\u6709\u4e00\u6a23\u7684\u554f\u984c\uff0c\u4f46\u7121\u592a\u5927\u5f71\u97ff\u5c31\u5148\u7528\u66ab\u89e3\u4f5c\u6cd5\u8655\u7406</p> command<pre><code>10:58:36 pinhuang@rhel8 0 /mnt/c/Users/pinhuang/rhwsl-home\n$ sudo hwclock -s\n04:08:48 pinhuang@rhel8 0 /mnt/c/Users/pinhuang/rhwsl-home\n$\n</code></pre>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#3-systemd","title":"3. \u78ba\u8a8d systemd \u555f\u7528\u6210\u529f","text":"command<pre><code>ps --no-headers -o comm 1\nsystemctl list-units --type=service\nsystemctl list-unit-files --type=service --state=enabled\n</code></pre> output<pre><code>$ ps --no-headers -o comm 1\nctl list-units --type=service\nsystemctl list-unit-files --type=service --state=enabledsystemd\n\n$ systemctl list-units --type=service\nUNIT                           LOAD   ACTIVE SUB     DESCRIPTION\nchronyd.service                loaded active running NTP client/server\ndbus.service                   loaded active running D-Bus System Message Bus\nsystemd-journal-flush.service  loaded active exited  Flush Journal to Persistent Storage\nsystemd-journald.service       loaded active running Journal Service\nsystemd-sysctl.service         loaded active exited  Apply Kernel Variables\nsystemd-tmpfiles-setup.service loaded active exited  Create Volatile Files and Directories\nsystemd-update-utmp.service    loaded active exited  Update UTMP about System Boot/Shutdown\nsystemd-user-sessions.service  loaded active exited  Permit User Sessions\n\nLOAD   = Reflects whether the unit definition was properly loaded.\nACTIVE = The high-level unit activation state, i.e. generalization of SUB.\nSUB    = The low-level unit activation state, values depend on unit type.\n\n8 loaded units listed. Pass --all to see loaded but inactive units, too.\nTo show all installed unit files use 'systemctl list-unit-files'.\n\n$ systemctl list-unit-files --type=service --state=enabled\nUNIT FILE                              STATE\nautovt@.service                        enabled\nchronyd.service                        enabled\ndbus-org.freedesktop.timedate1.service enabled\ngetty@.service                         enabled\ntimedatex.service                      enabled\n\n5 unit files listed.\n</code></pre>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-personal-wsl2.html#references","title":"References","text":"<ul> <li>WSL \u4e2d\u7684\u9032\u968e\u8a2d\u5b9a\u7d44\u614b</li> </ul>","tags":["linux","wsl2"]},{"location":"wiki/howto/howto-public-ip-address-verification.html","title":"How To: \u67e5\u8a62\u53ca\u9a57\u8b49\u81ea\u8eab Public IP","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230131</p>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-public-ip-address-verification.html#how-to-public-ip","title":"How To: \u67e5\u8a62\u53ca\u9a57\u8b49\u81ea\u8eab Public IP","text":"","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-public-ip-address-verification.html#dig","title":"\u4f7f\u7528 dig","text":"<p>\u9069\u7528\u65bc\u5c0d\u5916\u9632\u706b\u7246\u50c5\u80fd\u7528 DNS\uff0c\u7121\u6cd5\u7528 HTTP \u7684\u60c5\u6cc1</p> command.sh<pre><code>dig myip.opendns.com @resolver1.opendns.com\n</code></pre> output<pre><code>$ dig myip.opendns.com @resolver1.opendns.com\n\n; &lt;&lt;&gt;&gt; DiG 9.11.36-RedHat-9.11.36-5.el8_7.2 &lt;&lt;&gt;&gt; myip.opendns.com @resolver1.opendns.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 4503\n;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 4096\n;; QUESTION SECTION:\n;myip.opendns.com.              IN      A\n\n;; ANSWER SECTION:\nmyip.opendns.com.       0       IN      A       x.y.z.o\n\n;; Query time: 51 msec\n;; SERVER: 208.67.222.222#53(208.67.222.222)\n;; WHEN: Tue Jan 31 12:18:03 CST 2023\n;; MSG SIZE  rcvd: 61\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-public-ip-address-verification.html#nslookup","title":"\u4f7f\u7528 nslookup","text":"<p>\u9069\u7528\u65bc\u5c0d\u5916\u9632\u706b\u7246\u50c5\u80fd\u7528 DNS\uff0c\u7121\u6cd5\u7528 HTTP \u7684\u60c5\u6cc1</p> command.sh<pre><code>nslookup myip.opendns.com resolver1.opendns.com\n</code></pre> output<pre><code>\u4f3a\u670d\u5668:  dns.opendns.com\nAddress:  208.67.222.222\n\n\u672a\u7d93\u6388\u6b0a\u7684\u56de\u7b54:\n\u540d\u7a31:    myip.opendns.com\nAddress:  x.y.z.o\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-public-ip-address-verification.html#curl","title":"\u4f7f\u7528 curl","text":"<p>\u9069\u7528\u5c0d\u5916\u9632\u706b\u7246\u80fd\u7528 HTTP \u7684\u60c5\u6cc1</p> command.sh<pre><code>curl ipinfo.io/ip\n# or\n# curl ifconfig.me\n</code></pre> output<pre><code>x.y.z.o\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-public-ip-address-verification.html#wget","title":"\u4f7f\u7528 wget","text":"command.sh<pre><code>wget -q -O- http://ipecho.net/plain\n</code></pre> output<pre><code>x.y.z.o\n</code></pre>","tags":["azure","public ip","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html","title":"How To: \u8a2d\u5b9a Resolve \u65bc Azure Kubernetes Service","text":"<p>For DNS resolving, you have 2 options:</p> <ol> <li>Pod Level: If you want to resolve the DNS name within a <code>pod</code>.</li> <li>Cluster Level: If you want to resolve the DNS name within the <code>cluster</code>.</li> </ol>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#environment","title":"Environment","text":"<pre><code>$ kubectl version --short\nClient Version: v1.26.3\nKustomize Version: v4.5.7\nServer Version: v1.26.3\n\n$ kubectl cluster-info\nKubernetes control plane is running at https://poc-aks-pwppeq38.hcp.eastus.azmk8s.io:443\nCoreDNS is running at https://poc-aks-pwppeq38.hcp.eastus.azmk8s.io:443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\nMetrics-server is running at https://poc-aks-pwppeq38.hcp.eastus.azmk8s.io:443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy\n\n$ kubectl get nodes\nNAME                                STATUS   ROLES   AGE   VERSION\naks-nodepool1-36776276-vmss000001   Ready    agent   66m   v1.26.3\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#pod-level","title":"Pod Level","text":"","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#1-use-kubernetes-hostaliases","title":"1. Use Kubernetes <code>hostAliases</code>","text":"","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#before","title":"Before","text":"without-hostaliases-pod.yml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  namespace: default\n  name: without-hostaliases-pod\nspec:\n  restartPolicy: Never\n  containers:\n  - name: cat-hosts\n    image: quay.io/tw_pichuang/debug-container:master\n    command:\n    - \"/bin/bash\"\n    - \"-c\"\n    - \"--\"\n    args:\n    - \"while true; do sleep 30; done;\"\n</code></pre> Processes<pre><code>$ kubectl apply -f without-hostaliases-pod.yml\npod/without-hostaliases-pod created\n\n$ kubectl get pods\nNAME                      READY   STATUS    RESTARTS   AGE\nwithout-hostaliases-pod   1/1     Running   0          37s\n\n$ kubectl exec without-hostaliases-pod -- cat /etc/hosts\n# Kubernetes-managed hosts file.\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nfe00::0 ip6-mcastprefix\nfe00::1 ip6-allnodes\nfe00::2 ip6-allrouters\n10.241.0.13     without-hostaliases-pod\n\n$ kubectl exec without-hostaliases-pod -- dig +short blog.pichuang.com.tw\n104.21.70.229\n172.67.140.43\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#after","title":"After","text":"hostaliases-pod.yml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  namespace: default\n  name: hostaliases-pod\nspec:\n  restartPolicy: Never\n  hostAliases:\n  - ip: \"127.0.0.1\"\n    hostnames:\n    - \"blog.pichuang.com.tw\"\n    - \"local.pichuang.com.tw\"\n  - ip: \"10.1.2.3\"\n    hostnames:\n    - \"foo.remote\"\n    - \"bar.remote\"\n  containers:\n  - name: cat-hosts\n    image: quay.io/tw_pichuang/debug-container:master\n    command:\n    - \"/bin/bash\"\n    - \"-c\"\n    - \"--\"\n    args:\n    - \"while true; do sleep 30; done;\"\n</code></pre> Processes<pre><code>$ kubectl apply -f hostaliases-pod.yml\npod/hostaliases-pod created\n\n$ kubectl get pods\nNAME                      READY   STATUS    RESTARTS   AGE\nhostaliases-pod           1/1     Running   0          7s\nwithout-hostaliases-pod   1/1     Running   0          37s\n\n$ kubectl exec hostaliases-pod -- cat /etc/hosts\n# Kubernetes-managed hosts file.\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nfe00::0 ip6-mcastprefix\nfe00::1 ip6-allnodes\nfe00::2 ip6-allrouters\n10.241.0.69     hostaliases-pod\n\n# Entries added by HostAliases.\n127.0.0.1       blog.pichuang.com.tw    local.pichuang.com.tw\n10.1.2.3        foo.remote      bar.remote\n\n# Get a Shell to a Running Container\n$ kubectl exec --stdin --tty hostaliases-pod -- /bin/bash\n\n$ kubectl exec hostaliases-pod -- ping -c3 blog.pichuang.com.tw\nPING blog.pichuang.com.tw (127.0.0.1) 56(84) bytes of data.\n64 bytes from localhost (127.0.0.1): icmp_seq=1 ttl=64 time=0.018 ms\n64 bytes from localhost (127.0.0.1): icmp_seq=2 ttl=64 time=0.036 ms\n64 bytes from localhost (127.0.0.1): icmp_seq=3 ttl=64 time=0.037 ms\n\n--- blog.pichuang.com.tw ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2038ms\nrtt min/avg/max/mdev = 0.018/0.030/0.037/0.009 ms\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#2-use-kubernetes-dnsconfig","title":"2. Use Kubernetes <code>dnsConfig</code>","text":"<ul> <li>Pod's DNS Config</li> </ul>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#before_1","title":"Before","text":"without-dnsconfig-pod.yml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  namespace: default\n  name: without-dnsconfig-pod\nspec:\n  restartPolicy: Never\n  containers:\n  - name: cat-hosts\n    image: quay.io/tw_pichuang/debug-container:master\n    command:\n    - \"/bin/bash\"\n    - \"-c\"\n    - \"--\"\n    args:\n    - \"while true; do sleep 30; done;\"\n</code></pre> Processes<pre><code>$ kubectl apply -f without-dnsconfig-pod.yml\npod/without-dnsconfig-pod created\n\n$ kubectl exec without-dnsconfig-pod -- cat /etc/resolv.conf\nsearch default.svc.cluster.local svc.cluster.local cluster.local zc3wsrpezdhu5hdkc4pchiwajh.bx.internal.cloudapp.net\nnameserver 10.0.0.10\noptions ndots:5\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#after_1","title":"After","text":"dnsconfig-pod.yml<pre><code>---\napiVersion: v1\nkind: Pod\nmetadata:\n  namespace: default\n  name: dnsconfig-pod\nspec:\n  restartPolicy: Never\n  dnsConfig:\n    nameservers:\n      - 192.168.78.100 # On-premise DNS Server\n    searches:\n      - pichuang.local\n      - azure.local\n    options:\n      - name: ndots\n        value: \"2\"\n      - name: edns0\n  containers:\n  - name: cat-hosts\n    image: quay.io/tw_pichuang/debug-container:master\n    command:\n    - \"/bin/bash\"\n    - \"-c\"\n    - \"--\"\n    args:\n    - \"while true; do sleep 30; done;\"\n</code></pre> Processes<pre><code>$ kubectl apply -f dnsconfig-pod.yaml\npod/dnsconfig-pod created\n\n$ kubectl exec dnsconfig-pod -- cat /etc/resolv.conf\nsearch default.svc.cluster.local svc.cluster.local cluster.local zc3wsrpezdhu5hdkc4pchiwajh.bx.internal.cloudapp.net pichuang.local azure.local\nnameserver 10.0.0.10\nnameserver 192.168.78.100\noptions ndots:2 edns0\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#cluster-level","title":"Cluster Level","text":"<p>In Azure Kubernetes Service, you should follow the Customize CoreDNS with Azure Kubernetes Service to setup the <code>CoreDNS</code> configuration.</p>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#grab-the-current-resolving-configuration","title":"Grab the current resolving configuration","text":"<pre><code>$ kubectl get nodes\nNAME                                STATUS   ROLES   AGE     VERSION\naks-nodepool1-36776276-vmss000001   Ready    agent   4h54m   v1.26.3\n\n# Get a Shell to a Running Node\n$ kubectl debug node/aks-nodepool1-36776276-vmss000001 -it --image=quay.io/tw_pichuang/debug-container:master\nCreating debugging pod node-debugger-aks-nodepool1-36776276-vmss000001-srgx9 with container debugger on node aks-nodepool1-36776276-vmss000001.\nIf you don't see a command prompt, try pressing enter.\n\n[root@aks-nodepool1-36776276-vmss000001 /]# cat /etc/os-release\nNAME=\"CentOS Stream\"\nVERSION=\"8\"\nID=\"centos\"\nID_LIKE=\"rhel fedora\"\nVERSION_ID=\"8\"\nPLATFORM_ID=\"platform:el8\"\nPRETTY_NAME=\"CentOS Stream 8\"\nANSI_COLOR=\"0;31\"\nCPE_NAME=\"cpe:/o:centos:centos:8\"\nHOME_URL=\"https://centos.org/\"\nBUG_REPORT_URL=\"https://bugzilla.redhat.com/\"\nREDHAT_SUPPORT_PRODUCT=\"Red Hat Enterprise Linux 8\"\nREDHAT_SUPPORT_PRODUCT_VERSION=\"CentOS Stream\"\n\n[root@aks-nodepool1-36776276-vmss000001 /]# chroot /host /bin/bash\n\nroot@aks-nodepool1-36776276-vmss000001:/# cat /etc/os-release\nPRETTY_NAME=\"Ubuntu 22.04.2 LTS\"\nNAME=\"Ubuntu\"\nVERSION_ID=\"22.04\"\nVERSION=\"22.04.2 LTS (Jammy Jellyfish)\"\nVERSION_CODENAME=jammy\nID=ubuntu\nID_LIKE=debian\nHOME_URL=\"https://www.ubuntu.com/\"\nSUPPORT_URL=\"https://help.ubuntu.com/\"\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\nUBUNTU_CODENAME=jammy\n\nroot@aks-nodepool1-36776276-vmss000001:/# cat  /run/systemd/resolve/resolv.conf\n# This is /run/systemd/resolve/resolv.conf managed by man:systemd-resolved(8).\n# Do not edit.\n#\n# This file might be symlinked as /etc/resolv.conf. If you're looking at\n# /etc/resolv.conf and seeing this text, you have followed the symlink.\n#\n# This is a dynamic resolv.conf file for connecting local clients directly to\n# all known uplink DNS servers. This file lists all configured search domains.\n#\n# Third party programs should typically not access this file directly, but only\n# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a\n# different way, replace this symlink by a static file or a different symlink.\n#\n# See man:systemd-resolved.service(8) for details about the supported modes of\n# operation for /etc/resolv.conf.\n\nnameserver 168.63.129.16\nsearch zc3wsrpezdhu5hdkc4pchiwajh.bx.internal.cloudapp.net\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#show-default-corefile-within-aks","title":"Show Default Corefile within AKS","text":"kubectl -n kube-system configmaps/coredns<pre><code>$ kubectl -n kube-system get configmaps coredns -o yaml | kubectl neat -o yaml\napiVersion: v1\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        ready\n        health {\n          lameduck 5s\n        }\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n          pods insecure\n          fallthrough in-addr.arpa ip6.arpa\n          ttl 30\n        }\n        prometheus :9153\n        forward . /etc/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n        import custom/*.override\n    }\n    import custom/*.server\nkind: ConfigMap\nmetadata:\n  labels:\n    addonmanager.kubernetes.io/mode: Reconcile\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n  name: coredns\n  namespace: kube-system\n</code></pre> kubectl -n kube-system configmaps/coredns-custom<pre><code>$ kubectl -n kube-system get configmaps coredns-custom -o yaml | kubectl neat -o yaml\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  labels:\n    addonmanager.kubernetes.io/mode: EnsureExists\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n  name: coredns-custom\n  namespace: kube-system\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#add-nameserver-to-custom-corefile","title":"Add Nameserver to custom Corefile","text":"coredns-custom.yaml<pre><code>---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns-custom\n  namespace: kube-system\ndata:\n  Corefile.override: |\n        forward . 8.8.8.8 8.8.4.4\n</code></pre> <pre><code>$ kubectl apply -f coredns-custom.yaml\nconfigmap/coredns-custom created\n\n$ kubectl -n kube-system rollout restart deployment coredns\ndeployment.apps/coredns restarted\n\n$ kubectl -n kube-system get configmaps coredns-custom -o yaml | kubectl neat -o yaml\napiVersion: v1\ndata:\n  Corefile.override: |\n    forward . 8.8.8.8 8.8.4.4\nkind: ConfigMap\nmetadata:\n  labels:\n    addonmanager.kubernetes.io/mode: EnsureExists\n    k8s-app: kube-dns\n    kubernetes.io/cluster-service: \"true\"\n  name: coredns-custom\n  namespace: kube-system\n</code></pre>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-setup-resolve-within-aks.html#references","title":"References","text":"<ul> <li>pichuang/Debug-Container</li> <li>Customize CoreDNS with Azure Kubernetes Service</li> </ul>","tags":["azure","kubernetes","howto"]},{"location":"wiki/howto/howto-traffic-load-balancing.html","title":"How To: Traffic Load Balancing in Azure","text":"<p>Note</p> <p>\u6587\u4ef6\u66f4\u65b0\u6642\u9593: 20230720</p>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#how-to-traffic-load-balancing-in-azure","title":"How To: Traffic Load Balancing in Azure","text":"","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#traffic-load-balancing-9","title":"\u95dc\u65bc Traffic Load Balancing \u5e38\u898b 9 \u7a2e\u89e3\u6c7a\u65b9\u6848\u7d44\u5408","text":"<ol> <li>\u55ae\u7368\u7528 Azure Load Balancer</li> <li>\u55ae\u7368\u7528 Front Door</li> <li>\u55ae\u7368\u7528 Application Gateway</li> <li>\u55ae\u7368\u7528 Traffic Manager</li> <li>Multi-Tenant SaaS on Azure = \u524d\u9762\u7528 Azure Front Door \u5f8c\u9762\u63a5 Application Gateway</li> <li>Multi-region N-tier application = \u524d\u9762\u63a5 Traffic Manager \u5f8c\u9762\u63a5 Load Balancer</li> <li>Multi-tier web application built for HA/DR = \u524d\u9762\u63a5 Traffic Manager \u5f8c\u9762\u63a5 Load Balancer</li> <li>Multi-region load balancing = \u524d\u9762\u63a5 Traffic Manager \u5f8c\u9762\u63a5 Application Gateway</li> <li>Zero-Trust network for Web Applications = \u524d\u9762\u63a5 Application Gateway \u5f8c\u9762\u63a5 Azure Firewall</li> </ol>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#decision-tree-for-load-balancing-in-azure","title":"Decision tree for load balancing in Azure","text":"<p>\u57fa\u65bc Decision tree for load balancing in Azure</p> <p></p>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#regional-global","title":"\u95dc\u65bc\u670d\u52d9\u80fd\u529b\u548c\u5340\u57df Regional / Global","text":"<p>\u57fa\u65bc Global versus regional</p> Layer Regional Global DNS Azure Traffic Manager Azure Traffic Manager L7 (HTTP, HTTPS) Azure Application Gateway Azure Front Door L4 (TCP) Azure Load Balancer Azure Cross-region (Global) Load Balancer","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#inbound-private-network-public-network","title":"\u95dc\u65bc\u670d\u52d9 Inbound \u8def\u7dda: Private Network / Public Network","text":"Componets Private Network Public Network Azure Front Door Azure Traffic Manager Azure Application Gateway Azure Load Balancer Azure Cross-region (Global) Load Balancer","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#service-comparison","title":"Service Comparison","text":"Features Azure Application Gateway Azure Front Door Azure Load Balancer Azure Traffic Manager Supported protocols HTTP, HTTPS, HTTP/2 HTTP, HTTPS, HTTP/2 TCP, UDP Any (DNS Based) Private Load Balancing (1) Global load balancing (2) Routing Policies Round robin Latency, priority, round robin, weighted round robin Hash Based Geographical, latency, weighted, priority, subnet, multi-value Supported environments Azure, non-Azure cloud, on prem Azure, non-Azure cloud, on prem Within Azure Azure, non-Azure cloud, on prem Connection draining (3) Session affinity (4) Host and path based load balancing (5) TLS offloading (6) Site acceleration (7) Security Web Application Firewall (WAF), Network Security Group (NSG) Web Application Firewall (WAF) Network Security Group (NSG) Caching and compression (8) <pre><code>1. Used where private IPs are needed at the frontend only.\n2. Traffic distribution across multiple regional deployments or use it to improve application uptime with regional redundancy.\n3. Gracefully remove backend pool members during planned service updates.\n4. Useful when you want to keep a user session on the same server.\n5. Application-layer processing to route requests to the endpoints being load balanced\n6. TLS termination at the load balancing service, data will flow unencrypted to the backend servers\n7. Dynamic site acceleration (DSA).\n8. Caching of content and dynamic compression on the edge.\n</code></pre>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#azure-load-balancer","title":"\u95dc\u65bc Azure Load Balancer \u6392\u5217\u7d44\u5408","text":"Features Basic Standard Gateway Network Public / Private Public / Private Private Tier Regional Regional / Global Regional <p>\u7d50\u8ad6: \u4e00\u822c\u72c0\u6cc1\u5c31\u662f\u9078 Azure Load Balancer (Standard/Regional) \u5c31\u5c0d\u4e86</p>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/howto/howto-traffic-load-balancing.html#azure-paas","title":"\u5df2\u77e5 Azure PaaS \u63a1\u7528\u65b9\u6848","text":"<ul> <li> <p>Azure Red Hat OpenShift</p> <ul> <li>\u9810\u8a2d\u4f7f\u7528 Azure Load Balancer (Standard/Regional)</li> </ul> </li> <li> <p>Azure Kubernetes Service</p> <ul> <li>\u9810\u8a2d\u4f7f\u7528 Azure Load Balancer (Standard/Regional)</li> <li>Ingress \u4f7f\u7528 Azure Application Gateway Ingress Controller (+ Web Application Firewall)</li> </ul> </li> <li> <p>NVA\uff0c\u4f8b\u5982 F5 BIG-IP / Check Point CloudGuard / Citrix ADC / Fortinet FortiGate / Trend Micro Cloud One</p> </li> <li> <p>\u4f7f\u7528 Azure Load Balancer (Gateway)</p> </li> </ul>","tags":["loadbalancer","azure networking","azure"]},{"location":"wiki/openai/openai-location.html","title":"OpenAI API \u670d\u52d9\u4f4d\u7f6e","text":"","tags":["One Stop","azure networking"]},{"location":"wiki/openai/openai-location.html#openai-api_1","title":"\u95dc\u65bc OpenAI API","text":"<p>TL;DR, OpenAI Location: San Antonio, Texas, USA</p> <p>\u76ee\u524d\u6240\u6709\u7684 OpenAI API \u547c\u53eb\u90fd\u6703\u547c\u53eb <code>https://api.openai.com</code></p> <p>\u6211\u5011\u53ef\u4ee5\u4f7f\u7528 <code>mtr api.openai.com</code> \u4f86\u8ffd\u8e64\u5c01\u5305\u7684\u8def\u5f91\uff0c\u5f97\u77e5\u6700\u5f8c\u7684\u51fa\u53e3\u662f\u843d\u5728 <code>AS8075</code> \u88e1\u7684 <code>ae100-0.icr01.sn1.ntwk.msn.net</code>\uff0c\u800c <code>AS8075</code> \u662f Microsoft Global Network \u5c08\u7528\u7684 ASN\uff0c\u9664\u6b64\u4e4b\u5916\u4f60\u5982\u679c\u6709\u770b\u5230 AS8068\u3001AS8069\u3001AS12076 \u90fd\u662f\u96b8\u5c6c\u65bc Microsoft \u7ba1\u8f44\u7684\u7bc4\u570d</p> <pre><code>$ mtr --report --report-cycles 200 api.openai.com\nStart: 2023-03-08T06:24:44+0800\nHOST: rhel8                       Loss%   Snt   Last   Avg  Best  Wrst StDev\n  1.|-- _gateway                   0.0%   200    0.5   0.4   0.2   3.4   0.3\n  2.|-- 192.168.100.254            0.0%   200    3.5   4.0   2.1  18.3   2.4\n  3.|-- h254.s98.ts.hinet.net      0.0%   200   12.4  17.8  11.9  25.8   3.1\n  4.|-- tpdb-3332.hinet.net        3.5%   200   13.5  12.7  11.0  24.6   1.5\n  5.|-- tpdb-3031.hinet.net        0.5%   200   13.3  12.9  10.6  23.1   1.4\n  6.|-- 220-128-1-1.hinet-ip.hine  0.0%   200   13.1  13.1  10.6  37.6   2.9\n  7.|-- 211-22-228-233.hinet-ip.h  0.5%   200   13.4  13.3  10.5  45.9   4.0\n  8.|-- 203-75-250-153.hinet-ip.h  2.0%   200   13.7  13.7  10.8  48.3   4.4\n  9.|-- ae28-0.icr02.tyo30.ntwk.m  0.0%   200   43.2  47.6  42.1  91.1   6.8\n 10.|-- be-102-0.ibr01.tyo30.ntwk  0.5%   200  177.7 183.9 176.2 294.2  21.7\n 11.|-- be-1-0.ibr01.tyo31.ntwk.m  5.0%   200  178.3 180.2 176.3 272.5  10.4\n 12.|-- be-9-0.ibr01.pnq01.ntwk.m  5.5%   200  177.7 180.8 176.2 538.6  26.9\n 13.|-- be-1-0.ibr01.lax30.ntwk.m  7.0%   200  177.3 181.5 175.7 501.8  26.7\n 14.|-- be-9-0.ibr01.phx10.ntwk.m  4.5%   200  177.2 184.8 175.8 465.1  29.1\n 15.|-- be-6-0.ibr01.sn1.ntwk.msn  7.0%   200  244.4 188.1 176.1 431.3  32.4\n 16.|-- ae100-0.icr01.sn1.ntwk.ms  6.5%   200  176.9 181.8 175.1 396.1  17.6\n 17.|-- ???                       100.0   200    0.0   0.0   0.0   0.0   0.0\n</code></pre> <p>\u7576\u4e2d <code>ae100-0.icr01.sn1.ntwk.msn.net</code> \u6700\u91cd\u8981\u7684\u8cc7\u8a0a\u662f sn \u9019\u500b\u7e2e\u5beb\uff0c\u9019\u500b\u4ee3\u8868\u7684\u662f\u5c01\u5305\u8f49\u9001\u5230\u54ea\u4e00\u500b Azure Region\uff0c\u7136\u5f8c\u53ef\u4ee5\u4f9d\u64da Microsoft edge locations by abbreviation for Azure Front Door \u67e5\u8a62\uff0c\u6545\u53ef\u5f97\u77e5 sn \u4f4d\u65bc <code>San Antonio, Texas, USA</code> \u5730\u7406\u4f4d\u7f6e\uff0c\u800c Azure Region \u5c0d\u4e0a Location \u5247\u70ba <code>Azure Region - South Central US</code></p> <p>\u4ee5\u6b64\u985e\u63a8\uff0c\u53ef\u77e5\u5f9e\u6211\u5bb6\u5230 OpenAI \u7684\u5c01\u5305\u8def\u5f91\u70ba</p> <ul> <li>Route Path: Hinet (Taiwan) -&gt; TYO (Tokyo, Japan) -&gt; PNQ (Pune, India) -&gt; LAX (Los Angeles, California, USA) -&gt; PHX (Phoenix, Arizona, USA) -&gt; SN (San Antonio, Texas, USA)</li> </ul>","tags":["One Stop","azure networking"]},{"location":"wiki/openai/openai-location.html#azure-south-central-us-apiopenaicom","title":"\u95dc\u65bc Azure South Central US \u5230 api.openai.com \u7684\u8def\u7531","text":"<p>\u958b\u4e00\u500b\u4f4d\u65bc Azure South Central US \u7684 Ubuntu VM\uff0c\u4e26\u4e14\u639b\u4e0a Public IP \u6e2c\u8a66\u5230 api.openai.com \u7684\u8ddd\u96e2\uff0c\u5927\u7d04\u5728 1 ms \u4e0a\u4e0b</p> <pre><code>root@openai-vm:~# mtr --tcp --report --report-cycles 10 api.openai.com\nStart: 2023-03-08T04:45:08+0000\nHOST: openai-vm                   Loss%   Snt   Last   Avg  Best  Wrst StDev\n  1.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  2.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  3.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  4.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  5.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  6.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  7.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  8.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  9.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 10.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 11.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 12.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 13.|-- 52.152.96.252              0.0%    10    1.1   1.1   1.0   1.4   0.1\n</code></pre>","tags":["One Stop","azure networking"]},{"location":"wiki/openai/openai-location.html#azure-south-central-us-apilineme","title":"\u95dc\u65bc Azure South Central US \u5230 api.line.me \u7684\u8def\u7531","text":"<p>\u958b\u4e00\u500b\u4f4d\u65bc Azure South Central US \u7684 Ubuntu VM\uff0c\u4e26\u4e14\u639b\u4e0a Public IP \u6e2c\u8a66\u5230 api.line.me \u7684\u8ddd\u96e2\uff0c\u5927\u7d04\u5728 10~13 ms \u4e0a\u4e0b</p> <pre><code>root@centralus-vm:~# ping -c 10 api.line.me\nPING e14293.a.akamaiedge.net (184.86.161.105) 56(84) bytes of data.\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=1 ttl=52 time=13.1 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=2 ttl=52 time=13.2 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=3 ttl=52 time=13.1 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=4 ttl=52 time=13.0 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=5 ttl=52 time=13.2 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=6 ttl=52 time=13.1 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=7 ttl=52 time=13.1 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=8 ttl=52 time=13.1 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=9 ttl=52 time=13.0 ms\n64 bytes from a184-86-161-105.deploy.static.akamaitechnologies.com (184.86.161.105): icmp_seq=10 ttl=52 time=13.1 ms\n\n--- e14293.a.akamaiedge.net ping statistics ---\n10 packets transmitted, 10 received, 0% packet loss, time 9016ms\nrtt min/avg/max/mdev = 12.962/13.098/13.249/0.071 ms\n\nroot@centralus-vm:~# mtr --report --report-cycles 10 api.line.me\nStart: 2023-03-08T04:41:43+0000\nHOST: centralus-vm                Loss%   Snt   Last   Avg  Best  Wrst StDev\n  1.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  2.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  3.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  4.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  5.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  6.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  7.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  8.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n  9.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 10.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 11.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 12.|-- ???                       100.0    10    0.0   0.0   0.0   0.0   0.0\n 13.|-- a184-86-161-105.deploy.st  0.0%    10   10.2  10.0   9.8  10.3   0.2\n</code></pre>","tags":["One Stop","azure networking"]},{"location":"2024.html","title":"2024","text":""},{"location":"2023.html","title":"2023","text":""},{"location":"2022.html","title":"2022","text":""},{"location":"2021.html","title":"2021","text":""},{"location":"2020.html","title":"2020","text":""},{"location":"2019.html","title":"2019","text":""},{"location":"azure.html","title":"azure","text":""},{"location":"container.html","title":"container","text":""},{"location":"networking.html","title":"networking","text":""},{"location":"cncf.html","title":"cncf","text":""},{"location":"ansible.html","title":"ansible","text":""},{"location":"kubernetes.html","title":"kubernetes","text":""},{"location":"sustainability.html","title":"sustainability","text":""},{"location":"sla.html","title":"sla","text":""},{"location":"o11y.html","title":"o11y","text":""},{"location":"openai.html","title":"openai","text":""},{"location":"linux.html","title":"linux","text":""},{"location":"misc.html","title":"misc","text":""},{"location":"openshift.html","title":"openshift","text":""},{"location":"personal.html","title":"personal","text":""},{"location":"homecloud.html","title":"homecloud","text":""},{"location":"automation.html","title":"automation","text":""},{"location":"author/url.html","title":"Phil Huang","text":""},{"location":"2024/2.html","title":"2024","text":""},{"location":"2024/3.html","title":"2024","text":""},{"location":"2023/2.html","title":"2023","text":""},{"location":"2023/3.html","title":"2023","text":""},{"location":"2023/4.html","title":"2023","text":""},{"location":"2023/5.html","title":"2023","text":""},{"location":"2023/6.html","title":"2023","text":""},{"location":"2020/2.html","title":"2020","text":""},{"location":"2020/3.html","title":"2020","text":""},{"location":"2020/4.html","title":"2020","text":""},{"location":"2020/5.html","title":"2020","text":""},{"location":"2020/6.html","title":"2020","text":""},{"location":"2019/2.html","title":"2019","text":""},{"location":"2019/3.html","title":"2019","text":""},{"location":"azure/2.html","title":"azure","text":""},{"location":"azure/3.html","title":"azure","text":""},{"location":"homecloud/2.html","title":"homecloud","text":""},{"location":"kubernetes/2.html","title":"kubernetes","text":""},{"location":"kubernetes/3.html","title":"kubernetes","text":""},{"location":"kubernetes/4.html","title":"kubernetes","text":""},{"location":"kubernetes/5.html","title":"kubernetes","text":""},{"location":"kubernetes/6.html","title":"kubernetes","text":""},{"location":"kubernetes/7.html","title":"kubernetes","text":""},{"location":"linux/2.html","title":"linux","text":""},{"location":"openshift/2.html","title":"openshift","text":""},{"location":"author/url/2.html","title":"Phil Huang","text":""},{"location":"author/url/3.html","title":"Phil Huang","text":""},{"location":"author/url/4.html","title":"Phil Huang","text":""},{"location":"author/url/5.html","title":"Phil Huang","text":""},{"location":"author/url/6.html","title":"Phil Huang","text":""},{"location":"author/url/7.html","title":"Phil Huang","text":""},{"location":"author/url/8.html","title":"Phil Huang","text":""},{"location":"author/url/9.html","title":"Phil Huang","text":""},{"location":"author/url/10.html","title":"Phil Huang","text":""},{"location":"author/url/11.html","title":"Phil Huang","text":""},{"location":"author/url/12.html","title":"Phil Huang","text":""},{"location":"author/url/13.html","title":"Phil Huang","text":""},{"location":"author/url/14.html","title":"Phil Huang","text":""},{"location":"author/url/15.html","title":"Phil Huang","text":""},{"location":"author/url/16.html","title":"Phil Huang","text":""},{"location":"author/url/17.html","title":"Phil Huang","text":""},{"location":"author/url/18.html","title":"Phil Huang","text":""},{"location":"author/url/19.html","title":"Phil Huang","text":""}]}