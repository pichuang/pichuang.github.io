
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Open Knowledge, Open Source, Open Mind">
      
      
        <meta name="author" content="Phil Huang">
      
      
        <link rel="canonical" href="https://blog.pichuang.com.tw/author/url/page/3/">
      
      
        <link rel="prev" href="../../../..">
      
      
        <link rel="next" href="../../../../category/automation/">
      
      
        
      
      
      <link rel="icon" href="../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3+insiders-4.49.2">
    
    
      
        <title>Phil Huang - Phil's Workspace</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.67c3bdf0.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7COverpass+Mono+SemiBold:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"Overpass Mono SemiBold"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-8MQRY98QB2"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-8MQRY98QB2",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-8MQRY98QB2",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#phil-huang" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
  <a href="https://www.youtube.com/@pichuang-tw" style="color:white;">
    For updates follow <strong>@pichuang-tw</strong> on
    <strong>YouTube Channel ğŸ¥ </strong>
  </a>

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Phil&#39;s Workspace" class="md-header__button md-logo" aria-label="Phil's Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.97 5.92a.967.967 0 0 0-1.18-.68l-3.4.91-4.44-4.12-1.23.33 2.66 4.59-3.19.85-1.26-.98-.93.25 1.66 2.88 10.62-2.84c.52-.15.82-.68.69-1.19M21 10l-1 2h-5l-1-2 1-1h2V7h1v2h2l1 1m1 10v2H2v-2h13v-7h5v7h2Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Phil's Workspace
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Phil Huang
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pichuang/pichuang.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    blog.pichuang.com.tw
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../.." class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../wiki/" class="md-tabs__link">
          
  
    
  
  Wiki

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../azure-subnets/" class="md-tabs__link">
          
  
    
  
  Azure Visual Subnet Calculator

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../about/" class="md-tabs__link">
          
  
    
  
  About

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Phil&#39;s Workspace" class="md-nav__button md-logo" aria-label="Phil's Workspace" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.97 5.92a.967.967 0 0 0-1.18-.68l-3.4.91-4.44-4.12-1.23.33 2.66 4.59-3.19.85-1.26-.98-.93.25 1.66 2.88 10.62-2.84c.52-.15.82-.68.69-1.19M21 10l-1 2h-5l-1-2 1-1h2V7h1v2h2l1 1m1 10v2H2v-2h13v-7h5v7h2Z"/></svg>

    </a>
    Phil's Workspace
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pichuang/pichuang.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    blog.pichuang.com.tw
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../.." class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2023
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2021
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2020
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2019
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_3" >
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    automation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    azure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    container
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/homecloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    homecloud
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    linux
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    misc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/o11y/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    o11y
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/openai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    openai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/openshift/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    openshift
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/personal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    personal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/sla/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    sla
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/sustainability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    sustainability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" checked>
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Authors
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Authors
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    Phil Huang
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    Phil Huang
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kubernetes-app" class="md-nav__link">
    <span class="md-ellipsis">
      
        å¦‚ä½•ç§‘å­¸åœ°ä¼°ç®— Kubernetes æ‰€éœ€çš„è³‡æº? App è§’åº¦ç¯‡
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2020" class="md-nav__link">
    <span class="md-ellipsis">
      
        2020 å¹´åº¦å€‹äººå›é¡§
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes-api" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes API æœå‹™åŠè·Ÿå„çµ„ä»¶çš„äº¤äº’é—œä¿‚
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#namespace-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        å¦‚ä½•æ¢åˆ—å‡ºå–®ä¸€ Namespace å…§çš„ Kubernetes è¨ˆç®—è³‡æº?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes éƒ¨ç½²åœ¨è™›æ©Ÿå¥½é‚„æ˜¯è£¸æ©Ÿå¥½?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-4-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹äºŒ
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-4-etcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-pod-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift-rbac" class="md-nav__link">
    <span class="md-ellipsis">
      
        Red Hat OpenShift RBAC æœ€å°æ¬Šé™å¯¦è¸
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#red-hat-openshift" class="md-nav__link">
    <span class="md-ellipsis">
      
        ç•¶å®‰è£å®Œ Red Hat OpenShift ä¹‹å¾Œ...
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../wiki/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Wiki
  

    
  </span>
  
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Wiki
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Azure Visual Subnet Calculator
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Azure Visual Subnet Calculator
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../azure-subnets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Visual Subnet Calculator (Azure Edition)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    About
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Who is Phil Huang?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../recording/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Recording
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="phil-huang">Phil Huang</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2021-11-12 00:00:00">November 12, 2021</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="kubernetes-app"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/">å¦‚ä½•ç§‘å­¸åœ°ä¼°ç®— Kubernetes æ‰€éœ€çš„è³‡æº? App è§’åº¦ç¯‡</a></h2>
<p>ä»Šå¹´ 2021 å°å¼Ÿä¸ŠåŠå¹´éåº¦å¿™ç¢Œï¼ŒåŠ ä¸Šæ›çƒéšŠæ‰“çƒï¼Œå†åŠ ä¸Šæœ‰é»é‡åˆ°ä¸­å¹´å±æ©Ÿï¼Œå°è‡´ç™¼å»¢æ–‡é‡å¤§å¹…ä¸‹é™ï¼Œè«‹å¤§å®¶å¤šå¤šæ“”å¾…</p>
<blockquote>
<p>åœ°ä¸Šçˆ¬çš„æˆ‘ï¼šç®— Kubernetes Sizing å¥½ç´¯ï¼Œæˆ‘éƒ½ä»¥ç‚ºæˆ‘æ”¹è¡Œæˆç‚º Excel æ¶æ§‹å¸«äº†å‘¢
å¤©ä¸Šé£›çš„å­¸é•·ï¼šé›²åŸç”Ÿæœå‹™åˆ°åº•æ˜¯è¦ Sizing ä»€éº¼ =_= ? ä¸å¤ ä¸å°±çµ¦ä»–åŠ ä¸‹å»å°±å°äº†?
åœ°ä¸Šçˆ¬çš„æˆ‘ï¼šæˆ‘å€‘æ˜¯åœ°ç«¯...Q_Q
å¤©ä¸Šé£›çš„å­¸é•·ï¼šæ©...ä½ ä¿é‡</p>
</blockquote>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/#_1">ç³»åˆ—æ–‡å‰è¨€</a></h3>
<p>æ—©åœ¨æœ¬ç¯‡é–‹å§‹ï¼Œå…¶å¯¦æ—©åœ¨å…ˆå‰ <a href="https://learnk8s.io/kubernetes-instance-calculator">Learnk8s Kubernetes Instance Calculator</a> å·²ç¶“æœ‰æ¨å‡ºéä¸€å€‹è »å¥½çœ‹çš„ç¶²é è³‡æºè¨ˆç®—æ©Ÿä¾›å¤§å®¶åƒè€ƒï¼Œä½†é€™å€‹çš„å•é¡Œæ˜¯ä»–æ²’æœ‰è€ƒé‡åˆ°å¤šå€‹ Kubernetes Namespace éƒ¨ç½²çš„ç‹€æ³ï¼Œç•¢ç«Ÿä¸å¯èƒ½æ¯ä¸€å€‹ Pod çš„è³‡æºéƒ½é•·ä¸€æ¨£ã€‚å…¶æ¬¡ï¼Œåœ°ç«¯è·Ÿé›²ç«¯ä¸ä¸€æ¨£ï¼Œå‰è€…æ¡è³¼ç¡¬é«”éœ€è¦äº‹å…ˆæº–å‚™ï¼Œå¾Œè€…å‰‡å…·å‚™<code>æœ‰é™çš„ç„¡é™è³‡æº</code>å¯ä¾›ä½¿ç”¨ï¼Œæ‰€ä»¥åªè¦å‰è€…ä¸€å€‹ä¼°ä¸æº–å°±æœƒå‡ºäº‹ã€‚ä½†èº«ç‚ºä¸€å Ops äººå“¡ï¼Œæˆ‘åˆæ‡‰è©²è¦å¦‚ä½•è«‹ App äººå“¡æä¾›æ•¸å­—çµ¦ä½ ä½œç‚ºåƒè€ƒï¼Ÿ</p>
<p>æ‰€ä»¥ç‚ºäº†å»£å¤§çš„é„‰æ°‘ï¼Œæˆ‘æä¾›é ä¼°è³‡æºè³‡æºä½œæ³•ï¼Œå¤§æ¦‚å¯ä»¥è§£æ±º<code>å…«æˆå·¦å³</code>çš„ç‹€æ³ (å…¶ä»–å…©æˆç‹€æ³ï¼Œè«‹æ´½æ¥­å‹™æ‰¾æˆ‘å»å¹«å¿™ç®— XD)ã€‚æ•…ä»¥ç‚ºäº†è¦ç®¡ç†å¥½å¤šå€‹ Kubernetes å¢é›†éœ€æ±‚ä¹‹ä¸‹ï¼Œéœ€è¦åœ¨æ¯ä¸€å€‹ Kubernetes æ‰€éƒ¨ç½²çš„ç¨‹å¼è³‡æº <a href="https://gist.github.com/pichuang/eb50ee49e4cdb64549df335216cc5290">Tanzu Mission Control Extension Manager</a> çš„é€™æ”¯ç¨‹å¼ä½œç‚ºä¼°ç®—ç¯„ä¾‹</p>
<p>ä¸»è¦åˆ†ç‚ºå…©å€‹æ–¹å‘å¤¾æ“ŠæŠ“è³‡æº</p>
<ol>
<li>Top-Downï¼šä»¥ App è§’åº¦å‡ºç™¼çš„ Kubernetes Application è³‡æºä¼°ç®—</li>
<li>Bottom-Upï¼šä»¥ Ops è§’åº¦å‡ºç™¼çš„ Hardware (or Cloud Provider) è³‡æºä¼°ç®—</li>
</ol>
<h3 id="app-kubernetes-application"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/#app-kubernetes-application">ä»¥ App è§’åº¦å‡ºç™¼çš„ Kubernetes Application è³‡æºä¼°ç®—</a></h3>
<p>æƒ³å•å•å¤§å®¶ä¸€å€‹ Kubernetes è¦éƒ¨ç½²ä¸€å€‹ Application æœƒéœ€è¦ä»€éº¼æ±è¥¿? æ˜¯çš„ï¼Œä½ éœ€è¦å»æè¿°ä½ çš„æ‡‰ç”¨ç¨‹å¼è³‡æºå’Œç›¸é—œè³‡è¨Šï¼Œä¸¦ä¸”éƒ¨ç½²åœ¨ç‰¹å®šçš„ Kubernetes Namespaceï¼Œå¦‚ <code>vmware-system-tmc</code>ï¼Œæ‰€ä»¥èº«ç‚ºä¸€å€‹ App äººå“¡çš„ç›®æ¨™å°±æ˜¯æŠŠ <code>åŸºæ–¼ namespace ç‚ºä¸»çš„å…§éƒ¨æ‰€éœ€è³‡æºæ¢åˆ—å‡ºä¾†</code>ï¼Œæ“·å– <a href="https://gist.github.com/pichuang/eb50ee49e4cdb64549df335216cc5290#file-sample-tmc-deployment-yaml-L880-L957">Tanzu Mission Control Extension Manager L880-L957</a> å…§å®¹ï¼Œå¦‚ä¸‹</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nt">tmc.cloud.vmware.com/orphan-resource</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="nt">control-plane</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span><span class="nt">controller-tools.k8s.io</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="nt">tmc-extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="nt">tmc-extension-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span><span class="nt">tmc.cloud.vmware.com/managed</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;vmware-system-tmc&#39;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">  </span><span class="nt">minReadySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">  </span><span class="nt">progressDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">600</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">      </span><span class="nt">control-plane</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">      </span><span class="nt">controller-tools.k8s.io</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">      </span><span class="nt">tmc-extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100%</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">        </span><span class="nt">control-plane</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">        </span><span class="nt">controller-tools.k8s.io</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0&quot;</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">        </span><span class="nt">tmc-extension</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">        </span><span class="nt">tmc-extension-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">      </span><span class="nt">affinity</span><span class="p">:</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">        </span><span class="nt">nodeAffinity</span><span class="p">:</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">          </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">            </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/os</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">                </span><span class="nt">values</span><span class="p">:</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">beta.kubernetes.io/os</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">                </span><span class="nt">values</span><span class="p">:</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">linux</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">command</span><span class="p">:</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/usr/local/bin/manager</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POD_NAMESPACE</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metadata.namespace</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;extensions.vmware-cloud.tmc.cloud.vmware.com/extensions/extension-manager/extension-manager@sha256:&#39;</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9876</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">webhook-server</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256Mi</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128Mi</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">          </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="w">      </span><span class="nt">serviceAccountName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extension-manager</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
</code></pre></div>
<p>å°æ–¼ Kubernetes Application è³‡æºä¼°ç®—ä½ æ‡‰è©²è¦é—œå¿ƒä»¥ä¸‹å¹¾å€‹é»</p>
<ol>
<li>kind çš„é¡å‹ï¼šä¸»è¦å…ˆä»¥å¯æ¶µè“‹å¤§éƒ¨åˆ†éƒ¨ç½²å ´æ™¯ç‚ºä¸»ï¼Œå¸¸è¦‹æœ‰ 3 å¤§ Kindï¼ŒDeploymentã€StatefulSetã€DaemonSetï¼Œå¦‚æœ¬ç¯„ä¾‹ç‚ºä¾‹ <code>kind: Deployment</code></li>
<li>spec.replicas çš„æ•¸å­—ï¼šä¸»è¦æ˜¯è¦ç¢ºèªå¾…æœƒä¸‹é¢çš„ CPU / Memory æ˜¯è¦ä¹˜ä¸Šå¤šå°‘ï¼Œå¸¸è¦‹æ‡‰è©²éƒ½æ˜¯ä»¥ <code>1</code> ç‚ºä¸»ï¼Œè‡³æ–¼ç‚ºä»€éº¼å¯åƒé–±æˆ‘æ–¼ <a href="https://speakerdeck.com/pichuang/20210812-ru-he-cai-yong-yun-yuan-sheng-zuo-fa-velero-bei-fen-huan-yuan-ni-de-kubernetes-cong-ji?slide=8">ä¹‹å‰åœ¨ Microsoft DevDays 2021 æ¼”è¬›çš„å…§å®¹</a>ï¼Œå¦‚æœå¾®æœå‹™èƒ½å¤  Scale-Out çš„è©±ï¼Œå°±æ˜¯ <code>2</code> æˆ–ä»¥ä¸Šçš„æ•¸å­—</li>
<li>æ¯ä¸€å€‹ Pod æ‰€éœ€è¦çš„ CPU å’Œ Memory è³‡æºï¼šä¸»è¦æ˜¯ç¢ºå®šä¸€å€‹ Container æ‰€éœ€è¦çš„ CPU åŠ Memory çš„ä¸Šä¸‹é™ï¼Œè¦ç•™æ„ <code>1 å€‹ Pod è£¡é¢æœƒæœ‰ 1 å€‹æˆ–å¤šå€‹ Containers</code>ï¼Œå¯è©³é–±<a href="https://speakerdeck.com/pichuang/how-do-i-troubleshooting-on-container-more-than-docker?slide=17">ä¹‹å‰åœ¨ HKOSCon 2020 æ¼”è¬›å…§å®¹</a>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>        resources:
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>          limits:
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>            cpu: 100m
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>            memory: 256Mi
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>          requests:
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>            cpu: 100m
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>            memory: 128Mi
</code></pre></div></li>
<li>Storage çš„é¸å‹ï¼šä¸»è¦æ˜¯è¦ç¢ºå®šæ˜¯è¦é€é hostPath è‚šå­çš„ç¡¬ç¢Ÿé‚„æ˜¯ä½¿ç”¨ PV/PVC æ¡ç”¨åŸºæ–¼ CSI ä»‹é¢çš„å¤–æ›å„²å­˜æœå‹™ï¼Œå¸¸ç”¨å”å®šå¦‚ NFSã€iSCSI åŠ FC ç­‰ï¼Œé€™å€‹ä¸»è¦éƒ½æ˜¯ä»¥æœå‹™å°æ–¼ IOPS æˆ–å…¶ç‰¹æ€§çš„è€ƒé‡ç‚ºæ¡ç”¨æ¨™çš„ï¼Œä½†æœ¬æ–‡ä¸æ·±å…¥æ¢ç©¶</li>
</ol>
<p>æ‰€ä»¥æŠŠä¸Šé¢çš„è³‡è¨Šæ”¶é›†èµ·ä¾†ï¼Œæœƒå¾—åˆ°ä¸‹é¢é€™å¼µè¡¨</p>
<p><img alt="" src="/images/tmc-res.png" /></p>
<p>ä½†å¯¦éš›ä¸Šä½ å¡«å®Œï¼Œæœƒæ³¨æ„åˆ°ä¸€äº›äº‹æƒ…</p>
<ol>
<li>é€™æ¨£ç¸½è³‡æºæ˜¯å°çš„å—?</li>
<li>æœ‰äº›æ¬„ä½æ²’å¡«çš„æ€éº¼è¾¦?</li>
</ol>
<p>å›æ‡‰ç¬¬ä¸€é¡Œï¼Œä¸€å®šä¸å°ï¼Œå› ç‚ºä½ çœ‹ <code>Replicas</code> æœ‰äº›æ˜¯ 2ï¼Œæ‰€ä»¥å¯¦éš›ä¸Šä½ æ‡‰è©²è¦æŠŠå·¦é‚Šçš„è³‡æºå…¨éƒ¨ä¹˜ä¸Š <code>Replicas</code> æ•¸å­—ï¼Œèº«ç‚ºä¸€å€‹ App åœ˜éšŠä½ æ‡‰è©²æœƒå¾—åˆ°ä¸‹é¢é€™å¼µè¡¨</p>
<p><img alt="" src="/images/tmc-res-1.png" /></p>
<p>é€™æ™‚å€™ä½ æŠŠå…¨éƒ¨çš„è³‡è¨Šæ’ˆå‡ºä¾†ï¼Œå¯ä»¥ç²å¾—åˆ° <code>å¤§ç´„</code>é€™æ”¯æ•´å€‹ç¨‹å¼å†æ€éº¼è·‘ï¼Œé ‚å¤š <code>vmware-system-tmc</code> é€™å€‹ namesapceï¼Œå°±æ˜¯åƒæ‰ <code>4700m</code> CPU è·Ÿ <code>6382M</code> Memoryï¼Œè‡³æ–¼å°æ–¼ Kubernetes è¨ˆç®—å–®ä½ä¸ç†Ÿçš„å¯ä»¥åƒè€ƒ <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes Managing Resources for Containers</a>ï¼Œå¦é™„ä¸Š <a href="https://docs.google.com/spreadsheets/d/1zQswfXuZhpKjsmmFvCHiGt19Ej6s6hpr5yiB1wnPR70/edit?usp=sharing">Google Sheet åƒè€ƒæ–‡ä»¶</a></p>
<p>å›æ‡‰ç¬¬äºŒé¡Œï¼Œå‘ˆä¸Šï¼Œå¦‚æœä½ æ²’å¯«è³‡æºï¼Œé€™ä¸æ˜¯ä»£è¡¨ä»–é‹ä½œä¸ç”¨è³‡æºï¼Œæ˜¯ä»£è¡¨é€™ä»½ Yaml æ²’æœ‰å®šç¾© limits / requests å…©å€‹æ•¸å­—å»é™åˆ¶ä»–çš„è³‡æºä½¿ç”¨ï¼Œè€Œæ˜¯æœƒç”¨ BestEffort çš„æ–¹å¼é‹è¡Œã€‚åœ¨é€™å€‹ç‹€æ³ä¸‹ï¼Œå¦‚æœçœŸçš„å¯«ä¸å‡ºä¾†ï¼ŒçœŸçš„æ˜¯åªèƒ½æ†‘ç¶“é©—å…ˆä¼°ä¸€å€‹æ•¸å­—çµ¦ requests ç¢ºä¿ä¸æœƒçˆ†ç‚¸ï¼Œå†ä¾†ç”¨ Metrics æœå‹™ï¼Œå¦‚è‡ªå»º Prometheusã€æˆ– SaaS æœå‹™ Tanzu Observability é•·æœŸè§€æ¸¬èª¿æ•´æ•¸å­—ç‚ºæ¯”è¼ƒå‹™å¯¦çš„ä½œæ³•ã€‚å€˜è‹¥ä½ å¦‚æœé¸ç”¨çš„ç¨‹å¼æ˜¯ Java JVM æˆ–è€…æ˜¯è‡ªå¸¶ç¨‹å¼èªè¨€è™›æ“¬æ©Ÿï¼Œæœƒç›¸ç•¶å¥½ä¼°ç®—ï¼Œä½†æœ¬æ–‡ä¸æ·±å…¥æ¢ç©¶</p>
<p>é‚£é¡å¤–å•é¡Œä¾†äº†ï¼Œå¦‚æœæˆ‘åœ¨è³‡æºè£¡é¢å¡« 0 çš„è©±æœƒæ€æ¨£?</p>
<h3 id="0"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/#0">é—œæ–¼ 0 çš„é‚£äº›äº‹</a></h3>
<blockquote>
<p>å…ˆè¬›çµè«–ï¼Œå»ºè­°é‚„æ˜¯è¦è¨­å®š limits è·Ÿ requests çš„å€¼ä¸Šå»ï¼Œæœ€å°‘ä¹Ÿè¦æœ‰ limits</p>
</blockquote>
<p>ç•¶è³‡æºçœŸå¿ƒä¸è¶³çš„æ™‚å€™ï¼Œå‰‡ Kubernetes å‰‡æœ‰å…§å»ºæ”¯æ´ QoS æœå‹™ç®¡ç†èƒ½åŠ›ï¼Œä¸”æ”¯æ´ä½œæ¥­ç³»çµ±ç­‰ç´šçš„ OOM æ§åˆ¶ï¼Œæœ€å°è¨ˆç®—å–®ä½ç‚º Podã€‚<code>ä¸€èˆ¬ä¾†èªªï¼Œä¼°ç®—è¨ˆç®—è³‡æº limits æ¯”è¼ƒé‡è¦ï¼Œå¯¦éš›ä¸Šé‹è¡Œèª¿åº¦å‰‡æ˜¯ requests æ¯”è¼ƒé‡è¦</code></p>
<p>Kubernetes æœƒé–‹å§‹ä¾æ“š QoS ä¸‰ç¨®ç­‰ç´šï¼ˆç”±æœ€é«˜åˆ°æœ€ä½å„ªå…ˆæ¬Šæ’åºï¼‰ï¼šGuranted &gt; Bursatable &gt; BestEffort é€²è¡Œæ¬Šé‡æ’åºï¼Œé€šå¸¸æœƒç™¼ç”Ÿ OOM (Out-of-Memory) ä¹Ÿéƒ½æ˜¯å› ç‚ºæ’åˆ°è³‡æºä¸è¶³ï¼Œç„¶å¾Œå„ªå…ˆæ¬Šé‡åˆä½ï¼Œå°±è¢«å¹¹æ‰äº†ï¼Œå¸¸è¦‹å¦‚ AI/ML å®¹å™¨ç­‰æœƒåƒè³‡æºçš„å®¹å™¨æœå‹™ï¼Œç¢ºåˆ‡çš„è©³ç´°å…§å®¹è«‹åƒé–± <a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/quality-service-pod/">Kubernetes - é…ç½® Pod çš„æœåŠ¡è´¨é‡</a></p>
<table>
<thead>
<tr>
<th style="text-align: center;">å„ªå…ˆæ¬Š</th>
<th style="text-align: center;">QoS é¡å‹</th>
<th style="text-align: center;">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">1 (highest)</td>
<td style="text-align: center;">Guaranted</td>
<td style="text-align: center;">Pod è£¡é¢çš„æ¯ä¸€å€‹ Container éƒ½è¦è¨­å®š requests ç­‰æ–¼ limits (å…©å€‹å€¼çš†æœ‰è¨­å®šï¼Œä¸”ä¸ç­‰æ–¼ 0)</td>
</tr>
<tr>
<td style="text-align: center;">2</td>
<td style="text-align: center;">Burstable</td>
<td style="text-align: center;">Pod è£¡é¢çš„ä»»ä¸€å€‹ Container å…·æœ‰ requests ä¸ç­‰æ–¼ limits æ•¸å€¼ï¼Œä¸”ä¸ç¬¦åˆ Guaranted æ¢ä»¶</td>
</tr>
<tr>
<td style="text-align: center;">3 (lowest)</td>
<td style="text-align: center;">BestEffort</td>
<td style="text-align: center;">æ²’æœ‰è¨­å®šä»»ä½•è³‡æºè«‹æ±‚å’Œé™åˆ¶</td>
</tr>
</tbody>
</table>
<p>ç•¶ç„¶ä½ çœ‹å®Œä¸Šé¢æ‡‰è©²æœƒéœ§å‚»å‚»ï¼Œæ‰€ä»¥èº«ç‚º Excel ç²¾ç®—å¸«çš„æˆ‘å¹«å¤§å®¶æ•´ç†äº†ä»¥ä¸‹åˆ—èˆ‰äº†å·²çŸ¥çµ„åˆï¼Œä¾›å¤§å®¶åƒè€ƒ</p>
<p><img alt="" src="/images/tmc-res-4.png" /></p>
<p>ä½ çœ‹å®Œä¸Šé¢çš„åœ–æ‡‰è©²æœƒçŸ¥é“ä¸€å€‹äº‹å¯¦ï¼Œ<code>0</code> åœ¨ Kubernetes ä¾†èªªæ˜¯æœ‰æ„ç¾©çš„ï¼Œæ‰€ä»¥è³‡æºä¼°ç®—è«‹ä¸è¦äº‚å¯«ï¼Œä»–ä¸ä»£è¡¨ç„¡é™å¤§è³‡æºçš„æ„æ€...å¦‚æœçœŸçš„ä¸çŸ¥é“è«‹ç•™ç©ºï¼Œè€Œä¸æ˜¯å¯« 0</p>
<h3 id="app"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/#app">ä»¥ App è§’åº¦å‡ºç™¼çš„å¸¸è¦‹è³‡æºéŒ¯ä¼°èª¤å€</a></h3>
<p>ä½ æ˜¯ä¸æ˜¯è¦ºå¾—åˆ°é€™é‚Šå°±å¯ä»¥ä¼°ç®—çµæŸäº†ï¼Ÿ<code>å¾ˆæŠ±æ­‰æ²’æœ‰</code>ï¼Œä½ é‚„å°‘ç®—é‹è¡Œ Kubernetes æ‰€éœ€è¦çš„æœå‹™ï¼Œå¦‚ kubeletã€CNIã€kube-proxyã€OS æœ¬èº«æœå‹™ç­‰ç­‰é€™äº›ä¸å­˜åœ¨æ–¼ kubernetes çš„è³‡æºæ¸…å–®ä¸Šï¼Œä½†å¯¦éš›ä¸Šæ˜¯éœ€è¦é€™äº›æœå‹™æ‰èƒ½å¤ å¥½å¥½çš„é‹è¡Œ Kubernetes æœå‹™ï¼Œé‚£é€™æ˜¯ä»€éº¼æ„æ€å‘¢?</p>
<p>æ‹¿æˆ¿å­æ¬Šç‹€æ¯”å–»ï¼Œä»¥ä¸Šæ‰€åšçš„äº‹æƒ…éƒ½æ˜¯åœ¨ç®—å®¤å…§é¢ç©ï¼ˆå®¢å»³ã€æµ´å®¤ã€é™½å°ï¼‰ï¼Œå¯¦éš›ä¸Šä½ é‚„æœ‰å…¬è¨­ï¼ˆæ¨“æ¢¯ã€é›»æ¢¯ã€å¥èº«æˆ¿ï¼‰è¦ç®—å•Šï¼æ‰€ä»¥æœ€çµ‚ä¼°ç®— 1 å€‹ Kubernetes æ‰€éœ€è³‡æºçš„çµæœï¼Œä¸€å®šæœƒæ¯” App æ‰€å¯«çš„é‚„è¦ä¾†å¾—å¤§ä¸Šä¸€é»</p>
<p><img alt="" src="https://learnk8s.io/a/5505f01f0ed678a7ac42642b4dfd7b1c.svg" /></p>
<p>è€Œå„å¤§å» å•†ç‚ºäº†è¦é™ä½å…¬è¨­æ¯”ï¼Œç´›ç´›éƒ½æ¨å‡ºäº† Container OS é€²è¡Œè³‡æºå’Œæ•ˆèƒ½ä¸Šçš„æœ€ä½³åŒ–ï¼Œç•¢ç«Ÿèª°å¸Œæœ›æ‹¿åˆ° 1 å€‹ 4c/8g çš„ worker ç¯€é»ï¼ŒæŠŠä¸€å †è·Ÿ kubernetes æ²’é—œä¿‚çš„æœå‹™é–‹èµ·ä¾†å°±å‰©ä¸åˆ°ä¸€åŠè³‡æºå¯ä»¥ç”¨ï¼Œä½†å› ç‚ºå„å®¶å‡º Container OS ç³»çµ±éƒ½ä¸ç›¡ç›¸åŒï¼Œæ‰€ä»¥æœƒå¾ˆä»°è³´å„è‡ªå» å•†å·¥ç¨‹å¸«çš„ç²¾ç®—</p>
<h3 id="_2"><a class="toclink" href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/#_2">çµèª</a></h3>
<p>çœ‹å®Œä»¥ä¸Šçš„æ–‡ç« ï¼Œç›¸ä¿¡å¤§å®¶ä¸€å®šæœƒè¦ºå¾—ç‚ºå•¥æˆ‘è¦å€‹ Kubernetes ç‚ºå•¥è¦æå¾—é€™éº¼è¤‡é›œï¼Œæ‰€ä»¥ä¸‹ç¯‡æœƒè¬›ï¼Œ<code>ä»¥ Ops è§’åº¦å‡ºç™¼çš„ Hardware (or Cloud Provider) è³‡æºä¼°ç®—</code>ï¼Œå°±æ˜¯å¯«ä¸å‡ºä¾†çš„ç‹€æ³ä¸‹èº«ç‚º Ops åˆ°åº•è©²æ€éº¼è¾¦ï¼Ÿ</p>
<p>å¸Œæœ›ä»Šå¹´èƒ½å¯«å¾—å‡ºä¾†...å¸Œæœ›...</p>
<p>ç‰¹åˆ¥æ„Ÿè¬ Gene Kuo å’Œ Hwchiu å¹«å¿™æ ¡ç¨¿ XD</p>
    <nav class="md-post__action">
      <a href="../../../../2021/11/12/%E5%A6%82%E4%BD%95%E7%A7%91%E5%AD%B8%E5%9C%B0%E4%BC%B0%E7%AE%97-kubernetes-%E6%89%80%E9%9C%80%E7%9A%84%E8%B3%87%E6%BA%90-app-%E8%A7%92%E5%BA%A6%E7%AF%87/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-12-31 00:00:00">December 31, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/misc/" class="md-meta__link">misc</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="2020"><a class="toclink" href="../../../../2020/12/31/2020-%E5%B9%B4%E5%BA%A6%E5%80%8B%E4%BA%BA%E5%9B%9E%E9%A1%A7/">2020 å¹´åº¦å€‹äººå›é¡§</a></h2>
<p>åˆä¸€å€‹å®Œæ•´çš„æ—¥æ›†å¹´éäº†ï¼Œä¾†å€‹å¹´åº¦å›é¡§ç´€éŒ„</p>
<!--more-->

<p>é›–ç„¶ 2020 å¹´æ˜¯æ·±å—ç–«æƒ…æ»‹æ“¾çš„ä¸€å¹´ï¼Œæ„Ÿè¦ºæ‡‰è©²å•¥äº‹éƒ½æ²’åšï¼Œä½†é€éå›é¡§ï¼Œç™¼ç¾æˆ‘é‚„åšäº†ä¸å°‘äº‹æƒ…...</p>
<h3 id="2020_1"><a class="toclink" href="../../../../2020/12/31/2020-%E5%B9%B4%E5%BA%A6%E5%80%8B%E4%BA%BA%E5%9B%9E%E9%A1%A7/#2020_1">2020 å›é¡§</a></h3>
<ol>
<li>åœ¨æœ¬å¹´åº¦æœ€å¾Œä¸€å¤©å»åœŸåŸç•¶è­‰å©šäººï¼Œæˆ‘ä»¥ç‚ºçµå©šè¦æ‰¾è­‰å©šäººæ˜¯å¸¸è­˜ = =</li>
<li>æ­£å¼å·¥ä½œç¸½å¹´è³‡ä¾†åˆ° 4y 6m äº†ï¼Œä½†æˆ‘è¦ºå¾—å¥½åƒå·¥ä½œå¾ˆä¹…äº†...</li>
<li>åœ¨<a href="https://www.linkedin.com/in/phil-huang-09b09895/">Red Hat ç²¾ç¥æ™‚å…‰å±‹åº¦é 2y 8m</a> äº†</li>
<li><a href="https://blog.pichuang.com.tw/record/">2020 å¹´åº¦æ¼”è¬› 19 å ´</a>ï¼Œå®Œæˆå¹´åº¦å…©å²¸ä¸‰åœ°æ¼”è¬›å…¨æˆå°±ï¼ŒåŒ…å« 2 å ´é¦™æ¸¯åŠä¸­åœ‹ç¤¾ç¾¤é ç«¯æ¼”è¬›ï¼Œæ•´é«”æ¯” 2019 å¹´é‚„å¢åŠ  6 å ´</li>
<li><a href="https://blog.pichuang.com.tw/archives/">2020 å¹´åº¦æ–‡ç«  35 ç¯‡</a>ï¼Œæ¯” 2019 å¹´é‚„å¢åŠ  6 ç¯‡ï¼Œä½†æ¶µè“‹æŠ€è¡“å»£åº¦æ˜é¡¯ä¸è¶³ QQ</li>
<li><a href="https://speakerdeck.com/pichuang/gong-cheng-shi-de-ni-xi">æ‰æ‰å¯¦å¯¦åœ°æ¸›è‚¥ 20 å…¬æ–¤</a>ï¼Œæ¯”å»å¹´é è¨­ç›®æ¨™ 1 å…¬æ–¤é‚„å¤šå®Œæˆ 19 å…¬æ–¤ï¼Œå…‰æ˜¯é€™ä¸€æ¢æˆå°±æ‡‰è©²å¯ä»¥æœ‰æ•ˆè­‰æ˜æœ¬äººåšäº‹ç›¸ç•¶å…·å‚™å¼·å¤§æ„å¿—åŠ›å’ŒåŸ·è¡ŒåŠ› XD</li>
<li>å‘ˆä¸Šï¼Œ<a href="https://www.facebook.com/paulintoro/posts/4061098773905144">å¸¸è¨€é“ ï¼šé©åº¦å¥èº«å¸å¼•ç•°æ€§ï¼Œéåº¦å¥èº«å¸å¼•åŒæ€§</a>ï¼Œæœ¬å¹´åº¦ç´¯ç©è¢« 5 å€‹ä¸èªè­˜ç”·æ€§æ­è¨•åŠ 0 å€‹ä¸èªè­˜å¥³æ€§æ­è¨•ç´€éŒ„</li>
<li>æ‹¿äº†ä¸€å€‹ <a href="https://www.facebook.com/paulintoro/posts/4038305259517829">Red Hat APAC Office of Technology Team BU Advocates</a> å®˜æ–¹æˆå°±å›ä¾†ï¼Œé›–ç„¶è·Ÿæˆ‘ç›®æ¨™é‚„æœ‰æ®µå·®è·</li>
<li>æ†‘ä¸€å˜´ä¹‹åŠ›ï¼Œä¸€å¹´å…§è«‹äº† 1+N å€‹äººé€² Red Hatï¼Œå› ç‚ºæˆ‘æ€•è¢«å…¶ä»–å» å•†æŠ“å»åœæ¯†ï¼Œæ‰€ä»¥ä¸è¬›æ•¸å­—äº†</li>
<li>å› ç‚ºç–«æƒ…é—œä¿‚ï¼Œå‰µä¸‹é€£çºŒ 1 å€‹æœˆæ²’æœ‰é€²è¾¦å…¬å®¤ç´€éŒ„ï¼Œä½†æˆ‘å±…å®¶è¨­å‚™ (é›™è¢å¹•ã€BenQ æª¯ç‡ˆã€äººé«”å·¥å­¸é›»è…¦æ¤…ã€å‡é™æ¡Œ) æ¯”è¼ƒå¥½ï¼ŒåŠ ä¸Šæ²’äººåµæˆ‘ï¼ˆæˆ–æˆ‘æ²’äººå¯ä»¥å»åµï¼‰ï¼Œæ‰€ä»¥è™•ç†å…¬äº‹æ•ˆç‡å±…ç„¶é‚„æ¯”è¼ƒé«˜</li>
<li>2020 ä¸‹åŠå¹´å› ç‚ºæŸäº›åŸå› åº¦éäººç”Ÿæœ‰è¨˜æ†¶ä»¥ä¾†æœ€æ··æ²Œ 3 å€‹æœˆï¼Œæ„Ÿè¬é€™æ®µæ™‚é–“é™ªæˆ‘åº¦éæ··æ²Œä¸æ˜ç‹€æ…‹çš„æœ‹å‹å€‘å’Œå‰è¼©ï¼Œæœ‰ä½ å€‘çœŸå¥½ QQ</li>
<li>ä»Šå¹´æ²’å¤±æˆ€ 1 æ¬¡ï¼Œä¹Ÿå¤±æˆ€ 1 æ¬¡</li>
<li>æ‹äº†äººç”Ÿç¬¬ 1 æ¬¡çš„<a href="https://www.facebook.com/paulintoro/posts/4080957481919273">è¥¿è£æ²™é¾ç…§</a></li>
<li>å¹´åº¦æ”¾å¤§å‡å»å¢¾ä¸å­¸äº†æ½›æ°´ï¼Œä¸€æ¬¡è€ƒåˆ° 3 å¼µ<a href="https://www.instagram.com/p/CHY64ORh-LI/?utm_source=ig_web_copy_link">æ½›æ°´è­‰ç…§</a>ï¼ŒåŒ…å« PADI Open Water Driverã€PADI Advanced Open Water Driverã€PADI é«˜æ°§</li>
<li>é€£çºŒé ç«¯ä¸Šèª² 2 é€±ï¼Œç„¶å¾Œä¹Ÿåœ¨åŒæ™‚é€£çºŒæµæ„Ÿ 2 æ¬¡ï¼Œå·®é»ä»¥ç‚ºä¸­å¤§æ¨™è¦é€²å¤§é†«é™¢</li>
<li>è²·äº†äººç”Ÿç¬¬ 1 éš»<a href="https://www.instagram.com/p/CIX__rFhcPj">æ©Ÿæ¢°éŒ¶ Hamilton Murph</a>ï¼Œæœ¬äººæ˜¯è«¾è˜­é›»å½±ç²‰</li>
<li>å»çŸ¥åçš„ Gallup æ¸¬è©•äº†ä¸€ä¸‹å€‹äººç‰¹è³ªï¼Œç²å¾—å€‹äººå‰ 5 å¤§ä¸»è¦å¤©è³¦ï¼š<a href="https://lynnihlin.com/portfolio-posts/strategic/">æˆ°ç•¥</a>ã€<a href="https://lynnihlin.com/portfolio-posts/maximizer/">å®Œç¾</a>ã€<a href="https://lynnihlin.com/portfolio-posts/%e8%93%8b%e6%b4%9b%e6%99%ae%e5%a4%a9%e8%b3%a6%e4%b8%bb%e9%a1%8c%e8%a7%a3%e8%ae%801%ef%bc%9a%e6%88%90%e5%b0%b1achiever/">æˆå°±</a>ã€<a href="https://lynnihlin.com/portfolio-posts/intellection/">æ€ç¶­</a>ã€<a href="https://lynnihlin.com/portfolio-posts/positivity/">ç©æ¥µ</a>ï¼Œä¼¼ä¹äººè³‡ç•Œæ¯”è¼ƒçŸ¥é“é€™å€‹æ‰€ä»£è¡¨çš„æ„ç¾©</li>
<li>æ¦®ç²"æ‰¾æ­»ç‹"ç¨±è™Ÿ</li>
<li>ç²å¾— GitHub çµ¦çš„ 1 å€‹å°å‹›ç«  <a href="https://github.com/pichuang">Arctic Code Vault Contributor</a>ï¼Œæ‰€ä»¥åŒ—æ¥µçš„æŸå€‹åœŸåœ°æœ‰æˆ‘çš„...éºè·¡ï¼Ÿ</li>
<li>ä»¥ 2020/12/31 ç•¶æ—¥ç´€éŒ„ç‚ºæ­¢ï¼Œ2020 å¹´è²¢ç»äº† 9 å€‹ GitHub Repository</li>
<li>ç¬¬ä¸€æ¬¡ç•¶å¯©ç¨¿è€…ï¼Œé‚„æ˜¯æœ¬é•·é” 460 é çš„è‹±æ–‡æ›¸ <a href="https://www.facebook.com/paulintoro/posts/3849945331687157">Packt - The Kubernetes Workshop</a></li>
</ol>
<h3 id="2021"><a class="toclink" href="../../../../2020/12/31/2020-%E5%B9%B4%E5%BA%A6%E5%80%8B%E4%BA%BA%E5%9B%9E%E9%A1%A7/#2021">2021 å±•æœ›</a></h3>
<ol>
<li>æ´»ä¸‹å»!!! ç„¡è«–æ˜¯å·¥ä½œé‚„æ˜¯ç”Ÿå‘½</li>
<li>æŒ‘æˆ° 1 å ´åœ‹å¤–ç¤¾ç¾¤æ¼”è¬›</li>
<li>ç˜¦é€™éº¼å¤šï¼ŒåƒåŠ å€‹å¥ç¾æ¯”è³½ä¸ç‚ºéå§</li>
<li>å¤šå¢åŠ å»£åº¦å¯«é»æŠ€è¡“æ–‡ç« ï¼Œæ˜å¹´æŒ‘æˆ°å€‹ Windows è·Ÿå…¬æœ‰é›²ç³»åˆ—çš„å¥½äº†</li>
<li>å¸Œæœ›æˆ¿åƒ¹èƒ½é™ä¸‹å»è®“æˆ‘è²·å€‹å®…çª© QQ</li>
<li>è©²å¯« 1 æœ¬æ›¸äº†</li>
</ol>
<h3 id="_1"><a class="toclink" href="../../../../2020/12/31/2020-%E5%B9%B4%E5%BA%A6%E5%80%8B%E4%BA%BA%E5%9B%9E%E9%A1%A7/#_1">çµèª</a></h3>
<p>æ•´é«”æ™‚é–“åˆ†é…ä¸Šï¼Œä»Šå¹´æ•´é«”æ„Ÿè¦ºæ˜¯è¦ºå¾—å°ˆæ¥­æŠ€è¡“ç•¥å¾®ä¸‹é™ï¼Œä½†å¤šå‡ºçš„æ™‚é–“è®“èº«é«”è®Šå¾—è¶…ç´šå¥åº·ï¼Œæ²’å› ç‚ºç–«æƒ…çš„é—œä¿‚å°è‡´è‡ªå·±çš„ç”Ÿæ´»è£¹è¶³ä¸å‰ï¼Œå‹‰å¼·å¯ä»¥æ¥å—</p>
<p>æ•´é«” $$ åˆ†é…ä¸Šï¼Œå› ç‚ºç–«æƒ…çš„é—œä¿‚å°è‡´ä¸€å †äº‹æƒ…éƒ½åœ¨å®¶è£¡åšï¼Œä¹ŸåŠ å¼·äº†ä¸€äº›å€‹äººèƒ½åŠ› (è‹±æ–‡ã€å¥èº«ã€é£²é£Ÿ) æå‡çš„æ•™è‚²è¨“ç·´ï¼Œæ¯”å»å¹´ç”Ÿæ´»æ›´èŠ±éŒ¢ = =</p>
<p>æ•´é«”é‹æ°£ä¸Šï¼Œä»Šå¹´å­¸åˆ°ï¼Œå¾€å¾Œæœ‰ä»»ä½•äººç”Ÿé›£é¡Œï¼Œéƒ½å»å°åŒ—è¡Œå¤©å®®æ”¶å€‹é©šï¼Œç„¶å¾ŒæŠ½å€‹ç±¤ï¼Œå¿«é€Ÿèª¿æ•´ä¸€ä¸‹å¿ƒæ…‹è »æœ‰æ•ˆæœçš„ï¼Œä»Šå¹´äººç”Ÿæœ€æ··æ²Œçš„ç‹€æ…‹ä¸‹ï¼ŒæŠ½åˆ°äº†ä¸€å€‹<a href="https://www.instagram.com/p/CF4BwsjBUwg/?utm_source=ig_web_copy_link">å¤§å‰</a>å’Œ<a href="https://www.instagram.com/p/CFHYiNlhYyQ/?utm_source=ig_web_copy_link">ä¸Šå‰</a>çš„ç±¤ï¼Œé‚„è »ç©©çš„</p>
<p>ä¸‹åœ–æ‡‰è©²æ˜¯æœ¬å¹´åº¦ä»£è¡¨ä¹‹ä½œäº†</p>
<p><img alt="" src="/images/2020-personal-review-2.jpg" /></p>
    <nav class="md-post__action">
      <a href="../../../../2020/12/31/2020-%E5%B9%B4%E5%BA%A6%E5%80%8B%E4%BA%BA%E5%9B%9E%E9%A1%A7/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-10-09 00:00:00">October 9, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="kubernetes-api"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/">Kubernetes API æœå‹™åŠè·Ÿå„çµ„ä»¶çš„äº¤äº’é—œä¿‚</a></h2>
<p>å‰é™£å­å®¢æˆ¶é‚£é‚Šæœ‰å€‹å•é¡Œéœ€è¦å…ˆäº†è§£ Kubernetes å¾éƒ¨ç½² Deployment åˆ°å¯¦éš›ä¸Šè·Ÿé€™äº›ä¸»è¦çµ„ä»¶æºé€šçš„æµç¨‹ï¼Œä¸ç„¶å¾ˆé›£é€²è¡Œ Troubleshooting (a.k.a. è§€è½é™°)ã€‚å¹¸å¥½æœ¬æ¬¡ç ”ç©¶æœ‰ 3 ä½å¤§å¤§çš„ä¸€èµ·åƒèˆ‡ Maxã€åœ°ç“œã€å–œå¾·ï¼Œæœ€çµ‚æ‰¾åˆ°äº†ä¸€å€‹è·Ÿç¾è±¡æ¯«ç„¡é—œä¿‚çš„æ ¹æœ¬å•é¡Œ =_=ï¼Œä½†å› ç‚ºéç¨‹ç®—è »é›£å¾—çš„ï¼Œç‰¹åˆ¥è¨˜éŒ„ä¸‹ä¾†çµ¦å¤§å®¶åƒè€ƒåƒè€ƒ</p>
<p>ç…§ä¾‹è¬›å€‹é›œäº‹ï¼ŒRed Hat OpenShift 4.6 (ç­‰åŒ Kubernetes 1.19) è¦å‡ºå•¦ï¼é€™æ˜¯ä¸€å€‹å¯ä»¥ä¸€è·¯ç”¨åˆ° <code>2022 å¹´ 3 æœˆ</code> çš„ç‰ˆæœ¬ï¼Œå„ä½ Infra ä¸ç”¨åœ¨ç‚ºäº†æ›´æ–°å’Œå‡ç´šè½æ·šäº† Q_Qï¼Œæœ‰èˆˆè¶£è€…å¯ä»¥åƒè€ƒ <a href="https://speakerdeck.com/redhatopenshift/whats-new-in-openshift-container-platform-4-dot-6">What's New in OpenShift Container Platform 4.6</a></p>
<p><img alt="" src="/images/ocp4-6-eus.png" /></p>
<!--more-->

<p>æŒ‰ç…§æˆ‘å€‹äººå°æ–¼ Kubernetes å…§éƒ¨æºé€šç†è§£ï¼Œç´„ç•¥åˆ†ç‚ºä¸‹åˆ— 11 å€‹æºé€šæ­¥é©Ÿï¼Œç•¶ç„¶æˆ‘çŸ¥é“å†æ›´ç´°åˆ†çš„è©±ï¼Œé‚„å¯ä»¥åˆ†æ›´å¤šæ­¥é©Ÿå‡ºä¾†ï¼Œä½†æˆ‘é€™åœ–åƒ…é‡å° Container æœ€çµ‚èƒ½é‹è¡Œç‚ºä¸»æˆªæ­¢</p>
<p><img alt="" src="/images/kube-api.png" /></p>
<p>å¦‚æœæœ‰æ™‚å€™é‡åˆ°ä¸€äº›ä¸å¯çŸ¥çš„ç¥ç¥•ç¾è±¡ï¼Œå¯ä»¥æ€è€ƒä¸€ä¸‹æ•´å€‹ç³»çµ±ï¼Œæ˜¯ä½åœ¨å“ªä¸€å±¤å¡ä½</p>
<h3 id="kubernetes-deployment"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/#kubernetes-deployment">Kubernetes Deployment åˆ†è§£å‹•ä½œè¬›è§£</a></h3>
<ol>
<li>ä½¿ç”¨è€…è‡ªè¡Œæ’°å¯«å¥½æˆ–é€éåˆ¥äººå¼„å¥½çš„ <a href="https://k8syaml.com/">Kubernetes YAML Generator</a> ç”¢ç”Ÿ Kubernetes Deployment YAML æª”æ¡ˆï¼Œä¸”<a href="https://k8smeetup.github.io/docs/tasks/administer-cluster/access-cluster-api/#%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE-rest-api">é€šè¿‡ Kubernetes API è®¿é—®é›†ç¾¤</a>ä¸€æ–‡æ‰€åˆ—çš„æ–¹å¼ï¼škubectl / RESTful API / <a href="https://github.com/kubernetes/client-go">client-go</a> / <a href="https://github.com/kubernetes-client/python">kubernetes-client/python</a> ç­‰æ–¹å¼ç™¼é€åˆ° Kubernetes API Server å®£å‘Šé€²è¡Œéƒ¨ç½²æ‡‰ç”¨ç¨‹å¼ã€‚é€™å€‹éšæ®µ Kubernetes API Server æœƒé€²è¡Œä¾åºæ˜¯ Authenticationã€Authorizationã€Admission Control ç­‰é©—è­‰å’Œæª¢æŸ¥èªæ³•ï¼Œè©³ç´°éç¨‹å¯åƒè€ƒ <a href="https://www.oreilly.com/library/view/kubernetes-best-practices/9781492056461/ch17.html">Chapter 17. Admission Control and Authorization</a>ã€‚å¦‚æœéƒ½æ²’æœ‰å•é¡Œçš„è©±ï¼Œå°‡æœƒå„²å­˜ Deployment Object è‡³ etcd cluster</li>
<li>ç›®å‰ç‚ºæ­¢ï¼ŒPod é‚„æ²’è¢«å•Ÿå‹•èµ·ä¾†ï¼Œä½† Controller Manager å·²ç¶“æ”¶åˆ°ä¾†è‡ª Kubernetes API Server çš„è¦æ±‚</li>
<li>Controller Manager æœƒå»æª¢æŸ¥æ˜¯å¦æœ‰æ•¸é‡æ­£ç¢ºçš„å‰¯æœ¬ (Replicas) ä¸”å°æ‡‰æ­£ç¢ºéœ€æ±‚çš„ Pod å·²ç¶“åœ¨é‹è¡Œ</li>
<li>å¦‚æœæ²’æœ‰æ­£ç¢ºæ•¸é‡çš„å‰¯æœ¬æ­£åœ¨é‹è¡Œï¼Œå‰‡æœƒç™¼é€åŸºæ–¼ Pod Spec çš„è¦æ±‚åˆ° Kubernetes API Server è«‹æ±‚å»ºç«‹å°æ‡‰æ•¸é‡çš„ Pod èµ·ä¾†</li>
<li>Kubernetes API Server å¯«å…¥å’Œè®€å–ä¹‹å‰ï¼Œæœƒå…ˆç¶“éå…©é—œ Admission å’Œ Validationï¼Œå‰è€… Admission é€éç¢ºèªå¢é›†å…¨åŸŸè¨­å®šä¾†æª¢æŸ¥æ˜¯å¦å¯ä»¥æ–°å¢æˆ–æ›´æ–° Objectï¼Œä¸¦å¯èƒ½ä¾æ“šå¢é›†è¨­å®šæä¾›é è¨­å€¼ï¼Œå¾Œè€… Validation å‰‡æ˜¯åœ¨æ–°å¢æˆ–æ›´æ–°éç¨‹ä¸­ï¼Œä¾†æª¢æŸ¥å‚³å…¥çš„ Object æ˜¯å¦åˆæ³•ï¼ŒåŠæ˜¯å¦åƒ…åŒ…å«æœ‰æ•ˆåƒæ•¸ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://www.openshift.com/blog/kubernetes-deep-dive-api-server-part-2">Kubernetes Deep Dive: API Server â€“ Part 2</a></li>
<li>Kubernetes API Server æŒçºŒæœƒå° etcd æ‰€å­˜æ”¾çš„ Kuberentes Object é€²è¡Œæ›´æ–°æˆ–ç§»é™¤ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://www.openshift.com/blog/kubernetes-deep-dive-api-server-part-2">Kubernetes Deep Dive: API Server â€“ Part 2</a></li>
<li>é›–ç„¶ etcd å…§éƒ¨å·²ç¶“å­˜æœ‰ Pod çš„è³‡è¨Šï¼Œä½†ä¸éåƒ…åƒ…æ˜¯ä¸€æ¢ç´€éŒ„è€Œå·²ï¼Œç¾å¯¦ç‹€æ³æ˜¯é‚„æ²’æœ‰åˆ†é…åˆ° Worker Node ä¸Šã€‚é€™æ™‚å€™ Kubernetes API Server æœƒé€šçŸ¥ Kubernetes Schedulerï¼šç›®å‰æœ‰æ–°å¢ Pod çš„éœ€æ±‚ï¼Œä¸¦ä¸”é‚„æ²’æœ‰ Worker Node å¯ä»¥é‹è¡Œå®ƒ</li>
<li>Kubernetes Scheduler æœƒé€šéç¨‹å¼æª¢æŸ¥ç¾è¡Œè³‡æºä½¿ç”¨ç‹€æ³ä»¥åŠç¾æœ‰çš„ Pod çš„åˆ†é…ï¼Œç„¶å¾Œå»è¨ˆç®—å‡ºæœ€é©åˆæ“ºæ”¾æ¯ã„§å€‹æ–° Pod çš„ Worker Node ä½ç½®ã€‚ç•¶æ±ºå®šå‡ºä¾†ä¹‹å¾Œï¼ŒKubernetes Scheduler å°‡æœƒè¨­å®šæ¯ä¸€å€‹ Pod è£¡é¢çš„ <code>spec.nodeName</code>ï¼Œå°‡å…¶è½‰æ›æˆ Worker Node åç¨± ï¼Œä¸¦å°‡æœ€çµ‚æ±ºå®šé€šçŸ¥è‡³ Kubernetes API Server é€²è¡Œæ›´æ–°è«‹æ±‚</li>
<li>ç›´è‡³æœ¬æ­¥é©Ÿç‚ºæ­¢ï¼ŒPod å·²ç¶“çŸ¥é“å®ƒæ‡‰è©²è¦åœ¨å“ªä¸€å€‹ Worker Node ä¸Šé¢é‹è¡Œï¼Œä½†å°‡é€šçŸ¥ä½æ–¼éœ€è¢«åˆ†é…çš„ Worker Node ä¸Šçš„ kubeletï¼Œä¸¦æŒ‡ç¤ºé€™äº›ä¾†è‡ªæ–¼ Kubernetes API Server çš„æ–°å¢ Pod è«‹æ±‚éƒ½æ‡‰è©²è¦è¢« Kubelet è¢«éµç…§åŸ·è¡Œã€‚ç„¶è€Œï¼Œè©² Worker Node ç¯€é»ä¸Šçš„ Kubelet å°‡æª¢æŸ¥è‡ªèº«æ˜¯å¦å·²ç¶“å°‡è¦é‹è¡Œçš„ Pod é‹è¡Œèµ·ä¾†ã€‚</li>
<li>ä¸€ä½† Kubelet ç¢ºå®š Pod æ‡‰è©²è¦é‹è¡Œæ–¼è©²ç¯€é»ä¸Šä¹‹å¾Œï¼Œå°±æœƒå‘¼å« High-Level Contianer Runtime (å¦‚: Dockerã€Containerdã€CRI-O ç­‰) å·²å•Ÿå‹•å®¹å™¨ (Container)ã€‚ç•¶ä¸€åˆ‡éƒ½æº–å‚™å¥½ä¹‹å¾Œï¼Œkubelet æœƒå°‡å…¶ç‹€æ…‹å ±å‘Šå›å‚³è‡³ Kubernetes API Server</li>
<li>æ¥ä¸‹ä¾†å°±æ˜¯ä¾æ“š <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/">Pod Lifecycle - Kubernetes</a> æ‰€è¿°ï¼Œå»ºç«‹ infra (pause) container å¾Œï¼Œé–‹å§‹å°‡Pod Spec æ‰€è¦æ±‚çš„ Container ä¸€å€‹ä¸€å€‹æ‹‰å–ä¸¦ä¸”å•Ÿå‹•ï¼Œä¸¦ä¸”èˆ‡ Kube-proxy å”ä½œå°‡æœå‹™è½‰ç™¼å‡ºå»</li>
</ol>
<h3 id="qa"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/#qa">Q&amp;A</a></h3>
<h4 id="high-level-container-runtime-low-level-container-runtime"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/#high-level-container-runtime-low-level-container-runtime">High-Level Container Runtime è·Ÿ Low-Level Container Runtime å·®ç•°æ˜¯å•¥?</a></h4>
<p>Low-Level Container Runtime ä¸»è¦å°ˆè·é‹è¡Œå®¹å™¨æˆ–å…¶ç‰¹å®šç’°å¢ƒï¼Œå¯¦éš›å°ˆæ¡ˆå¦‚ï¼Œå¸¸è¦‹æ–¼å„å¤§å°ˆæ¡ˆçš„ runc æˆ–è€…æ˜¯ crunã€runv ç­‰ï¼Œè©³ç´°å¯åƒè€ƒ <a href="https://github.com/opencontainers/runtime-spec/blob/master/implementations.md">opencontainers / runtime-spec - implementations.md</a></p>
<p>High-Level Container Runtime ä¸»è¦è² è²¬ç®¡ç†å„å¼å®¹å™¨æ˜ åƒæª”ä»¥åŠè² è²¬è·Ÿ Low-Level Container Runtime ç®¡ç†è·Ÿæºé€šï¼Œæœ¬èº«ä¸è™•ç†å¯¦éš›é‹è¡Œå®¹å™¨çš„äº‹æƒ…ï¼Œä¸€èˆ¬éƒ½æœƒæœ‰ä¸€å€‹ Daemon å’Œ API å¯ä»¥å»ç›£æ§åº•å±¤ç‹€æ…‹ï¼Œè­¬å¦‚èªª OpenShift 4 ä¹‹å¾Œæ‰€ä½¿ç”¨çš„ CRI-O æˆ–è€…æ˜¯æ›´å¤šäººæ¯”è¼ƒçŸ¥é“ Dockerd è·Ÿè¢«æ‹†åˆ†å‡ºä¾†çš„ containerd éƒ½åŒå±¬é€™é¡</p>
<h3 id="_1"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/#_1">æ–‡å¾Œæ„Ÿè¬</a></h3>
<p>æ„Ÿè¬åœ°ç“œã€Davy å…©ä½å¤§å¤§çš„åŠå¤œå”åŠ©å’Œæ¯«ä¸çŸ¥æƒ…ç…§ç‰‡è¢«æˆ‘æ‹¿ä¾†ç”¨çš„ <a href="https://www.hwchiu.com/">hwchiu</a></p>
<h3 id="references"><a class="toclink" href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/#references">References</a></h3>
<ul>
<li><a href="https://www.openshift.com/blog/kubernetes-deep-dive-api-server-part-1">Kubernetes deep dive: API Server - part 1</a></li>
<li><a href="https://medium.com/@michalswi/introduction-to-kubernetes-api-the-way-to-understand-the-concept-of-kubernetes-operators-ed667385caf4">Introduction to Kubernetes API - the way to understand the concept of Kubernetes Operators.</a></li>
<li><a href="https://www.openshift.com/blog/kubernetes-deep-dive-api-server-part-2">Kubernetes Deep Dive: API Server â€“ Part 2</a></li>
<li><a href="https://k8syaml.com/">Kubernetes YAML Generator - Powered by Octopus.</a></li>
<li><a href="https://k8smeetup.github.io/docs/tasks/administer-cluster/access-cluster-api/#%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE-rest-api">é€šè¿‡ Kubernetes API è®¿é—®é›†ç¾¤</a></li>
<li><a href="https://github.com/kubernetes/client-go">kubernetes/client-go</a></li>
<li><a href="https://github.com/kubernetes-client/python">kubernetes-client/python</a></li>
<li><a href="https://www.oreilly.com/library/view/kubernetes-best-practices/9781492056461/ch17.html">Chapter 17. Admission Control and Authorization</a></li>
<li><a href="https://www.openshift.com/blog/kubernetes-deep-dive-api-server-part-2">Kubernetes Deep Dive: API Server â€“ Part 2</a></li>
<li><a href="https://developers.redhat.com/blog/2019/01/15/podman-managing-containers-pods">Podman: Managing pods and containers in a local container runtime</a></li>
<li><a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/">Pod Lifecycle - Kubernetes</a></li>
<li><a href="https://speakerdeck.com/redhatopenshift/whats-new-in-openshift-container-platform-4-dot-6">What's New in OpenShift Container Platform 4.6</a></li>
<li><a href="https://github.com/opencontainers/runtime-spec/blob/master/implementations.md">opencontainers / runtime-spec - implementations.md</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/10/09/kubernetes-api-%E6%9C%8D%E5%8B%99%E5%8F%8A%E8%B7%9F%E5%90%84%E7%B5%84%E4%BB%B6%E7%9A%84%E4%BA%A4%E4%BA%92%E9%97%9C%E4%BF%82/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-08-28 00:00:00">August 28, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="namespace-kubernetes"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/">å¦‚ä½•æ¢åˆ—å‡ºå–®ä¸€ Namespace å…§çš„ Kubernetes è¨ˆç®—è³‡æº?</a></h2>
<p>æœ€è¿‘é€™ä¸€å€‹æœˆå‡ºäº†ä¸€äº›äº‹ï¼Œå°è‡´å¤ªä¹…æ²’å¯«å»¢æ–‡ã€‚æœ€è¿‘æœ‰å€‹éœ€æ±‚éœ€è¦<code>é€†å‘</code>ç ”ç©¶å‡º Red Hat OpenShift 4 åŸç”Ÿå®‰è£å¾Œï¼Œå®ƒé è¨­å®‰è£ä¸€å †çš„ Namespace (åœ¨ OpenShift ç¨±ä½œ Projectï¼Œä½†åœ¨é€™é‚Šå¯ä»¥è¦–ç‚ºä¸€æ¨£)ï¼Œå„è‡ªçš„ CPU / Memory / Storage è³‡æºæ¶ˆè€—å¤šå°‘ï¼Œèº«ç‚ºä¸€ä½è¨ˆç®—è³‡æºç²¾ç®—å¸«ï¼Œæ‰€ä»¥å°±æœ‰äº†ä¸‹é¢é€™ç¯‡çš„ç´€éŒ„</p>
<p>æœ¬æœˆç„¡å¿ƒåŠ›ï¼Œç„¡æ¢—åœ–å‘ˆç¾</p>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#_1">ç‚ºä»€éº¼è¦é€™æ¨£åš?</a></h3>
<p>é€™ä»¶äº‹è·Ÿ Kubernetes è¨ˆç®—è³‡æºä¼°ç®—æœ‰é—œä¿‚ï¼ŒåŸºæ–¼<a href="https://blog.pichuang.com.tw/20200713-bm-and-vm-container-deployment-consideration/#Kubernetes-%E8%B3%87%E6%BA%90%E4%BC%B0%E7%AE%97%E6%96%B9%E5%BC%8F">å‰ä¸€ç¯‡</a>æ‰€æåˆ°çš„ <code>Kubernetes è³‡æºä¼°ç®—æ–¹å¼</code>ï¼Œè‹¥æŠŠå¯¦æ©Ÿæˆ–è™›æ©Ÿçš„å®Œæ•´å¯ç”¨è³‡æºç•¶ä½œä¸€å€‹ç»ç’ƒæ¯ä¾†çœ‹ï¼Œè‹¥æœ‰æœå‹™éœ€è¦ä½¿ç”¨ Kubernetes è¨ˆç®—è³‡æºçš„è©±ï¼Œå‰‡è¦–ç‚ºå¾€ç»ç’ƒæ¯å€’æ°´é€²å»ï¼Œç•¶æ°´ä½æ»¿çš„æ™‚å€™ï¼Œå°±ä»£è¡¨è©²å¯¦æ©Ÿæˆ–è™›æ©Ÿä¸èƒ½åœ¨æ“ºæ”¾å…¶ä»–çš„æœå‹™äº†ï¼Œç•¶æ°´ä½æ¯”è¼ƒä½çš„æ™‚å€™ï¼Œå‰‡ä»£è¡¨å¯ä»¥è¼ƒæœ‰é¤˜è£•æ”¾ç½®å…¶ä»–æœå‹™åœ¨è£¡é¢</p>
<p><img alt="" src="/images/glass.png" /></p>
<h3 id="kubectl-view-allocations"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#kubectl-view-allocations">Kubectl-view-allocations</a></h3>
<p>é€™é‚Šè¦æ¨è–¦ <a href="https://github.com/davidB/kubectl-view-allocations">davidB/kubectl-view-allocations</a> é€™å€‹å°ˆæ¡ˆï¼Œç›¸ç•¶å¥½ç”¨ï¼Œä¹‹å‰é‚„æ²’æ‰¾åˆ°é€™å€‹å°ˆæ¡ˆä¹‹å‰ï¼Œæˆ‘éƒ½æ˜¯ç”¨ <code>jsonpath</code> æ…¢æ…¢çˆ¬ï¼Œä½†æˆ‘è¦ºå¾—ä¸åƒ…æŒ‡ä»¤ç›¸ç•¶é•· (å¦‚ä¸‹æŒ‡ä»¤)ï¼Œè€Œä¸”è¼¸å‡ºçµæœ<a href="https://gist.github.com/pichuang/59c42de25991c516909c4736caa7893d">ä¸æ˜ç¢º</a>ï¼ŒåŠ ä¸Šå¾ˆé›£é–±è®€ï¼Œæ‰€ä»¥æ‰åˆå¦å¤–æ‰¾äº†ä¸€ä¸‹é€™å€‹å°ˆæ¡ˆä¾†ç”¨ç”¨</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>oc<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="o">=</span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{range .items[]}{range .spec.containers[]} {.name} CPU_Requests:{.resources.requests.cpu} CPU_Limites:{.resources.limits.cpu} Memory_Requests:{.resources.requests.memory} Memory_Limites:{.resources.limits.memory} {&#39;\n&#39;}{end}{&#39;\n&#39;}{end}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>column<span class="w"> </span>-t
</code></pre></div>
<h4 id="kubectl-view-allocations_1"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#kubectl-view-allocations_1">è¶…ç°¡å–®å®‰è£ Kubectl-view-allocations</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/davidB/kubectl-view-allocations/master/scripts/getLatest.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>sudo<span class="w"> </span>mv<span class="w"> </span>kubectl-view-allocations<span class="w"> </span>/usr/local/bin
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>kubectl-view-allocations<span class="w"> </span>-V
</code></pre></div>
<h3 id="use-cases"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#use-cases">Use Cases</a></h3>
<h4 id="namespace"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#namespace">æ¢åˆ— Namespace å…§è³‡æº</a></h4>
<p>è­¬å¦‚èªªæˆ‘æƒ³è¦æŸ¥ <code>openshift-etcd</code> è£¡é¢çš„è³‡æºé è¨­æ¶ˆè€—å¦‚ä½•ï¼Œå¯ä»¥ç”¨ä¸‹åˆ—æŒ‡ä»¤è¾¦åˆ°</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>kubectl-view-allocations<span class="w"> </span>-n<span class="w"> </span>openshift-etcd
</code></pre></div>
<p><img alt="" src="/images/show-openshift-etcd.png" /></p>
<h4 id="_2"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#_2">æ¦‚è§€äº†è§£å„ç¯€é»è³‡æº</a></h4>
<p>é¡åŒæ–¼ <code>oc adm top node</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>kubectl-view-allocations<span class="w"> </span>-r<span class="w"> </span>cpu<span class="w"> </span>-g<span class="w"> </span>node
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>kubectl-view-allocations<span class="w"> </span>-r<span class="w"> </span>memory<span class="w"> </span>-g<span class="w"> </span>node
</code></pre></div>
<p><img alt="" src="/images/show-node-cpu-mem.png" /></p>
<h4 id="_3"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#_3">è©³ç´°äº†è§£å„ç¯€é»è³‡æº</a></h4>
<p>ç•¶ä½ æƒ³è¦äº†è§£ä½ çš„ master node ä¸Šé¢åˆ°åº•éƒ½æ”¾äº†ä»€éº¼ç¢—ç³•çš„æ±è¥¿ï¼Œé€™å€‹é‚„è »å¥½ç”¨çš„...</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>kubectl-view-allocations<span class="w"> </span>-r<span class="w"> </span>cpu
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>kubectl-view-allocations<span class="w"> </span>-r<span class="w"> </span>memory
</code></pre></div>
<p><img alt="" src="/images/show-node-memory-details.png" /></p>
<h3 id="appendix"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#appendix">Appendix</a></h3>
<h4 id="environment-information"><a class="toclink" href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/#environment-information">Environment Information</a></h4>
<ul>
<li>Red Hat OpenShift 4.4.0</li>
<li>Kubernetes v1.18.3</li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/08/28/%E5%A6%82%E4%BD%95%E6%A2%9D%E5%88%97%E5%87%BA%E5%96%AE%E4%B8%80-namespace-%E5%85%A7%E7%9A%84-kubernetes-%E8%A8%88%E7%AE%97%E8%B3%87%E6%BA%90/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-07-13 00:00:00">July 13, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="kubernetes"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/">Kubernetes éƒ¨ç½²åœ¨è™›æ©Ÿå¥½é‚„æ˜¯è£¸æ©Ÿå¥½?</a></h2>
<p>é€™å¹¾é€±å¸¸è¢«å•åˆ°ä¸€å€‹å•é¡Œ</p>
<blockquote>
<p>ä»¥æŠ€è¡“è§€é»ä¾†çœ‹ï¼Œè«‹å•å®¹å™¨ (Container) æˆ–è€…æ˜¯å®¹å™¨å¹³å° (Kubernetes) æ¯”è¼ƒé©åˆéƒ¨ç½²åœ¨è™›æ“¬ç’°å¢ƒ (VM) ä¸­é‚„æ˜¯è£¸æ©Ÿç’°å¢ƒä¸­ (Bare Metal)?</p>
</blockquote>
<p><img alt="" src="/images/vm-vs-bm.jpg" /></p>
<p>å…¶å¯¦é€™å€‹å•é¡Œåœ¨åå¹´å‰è™›æ“¬æ©ŸæŠ€è¡“å‰›å‡ºä¾†çš„æ™‚å€™ï¼Œä¹Ÿè »å¤šäººåšéæ¶æ§‹åŠæ€§èƒ½æ¯”è¼ƒï¼Œæ™‚å…‰å¿«è½‰åˆ°ç¾åœ¨çš„å¹´ä»£ï¼Œä¾†åˆ°å®¹å™¨çš„ä¸–ä»£ï¼Œç›¸åŒçš„å•é¡Œä¹Ÿè¢«æ‹¿å‡ºä¾†è¨è«–ï¼Œæœ¬ç¯‡å°±æ˜¯è¦ç‰¹åˆ¥è¬›è¿°ä¸€ä¸‹é—œæ–¼é€™äº›æ¶æ§‹ä¸Šçš„æ¯”è¼ƒåˆ†æã€ä½¿ç”¨å½±éŸ¿åŠå»ºè­°æ¡ç”¨çš„ç­–ç•¥ä½œæ³•å»ºè­°ï¼Œé€™ç¯‡æœƒæ¡ç”¨æ¯”è¼ƒä¸­ç«‹çš„è§’åº¦é—¡è¿°ï¼Œå¦‚æœæœ‰è§€é»å¤ªåé —çš„åœ°æ–¹ï¼Œå¯ä»¥ç§ä¸‹è·Ÿæˆ‘èªªåŠæä¾›ä¿®æ”¹å»ºè­°</p>
<p>ä¸å…ä¿—çš„æˆ‘é‚„æ˜¯è¦ä¾†è¬›ä¸€ä¸‹æœ¬æ¬¡æ–°ç™¼ç¾ï¼Œä¸‰å€‹æ„Ÿè¦ºä¸æœƒåŒæ¡†çš„å…¬å¸ Microsoft + Red Hat + HPE ä¸€èµ·å‡ºäº†æœ¬æ¶æ§‹æ›¸ <a href="https://h20195.www2.hpe.com/V2/GetDocument.aspx?docname=a50001963enw">HPE Reference Architecture for delivering insight across all your data with Microsoft SQL Server 2019 Big Data Clusters</a> æˆ‘è¦ºå¾—å¯¦åœ¨å¤ªç„äº† XD åˆ†äº«çµ¦å¤§å®¶</p>
<!--more-->

<h3 id="4"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#4">4 å€‹å…ˆå‚™å°çŸ¥è­˜</a></h3>
<p>åœ¨è¨è«–æ¶æ§‹ä¸Šçš„å„ªåŠ£ä¹‹å‰ï¼Œè¦å…ˆè·Ÿå„ä½æ¸…æ¥šåœ°è§£é‡‹é€™äº›æ¶æ§‹çš„å¯¦éš›é•·ç›¸æ˜¯æœ‰å“ªä¸€äº›</p>
<h4 id="containers-are-linux"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#containers-are-linux">Containers are Linux</a></h4>
<blockquote>
<p>A linux container is nothing more than a process that runs on Linux</p>
</blockquote>
<p><img alt="" src="/images/container-performance.png" /></p>
<p>ä¸€é–‹å§‹è¦å…ˆå°å®¹å™¨ (Container) é€²è¡Œåè©èªªæ˜ï¼Œå…¶å¯¦é€™å€‹å®¹å™¨é€™å€‹æŠ€è¡“æ²’ä»€éº¼ç‰¹åˆ¥çš„é»‘é­”æ³•ï¼Œä¹Ÿä¸æ˜¯ç›¸ç•¶å‰è¡›çš„æ±è¥¿ï¼ŒæŠ€è¡“æœ¬è³ªä¸Šå°±æ˜¯ä¸€å€‹æˆ–å¤šå€‹ Linux Process çš„å‘ˆç¾ï¼Œæ˜¯çš„ï¼ä½ éå¾€ä½¿ç”¨çš„ chroot / LXC / Jail çš†å±¬é€™é¡ï¼Œæ‰€ä»¥ä½ éå¾€èƒ½å° Linux Process é€²è¡Œä¸€äº›æ·±åº¦æ§åˆ¶çš„æ–¹å¼ï¼Œè­¬å¦‚åƒæ˜¯ secompã€cgroupsã€selinux ç­‰æ“ä½œï¼Œéƒ½èƒ½åœ¨ Container è£¡é¢å‘ˆç¾ï¼Œæ›´ç”šè‡³æ˜¯å¸¸è¦‹çš„ Linux Performance Obsevability Tools æ•ˆèƒ½é‡æ¸¬å·¥å…·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå¯¦å‹™ä¸Šå¯ä»¥åƒè€ƒ <a href="https://github.com/nicolaka/netshoot">nicolaka/netshoot - a Docker + Kubernetes network trouble-shooting swiss-army container</a></p>
<p>åŸºæ–¼ä»¥ä¸Šçš„ç†ç”±ï¼Œæ‰€ä»¥æœ‰æ™‚å€™ä½ æœƒçœ‹åˆ°ä¸‹åˆ—å¹¾ç¨®èªªæ³•</p>
<ul>
<li>Container Security is Linux Security</li>
<li>Container Performance is Linux Performance</li>
<li>Container Reliability is Linux Reliability</li>
</ul>
<p><img alt="" src="/images/linux-arch.png" /></p>
<p>çµè«–å°±æ˜¯ï¼Œä½ çš„å®¹å™¨ç©©ä¸ç©©å®šã€å®‰ä¸å®‰å…¨è·Ÿä½ æ‰€ä½¿ç”¨çš„ä½œæ¥­ç³»çµ±å…¶å¯¦æ˜¯æœ‰ 100% çš„é—œä¿‚</p>
<h4 id="kubernetes-is-a-container-orchestration-platform"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#kubernetes-is-a-container-orchestration-platform">Kubernetes is a Container Orchestration Platform</a></h4>
<p><img alt="" src="/images/k8s-arch.png" /></p>
<blockquote>
<p>Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications.</p>
</blockquote>
<p>å¾ <a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">What is Kubernetes?</a> å¯çŸ¥ï¼Œæ‡‰ç”¨ç¨‹å¼é€éå®¹å™¨éƒ¨ç½²æ–¹å¼æ‰€å¸¶ä¾†çš„å„ªå‹¢ï¼Œå…·å‚™è¼•é‡ç´šè³‡æºéš”é›¢æ–¹å¼ã€å¯å…±ç”¨ä½œæ¥­ç³»çµ±åŠè³‡æºå¯é«˜æ•ˆç‡åŠå¯†é›†ä½¿ç”¨ç­‰çœ¾å¤šå¥½è™•ï¼Œä½†ç•¶æˆ‘çš„ Container æ•¸é‡ä¸€å¤šï¼Œæœå‹™è®Šå¾—æ›´å¤§æ›´å¤šçš„æ™‚å€™ï¼Œèª°èƒ½è² è²¬å¹«é€™äº› Container æ‰¾åˆ°ä¸€å€‹é©åˆçš„åœ°æ–¹é‹è¡Œã€æŒçºŒçš„ç›£æ§åŠæ•…éšœè™•ç†? æ‰€ä»¥é€™æ™‚å€™ä½ æœƒéœ€è¦ä¸€å€‹<code>è² è²¬ç®¡ç†å®¹å™¨é‹è¡Œçš„æ§åˆ¶å¹³å°</code>ï¼Œä¹Ÿå°±æ˜¯ç¾ä»Šæœ€ç†±é–€çš„ Kubernetesã€‚</p>
<p>Kubernetes å®¹å™¨å¹³å°å…§å»ºå¤šç¨®å”åŠ©ç®¡ç†å®¹å™¨çš„æ©Ÿåˆ¶ï¼ŒåŒ…å«ä½†ä¸é™æ–¼ï¼š</p>
<ol>
<li>å…§éƒ¨æœå‹™ç™¼ç¾å’Œè² è¼‰å‡è¡¡</li>
<li>æå‡ºçµ±ä¸€ä¸”æ¨™æº–çš„è²æ˜å¼ (Declarative) APIï¼šé€™é»æ‡‰è©²æ˜¯ Kubernetes èª•ç”Ÿå¾Œï¼Œå°æ–¼æ•´å€‹ IT ç•Œæœ€å¤§çš„å½±éŸ¿äº†ï¼Œæœ‰èˆˆè¶£æƒ³äº†è§£æ›´å¤šçš„å¯ä»¥åƒè€ƒæ­¤æ–‡ <a href="https://yq.aliyun.com/articles/713012">äº‘åŸç”Ÿæ—¶ä»£ï¼Œ Kubernetes å¤šé›†ç¾¤æ¶æ„åˆæ¢</a>ï¼Œé€™ç¯‡çœŸçš„å¯«å¾—ä¸éŒ¯</li>
<li>å…§å»ºè‡ªæˆ‘ä¿®å¾©å®¹å™¨èƒ½åŠ›ï¼šæ‰¿ä¸Šï¼ŒKubernetes ä¸­çš„è²æ˜å¼ API å…¶å¯¦å°±æ˜¯<em>æŒ‡å®šè©²å¢é›†æ‰€æœŸæœ›çš„é‹è¡Œç‹€æ…‹</em>ï¼Œæ‰€ä»¥å‡ºç¾ä»»ä½•ä¸ä¸€è‡´çš„ç‹€æ…‹çš„æ™‚å€™ï¼ŒKubernetes å¯ä»¥è‡ªè¡Œé€éæŒ‡å®šçš„ YAML æ–‡ä»¶æè¿°ï¼Œä¾†é€²è¡Œç‹€æ…‹é·ç§»ï¼Œä½œå‡ºåˆé©æ–¼ç•¶ä¸‹ç’°å¢ƒçš„æ“ä½œ</li>
<li>æ˜“æ–¼è³‡æºæ©«å‘æ“´å……ï¼šä»¥ Kubernetes çš„è§’åº¦é€²è¡Œçš„å®¹å™¨ç·¨æ’ï¼Œå·²ç¶“å°‡ä¸Šå±¤æœå‹™è·Ÿåº•å±¤åŸºç¤è¨­æ–½è„«é›¢æ›é‰¤ï¼ŒIT äººå“¡åƒ…éœ€é—œå¿ƒ Kuerbernets æ‰€æº–å‚™çš„è³‡æºå¤ ä¸å¤ ä¸Šå±¤æœå‹™ä½¿ç”¨ï¼Œé€²è€Œå½¢æˆä¸€å€‹è³‡æºæ±  (Resource Pool) çš„è§€å¿µï¼ŒåŒ…å« CPU Pool / Memory Pool / Storage Pool</li>
<li>å¯è·¨è£¸æ©Ÿã€è™›æ“¬ç’°å¢ƒã€å…¬ç§æœ‰é›²ä¸Šä½¿ç”¨ï¼šå…¶å¯¦é€™å€‹çœŸæ­£çš„ç†ç”±æ˜¯å› ç‚ºä½œæ¥­ç³»çµ±çš„é—œä¿‚ï¼Œå› ç‚º Kubernetes çš„é‹ä½œæ˜¯åŸºæ–¼åœ¨ä½œæ¥­ç³»çµ±ä¹‹ä¸Šï¼Œæ‰€ä»¥åªè¦ç¢ºä¿èƒ½åœ¨ä½œæ¥­ç³»çµ±èƒ½åœ¨ä»»ä¸€ç’°å¢ƒå•Ÿå‹•å³å¯ä½¿ç”¨</li>
</ol>
<p>è€Œè¦è®“ Kubernetes æ§åˆ¶å¹³å°æœ‰é€™äº›èƒ½åŠ›å¿…ç„¶æœƒéœ€è¦å¦å¤–å®‰è£ä¸€äº›æ‰€éœ€è¦çš„è»Ÿé«”ï¼Œè­¬å¦‚èªªæ¯ä¸€å€‹ Worker å¿…ç„¶æœƒéœ€è¦å®‰è£çš„ä½œæ¥­ç³»çµ±ã€kubeletã€CNI ç¶²è·¯å¥—ä»¶ç­‰ä¸€äº›å¸¸é§è»Ÿé«”ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¾†è¬›æœ€çµ‚èƒ½ä¾›æ‡‰ç”¨ç¨‹å¼æ‰€ä½¿ç”¨çš„è³‡æºä¸å…¨ç„¶æ˜¯ç­‰åŒæ–¼å¤–é¢çš„è¦æ ¼ï¼Œæ‰€ä»¥é‡å° Kubernetes å¹³å°å»ºç½®æ‰æœƒæœ‰ä¸€ç¨®è¶¨å‹¢æ˜¯<code>ä½œæ¥­ç³»çµ±ç›¡é‡ç²¾ç°¡åˆ°åƒ…éœ€å¯ä»¥ä¹˜è¼‰å®¹å™¨é‹ä½œå³å¯ï¼Œå…¶ä»–å¤šé¤˜çš„éƒ½å¯ä»¥æ‹¿æ‰ï¼Œä»¥é”åˆ°æœ€å¤§è³‡æºåˆ©ç”¨ç‡</code>ï¼Œé€²è€Œèª•ç”Ÿå„å¼å„æ¨£çš„<code>å®¹å™¨ä½œæ¥­ç³»çµ± (Container OS)</code> ä¾›å¤§å®¶é¸æ“‡ä½¿ç”¨</p>
<p>è‹¥æƒ³è¦äº†è§£ CPU å’Œ Memory çš„è³‡æºé…ç½®æ–¹å¼å¯ä»¥åƒè€ƒåœ–æ–‡ä¸¦èŒ‚çš„ <a href="https://learnk8s.io/allocatable-resources">Allocatable memory and CPU in Kubernetes Nodes - learnk8s</a></p>
<h4 id="container-pod-kubernetes"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#container-pod-kubernetes">Container è·Ÿ Pod è·Ÿ Kubernetes çš„é—œä¿‚</a></h4>
<p><img alt="" src="/images/container-pod-k8s.png" /></p>
<p>é¦–å…ˆæ˜¯ï¼ŒPod è·Ÿ Kubernetes</p>
<blockquote>
<p>Pods are the smallest deployable units in Kubernetes</p>
</blockquote>
<p>åœ¨ Kubernetes çš„ä¸–ç•Œè£¡ï¼Œæœ€å°èª¿åº¦å–®ä½æ˜¯ <code>Pod</code>ï¼Œè€Œä¸æ˜¯ Containerï¼Œé€™é»ç›¸ç•¶é‡è¦ï¼Œæ‰€ä»¥æˆ‘å€‘æ‰€çŸ¥é“çš„è³‡æºèª¿åº¦åŠæ‡‰ç”¨ç¨‹å¼è¤‡è£½ï¼Œå…¨éƒ¨éƒ½æ˜¯ä»¥ Pod ç‚ºè§’åº¦æ€è€ƒè€Œä¸æ˜¯ä»¥å–®ã„§ Container ç‚ºä¸»ï¼Œé‚£æœ‰äººå°±æœƒå•é‚£ Container è·Ÿ Pods çš„é—œä¿‚åˆæ˜¯ä»€éº¼?</p>
<blockquote>
<p>A Pod is a group of one of more containers with shared storage and network</p>
</blockquote>
<p>åœ¨ Kubernetes æ‰€å®šç¾©æœ€å°å–®ä½ <code>Pod</code> ç•¶ä¸­ï¼Œå¯ä»¥<code>å­˜åœ¨ 1 å€‹æˆ–å¤šå€‹</code>çš„ Container é‹è¡Œåœ¨å…¶ä¸­ï¼Œä¸¦ä¸”å…±é€šåˆ†äº«åŒä¸€å€‹ Linux Namespace æ‰€æä¾›çš„è³‡æºï¼Œåªè¦åœ¨åŒä¸€å€‹ Pod è£¡é¢å…§ï¼ŒContainer äº’ç›¸çš„è³‡æºçš†å¯ä»¥è¢«å­˜å–ï¼Œç„¶è€Œé€™äº› Container æ‰æ˜¯å¯¦éš›ä¸ŠåŒ…è£æ‡‰ç”¨ç¨‹å¼å¾Œæ‰€å‘ˆç¾çš„æ¨£æ…‹ï¼Œé‹è¡Œçš„ç’°å¢ƒæ¯«ä¸æ‡·ç–‘åœ°å°±æ˜¯è·‘åœ¨ä½œæ¥­ç³»çµ±ä¸Šé¢</p>
<p>æœ‰äº›äººæœƒå¾ˆå¥½å¥‡ç‚ºä»€éº¼å¾ˆå¤šæ™‚å€™éƒ½æœƒæŠŠ Pod è·Ÿ Container æ··åœ¨ä¸€èµ·æè¿°å‘¢? é€™æ˜¯å› ç‚ºçµ•å¤§éƒ¨åˆ†çš„å¯¦ä½œï¼Œä¸€å€‹ Pod è£¡é¢åƒ…æœƒæ”¾ç½®ä¸€å€‹ Container åœ¨è£¡é¢ï¼Œæ‰€ä»¥æ‰æœƒæœ‰é€™ç¨®éŒ¯è¦ºç”¢ç”Ÿ</p>
<h4 id="kubernetes_1"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#kubernetes_1">Kubernetes è³‡æºä¼°ç®—æ–¹å¼</a></h4>
<p>æ ¹æ“š <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Managing Resources for Containers - Kubernetes</a>ï¼Œä½ æœƒçŸ¥é“å…¶æ‰€å®šç¾©çš„ Resource Type ä¸»è¦æœ‰ä¸‹åˆ—å…©å€‹ï¼š</p>
<ol>
<li>CPU</li>
<li>Memory</li>
</ol>
<blockquote>
<p>One cpu, in Kubernetes, is equivalent to 1 vCPU/Core for cloud providers and 1 hyperthread on bare-metal Intel processors.</p>
</blockquote>
<p>å‰è€… CPU çš„æ›ç®—æ–¹å¼ï¼Œå°±æ˜¯ <code>1 CPU = 1 Core = 1,000 millicores = 1,000m</code>ï¼Œæ˜¯æ¡ç”¨<code>çµ•å°æ•¸é‡</code>ä¾†é€²è¡Œè¨ˆç®—ï¼ŒKubernetes è¦æ±‚ 0.1 Core å°±æ˜¯éœ€è¦å®Œå®Œæ•´æ•´çš„ 0.1 Coreï¼Œç„¡è«–åº•ä¸‹ CPU æ˜¯ Single Coreã€Dual-Coreã€32 Core æ©Ÿå™¨ï¼Œé‚„æ˜¯é€é CPU Overcommitment èª¿æ•´å¾Œï¼Œä¸” Kubernetes è¨ˆç®—è³‡æºæ™‚ä¹Ÿç„¡è¦–æ™‚è„ˆé »ç‡ (clock rate) çš„å·®ç•°ï¼Œä¸‹åˆ—ç‰¹åˆ¥åˆ—èˆ‰å‡ºæ‰€æœ‰è·Ÿ Kubernetes 1 CPU æ‰€ç­‰åƒ¹çš„è³‡æºæ¸…å–®ï¼Œç„¶è€Œä¸€èˆ¬åš CPU è³‡æºè¨ˆç®—çš„æ™‚å€™éƒ½æœƒä»¥ vCPU è§’åº¦é€²è¡Œè¨ˆç®—</p>
<table>
<thead>
<tr>
<th>1 Kubernetes CPU is equivalent to</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Hyperthread on a bare-metal Intel processor with Hyperthreading</td>
</tr>
<tr>
<td>1 vSphere CPU</td>
</tr>
<tr>
<td>1 IBM vCPU</td>
</tr>
<tr>
<td>1 Azure vCore</td>
</tr>
<tr>
<td>1 GCP Core</td>
</tr>
<tr>
<td>1 AWS vCPU</td>
</tr>
<tr>
<td>1 Non-HT CPU</td>
</tr>
</tbody>
</table>
<p>å¾Œè€… Memory çš„è¨ˆç®—æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨äºŒé€²ä½è¡¨ç¤ºæˆ–è€…æ˜¯åé€²ä½è¡¨ç¤ºï¼Œä¾‹å¦‚ä¸‹åˆ— 3 å€‹æ•¸å€¼æ˜¯ç­‰åƒ¹é—œä¿‚ï¼š</p>
<blockquote>
<p>128974848 = 123 Mi (power of 2) = 129 M (power of 10)</p>
</blockquote>
<p>å¦å¤–å®ƒä¹Ÿæ˜¯æ¡ç”¨<code>çµ•å°æ•¸é‡</code>ä¾†é€²è¡Œè¨ˆç®—ï¼Œç„¡è«–ä½ åº•ä¸‹æ˜¯å¯¦é«”è¨˜æ†¶é«”é‚„æ˜¯è™›æ“¬è¨˜æ†¶é«”ï¼Œæˆ–è€…æ˜¯æœ‰ç¶“ VMM å¹³å°æ‰€æä¾›çš„ Memory overcommitment èƒ½åŠ›æ“´å¼µå¾Œçš„æ•¸å­—ï¼Œä¸€èˆ¬å¾ˆå°‘é‡åˆ°é€™é¡å•é¡Œæ˜¯å› ç‚ºå¤§å¤šæ•¸çš„äººçš„è¨˜æ†¶é«”ç”¨æ³•éƒ½æ˜¯ 1:1 é€²è¡Œä½¿ç”¨ï¼Œç„¶è€Œåš Memory è³‡æºè¨ˆç®—çš„æ™‚å€™ï¼Œå»ºè­°éƒ½ä»¥ vRAM è§’åº¦é€²è¡Œè¨ˆç®—</p>
<table>
<thead>
<tr>
<th>1 Kubernetes memory is equivalent to</th>
</tr>
</thead>
<tbody>
<tr>
<td>1 physical RAM</td>
</tr>
<tr>
<td>1 virtual RAM</td>
</tr>
</tbody>
</table>
<h3 id="_1"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_1">å®¹å™¨éƒ¨ç½²åœ¨è™›æ“¬ç’°å¢ƒå¥½é‚„æ˜¯å¯¦é«”ç’°å¢ƒå¥½?</a></h3>
<p>è‹¥ä½ æœ‰èªçœŸæŠŠä¸Šé¢çš„ 4 å€‹å…ˆå‚™å°çŸ¥è­˜çœ‹å®Œä¹‹å¾Œï¼Œç†æ‡‰æœƒæœ‰ä¸‹åˆ—çµè«–</p>
<ol>
<li>å®¹å™¨å¿…ç„¶æœƒé‹è¡Œæ–¼ä½œæ¥­ç³»çµ±ä¹‹ä¸Š</li>
<li>Kubernetes çš„é‹è¡Œæ˜¯å»ºç«‹æ–¼ä½œæ¥­ç³»çµ±ä¹‹ä¸Šï¼Œå…¶æœ¬èº«é‚„æ˜¯éœ€è¦æ¶ˆè€—ä¸€å®šçš„è³‡æºé‹ä½œ</li>
<li>Kubernetes å°æ–¼è³‡æºçš„åˆ©ç”¨æ˜¯ç„¡è¦–è™›æ“¬ç’°å¢ƒã€å¯¦é«”ç’°å¢ƒ</li>
</ol>
<p>é¦–å…ˆå…ˆæŠŠæ‰€æœ‰å¸¸è¦‹ç’°å¢ƒæ¶æ§‹æ“ºåœ¨ä¸€èµ·ï¼ŒåŒ…å«ä¸‹åˆ— 4 ç¨®ï¼š</p>
<p><img alt="" src="/images/4-compare.png" /></p>
<ol>
<li>Bare Metal</li>
<li><code>Container on Bare Metal</code></li>
<li>VM on Bare Metal</li>
<li><code>Container on VM on Bare Metal</code></li>
</ol>
<p>ç•¶ä¸­ 2ã€Container on Bare Metal è·Ÿ 4ã€Container on VM on Bare Metal æ˜¯æœ¬æ–‡éœ€è¦è¨è«–çš„æ¶æ§‹ï¼Œä¸€èˆ¬éœ€è¦è€ƒé‡å®¹å™¨æ˜¯å¦è¦ä¸è¦æ”¾åœ¨è™›æ“¬ç’°å¢ƒå’Œå¯¦é«”ç’°å¢ƒï¼Œæœƒæœ‰ä»¥ä¸‹ 5 å¤§è€ƒé‡é»</p>
<ol>
<li>ç®¡ç†æ€§</li>
<li>è³‡æºéš”é›¢æ€§</li>
<li>é‹ç®—æ•ˆèƒ½</li>
<li>æ˜¯å¦å…·å‚™ç‰¹æ®Šç¡¬é«”</li>
<li>æ•´é«”æ“æœ‰æˆæœ¬</li>
</ol>
<h4 id="_2"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_2">ç®¡ç†æ€§</a></h4>
<p><img alt="" src="/images/pets-cattle.jpeg" /></p>
<p>å¦‚æœä½ æ˜¯è™›æ“¬æ©Ÿç’°å¢ƒä½¿ç”¨ç‚ºä¸»çš„ç¶­é‹äººå“¡ï¼Œå°±è§’åº¦ä¸Šä¾†èªªï¼ŒKubernetes å°±æ˜¯ä¸€ç¾¤ VM æ‰€çµ„æˆçš„ï¼Œæ‰€ä»¥æ—¢æœ‰çš„ VM ç®¡ç†æ–¹å¼æˆ–åŠŸèƒ½é‚„æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè­¬å¦‚èªª Overcommitmentã€Snapshotã€è™›æ“¬ç¶²è·¯å¡æ–°ä¿®åˆªã€Migrationï¼Œä½†é€™äº›åŠŸèƒ½å°æ–¼ Kubernetes æœ¬èº«é‹ä½œä¾†è¬›ä¸¦ä¸æ˜¯å¿…è¦çš„é¸é …ï¼Œæ­¸å±¬æ–¼æŠ€è¡“å¯ä»¥å¯¦ç¾ä½†ä¸¦ä¸æ˜¯å¿…è¦çš„é¡åˆ¥ï¼Œæ¯”è¼ƒå¸¸è¦‹çš„è¨è«–å°±æ˜¯åœ¨ VM Migration èƒ½åŠ›éœ€è¦èˆ‡å¦ï¼Œä»¥ Kubernetes ä¾†è¬›ï¼Œé€éå…§å»ºçš„ Self Healing æˆ–è€…æ˜¯ Node Selector çš„åšæ³•ï¼Œå¯ä»¥è¼•æ˜“çš„è¾¦åˆ°è·¨ç¯€é»é‹è¡Œç›¸åŒç¨‹å¼çš„éœ€æ±‚</p>
<p>å€˜è‹¥æ˜¯ä»¥è£¸æ©Ÿç’°å¢ƒç‚ºä¸»çš„ç¶­é‹äººå“¡ï¼Œå› ç‚ºè£¸æ©Ÿä¸Šé¢ç›´æ¥å¥—ç”¨ä½œæ¥­ç³»çµ±ï¼Œå¯ä»¥ç›¸ç•¶ç„¡è…¦åœ°åŠ å…¥å…¨æ©Ÿè³‡æºè½‰æ›æˆ Worker Node æä¾›çµ¦ Kubernetes åŠ å…¥ç•¶ä¸­çš„è¨ˆç®—è³‡æºæ± å…§ä½¿ç”¨ï¼Œä¸”æ‰€æœ‰ç®¡ç†æ“ä½œçš†ç”± Kubernetes æ§åˆ¶ç¯€é»çµ±ä¸€ç®¡ç†ï¼Œç›¸å°ä¾†èªªæ¸›å°‘äº†æ‰€éœ€ç®¡ç†çš„å±¤æ•¸ï¼Œå¯ä»¥é€éè¼ƒå°‘çš„ç¡¬é«”ä¾†é‹è¡Œç›¸åŒæ•¸é‡çš„å®¹å™¨</p>
<p>çµè«–æ˜¯ï¼Œå¦‚æœä½ æƒ³è¦æ²¿ç”¨æ—¢æœ‰è™›æ“¬ç’°å¢ƒçš„ç®¡ç†å„ªå‹¢ï¼Œè€Œä¸è€ƒæ…®å„ªå…ˆä½¿ç”¨ Kubernetes å…§å»ºç®¡ç†æ©Ÿåˆ¶ï¼Œéƒ¨ç½²å®¹å™¨è‡³è™›æ“¬ç’°å¢ƒæ˜¯æ¯”è¼ƒå¥½çš„é¸æ“‡ï¼›åä¹‹ï¼Œä½ æƒ³è¦å®Œå…¨ä½¿ç”¨ Kubernetes å…§å»ºæ‰€å¸¶ä¾†çš„ç®¡ç†æ©Ÿåˆ¶ï¼Œéƒ¨ç½²å®¹å™¨è‡³è£¸æ©Ÿç’°å¢ƒæ˜¯æœ€ä½³é¸</p>
<h4 id="_3"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_3">è³‡æºéš”é›¢æ€§</a></h4>
<p><img alt="" src="/images/container-vm-isolation.png" /></p>
<p>ç„¡è«–æ˜¯ VM åŠ Container å…¶å¯¦çš†æœ‰æä¾›è³‡æºéš”é›¢èƒ½åŠ›çµ¦æ‡‰ç”¨ç¨‹å¼ï¼Œåªæ˜¯æŠ€è¡“è§’åº¦ä¸ä¸€æ¨£ã€‚</p>
<p>è‹¥æ˜¯ä»¥è£¸æ©Ÿç’°å¢ƒä¾†èªªï¼Œå› ç‚ºæ•´å°æ©Ÿå™¨è³‡æºåŠæ§åˆ¶æ¬Šéƒ½äº¤çµ¦äº† Host OSï¼Œæ‰€ä»¥ä½œæ¥­ç³»çµ±çš„å®‰å…¨æ€§æœƒç›´æ¥å½±éŸ¿åˆ°åº•å±¤ç¡¬é«”çš„å®‰å…¨æ€§èˆ‡å¦ï¼ŒåŒæ™‚å†æ­é…ä¸Š Container æœ¬èº«è‡ªå¸¶çš„è³‡æºéš”é›¢å‘½åç©ºé–“ - Linux Namespaces åŠå…¶ç›¸é—œçš„æ§åˆ¶èƒ½åŠ› seccompã€selinuxã€cgroups ç­‰æä¾› <code>Linux Process ç´šåˆ¥</code>ä¹‹è¼•é‡ç´šè³‡æºéš”é›¢</p>
<p>ä»¥è™›æ“¬ç’°å¢ƒ VMM Type 1 çš„æ¶æ§‹ç‚ºä¸»ï¼Œè™›æ“¬æ©Ÿå…·å‚™å®Œæ•´çš„ä½œæ¥­ç³»çµ±ï¼ŒåŒ…å«è¨˜æ†¶é«”ç®¡ç†å’Œè™›æ“¬è¨­å‚™é©…å‹•ç¨‹å¼ï¼Œä¸»è¦æ–¼<code>è™›æ“¬æ©Ÿç´šåˆ¥</code>æä¾›éš”é›¢èƒ½åŠ›ï¼Œä¸¦ç‚º Guest OS æä¾›æ“¬çœŸè³‡æºï¼Œå¯ä»¥é˜»æ­¢è™›æ“¬æ©ŸåŸ·è¡Œå¯èƒ½æå®³ä¸»æ©Ÿå¹³å°å®Œæ•´æ€§çš„æŒ‡ä»¤ï¼Œé€™ç¨®æ¶æ§‹æƒ³ç•¶ç„¶è€Œæ˜¯å°ä¸»æ©Ÿè³‡æºéœ€è¦æœ‰è¼ƒå¤§çš„è¦æ±‚ï¼Œä¾†é€²è¡Œå…¨è™›æ“¬åŒ–çš„ä¿è­·ï¼ŒåŒæ™‚é–“ä¹Ÿæ¡ç”¨äº† Container æœ¬èº«æ‰€å¸¶ä¾†çš„è³‡æºéš”é›¢èƒ½åŠ›ï¼Œåšåˆ°é›™é‡éš”é›¢</p>
<p><img alt="" src="/images/vm-coontainer.png" /></p>
<p>çµè«–æ˜¯ï¼Œå€˜è‹¥ä½ å–®å°è¨­å‚™æœ‰éœ€è¦è·Ÿåˆ¥çš„å–®ä½å…±ç”¨å·¥ä½œè² è¼‰ä¸”ä½œç‚ºä¸åŒç”¨é€”çš„è©±ï¼Œä¸”ä¸¦éæ˜¯å¯ä»¥é€éè¼•é‡ç´šéš”é›¢èƒ½åŠ›å¯ä»¥è¾¦åˆ°çš„è³‡æºéš”é›¢ï¼Œé‚£ä½¿ç”¨è™›æ“¬ç’°å¢ƒæ˜¯æ¯”è¼ƒå¥½çš„é¸æ“‡ï¼Œåä¹‹ï¼Œä½ æ˜¯å°ˆé–€æƒ³è¦æä¾›æŸå€‹æœå‹™æˆ–æŸå€‹éƒ¨é–€ï¼Œä¸¦æœªæœ‰å…±ç”¨å…¶ä»–å·¥ä½œè¦†è¼‰è­°é¡Œçš„è©±ï¼Œè£¸æ©Ÿç’°å¢ƒåŸºæœ¬ä¸Šæ˜¯æœ€ä½³é¸æ“‡</p>
<h4 id="_4"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_4">é‹ç®—æ•ˆèƒ½</a></h4>
<p><img alt="" src="/images/vm-bm-latency.png" /></p>
<blockquote>
<p>Performance: Native &gt; Container &gt; VM</p>
</blockquote>
<p>å…¶å¯¦é€™å€‹ä¸ç”¨ç‰¹åˆ¥è¨è«–ä¹Ÿå¯ä»¥ç†è§£åˆ°ï¼Œè£¸æ©Ÿæ•´é«”æ•ˆèƒ½æœƒæ¯”è™›æ“¬ç’°å¢ƒå¥½ï¼Œç•¢ç«Ÿè£¸æ©Ÿå…¨éƒ¨çš„è³‡æºéƒ½æ‹¿ä¾†ä½¿ç”¨ï¼Œé‡å°ç¶²è·¯çš„éƒ¨åˆ†ï¼Œé€™ç¯‡æ–‡ç«  <a href="https://www.ctl.io/developers/blog/post/kubernetes-bare-metal-servers">Kubernetes on Bare Metal: When Low Network Latency is Key</a>ï¼Œè¡¨æ˜ Network Latency å·®è·æ˜¯ 3 å€å·¦å³ï¼ŒCPU åˆ©ç”¨ç‡å·®è·å¤§æ¦‚æ˜¯ 10% - 15% å·¦å³</p>
<p>æœ‰äººæœƒå•èªªä¸€èˆ¬çš„ Kubernetes å£“åŠ›æ¸¬è©¦å¹³æ™‚éƒ½æ˜¯åœ¨ä»€éº¼ç’°å¢ƒå£“çš„? ç­”æ¡ˆæ˜¯ä¸»è¦æ˜¯åœ¨ä¸‰å¤§å…¬æœ‰é›²ä¸Šçš„ç’°å¢ƒï¼Œå› ç‚ºè¨ˆç®—è³‡æºå…¬æœ‰é›²éƒ½æº–å‚™å¥½äº†ï¼Œä¸»è¦æ¸¬è©¦ä¹Ÿæœƒä»¥é€™äº›å…¬æœ‰é›²çš„ç’°å¢ƒç‚ºä¸»ï¼Œæœ‰è¶£çš„äº‹æƒ…æ˜¯ä¸‰å¤§é›²æ‰€æä¾›çš„ç’°å¢ƒé›–ç„¶éƒ½æ˜¯ç›¸åŒçš„é‡ç´šçš„ CPU / Memoryï¼Œä½†ç«¯çœ‹æ¸¬è©¦çš„æ™‚å€™æœƒæœ‰æ•ˆèƒ½ä¸Šçš„é¡¯è‘—å·®ç•°</p>
<h4 id="_5"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_5">å…·å‚™ç‰¹æ®Šç¡¬é«”</a></h4>
<p><img alt="" src="/images/pci-passthough.gif" /></p>
<p>å€˜è‹¥ä½ æ˜¯éœ€è¦é‹è¡Œ GPU / SR-IOV NIC æˆ–è€…æ˜¯å…¶ä»–éœ€è¦é«˜æ€§èƒ½é‹ç®—æˆ–å°å¯¦é«”ç¶²å¡æœ‰ç‰¹æ®Šè¦æ±‚çš„ï¼Œå»ºè­°ä¸€å¾‹å°±æ˜¯é¸æ“‡è£¸æ©Ÿéƒ¨ç½²è·¯ç·šäº†ï¼Œé›–ç„¶è™›æ“¬ç’°å¢ƒå¯ä»¥é€é PCI Passthough é€²è¡Œç©¿é€ä½¿ç”¨ï¼Œä½†ç¾è¡Œæ–¼ Kubernetes çš„ä½¿ç”¨ä¸Šå¤§å¤šé‚„æ˜¯ç›´æ¥è£¸æ©Ÿç’°å¢ƒä½¿ç”¨ï¼Œé™¤äº†ç®¡ç†æ–¹ä¾¿ä»¥å¤–ï¼Œå…¶æ¬¡çš„åŸå› æ˜¯é€šå¸¸æœƒè£è¼‰ç‰¹æ®Šç¡¬é«”ï¼Œæ‰€éœ€è¦çš„è¨ˆç®—è³‡æºä¹Ÿæ˜¯ç›¸ç•¶å¤§çš„ï¼Œå¤§éƒ¨åˆ†å¸¸è¦‹æ–¼é†«ç™‚ã€è£½é€ ã€é›»ä¿¡ç­‰å°è¨ˆç®—éœ€æ±‚ç›¸å°å¤§çš„é ˜åŸŸ</p>
<h4 id="tco"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#tco">æ•´é«”æ“æœ‰æˆæœ¬ (TCO)</a></h4>
<p>å¾ <a href="https://climbcsblog.com/2019/03/11/five-reasons-you-should-run-containers-on-bare-metal-not-vms/">Five Reasons You Should Run Containers on Bare Metal, not Virtual Machines</a> å€Ÿåœ–</p>
<p><img alt="" src="/images/tco.png" /></p>
<blockquote>
<p>ä¼ºæœå™¨æ‰€èƒ½æä¾›çš„è³‡æºä¸Šé™å°±æ˜¯å®Œå…¨ä¾æ“šç¡¬é«”è¦æ ¼æ‰€æä¾›çš„ï¼Œä¸¦ä¸æœƒå¤šä¹Ÿä¸æœƒå°‘</p>
</blockquote>
<p>æ–¼è™›æ“¬ç’°å¢ƒä¸­ï¼Œéœ€è¦å…ˆæ‰£é™¤æ‰ Host OS + é‹è¡Œ VMM Hypervisor Type 1 æ‰€éœ€è³‡æº + Guest OS é€™ä¸‰å¤§è¨ˆç®—è³‡æºä¹‹å¾Œï¼Œå‰©ä¸‹çš„æ‰æ˜¯å¯ç”¨è¨ˆç®—è³‡æºï¼ŒæŒ‰ç…§ <a href="https://blogs.vmware.com/apps/files/2019/11/Best-Practices-for-Red-Hat-OpenShift-on-the-VMware-SDDC-Final01.pdf">Best Practices for Red Hat OpenShift on the VMware SDDC - VMware</a> æ‰€è¿°ï¼Œç´„ç•¥æœƒéœ€è¦å…ˆ<code>ä¿ç•™ 15%</code>çš„è³‡æºä¾›è™›æ“¬ç’°å¢ƒå¹³å°ä½¿ç”¨ï¼›è€Œæ–¼è£¸æ©Ÿç’°å¢ƒä¸­ï¼Œå‰‡åƒ…éœ€æ‰£é™¤æ‰ Host OS çš„é‹ä½œè³‡æºå³å¯ï¼Œå¯ä»¥ç”¨æœ€å¤§å¹…åº¦å¯ç”¨è¨ˆç®—è³‡æºå»é‹è¡Œæœå‹™ï¼Œæ­£å¸¸ç‹€æ³ä¹‹ä¸‹ï¼Œæ¯å°ä¼ºæœå™¨èƒ½é‹è¡Œçš„å®¹å™¨æ•¸é‡ï¼Œè£¸æ©Ÿç’°å¢ƒæœƒæ¯”è™›æ“¬ç’°å¢ƒä¾†çš„é‚„è¦é«˜ï¼Œä¹Ÿæ„å‘³è‘—æ›´é«˜çš„åˆ©ç”¨ç‡ã€æ›´ä½çš„åŠŸè€—å’Œæ›´ä½çš„æˆæœ¬ã€è¿‘ä¸€æ­¥é™ä½ç®¡ç†è²»ç”¨</p>
<p>åŸºæ–¼è™›æ“¬ç’°å¢ƒçš„å®¹å™¨éƒ¨ç½²ä¸Šï¼Œæœ€å¤šçš„æˆæœ¬è€ƒæ…®å› ç´ æ˜¯è™›æ“¬åŒ–è»Ÿé«”æ‰€é™„å¸¶çš„æˆæœ¬è²»ç”¨ï¼Œç¨±ä½œ vTAXï¼Œé€šå¸¸éƒ¨ç½²ä¸Šæœƒé€£å¸¶ç”¢ç”Ÿç‚ºæ•¸å¯è§€çš„è²»ç”¨ï¼Œé€²è€Œå¢åŠ ç¸½é«”æ“æœ‰æˆæœ¬</p>
<p>çµè«–æ˜¯ï¼Œå€˜è‹¥ä½ æƒ³è¦æœ‰æœ€é«˜çš„ C/P å€¼çš„è©±ï¼Œåº•å±¤ç¡¬é«”å®Œå…¨æä¾›çµ¦å®¹å™¨é‹è¡Œçš„è©±ï¼Œè£¸æ©Ÿç’°å¢ƒéƒ¨ç½²æ˜¯æœ€ä½³é¸é …ï¼Œå…¶æ¬¡æ‰æ˜¯è™›æ“¬ç’°å¢ƒç‚ºä¸»</p>
<h3 id="_6"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#_6">çµèª</a></h3>
<p>æœ€è¿‘è »å¤šå…¬å¸éƒ½åœ¨æ¨å»£ Kubernetes on Bare Metal çš„æ¶æ§‹ï¼Œä¾†ç²å¾—çš„è³‡æºæœ€å¤§ä½¿ç”¨æ•ˆç‡ã€æœ€ä½ TCOã€æœ€å¥½æ•ˆèƒ½ã€ç®¡ç†å–®ç´”ç­‰å¥½è™•ï¼Œå€˜è‹¥ä»Šå¤©æœ‰è€ƒæ…®è¦å»ºç«‹ä¸€å€‹åŸºæ–¼ Kubernetes ç‚ºä¸»çš„ç§æœ‰é›²æœå‹™ï¼Œé‚£çš„ç¢ºæ˜¯ä¸€å€‹è »å¥½çš„é¸æ“‡ï¼›å€˜è‹¥æ˜¯è¦è·Ÿæ—¢æœ‰çš„ç’°å¢ƒæ··ç”¨æˆ–è€…æ˜¯å› æ—¢æœ‰ç®¡ç†éœ€æ±‚ç­‰å› ç´ ï¼Œå‰‡å¯ä»¥è€ƒæ…®ä»¥ VM ç‚ºä¸»çš„ Kubernetes æœå‹™ï¼›ç•¶ç„¶é‚„æœ‰ä¸€ç¨®é¸æ“‡æ˜¯<code>æ··ç”¨</code>ï¼Œæˆ‘å€‹äººæ˜¯æ¯”è¼ƒæ¨å´‡é€™ç¨®æ¶æ§‹ï¼Œä¾æ“šæƒ…å¢ƒä¸åŒæä¾›ä¸åŒè³‡æºï¼Œç›¡å¯èƒ½çš„æœ‰æ•ˆåˆ©ç”¨å„æ¶æ§‹çš„å„ªå‹¢æˆªé•·è£œçŸ­</p>
<p><img alt="" src="/images/vmware-vs-k8s.png" /></p>
<p>ç¾å¯¦ç”Ÿæ´»ä¸­ï¼Œå¤§éƒ¨åˆ†çš„äººé‚„æ˜¯æœƒè©¢å•èªªï¼ŒVMware è·Ÿ Kubernetes çš„æ¶æ§‹å·®ç•°æ˜¯ä»€éº¼ï¼Œæˆ‘è¦ºå¾— VMware é€™ç¯‡æ¯”è¼ƒæ–‡ç« å¯«å¾—ä¸éŒ¯ <a href="https://blogs.vmware.com/cloudnative/2017/10/25/kubernetes-introduction-vmware-users/">Kubernetes Introduction for VMware Users â€“ Part 1: The Theory</a></p>
<h3 id="references"><a class="toclink" href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/#references">References</a></h3>
<ul>
<li><a href="https://searchservervirtualization.techtarget.com/tip/Bare-metal-vs-VM-container-deployment-considerations">Bare-metal vs. VM container deployment considerations</a></li>
<li><a href="https://climbcsblog.com/2019/03/11/five-reasons-you-should-run-containers-on-bare-metal-not-vms/">Five Reasons You Should Run Containers on Bare Metal, not Virtual Machines</a></li>
<li><a href="https://igene.tw/container-vs-vm#%E4%BD%BF%E7%94%A8%E6%99%82%E6%A9%9F">Container vs VM: When and Why? - Gene</a></li>
<li><a href="https://containerjournal.com/features/better-containers-bare-metal-virtual-machines/">Which is Better for Containers, Bare Metal or Virtual Machines?</a></li>
<li><a href="https://www.scitepress.org/papers/2018/66806/66806.pdf">Comparison Between Bare-metal, Container and VM using Tensorflow Image Classification Benchmarks for Deep Learning Cloud Platform - Paper</a></li>
<li><a href="https://lsalab.cs.nthu.edu.tw/home/publication/CLOSER18.pdf">Comparison Between Bare-metal, Container and VM using Tensorflow Image Classification Benchmarks for Deep Learning Cloud Platform - Slide</a></li>
<li><a href="https://www.openshift.com/blog/containers-are-linux">Containers are Linux</a></li>
<li><a href="https://medium.com/@jessgreb01/what-is-the-difference-between-a-process-a-container-and-a-vm-f36ba0f8a8f7">What is the difference between a process, a container, and a VM?</a></li>
<li><a href="https://github.com/nicolaka/netshoot">nicolaka/netshoot - GitHub</a></li>
<li><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">What is Kubernetes?</a></li>
<li><a href="https://yq.aliyun.com/articles/713012">äº‘åŸç”Ÿæ—¶ä»£ï¼Œ Kubernetes å¤šé›†ç¾¤æ¶æ„åˆæ¢</a></li>
<li><a href="https://blogs.vmware.com/cloudnative/2017/10/25/kubernetes-introduction-vmware-users/">Kubernetes Introduction for VMware Users â€“ Part 1: The Theory</a></li>
<li><a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Managing Resources for Containers - Kubernetes</a></li>
<li><a href="https://learnk8s.io/allocatable-resources">Allocatable memory and CPU in Kubernetes Nodes - learnk8s</a></li>
<li><a href="https://h20195.www2.hpe.com/V2/GetDocument.aspx?docname=a50001963enw">HPE Reference Architecture for delivering insight across all your data with Microsoft SQL Server 2019 Big Data Clusters</a></li>
<li><a href="https://blogs.vmware.com/apps/files/2019/11/Best-Practices-for-Red-Hat-OpenShift-on-the-VMware-SDDC-Final01.pdf">Best Practices for Red Hat OpenShift on the VMware SDDC - VMware</a></li>
<li><a href="https://www.ctl.io/developers/blog/post/kubernetes-bare-metal-servers">Kubernetes on Bare Metal: When Low Network Latency is Key</a></li>
<li><a href="https://www.dellemc.com/resources/en-us/asset/technical-guides-support-information/solutions/h18212-openshift-container-dpg.pdf">Dell EMC Ready Stack for Red Hat OpenShift Container Platform 4.3</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/07/13/kubernetes-%E9%83%A8%E7%BD%B2%E5%9C%A8%E8%99%9B%E6%A9%9F%E5%A5%BD%E9%82%84%E6%98%AF%E8%A3%B8%E6%A9%9F%E5%A5%BD/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-29 00:00:00">May 29, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/openshift/" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-4-etcd"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹äºŒ</a></h2>
<p>æ‰¿è¥²ä¸Šæ–‡ <a href="https://blog.pichuang.com.tw/20200528-openshift-etcd-operator-1/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a>ï¼Œç¹¼çºŒé‡å°ç¡¬ç¢Ÿçš„éƒ¨åˆ†é€²è¡Œèª¿æ•´ï¼Œç•¢ç«Ÿ etcd å°<a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/hardware.md#disks">ç¡¬ç¢Ÿ</a> IOPS ç›¸ç•¶è¦æ±‚ï¼Œå»ºè­°ç”¨ SSD æ¯”è¼ƒå¥½</p>
<p>æ²’æ„å¤–çš„ï¼Œé–‹å ´åˆ†äº«å€‹ <a href="https://www.openshift.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7">Deploying OpenShift 4.4 to VMware vSphere 7</a>ï¼Œæ•´é«”ä¸Šæ¯”è¼ƒé‡è¦çš„æ˜¯åˆ©ç”¨ VMware vSphere 7 è£¡é¢çš„ DRS (Dynamic Resource Scheduler) åŠ NSX-T çš„éƒ¨åˆ†ï¼Œä¹‹å¾Œæœ‰æ©Ÿæœƒå†èªª</p>
<p>{% youtube PdyNQXpYknI %}</p>
<!--more-->

<h3 id="etcd"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#etcd">etcd ç¯€é»ç¡¬ç¢Ÿèª¿æ•™</a></h3>
<blockquote>
<p>ionice: set or get process I/O scheduling class and priority</p>
</blockquote>
<p>é€™é‚Šä½¿ç”¨ <a href="https://www.systutorials.com/docs/linux/man/1-ionice/">ionice (1) - Linux Man Pages</a> ä¾†å®Œæˆé€™ä»¶äº‹ï¼Œå‰›å¥½ CoreOS å…§å»ºæœ‰æ”¯æ´é€™å€‹æŒ‡ä»¤ XDï¼Œå·®é»å°±è¦åŒ…ä¸€å€‹ Container è€Œä¸”è¦è »é«˜çš„æ¬Šé™ (éœ€è¦ root) å»å®šæœŸåŸ·è¡Œäº†</p>
<h4 id="before"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#before">Before</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>pgrep<span class="w"> </span>etcd
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="m">740369</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="m">740441</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>ps<span class="w"> </span>uax<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="m">740369</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>root<span class="w">      </span><span class="m">740369</span><span class="w">  </span><span class="m">7</span>.6<span class="w">  </span><span class="m">8</span>.4<span class="w"> </span><span class="m">9672968</span><span class="w"> </span><span class="m">1382392</span><span class="w"> </span>?<span class="w">     </span>Ssl<span class="w">  </span><span class="m">17</span>:05<span class="w">   </span><span class="m">4</span>:25<span class="w"> </span>etcd<span class="w"> </span>--initial-advertise-peer-urls<span class="o">=</span>https://10.0.97.3:2380<span class="w"> </span>--cert-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.crt<span class="w"> </span>--key-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving/etcd-serving-control-plane-2.key<span class="w"> </span>--trusted-ca-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/configmaps/etcd-serving-ca/ca-bundle.crt<span class="w"> </span>--client-cert-auth<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--peer-cert-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt<span class="w"> </span>--peer-key-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key<span class="w"> </span>--peer-trusted-ca-file<span class="o">=</span>/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt<span class="w"> </span>--peer-client-cert-auth<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--advertise-client-urls<span class="o">=</span>https://10.0.97.3:2379<span class="w"> </span>--listen-client-urls<span class="o">=</span>https://0.0.0.0:2379<span class="w"> </span>--listen-peer-urls<span class="o">=</span>https://0.0.0.0:2380<span class="w"> </span>--listen-metrics-urls<span class="o">=</span>https://0.0.0.0:9978
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>core<span class="w">      </span><span class="m">901685</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">12760</span><span class="w">  </span><span class="m">1076</span><span class="w"> </span>pts/0<span class="w">    </span>S+<span class="w">   </span><span class="m">18</span>:03<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>grep<span class="w"> </span>--color<span class="o">=</span>auto<span class="w"> </span><span class="m">740369</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>ps<span class="w"> </span>uax<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>root<span class="w">      </span><span class="m">740441</span><span class="w">  </span><span class="m">0</span>.9<span class="w">  </span><span class="m">0</span>.1<span class="w"> </span><span class="m">124764</span><span class="w"> </span><span class="m">25288</span><span class="w"> </span>?<span class="w">        </span>Ssl<span class="w">  </span><span class="m">17</span>:05<span class="w">   </span><span class="m">0</span>:32<span class="w"> </span>etcd<span class="w"> </span>grpc-proxy<span class="w"> </span>start<span class="w"> </span>--endpoints<span class="w"> </span>https://10.0.97.3:9978<span class="w"> </span>--metrics-addr<span class="w"> </span>https://0.0.0.0:9979<span class="w"> </span>--listen-addr<span class="w"> </span><span class="m">127</span>.0.0.1:9977<span class="w"> </span>--key<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.key<span class="w"> </span>--key-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.key<span class="w"> </span>--cert<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-peer/etcd-peer-control-plane-2.crt<span class="w"> </span>--cert-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/secrets/etcd-all-serving-metrics/etcd-serving-metrics-control-plane-2.crt<span class="w"> </span>--cacert<span class="w"> </span>/etc/kubernetes/static-pod-certs/configmaps/etcd-peer-client-ca/ca-bundle.crt<span class="w"> </span>--trusted-ca-file<span class="w"> </span>/etc/kubernetes/static-pod-certs/configmaps/etcd-metrics-proxy-serving-ca/ca-bundle.crt
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>core<span class="w">      </span><span class="m">902165</span><span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">0</span>.0<span class="w">  </span><span class="m">12760</span><span class="w">  </span><span class="m">1060</span><span class="w"> </span>pts/0<span class="w">    </span>S+<span class="w">   </span><span class="m">18</span>:03<span class="w">   </span><span class="m">0</span>:00<span class="w"> </span>grep<span class="w"> </span>--color<span class="o">=</span>auto<span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="c1"># Get priority and class</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-p<span class="w"> </span><span class="m">740369</span><span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>none:<span class="w"> </span>prio<span class="w"> </span><span class="m">4</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>none:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<h4 id="tuning"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#tuning">Tuning</a></h4>
<p>æˆ‘å€‘å¯ä»¥ç›´æ¥ç™»å…¥ CoreOS å¾Œä¸‹ <code>ionice</code> å°ç‰¹å®š PID å’Œç¡¬ç¢Ÿè™•ç†æ¬Šé™æ‹‰é«˜ï¼Œå¯ä»¥æ­é… ansible ä¾†é‡å° master node åŸ·è¡Œ</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Set priority and class</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-c2<span class="w"> </span>-n0<span class="w"> </span>-p<span class="w"> </span><span class="sb">`</span>pgrep<span class="w"> </span>etcd<span class="sb">`</span>
</code></pre></div>
  - <code>-c2</code>: best-effort
  - <code>-n0</code>: the highest priority level</p>
<h4 id="after"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#after">After</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>pgrep<span class="w"> </span>etcd
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="m">740369</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="m">740441</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="o">[</span>core@control-plane-2<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>ionice<span class="w"> </span>-p<span class="w"> </span><span class="m">740369</span><span class="w"> </span><span class="m">740441</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>best-effort:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>best-effort:<span class="w"> </span>prio<span class="w"> </span><span class="m">0</span>
</code></pre></div>
<h3 id="_1"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#_1">å¾Œè©±</a></h3>
<p>æ©...åæ­£è£ etcd çš„é‚£å€‹ç¯€é»ä¹‹ç¡¬ç¢Ÿé¸ç”¨é«˜ IOPSï¼Œä¾‹å¦‚ç”¨ SSDï¼Œæ•ˆç‡å’Œç©©å®šæ€§æœƒæå‡ä¸å°‘</p>
<h3 id="references"><a class="toclink" href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/#references">References</a></h3>
<ul>
<li><a href="https://www.systutorials.com/docs/linux/man/1-ionice/">ionice (1) - Linux Man Pages</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/architecture/architecture-rhcos.html">machineconfig</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/111245626">etcd æ€§èƒ½æµ‹è¯•ä¸è°ƒä¼˜</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/nodes/jobs/nodes-pods-daemonsets.html">Running background tasks on nodes automatically with daemonsets</a></li>
<li><a href="https://rancher.com/docs/rancher/v2.x/en/installation/options/etcd/">Tuning etcd for Large Installations - Rancher</a></li>
<li><a href="https://blog.pichuang.com.tw/20200528-openshift-etcd-operator-1/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/op-guide/hardware.md#disks">etcd - hardware</a></li>
<li><a href="https://www.openshift.com/blog/deploying-openshift-4.4-to-vmware-vsphere-7">Deploying OpenShift 4.4 to VMware vSphere 7</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/05/29/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%BA%8C/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-28 00:00:00">May 28, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/openshift/" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-4-etcd"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/">Red Hat OpenShift 4 çš„ etcd ä¹‹å¹¾å€‹ä½ æ‡‰è©²è¦çŸ¥é“çš„äº‹ä¹‹ä¸€</a></h2>
<p>æ‰“å¾ OpenShift 4 ä¹‹å¾Œï¼Œetcd çš„å®‰è£è®Šæˆæ˜¯é€é <code>etcd-operator</code> ä¾†é€²è¡Œå®‰è£çš„ï¼Œé è¨­ç‹€æ³ä¸‹ä¸€æ¬¡æœƒå»ºç«‹ 3 å€‹ etcd instancesï¼Œç„¶å¾ŒæŠŠä»–å€‘å¼„æˆä¸€å€‹ etcd clusterï¼Œæœ¬æ–‡æœƒè¨˜éŒ„ä¸€äº›é—œæ–¼ OpenShift è·Ÿ etcd ä¹‹é–“çš„ä¸€äº›æ“ä½œè¨˜éŒ„</p>
<p><img alt="" src="/images/etcd-operator-overview.png" /></p>
<!--more-->

<h3 id="oc-etcd"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#oc-etcd">é€é oc æª¢æŸ¥ etcd ç‹€æ…‹</a></h3>
<p>æ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œæ­£å¸¸ç‹€æ…‹ä¸‹ä¸€å®šæ˜¯è¦å¥½çš„ï¼Œå®ƒçš„ç©©å®šæ€§æœƒç›´æ¥é—œè¯åˆ° etcd å¢é›†çš„ç©©å®šæ€§ï¼Œå…©é»ä¹‹é–“å»ºè­°é ˆä½æ–¼ <code>&gt;100ms</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>openshift-etcd<span class="w"> </span>-o<span class="w"> </span>wide<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>etcd
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>etcd-control-plane-0<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.1<span class="w">     </span>control-plane-0<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>etcd-control-plane-1<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.2<span class="w">     </span>control-plane-1<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>etcd-control-plane-2<span class="w">                </span><span class="m">3</span>/3<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>2d3h<span class="w">   </span><span class="m">10</span>.0.97.3<span class="w">     </span>control-plane-2<span class="w">   </span>&lt;none&gt;<span class="w">           </span>&lt;none&gt;
</code></pre></div>
<h3 id="etcd"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcd">æª¢æŸ¥ etcd å¢é›†ç‹€æ…‹</a></h3>
<p>æ¡ç”¨è·Ÿå‰ä¸€ç¯‡ä»‹ç´¹çš„æ–¹æ³• <a href="https://blog.pichuang.com.tw/20200521-openshift-with-coreos-part-7/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a> é€²è¡Œ <code>etcdctl</code> çš„åŸºç¤æ“ä½œ</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-n<span class="w"> </span>openshift-etcd<span class="w"> </span>etcd-control-plane-0
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>Defaulting<span class="w"> </span>container<span class="w"> </span>name<span class="w"> </span>to<span class="w"> </span>etcdctl.
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>Use<span class="w"> </span><span class="s1">&#39;oc describe pod/etcd-control-plane-0 -n openshift-etcd&#39;</span><span class="w"> </span>to<span class="w"> </span>see<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>containers<span class="w"> </span><span class="k">in</span><span class="w"> </span>this<span class="w"> </span>pod.
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>version
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>etcdctl<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3.18
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>API<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>endpoint<span class="w"> </span>status<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="p">|</span><span class="w">        </span>ENDPOINT<span class="w">        </span><span class="p">|</span><span class="w">        </span>ID<span class="w">        </span><span class="p">|</span><span class="w"> </span>VERSION<span class="w"> </span><span class="p">|</span><span class="w"> </span>DB<span class="w"> </span>SIZE<span class="w"> </span><span class="p">|</span><span class="w"> </span>IS<span class="w"> </span>LEADER<span class="w"> </span><span class="p">|</span><span class="w"> </span>RAFT<span class="w"> </span>TERM<span class="w"> </span><span class="p">|</span><span class="w"> </span>RAFT<span class="w"> </span>INDEX<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>8e7cdeadd4c04bd3<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">      </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>65124c220e1d1efa<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="nb">false</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span><span class="w"> </span>23675b8f347a5bea<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">3</span>.3.18<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">168</span><span class="w"> </span>MB<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="nb">false</span><span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="m">109</span><span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">35522525</span><span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>+------------------------+------------------+---------+---------+-----------+-----------+------------+
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>endpoint<span class="w"> </span>health<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="p">|</span><span class="w">        </span>ENDPOINT<span class="w">        </span><span class="p">|</span><span class="w"> </span>HEALTH<span class="w"> </span><span class="p">|</span><span class="w">    </span>TOOK<span class="w">     </span><span class="p">|</span><span class="w"> </span>ERROR<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">12</span>.52718ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">16</span>.830977ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="nb">true</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">21</span>.484222ms<span class="w"> </span><span class="p">|</span><span class="w">       </span><span class="p">|</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>+------------------------+--------+-------------+-------+
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>member<span class="w"> </span>list<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>+------------------+---------+-----------------+------------------------+------------------------+
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="p">|</span><span class="w">        </span>ID<span class="w">        </span><span class="p">|</span><span class="w"> </span>STATUS<span class="w">  </span><span class="p">|</span><span class="w">      </span>NAME<span class="w">       </span><span class="p">|</span><span class="w">       </span>PEER<span class="w"> </span>ADDRS<span class="w">       </span><span class="p">|</span><span class="w">      </span>CLIENT<span class="w"> </span>ADDRS<span class="w">      </span><span class="p">|</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>+------------------+---------+-----------------+------------------------+------------------------+
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="p">|</span><span class="w"> </span>23675b8f347a5bea<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-2<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.3:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="p">|</span><span class="w"> </span>65124c220e1d1efa<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.2:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="p">|</span><span class="w"> </span>8e7cdeadd4c04bd3<span class="w"> </span><span class="p">|</span><span class="w"> </span>started<span class="w"> </span><span class="p">|</span><span class="w"> </span>control-plane-0<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2380<span class="w"> </span><span class="p">|</span><span class="w"> </span>https://10.0.97.1:2379<span class="w"> </span><span class="p">|</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a>+------------------+---------+-----------------+------------------------+------------------------+
</code></pre></div>
<h3 id="etcdctl"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcdctl">ä½¿ç”¨ etcdctl åŸç”Ÿæ•ˆèƒ½æª¢æŸ¥</a></h3>
<p>æ‰¿ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ etcdctl åšä¸€å€‹ 60 ç§’çš„æª¢æ¸¬ï¼Œ
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>sh-4.2#<span class="w"> </span>etcdctl<span class="w"> </span>check<span class="w"> </span>perf<span class="w"> </span>-w<span class="w"> </span>table
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w"> </span><span class="m">60</span><span class="w"> </span>/<span class="w"> </span><span class="m">60</span><span class="w"> </span>Boooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo!<span class="w"> </span><span class="m">100</span>.00%1m0s
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>PASS:<span class="w"> </span>Throughput<span class="w"> </span>is<span class="w"> </span><span class="m">150</span><span class="w"> </span>writes/s
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>PASS:<span class="w"> </span>Slowest<span class="w"> </span>request<span class="w"> </span>took<span class="w"> </span><span class="m">0</span>.134647s
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>PASS:<span class="w"> </span>Stddev<span class="w"> </span>is<span class="w"> </span><span class="m">0</span>.003738s
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>PASS
</code></pre></div></p>
<h3 id="_1"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#_1">é—œæ–¼é è¨­åƒæ•¸</a></h3>
<p>é€é <code>oc describe pod/etcd-control-plane-0 -n openshift-etcd</code> å¯çŸ¥ï¼Œ</p>
<ol>
<li>ETCD é¸èˆ‰è¶…æ™‚é è¨­æ™‚é–“ (ETCD_ELECTION_TIMEOUT): 1000ms</li>
<li>ETCD å¿ƒè·³é–“éš”é è¨­æ™‚é–“ (ETCD_HEARTBEAT_INTERVAL): 100ms</li>
</ol>
<p>etcd çš„åˆ†æ•£å¼ä¸€è‡´æ€§å”å®šä»°è³´ä¸Šè¿° 2 å€‹åƒæ•¸ä¾†ä¿è­‰ç¯€é»ä¹‹é–“èƒ½å¤ åœ¨éƒ¨åˆ†ç¯€é»æ–·ç·šçš„ç‹€æ³ä¸‹ä¾ç„¶èƒ½å¤ æ­£ç¢ºè™•ç† Leader Node çš„é¸èˆ‰ã€‚</p>
<p>ä¾æ“š <a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a> åŠå€‹äººç¶“é©—å¯çŸ¥ï¼Œ<code>ETCD_HEARTBEAT_INTERVAL</code>ï¼Œå³ç”± Leader ç¯€é»é€šçŸ¥å…¶ä»–ç¯€é» <code>å®ƒé‚„æ˜¯ Leader</code> çš„é »ç‡ï¼Œå»ºè­°è¨­å®šç‚º 2 å€‹ç¯€é»ä¹‹é–“ RTT æœ€å¤§å€¼æ™‚é–“ * 1 ~ 1.5 å€ï¼Œè‹¥è©²å€¼è¨­å®šå¤ªçŸ­ï¼Œetcd æœƒç™¼é€ç„¡ç”¨çš„å¿ƒè·³ç¢ºèªè¨Šæ¯ï¼Œåè€Œå¢åŠ  CPU / Network / Disk ç„¡è¬‚çš„è³‡æºæ¶ˆè€—ï¼›è‹¥è©²å€¼è¨­å®šå¤ªé•·ï¼Œå°±æœƒå°è‡´ç›£æ§ç¯€é»ç•°å¸¸æ™‚é–“éé•·ï¼Œæœƒæœ‰é‡æ–°é¸èˆ‰çš„äº‹æƒ…ç™¼ç”Ÿã€‚åˆ¤æ–· RTT çš„æœ€ç°¡å–®æ–¹å¼å°±æ˜¯ä½¿ç”¨ pingï¼Œå¦‚ä¸‹</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># ç™»å…¥ç¯€é»</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>node/control-plane-0
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Starting<span class="w"> </span>pod/control-plane-0-debug<span class="w"> </span>...
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>To<span class="w"> </span>use<span class="w"> </span>host<span class="w"> </span>binaries,<span class="w"> </span>run<span class="w"> </span><span class="sb">`</span>chroot<span class="w"> </span>/host<span class="sb">`</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.0.97.1
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>sh-4.2#<span class="w"> </span>chroot<span class="w"> </span>/host
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>sh-4.4#<span class="w"> </span>ping<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span>-c60
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>PING<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span><span class="o">(</span><span class="m">10</span>.0.97.5<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.191<span class="w"> </span>ms
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.151<span class="w"> </span>ms
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.213<span class="w"> </span>ms
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>...omit...
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">59</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.142<span class="w"> </span>ms
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.5:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">60</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.204<span class="w"> </span>ms
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>---<span class="w"> </span><span class="m">10</span>.0.97.5<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="m">60</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">60</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>59000ms
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.112/0.212/0.435/0.054<span class="w"> </span>ms
</code></pre></div>
<p>å¦‚ä¸Šé¢æ•¸å­—è¡¨ç¾ï¼ŒRTT æ¸¬è©¦å‡ºä¾†æ˜¯ <code>0.435ms</code>ï¼Œé ä½æ–¼é è¨­å€¼ <code>100ms</code>ï¼Œæ‰€ä»¥å°±ä¸ç”¨ç‰¹åˆ¥æ”¹</p>
<p><code>ETCD_ELECTION_TIMEOUT</code>ï¼Œå‰‡æ˜¯è¡¨ç¤ºå¦‚æœç¯€é»ç­‰å¾…å¤šä¹…æ²’æ”¶åˆ° Leader çš„å¿ƒè·³ç¢ºèªçš„è©±ï¼Œå°±æœƒé–‹å§‹å˜—è©¦å»ç«¶é¸ Leader çš„ä½å­ï¼Œå»ºè­°è¨­å®šç‚º 2 å€‹ç¯€é»ä¹‹é–“ RTT æœ€å¤§å€¼æ™‚é–“ * 10ï¼Œä»¥æ‡‰å°ç¶²è·¯è®ŠåŒ–ï¼Œæ•…å¦‚æœåŸæœ‰ RTT ç‚º 100ms çš„è©±ï¼Œå‰‡é¸èˆ‰è¶…æ™‚è¨­å®šå‰‡ç‚º 1000msã€‚</p>
<p>å¦å¤–é¸èˆ‰è¶…æ™‚å»ºè­°ä¸Šé™å€¼ç‚º 50,000 msï¼Œå¿ƒè·³é–“éš”ä¸Šé™å€¼ç‚º 5,000 ms</p>
<h3 id="etcd-database"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#etcd-database">å‚™ä»½ etcd database</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>$<span class="w"> </span>ssh<span class="w"> </span>core@control-plane-1<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa_ocp4_vcenter.pub
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>Last<span class="w"> </span>login:<span class="w"> </span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">16</span>:49:17<span class="w"> </span><span class="m">2020</span><span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.0.97.100
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="c1"># Backup</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>/usr/local/bin/cluster-backup.sh<span class="w"> </span>./assets/backup
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>385e44c057e47b6fe0b02d534dc4cb452056d33f9174271d1ecced45bc317e50
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>etcdctl<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3.18
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>API<span class="w"> </span>version:<span class="w"> </span><span class="m">3</span>.3
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-apiserver-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-apiserver-pod-131
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-controller-manager-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-controller-manager-pod-13
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>found<span class="w"> </span>latest<span class="w"> </span>kube-scheduler-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/kube-scheduler-pod-17
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>found<span class="w"> </span>latest<span class="w"> </span>etcd-pod:<span class="w"> </span>/etc/kubernetes/static-pod-resources/etcd-pod-139
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>Snapshot<span class="w"> </span>saved<span class="w"> </span>at<span class="w"> </span>./assets/backup/snapshot_2020-05-27_165016.db
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>snapshot<span class="w"> </span>db<span class="w"> </span>and<span class="w"> </span>kube<span class="w"> </span>resources<span class="w"> </span>are<span class="w"> </span>successfully<span class="w"> </span>saved<span class="w"> </span>to<span class="w"> </span>./assets/backup
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="c1"># Check</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./assets/backup/
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>backup<span class="o">]</span>$<span class="w"> </span>ls
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>snapshot_2020-05-27_165016.db<span class="w">  </span>static_kuberesources_2020-05-27_165016.tar.gz
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="c1"># Copy to outside</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="o">[</span>core@control-plane-1<span class="w"> </span>backup<span class="o">]</span>$<span class="w"> </span>scp<span class="w"> </span>snapshot_2020-05-27_165016.db<span class="w"> </span>static_kuberesources_2020-05-27_165016.tar.gz<span class="w"> </span>root@bastion.ocp4.internal:~/
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>snapshot_2020-05-27_165016.db<span class="w">                                                                                                             </span><span class="m">100</span>%<span class="w">  </span>171MB<span class="w"> </span><span class="m">135</span>.1MB/s<span class="w">   </span><span class="m">00</span>:01
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>static_kuberesources_2020-05-27_165016.tar.gz<span class="w">                                                                                             </span><span class="m">100</span>%<span class="w">   </span>64KB<span class="w">  </span><span class="m">56</span>.1MB/s<span class="w">   </span><span class="m">00</span>:00
</code></pre></div>
<p>æœ‰åœ–æœ‰çœŸç›¸</p>
<p><img alt="" src="/images/etcd-backup.png" /></p>
<h3 id="_2"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#_2">å¾Œè©±</a></h3>
<p>ä¸‹å›å¾…çºŒ</p>
<h3 id="references"><a class="toclink" href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/#references">References</a></h3>
<ul>
<li><a href="https://blog.pichuang.com.tw/20200521-openshift-with-coreos-part-7/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a></li>
<li><a href="https://www.huweihuang.com/kubernetes-notes/etcd/etcdctl-v3.html">etcdctl å¸¸ç”¨å‘½ä»¤</a></li>
<li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/tuning.md">etcd - tuning</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/backup_and_restore/backing-up-etcd.html">Backing up etcd</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.4/backup_and_restore/replacing-unhealthy-etcd-member.html#restore-replace-stopped-etcd-member_replacing-unhealthy-etcd-member">Replacing an unhealthy etcd member</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/05/28/red-hat-openshift-4-%E7%9A%84-etcd-%E4%B9%8B%E5%B9%BE%E5%80%8B%E4%BD%A0%E6%87%89%E8%A9%B2%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E4%BA%8B%E4%B9%8B%E4%B8%80/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-21 00:00:00">May 21, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/openshift/" class="md-meta__link">openshift</a></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-pod-container"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/">Red Hat OpenShift Pod èˆ‡ Container çš„æ„›æ¨æƒ…ä»‡</a></h2>
<p>é€™å¹¾å¤©æœ‰ä½å®¢æˆ¶å•äº†ä¸€å€‹å¾ˆä¸éŒ¯çš„å•é¡Œ</p>
<blockquote>
<p>å¦‚æœåœ¨ 1 å€‹ Pod è£¡é¢ï¼Œæœ‰ 2 å€‹ Containers çš„ç‹€æ³ä¸‹ï¼ŒOpenShift è©²å¦‚ä½•é‡å°ç‰¹å®šçš„ Container é€²è¡Œæ“ä½œ?</p>
</blockquote>
<p>æŒ‰ç…§ Kuberentes çš„è¨­è¨ˆï¼ŒKubernetes æœ€å°å–®ä½æ˜¯ Podï¼Œè€Œä¸æ˜¯ Containerï¼Œç„¶è€Œ 1 å€‹ Podï¼Œå¯ä»¥æœ‰ 1 å€‹æˆ–å¤šå€‹çš„ Container è¢«åŒ…å«åœ¨è£¡é¢ï¼Œåœ–ç¤ºå¯ä»¥åƒè€ƒ <a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking?slide=6">20190817 Container Bare Metal for Networking</a>ï¼Œä½†å¯¦éš›ä¸Šé‡åˆ°å¤šå€‹ Container è¢«åŒ…å«åœ¨ 1 å€‹ Pods çš„æ™‚å€™ï¼Œåœ¨ OpenShift è£¡é¢æ˜¯æ€éº¼æ“ä½œçš„å‘¢? ç§‰æŒè‘—æœ¬äººéµå¾ªå®¢æˆ¶é©…å‹•æœå‹™ (Customer Driven Service)ï¼Œç‰¹åˆ¥å¯«ä¸€ç¯‡è¨˜éŒ„</p>
<p>å› ç‚ºæœ€è¿‘å¤ªç´¯ï¼Œæ‡¶å¾—æƒ³æ¢—åœ–ï¼Œæ‰€ä»¥é™„ä¸Šä¸€å€‹è¿‘æœŸæˆ‘è¦ºå¾—ç›¸ç•¶ä¸éŒ¯çš„ Demoï¼Œåœ¨ OpenShift è£¡é¢é–‹ Windows Server 2019 èµ·ä¾†åšä½¿ç”¨</p>
<p>{% youtube Kx110kqoHo0 %}</p>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#_1">èµ°é¦¬çœ‹èŠ±ä¹‹æ—…: ç¬¬ä¸ƒå¤©</a></h3>
<h4 id="pods-container"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#pods-container">é¡¯ç¤ºä¸€å€‹ Pods è£¡é¢æ‰€åŒ…å«çš„ Container</a></h4>
<p>é è¨­ç‹€æ³ä¸‹ï¼Œå…¶å¯¦å…§å»ºçš„ <code>api-resources</code> ä¸¦æ²’æœ‰åŒ…å«ä¸€å€‹é¡å‹æ˜¯ <code>container</code>ï¼Œæ‰€ä»¥å¦‚æœè¦çŸ¥é“ä¸€å€‹ Pod è£¡é¢æœ‰åŒ…å«å¤šå°‘å€‹ Container èƒ½ç”¨ä¸‹åˆ— 2 å€‹æ–¹å¼æ‰¾</p>
<ol>
<li>
<p>é€é oc æŒ‡ä»¤ filter å‡ºä¾†
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># å…ˆç²å¾—åˆ° Pod æ¸…å–®ï¼Œé€™é‚Šé¸æ“‡ productpage-v1-597b74b4c-x2pgk</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>NAME<span class="w">                             </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>details-v1-6657b8bdf-mm4r4<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>productpage-v1-597b74b4c-x2pgk<span class="w">   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>ratings-v1-66cddbfb8f-wvpbz<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>reviews-v1-6788566f98-slm9q<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>reviews-v2-7c4bffdcc4-6wmg2<span class="w">      </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>reviews-v3-69b6d8786-rbhw5<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>34m
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="c1"># oc get pods &lt;PDO NAME&gt; -o jsonpath=&#39;{.spec.containers[*].name}&#39;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>productpage-v1-597b74b4c-x2pgk<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.containers[*].name}&#39;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>productpage<span class="w"> </span>istio-proxy
</code></pre></div></p>
</li>
<li>
<p>é€é OpenShift Web Console</p>
</li>
</ol>
<p>é€™å€‹åšæ³•æ˜¯ç›´æ¥é€éç›¸ç•¶å¥½ç”¨çš„ Web Console ç›´æ¥è§€å¯Ÿï¼Œç›´è§€æ–¹ä¾¿</p>
<p><img alt="" src="/images/show-containes.png" /></p>
<h4 id="container"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#container">ç™»å…¥å…¶ä¸­ä¸€å€‹ Container è£¡é¢</a></h4>
<p>ä¸€æ¨£ä¹Ÿæ˜¯ 2 ç¨®æ–¹å¼</p>
<ol>
<li>é€é oc rsh æŒ‡ä»¤</li>
</ol>
<p>Red Hat OpenShift æœ‰ä¸€å€‹å…§å»ºçš„æŒ‡ä»¤å¯ä»¥åšåˆ° - <code>oc rsh</code></p>
<blockquote>
<p>oc rsh = Open a remote shell session to a container</p>
</blockquote>
<p>ä¸€èˆ¬ç‹€æ³ä¸‹ï¼Œ<code>oc rsh &lt;PDO NAME&gt;</code> éƒ½æ˜¯ç›´æ¥é€£åˆ°<code>ç¬¬ä¸€å€‹</code> Containerï¼Œå¦‚æœè¦é¸æ“‡è£¡é¢çš„ç¬¬äºŒå€‹ï¼Œæ›´ç”šè‡³æ˜¯ç¬¬ä¸‰å€‹çš„å®¹å™¨ï¼Œå‰‡éœ€è¦ç‰¹åˆ¥å¤šä¸€å€‹ <code>--container</code> æŒ‡å®šï¼Œæ›´å¤šå…§å®¹å¯ä»¥ç›´æ¥åƒè€ƒ <code>oc rsh -h</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># Open a shell session on the container named &#39;index&#39; inside a pod</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="c1"># oc rsh -c &lt;CONTAINER NAME&gt; pod/&lt;PDO NAME&gt;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-c<span class="w"> </span>istio-proxy<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>sh-4.4$<span class="w"> </span>ls
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>bin<span class="w">   </span>dev<span class="w">  </span>home<span class="w">  </span>lib64<span class="w">       </span>media<span class="w">  </span>opt<span class="w">   </span>root<span class="w">  </span>sbin<span class="w">  </span>sys<span class="w">  </span>usr
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>boot<span class="w">  </span>etc<span class="w">  </span>lib<span class="w">   </span>lost+found<span class="w">  </span>mnt<span class="w">    </span>proc<span class="w">  </span>run<span class="w">   </span>srv<span class="w">   </span>tmp<span class="w">  </span>var
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>-c<span class="w"> </span>productpage<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>$<span class="w"> </span>ls
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>__pycache__<span class="w">       </span>productpage.py<span class="w">    </span>static<span class="w">      </span>stdout.log<span class="w">  </span>test_productpage.py
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>microservice.log<span class="w">  </span>requirements.txt<span class="w">  </span>stderr.log<span class="w">  </span>templates
</code></pre></div>
<p>å¥½æˆ‘çŸ¥é“å„ä½ä¸€å®šçœ‹ä¸æ‡‚ï¼Œä¸‹é¢æœ‰æˆªåœ–</p>
<p><img alt="" src="/images/rsh-container.png" /></p>
<ol>
<li>é€é OpenShift Web Console</li>
</ol>
<p>ç›¸ç•¶ç›´è§€å°±æ˜¯ç›´æ¥å° Web Console æ“ä½œï¼Œå¦‚ä¸‹åœ–ç¤ºè¡¨ç¾</p>
<p><img alt="" src="/images/terminal-container.gif" /></p>
<h4 id="container_1"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#container_1">é‡å°å…¶ä¸­ä¸€å€‹ Container é™¤éŒ¯</a></h4>
<p>åªæœ‰ä¸€å€‹ä½œæ³•ï¼Œé€é Red Hat OpenShift å…§å»ºçš„æŒ‡ä»¤ - <code>oc debug</code></p>
<blockquote>
<p>oc debug = Launch a command shell to debug a running application</p>
</blockquote>
<p>ä¸€èˆ¬ç‹€æ³ä¸‹ï¼Œå¦‚åŒ <code>oc rsh</code>ï¼Œä½¿ç”¨ <code>oc debug</code> æ™‚ï¼Œéƒ½æ˜¯ç›´æ¥é€£åˆ°<code>ç¬¬ä¸€å€‹</code> Containerï¼Œå¦‚æœè¦é¸æ“‡è£¡é¢çš„ç¬¬äºŒå€‹ï¼Œæ›´ç”šè‡³æ˜¯ç¬¬ä¸‰å€‹çš„å®¹å™¨ï¼Œå‰‡éœ€è¦ç‰¹åˆ¥å¤šä¸€å€‹ <code>--container</code> æŒ‡å®šï¼Œæ›´å¤šå…§å®¹å¯ä»¥ç›´æ¥åƒè€ƒ <code>oc debug -h</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>-c<span class="w"> </span>istio-proxy<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Starting<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk-debug<span class="w"> </span>...
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.128.2.27
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>sh-4.4$<span class="w"> </span>ls
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>bin<span class="w">   </span>dev<span class="w">  </span>home<span class="w">  </span>lib64<span class="w">       </span>media<span class="w">  </span>opt<span class="w">   </span>root<span class="w">  </span>sbin<span class="w">  </span>sys<span class="w">  </span>usr
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>boot<span class="w">  </span>etc<span class="w">  </span>lib<span class="w">   </span>lost+found<span class="w">  </span>mnt<span class="w">    </span>proc<span class="w">  </span>run<span class="w">   </span>srv<span class="w">   </span>tmp<span class="w">  </span>var
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>sh-4.4$
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>$<span class="w"> </span>oc<span class="w"> </span>debug<span class="w"> </span>-c<span class="w"> </span>productpage<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>Starting<span class="w"> </span>pod/productpage-v1-597b74b4c-x2pgk-debug<span class="w"> </span>...
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>Pod<span class="w"> </span>IP:<span class="w"> </span><span class="m">10</span>.128.2.28
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>If<span class="w"> </span>you<span class="w"> </span>dont<span class="w"> </span>see<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span>prompt,<span class="w"> </span>try<span class="w"> </span>pressing<span class="w"> </span>enter.
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>$<span class="w"> </span>ls
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>__pycache__<span class="w">       </span>productpage.py<span class="w">    </span>static<span class="w">     </span>test_productpage.py
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>microservice.log<span class="w">  </span>requirements.txt<span class="w">  </span>templates
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>$
</code></pre></div>
<p>ä¸€æ¨£æˆ‘çŸ¥é“å„ä½é‚„æ˜¯çœ‹ä¸æ‡‚ï¼Œæˆªåœ–å¦‚ä¸‹</p>
<p><img alt="" src="/images/debug-container.png" /></p>
<h3 id="_2"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#_2">å¾Œè©±</a></h3>
<p>å¦‚æœæœ‰ä»”ç´°çœ‹å…§å®¹çš„è©±ï¼Œå…¶å¯¦æˆ‘çš„æ“ä½œç’°å¢ƒå°±æ˜¯å»ºå¥½ä¸€å€‹ bookinfo ä¹‹å¾Œï¼ŒService Mesh è‡ªå‹•æ³¨å…¥ (inject) Sidecard é€²å»åˆ°æ¯ä¸€å€‹ Podï¼Œæ‰€ä»¥æ‰æœƒæœ‰ 1 å€‹ Pod æœƒæœ‰ 2 å€‹ Container çš„ç¾è±¡ç™¼ç”Ÿï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå€‹äººç¶“é©—é‚„æœ‰å¦‚æœéœ€è¦æ•´åˆç¶²è·¯å» å•†æ‰€æä¾›çš„ CNI Pluginï¼Œä¹Ÿæœ‰æ©Ÿæœƒæœƒé‡åˆ°é€™ç¨®ç­‰ç´šçš„æ“ä½œ</p>
<p>çµè«–ä¸Šä¾†èªªï¼Œé›–ç„¶ Kubernetes æœ€å°å–®ä½æ˜¯ Podï¼Œä¸€èˆ¬æ“ä½œçš„å±¤ç´šéƒ½æ˜¯åœ¨é€™å€‹å±¤ç´šï¼Œä½†è‹¥æƒ³åœ¨ OpenShift ä¸Šé‡å°ç‰¹å®šçš„ Container é€²è¡ŒæŒ‡ä»¤æ“ä½œã€é™¤éŒ¯ï¼Œéƒ½é‚„æ˜¯å¯ä»¥å¾ˆè¼•é¬†åœ°è¾¦åˆ°ï¼Œä¹Ÿç›¸ç•¶çš„ç›´è¦º</p>
<p>æœ€å¾Œï¼Œè«‹å¤§å®¶å¤šå¤šè¨‚é–± Red Hat æœå‹™ã€åˆ†äº«é–‹æºæŠ€è¡“åŠé–‹å•ŸæŠ€è¡“å‹å–„å¥½ç’°å¢ƒï¼Œæˆ‘å€‘å®…å®…å€‘å°±é å„ä½å®¢æˆ¶é¤Šäº† XD</p>
<h3 id="references"><a class="toclink" href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/#references">References</a></h3>
<ul>
<li><a href="https://speakerdeck.com/pichuang/20190817-container-bare-metal-for-networking?slide=6">20190817 Container Bare Metal for Networking</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/05/21/red-hat-openshift-pod-%E8%88%87-container-%E7%9A%84%E6%84%9B%E6%81%A8%E6%83%85%E4%BB%87/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-05-02 00:00:00">May 2, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              5 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift-rbac"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/">Red Hat OpenShift RBAC æœ€å°æ¬Šé™å¯¦è¸</a></h2>
<p>ç¹¼<a href="https://blog.pichuang.com.tw/20200427-openshift-with-coreos-part-5/">ä¸Šä¸€ç¯‡</a>æº–å‚™å¥½äº†åŸºç¤çš„ OpenShift 4 è¶…ç´šç®¡ç†å“¡ <code>ocproot</code> è¨­å®šå¾Œï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ¯”è¼ƒé‡å° Project/Namespace ä¾†é€²è¡Œæ¯”è¼ƒç´°å¾®çš„ RBAC è¨­å®šï¼Œç›¡å¯èƒ½è®“ User æˆ– Group é©ç”¨æ–¼<code>æœ€å°æ¬Šé™åŸå‰‡</code></p>
<p><img alt="" src="/images/rbac-4.png" /></p>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#_1">èµ°é¦¬çœ‹èŠ±ä¹‹æ—…: ç¬¬å…­å¤©</a></h3>
<h4 id="openshift-project"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#openshift-project">å¸¸è¦‹ OpenShift Project æ¬Šé™æŒ‡æ´¾</a></h4>
<p>OpenShift åŸºæœ¬ä¸Šæœƒæœ‰ Users/Groups/Projects å¯ä»¥é€²è¡Œç®¡ç†ï¼Œä»¥ä¸‹åƒè€ƒ <a href="https://blog.csdn.net/weixin_43902588/article/details/103412127">OpenShift 4ä¹‹è®¾ç½®ç”¨æˆ·/ç»„å¯¹é¡¹ç›®çš„è®¿é—®æƒé™</a> çš„æ–‡ç« ä¾†å¯¦ä½œ</p>
<p>é‡å°å°ˆæ¡ˆ <code>project-cicd</code>ã€<code>project-uat</code> ä¹‹ RBAC æ¬Šé™åˆ†é…å¦‚åœ–ç¤º</p>
<p><img alt="" src="/images/rbac-3.png" /></p>
<ul>
<li>Users</li>
<li>Administrators<ul>
<li>admin1/admin1</li>
<li>admin2/admin2</li>
</ul>
</li>
<li>Developers<ul>
<li>developer1/developer1</li>
<li>developer2/developer2</li>
</ul>
</li>
<li>Testers<ul>
<li>tester1/tester1</li>
<li>tester2/tester2</li>
</ul>
</li>
<li>Groups</li>
<li>admin-group: å°æ–¼ <code>project-cicd</code> åŠ <code>project-uat</code>ï¼Œå…·å‚™æœ€é«˜æ¬Šé™</li>
<li>developer-group: å°æ–¼ <code>project-cicd</code> å°ˆæ¡ˆå…·å‚™è¨­å®šæ¬Šé™ï¼Œå° <code>project-uat</code> åƒ…æœ‰æŸ¥çœ‹æ¬Šé™</li>
<li>tester-group: å°æ–¼ <code>project-uat</code> å°ˆæ¡ˆå…·å‚™è¨­å®šæ¬Šé™ï¼Œå° <code>project-cicd</code> åƒ…æœ‰æŸ¥çœ‹æ¬Šé™</li>
<li>Projects</li>
<li>project-cicd: é–‹ç™¼ç”¨ç’°å¢ƒ</li>
<li>
<p>project-uat: UAT ç’°å¢ƒ</p>
</li>
<li>
<p>å¦‚æœæ²’å­˜çš„è©±ï¼Œæ’ˆå‡ºæ—¢æœ‰ç’°å¢ƒ <code>htpasswd</code> æª”æ¡ˆ
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>local-htpasswd-secret<span class="w">  </span>-ojsonpath<span class="o">={</span>.data.htpasswd<span class="o">}</span><span class="w"> </span>-n<span class="w"> </span>openshift-config<span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>localuser-htpasswd
</code></pre></div></p>
</li>
<li>
<p>æ–°å¢ 6 å€‹å¥½æ¼¢é€² <code>localuser-htpasswd</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># ç®¡ç†äººå“¡ admin1ã€admin2 çš†å…·å‚™ project-cicdã€project-uat æœ€é«˜æ¬Šé™</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>admin1<span class="w"> </span>admin1
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>admin2<span class="w"> </span>admin2
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="c1"># é–‹ç™¼äººå“¡ developer1 è¨­å®šå–®ä¸€å°ˆæ¡ˆ project-cicd æ¬Šé™ ä¸” æª¢è¦–å–®ä¸€å°ˆæ¡ˆ project-uat æ¬Šé™</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>developer1<span class="w"> </span>developer1
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="c1"># é–‹ç™¼äººå“¡ developer2 è¨­å®šå–®ä¸€å°ˆæ¡ˆ project-cicd æ¬Šé™ ä¸” æª¢è¦–å–®ä¸€å°ˆæ¡ˆ project-uat æ¬Šé™</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>developer2<span class="w"> </span>developer2
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="c1"># æ¸¬è©¦äººå“¡ tester1 è¨­å®šå–®ä¸€å°ˆæ¡ˆ project-uat æ¬Šé™ ä¸” æª¢è¦–å–®ä¸€å°ˆæ¡ˆ project-cicd æ¬Šé™</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>tester1<span class="w"> </span>tester1
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="c1"># æ¸¬è©¦äººå“¡ tester2 è¨­å®šå–®ä¸€å°ˆæ¡ˆ project-uat æ¬Šé™ ä¸” æª¢è¦–å–®ä¸€å°ˆæ¡ˆ project-cicd æ¬Šé™</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>tester2<span class="w"> </span>tester2
</code></pre></div></p>
</li>
<li>
<p>æª¢æŸ¥ localuser-htpasswd
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Show all user mapping</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>$<span class="w"> </span>cat<span class="w"> </span>localuser-htpasswd
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>ocproot:<span class="nv">$2</span>y<span class="nv">$05$pMTSySH</span>/qa.gTcom9q/Pd.WHoI8VMIpCHWgc9d7cnQuIbRuuPeMia
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>developer1:<span class="nv">$apr1$f7fpvHKb$X</span>.MnMay0USf0.SOg/4hm6.
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>developer2:<span class="nv">$apr1$FtL</span>.4QEj<span class="nv">$lQgfnYB42klWq5</span>.BYnUxx0
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>tester1:<span class="nv">$apr1$AuGDNNK</span>/<span class="nv">$U9Y0ytnT3qrakKat6jYkD1</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>tester2:<span class="nv">$apr1$z1H</span>./q7P<span class="nv">$cvi62jxjmDOyMHQ</span>/Gsx6R0
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>admin1:<span class="nv">$apr1$tUyAimmD$uXc2my4xMGitt</span>/hekx6SH/
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>admin2:<span class="nv">$apr1$rbFALSqT$6</span>emskSJsH8LD0ptM5eXlK1
</code></pre></div></p>
</li>
<li>
<p>æ›´æ–°æ—¢æœ‰çš„ <code>local-htpasswd-secret</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>$<span class="w"> </span>oc<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>local-htpasswd-secret<span class="w"> </span>--from-file<span class="w"> </span><span class="nv">htpasswd</span><span class="o">=</span>/root/user/localuser-htpasswd<span class="w"> </span>--dry-run<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>-n<span class="w"> </span>openshift-config<span class="w"> </span><span class="p">|</span><span class="w"> </span>oc<span class="w"> </span>replace<span class="w"> </span>-f<span class="w"> </span>-
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>secret/local-htpasswd-secret<span class="w"> </span>replaced
</code></pre></div></p>
</li>
</ul>
<h4 id="_2"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#_2">ç®¡ç†è³‡æºåŠè³¦äºˆæ¬Šé™</a></h4>
<p>OpenShfit é è¨­æ¬Šé™æ§åˆ¶èƒ½åšåˆ° 3 ç¨®å±¤ç´šï¼Œåˆ†åˆ¥æ˜¯ï¼š
1. æŒ‡å®š Roles çµ¦ user æˆ– groups
  - role-to-user
  - role-to-group
2. æŒ‡å®š Cluster Roles çµ¦ users æˆ– groups
  - cluster-role-to-user
  - cluster-role-to-group
3. æŒ‡å®š SCC (Security Context Constraints) ä¾†ç®¡ç† Pods å’Œ Containers çµ¦ users æˆ– groups
  - scc-to-user
  - scc-to-group</p>
<p>å¦‚æœæƒ³è¦æŸ¥è©¢æœ‰ä»€éº¼ Role å¯ä»¥ä½¿ç”¨çš„è©±ï¼Œå¯ä»¥ç”¨ <code>oc get clusterrole.rbac</code> æ’ˆï¼Œç›¸ç•¶å¤šè¨˜å¾—è¦ filter ä¸€ä¸‹</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Create Projects</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>$<span class="w"> </span>oc<span class="w"> </span>new-project<span class="w"> </span>project-cicd
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>$<span class="w"> </span>oc<span class="w"> </span>new-project<span class="w"> </span>project-uat
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1"># Create groups</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>new<span class="w"> </span>admin-group
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>new<span class="w"> </span>developer-group
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>new<span class="w"> </span>tester-group
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="c1"># Assgin Users and Groups</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>add-users<span class="w"> </span>admin-group<span class="w"> </span>admin1<span class="w"> </span>admin2
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>group.user.openshift.io/admin-group<span class="w"> </span>added:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;admin1&quot;</span><span class="w"> </span><span class="s2">&quot;admin2&quot;</span><span class="o">]</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>add-users<span class="w"> </span>developer-group<span class="w"> </span>developer1<span class="w"> </span>developer2
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>group.user.openshift.io/developer-group<span class="w"> </span>added:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;developer1&quot;</span><span class="w"> </span><span class="s2">&quot;developer2&quot;</span><span class="o">]</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>groups<span class="w"> </span>add-users<span class="w"> </span>tester-group<span class="w"> </span>tester1<span class="w"> </span>tester2
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>group.user.openshift.io/tester-group<span class="w"> </span>added:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;tester1&quot;</span><span class="w"> </span><span class="s2">&quot;tester2&quot;</span><span class="o">]</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a><span class="c1"># Assgin Role to Group within Project</span>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="c1"># For admin-group</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>admin<span class="w"> </span>admin-group<span class="w"> </span>-n<span class="w"> </span>project-cicd
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>admin<span class="w"> </span>admin-group<span class="w"> </span>-n<span class="w"> </span>project-uat
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="c1"># For developer-group</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>edit<span class="w"> </span>developer-group<span class="w"> </span>-n<span class="w"> </span>project-cicd
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>view<span class="w"> </span>developer-group<span class="w"> </span>-n<span class="w"> </span>project-uat
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a><span class="c1"># For tester-group</span>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>edit<span class="w"> </span>tester-group<span class="w"> </span>-n<span class="w"> </span>project-cicd
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-group<span class="w"> </span>view<span class="w"> </span>tester-group<span class="w"> </span>-n<span class="w"> </span>project-uat
</code></pre></div>
<h3 id="appendix"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#appendix">Appendix</a></h3>
<h4 id="rbac"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#rbac">äº†è§£ RBAC è§’è‰²æ¬Šé™</a></h4>
<p><img alt="" src="/images/rbac-6.png" /></p>
<p>ä¾ç…§ <a href="https://docs.openshift.com/container-platform/4.3/authentication/using-rbac.html#default-roles_using-rbac">OpenShift é è¨­ RBAC è§’è‰²å®šç¾©</a>ï¼Œæˆ‘å€‘æ–°å¢ä»¥ä¸‹å¸³è™Ÿé€²å»è§€æ¸¬ï¼Œä¸¦ä¸”åšå€‹åŸºæœ¬æ­¸ç´
  - cluster-admin-user/cluster-admin
  - cluster-status-user/cluster-status
  - admin-user/admin
  - basic-user/basic-user
  - self-provisioner-user/self-provisioner
  - edit-user/edit
  - view-user/view</p>
<ol>
<li>
<p>æ–°å¢å¸³è™Ÿ
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1"># cluster-adminï¼Œé¡åŒæ–¼ Linux root åœ¨ OpenShift ä¸­çš„è¶…ç´šç®¡ç†å“¡è§’è‰²</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>cluster-admin-user<span class="w"> </span>cluster-admin
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="c1"># cluster-statusï¼Œå¯ä»¥ç²å–åŸºæœ¬çš„ Cluster è³‡è¨Š</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>cluster-status-user<span class="w"> </span>cluster-status
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="c1"># adminï¼Œå°ˆæ¡ˆç®¡ç†è€…ï¼Œå¯ä»¥æŸ¥çœ‹ä¿®æ”¹å°ˆæ¡ˆä¸­ä»»ä½•è³‡è¨Š</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>admin-user<span class="w"> </span>admin
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="c1"># basic-userï¼Œå¯ä»¥æª¢è¦–å°ˆæ¡ˆä¸­ä»»ä½•è³‡è¨Š</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>basic-user<span class="w"> </span>basic-user
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="c1"># self-provisionerï¼Œå¯ä»¥è‡ªå·±é–‹å°ˆæ¡ˆ</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>self-provisioner-user<span class="w"> </span>self-provisioner
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="c1"># editï¼Œå¯ä»¥ä¿®æ”¹è³‡æºï¼Œä½†ä¸èƒ½çœ‹ä¸”ä¿®æ”¹ Role ç¶å®š</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>edit-user<span class="w"> </span>edit
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="c1"># viewï¼Œåªèƒ½æª¢è¦–è³‡æºï¼Œä½†ä¸èƒ½é€²è¡Œä»»ä½•ä¿®æ”¹</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>view-user<span class="w"> </span>view
</code></pre></div></p>
</li>
<li>
<p>æ›´æ–°æ—¢æœ‰çš„ <code>local-htpasswd-secret</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>$<span class="w"> </span>oc<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>local-htpasswd-secret<span class="w"> </span>--from-file<span class="w"> </span><span class="nv">htpasswd</span><span class="o">=</span>/root/user/localuser-htpasswd<span class="w"> </span>--dry-run<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>-n<span class="w"> </span>openshift-config<span class="w"> </span><span class="p">|</span><span class="w"> </span>oc<span class="w"> </span>replace<span class="w"> </span>-f<span class="w"> </span>-
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>secret/local-htpasswd-secret<span class="w"> </span>replaced
</code></pre></div></p>
</li>
<li>
<p>å„å€‹é¡¯ç¤º User ç‹€æ…‹
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># https://docs.openshift.com/container-platform/4.3/authentication/using-rbac.html#default-roles_using-rbac</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="c1"># Cluster Level</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># å¸¸ç”¨æ–¼é›†ç¾¤ç®¡ç†å“¡ï¼Œé¡åŒæ–¼ Linux root çš„å­˜åœ¨</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-cluster-role-to-user<span class="w"> </span>cluster-admin<span class="w"> </span>cluster-admin-user
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac.authorization.k8s.io/cluster-admin
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-cluster-role-to-user<span class="w"> </span>cluster-status<span class="w"> </span>cluster-status-user
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>cluster-status
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="c1"># Project Level</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="c1"># å¸¸ç”¨æ–¼æŒ‡å®š Project å…·å‚™ administrator æ¬Šé™</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-user<span class="w"> </span>admin<span class="w"> </span>admin-user
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>admin
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="c1"># å¸¸ç”¨æ–¼æŒ‡å®š Project å…·å‚™ edit æ¬Šé™ï¼Œä¾‹å¦‚é–‹ç™¼äººå“¡</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-user<span class="w"> </span>edit<span class="w"> </span>edit-user
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>edit
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="c1"># å¸¸ç”¨æ–¼æŒ‡å®š Project å…·å‚™ view æ¬Šé™ï¼Œä¾‹å¦‚éé–‹ç™¼ï¼Œä½†å…·å°ˆæ¡ˆç›¸é—œæ€§ä¹‹äººå“¡</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-user<span class="w"> </span>view<span class="w"> </span>view-user
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>view
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="c1"># Misc</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="c1"># éŠå®¢å¸³è™Ÿ</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-user<span class="w"> </span>basic-user<span class="w"> </span>basic-user
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>basic-user
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-role-to-user<span class="w"> </span>self-provisioner<span class="w"> </span>self-provisioner-user
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>$<span class="w"> </span>oc<span class="w"> </span>describe<span class="w"> </span>clusterrole.rbac<span class="w"> </span>self-provisioner
</code></pre></div></p>
</li>
</ol>
<h3 id="_3"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#_3">å¾Œè©±</a></h3>
<p>ä¾æ“š <a href="https://www.slideshare.net/chakrekevin/introduction-to-ethical-hacking-41597834">Introduction To Ethical Hacking</a> ä¸­çš„å®‰å…¨ (Security), åŠŸèƒ½ (Functionality) å’Œæ–¹ä¾¿ (Usability) å¤§ä¸‰è§’</p>
<p><img alt="" src="/images/rbac-5.png" /></p>
<p>é€™å€‹å¤§ä¸‰è§’æ˜¯ä»£è¡¨ï¼Œè‹¥ä½ æ˜¯è¦ç³»çµ±ï¼Œæ¯”è¼ƒå®‰å…¨åŠå…·å‚™å®Œæ•´åŠŸèƒ½ï¼Œé‚£å°±ä¸å¯èƒ½æœƒå¾ˆæ–¹ä¾¿ä½¿ç”¨ï¼Œåä¹‹ï¼Œå¦‚æœè¦å®‰å…¨åˆè¦æ–¹ä¾¿ä½¿ç”¨ï¼Œé‚£åŠŸèƒ½å°±ä¸æœƒå¤šã€‚è€Œ OpenShift çœ‹èµ·ä¾†æ˜¯æ¯”è¼ƒåå‘å®‰å…¨å’ŒåŠŸèƒ½é€™é‚Šï¼Œæ‰€ä»¥ä¸ç†Ÿæ‚‰åŸºæœ¬æ“ä½œçš„è©±ï¼Œæœƒè¦ºå¾—æœ‰é»ç„ï¼Œä½ æœ‰æ²’æœ‰è¦ºå¾—é€™å€‹è·Ÿç•¶å¹´å­¸ Linux ä½œæ¥­ç³»çµ±éå¸¸åƒå‘¢ï¼Ÿ</p>
<h3 id="references"><a class="toclink" href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/#references">References</a></h3>
<ul>
<li><a href="https://docs.openshift.com/container-platform/4.3/authentication/using-rbac.html#default-roles_using-rbac">Using RBAC - OpenShift 4.3</a></li>
<li><a href="https://blog.csdn.net/weixin_43902588/article/details/103412127">OpenShift 4ä¹‹è®¾ç½®ç”¨æˆ·/ç»„å¯¹é¡¹ç›®çš„è®¿é—®æƒé™</a></li>
<li><a href="https://blog.csdn.net/weixin_43902588/article/details/103414273">OpenShift 4ä¹‹è®¿é—®æƒé™åˆ†çº§æˆæƒ</a></li>
<li><a href="https://blog.csdn.net/weixin_43902588/article/details/104470294">OpenShift 4 Hands-on Lab (9) ç”¨æˆ·èº«ä»½è®¤è¯å’Œèµ„æºè®¿é—®é™åˆ¶</a></li>
<li><a href="https://blog.pichuang.com.tw/20200427-openshift-with-coreos-part-5/">æ„›çš„èµ°é¦¬çœ‹èŠ± Red Hat CoreOS èˆ‡ Red Hat OpenShift Part 5</a></li>
<li><a href="https://www.slideshare.net/chakrekevin/introduction-to-ethical-hacking-41597834">Introduction To Ethical Hacking</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/05/02/red-hat-openshift-rbac-%E6%9C%80%E5%B0%8F%E6%AC%8A%E9%99%90%E5%AF%A6%E8%B8%90/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://avatars.githubusercontent.com/u/5253671" alt="Phil Huang">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2020-04-27 00:00:00">April 27, 2020</time></li>
        
          <li class="md-meta__item">
            in
            
              <a href="../../../../category/kubernetes/" class="md-meta__link">kubernetes</a></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="red-hat-openshift"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/">ç•¶å®‰è£å®Œ Red Hat OpenShift ä¹‹å¾Œ...</a></h2>
<p>å¦‚æœæœ‰æœ‹å‹å‰›å¼„å¥½ OpenShift 4 å¯èƒ½å°æ–¼å¾ˆå¤šé è¨­æ©Ÿåˆ¶æ„Ÿåˆ°æœ‰é»ç‹ç–‘ï¼Œé€™ç¯‡æ–‡ç« å°±æ˜¯è¦ä¾†è§£é‡‹ï¼Œå®‰è£å®Œ OpenShift 4 å¾Œï¼Œæœ€é‡è¦çš„å°äº‹ - å¸³è™Ÿæ¬Šé™èªè­‰ (Authentication)</p>
<p>Red Hat OpenShift çš„æ¬Šé™èªè­‰ä¸€å¦‚ç¹¼å¾€éƒ½æ˜¯æ¡ç”¨è§’è‰²å‹å­˜å–æ§åˆ¶ (Role Based Access Control, RBAC)ï¼Œé€™é‚Šå°±è¦ä¾†æº–å‚™é–‹å§‹å‹™å¯¦ä¸€é»çš„æ“ä½œï¼Œæœ¬æ–‡å…ˆå¾ç°¡å–®çš„æŠŠé è¨­å¸³è™Ÿç½®æ›é–‹å§‹åšèµ·</p>
<p><img alt="" src="/images/rbac.png" /></p>
<blockquote>
<p>åœ–ç‰‡å‡ºè™•: ã€æœ€çµ‚å¹»æƒ³7ï¼šé‡è£½ç‰ˆã€‘4Ké›»å½±å‰ªè¼¯ç‰ˆ(å¾Œç¯‡) - é›¶æ”¶é›†ã€é›»å½±å¼é‹é¡ã€å®Œæ•´åŠ‡æƒ… - PS4 Proå¢å¼·æ¨¡å¼ - Final Fantasy VII: REMAKE - å¤ªç©ºæˆ°å£«7- Semenixå‡ºå“</p>
</blockquote>
<p>è©±èªªå¤§å®¶ä¹Ÿå¯ä»¥å¤šå¤šæ”¯æŒä¸€ä¸‹ <a href="https://www.youtube.com/watch?v=4CS9KvnVFs0">Semenix Gaming</a> -  å¤§å¤§çš„å½±ç‰‡ï¼Œæˆ‘çš„åœ–ç‰‡éƒ½æ˜¯æˆªä»–çš„é »é“ï¼ŒéŒ„çš„å½±ç‰‡ç›¸ç•¶æœ‰æ°´æº–ï¼Œæœ€è¿‘éƒ½åœ¨çœ‹å®ƒçš„å½±ç‰‡ç•¶ä½œè‡ªå·±æœ‰åœ¨æ‰“å¤ªä¸ƒ Q_Q</p>
<!--more-->

<h3 id="_1"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#_1">èµ°é¦¬çœ‹èŠ±ä¹‹æ—…: ç¬¬äº”å¤©</a></h3>
<p>é è¨­å‰›è£å®Œ OpenShift 4ï¼Œæ‡‰è©²éƒ½æœƒæ‹¿åˆ° 3 å€‹è³‡è¨Š</p>
<ul>
<li>Web Console: https://console-openshift-console.apps.ocp4.internal/dashboards</li>
<li>Username: <code>kubeadmin</code></li>
<li>Password: <code>XXXX-XXXX-XXXX-XXXX</code></li>
</ul>
<p>ä½†å› ç‚ºé è¨­å¸³è™Ÿå°è‡´çš„è³‡å®‰è­°é¡Œï¼Œé€™å€‹é è¨­çš„ <code>kubeadmin</code> åŠ <code>XXXX-XXXX-XXXX-XXXX</code> ä¸å»ºè­°æŒçºŒä½¿ç”¨ï¼Œå»ºè­°æ˜¯æ›æˆåˆ¥çš„å¸³è™Ÿæ›¿æ›å®ƒæ—¢æœ‰çš„è§’è‰² <code>cluster-admin</code>ï¼Œè©³è«‹å¯åƒè€ƒ <a href="https://docs.openshift.com/container-platform/4.3/authentication/remove-kubeadmin.html">Removing the kubeadmin user - OpenShift 4.3</a></p>
<h4 id="htpasswd-identity-provider"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#htpasswd-identity-provider">æº–å‚™ HTPasswd Identity Provider</a></h4>
<p>é è¨ˆå°‡ <code>kubeadmin</code> ç½®æ›æˆ <code>ocproot</code>ï¼Œæ¬Šé™ä¹Ÿè¦ä¸€ä½µç§»è½‰ï¼Œå°‡é€é <code>HTPasswd Identity Porvider</code> çš„æ–¹å¼å°‡å¸³è™Ÿè¨­å®šå¥½</p>
<h5 id="oauth"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#oauth">è¨­å®š OAuth è³‡æº</a></h5>
<p>é€™é‚Šå…ˆé–‹å•Ÿä¸€å€‹æª”æ¡ˆ <code>oauth.yaml</code>ï¼Œæ–°å¢ <code>identityProvider</code> åå­—ç‚º <code>local_htpasswd_provider</code>ï¼Œå½¢å¼ç‚º <code>HTPasswd</code>ï¼Œå¸³è™Ÿå¯†ç¢¼å°ç…§è¡¨æ”¾åœ¨ <code>local-htpasswd-secret</code> è£¡é¢ã€‚</p>
<p>ç•¶ä¸­çš„ <code>local-htpasswd-secret</code> å°‡ä¹‹å¾Œå†æ–°å¢ï¼Œæ‰€ä»¥ä¸ç”¨é€™æ™‚å€™å…ˆæº–å‚™</p>
<p>```yaml oauth.yaml
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: local_htpasswd_provider
    challenge: true
    login: true
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: local-htpasswd-secret
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>```bash
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a># Update OAuth CRD
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>$ oc apply -f oauth.yaml
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>oauth.config.openshift.io/cluster configured
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a># Check
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>$ oc describe oauth cluster
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a># Update in the future if needed
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>$ oc get oauth cluster -o yaml &gt; oauth.yaml
</code></pre></div></p>
<h4 id="-ocproot"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#-ocproot">è¨­å®šæ–°çš„æœ€é«˜æ¬Šé™å¸³è™Ÿ - ocproot</a></h4>
<p>é€™é‚Šå°ç…§éå¾€ Linux æ“ä½œç³»çµ±çš„ç¿’æ…£ï¼Œæˆ‘è‡ªè¡Œå–å <code>ocproot</code>ï¼Œå¦‚æœä½ æƒ³è¦å–åˆ¥çš„ä¹Ÿå¯ä»¥ï¼Œè«‹è‡ªè¡Œä¿®æ”¹æ²’å•é¡Œ</p>
<ol>
<li>ç¢ºä¿ä½ æœ‰ <code>htpasswd</code> å¯ä»¥ä½¿ç”¨</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Make sure you have htpasswd</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>httpd-tools<span class="w"> </span>-y
</code></pre></div>
<ol>
<li>æ–°å¢ <code>local-htpasswd-secret</code> æª”æ¡ˆï¼Œæ–°å¢ <code>ocproot/ocproot</code> é€²å»</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># Create</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>$<span class="w"> </span>htpasswd<span class="w"> </span>-c<span class="w"> </span>-B<span class="w"> </span>-b<span class="w"> </span>localuser-htpasswd<span class="w"> </span>ocproot<span class="w"> </span>ocproot
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>Adding<span class="w"> </span>password<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span>ocproot
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>$<span class="w"> </span>cat<span class="w"> </span>localuser-htpasswd
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>ocproot:<span class="nv">$2</span>y<span class="nv">$05$pMTSySH</span>/qa.gTcom9q/Pd.WHoI8VMIpCHWgc9d7cnQuIbRuuPeMia
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="c1"># Update if needed</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="c1"># $ htpasswd -b localuser-htpasswd ocproot ocproot</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="c1"># Remove if needed</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="c1"># $ htpasswd -D localuser-htpasswd ocproot ocproot</span>
</code></pre></div>
<ol>
<li>æ–°å¢ <code>HTpasswd</code> é€²å»åˆ° OpenShift è£¡é¢</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>$<span class="w"> </span>oc<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>local-htpasswd-secret<span class="w"> </span>--from-file<span class="w"> </span><span class="nv">htpasswd</span><span class="o">=</span>/root/user/localuser-htpasswd<span class="w"> </span>-n<span class="w"> </span>openshift-config
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>secret/local-htpasswd-secret<span class="w"> </span>created
</code></pre></div>
<ol>
<li>æ–°å¢å¢é›†æœ€é«˜æ¬Šé™ <code>cluster-admin</code> çµ¦ <code>ocproot</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>$<span class="w"> </span>oc<span class="w"> </span>adm<span class="w"> </span>policy<span class="w"> </span>add-cluster-role-to-user<span class="w"> </span>cluster-admin<span class="w"> </span>ocproot
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>clusterrole.rbac.authorization.k8s.io/cluster-admin<span class="w"> </span>added:<span class="w"> </span><span class="s2">&quot;ocproot&quot;</span>
</code></pre></div>
<ol>
<li>æ¸¬è©¦ <code>ocproot</code>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>$<span class="w"> </span>oc<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span>ocproot
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>oc<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span>ocproot
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Authentication<span class="w"> </span>required<span class="w"> </span><span class="k">for</span><span class="w"> </span>https://api.ocp4.internal:6443<span class="w"> </span><span class="o">(</span>openshift<span class="o">)</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>Username:<span class="w"> </span>ocproot
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>Password:
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>Login<span class="w"> </span>successful.
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>$<span class="w"> </span>oc<span class="w"> </span>whoami
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>ocproot
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>users
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>NAME<span class="w">      </span>UID<span class="w">                                    </span>FULL<span class="w"> </span>NAME<span class="w">   </span>IDENTITIES
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>ocproot<span class="w">   </span>3635b015-3664-4836-a5a0-2aff1100d99c<span class="w">               </span>local_htpasswd_provider:ocproot
</code></pre></div></li>
</ol>
<p><img alt="" src="/images/ocproot.png" /></p>
<h5 id="kubeadmin"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#kubeadmin">ç§»é™¤ <code>kubeadmin</code> å¸³è™Ÿ</a></h5>
<p>æ ¹æ“š <a href="https://docs.openshift.com/container-platform/4.3/authentication/remove-kubeadmin.html">Removing the kubeadmin user - OpenShift 4.3</a> ä¾†ç§»é™¤é è¨­å¸³è™Ÿ <code>kubeadmin</code>ï¼Œå‹™å¿…è¦è¨˜å¾—ï¼Œä½ çš„é›†ç¾¤è£¡é¢ä¸€å®šè¦æœ‰</p>
<ul>
<li>ä¸€å€‹ä»¥ä¸Šçš„ <code>Identity Provider</code>ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨ <code>HTpasswd</code></li>
<li>ä¸€å€‹ä»¥ä¸Šçš„å¸³è™Ÿå…·å‚™ <code>cluster-admin</code> çš„æ¬Šé™</li>
</ul>
<p>ä¸ç„¶ä½ æœƒç™»ä¸é€²å»é›†ç¾¤ = =ï¼Œé€™æ˜¯ä¸å¯é€†çš„æŒ‡ä»¤</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># Remove it</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>$<span class="w"> </span>oc<span class="w"> </span>delete<span class="w"> </span>secrets<span class="w"> </span>kubeadmin<span class="w"> </span>-n<span class="w"> </span>kube-system
</code></pre></div>
<h5 id="_2"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#_2">ä¿®æ”¹è‡ªå‹•ç™»å‡ºæ™‚é–“</a></h5>
<p>æ ¹æ“š <a href="https://docs.openshift.com/container-platform/4.3/authentication/configuring-internal-oauth.html">Configuring the internal OAuth server - OpenShift 4.3</a>ï¼Œè·Ÿ OpenShift 3 ä¸€æ¨£ï¼Œéƒ½æ˜¯è¦ä¿®æ”¹ <code>accessTokenMaxAgeSeconds</code> å€¼ï¼Œé è¨­æ™‚é–“æ‡‰è©²æ˜¯ <code>86400</code>ï¼Œä¹Ÿå°±æ˜¯ 24 å°æ™‚å¾Œç™»å‡ºï¼Œå› ç‚ºå¤ªé•·äº†ï¼Œæ‰€ä»¥æ”¹ç‚º <code>3600</code>ï¼Œä¹Ÿå°±æ˜¯ç™»å…¥ 1 å°æ™‚å¾Œè‡ªå‹•ç™»å‡º</p>
<p>```yaml oauth.yaml
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: local_htpasswd_provider
    challenge: true
    login: true
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: local-htpasswd-secret
  tokenConfig:
    accessTokenMaxAgeSeconds: 3600
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>å¦‚åŒä¿®æ”¹ OAuth ã„§æ¨£ï¼ŒåŸ·è¡Œä¸‹åˆ—æ“ä½œå³å¯
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>```bash
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a># Update OAuth CRD
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>$ oc apply -f oauth.yaml
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>oauth.config.openshift.io/cluster configured
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a># Check
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>$ oc describe oauth cluster
</code></pre></div></p>
<h3 id="_3"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#_3">çµèª</a></h3>
<p>åšå®Œä¸Šé¢çš„æ­¥é©Ÿï¼Œåªæ˜¯å‰›å‰›å¥½æº–å‚™é–‹å§‹ä»¥æ­£ç¢ºä¸”å®‰å…¨çš„å§¿å‹¢æ“ä½œ OpenShift 4ï¼Œä¸‹ä¸€ç¯‡æœƒæåˆ°æ›´è¤‡é›œçš„ Users/Groups/Projects çš„ RBAC æ§åˆ¶æ“ä½œ</p>
<p>å° æˆ‘çŸ¥é“ä½ çš„è¡€æ¢å°±è·Ÿä¸‹åœ–ã„§æ¨£</p>
<p><img alt="" src="/images/rbac-2.png" /></p>
<h3 id="appendix"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#appendix">Appendix</a></h3>
<h4 id="q-error-x509-certificate-signed-by-unknown-authority"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#q-error-x509-certificate-signed-by-unknown-authority">Q: ç™»å…¥æ™‚ï¼Œé‡åˆ° <code>error: x509: certificate signed by unknown authority</code></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>$<span class="w"> </span>oc<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span>ocproot<span class="w"> </span>--insecure-skip-tls-verify<span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>error:<span class="w"> </span>x509:<span class="w"> </span>certificate<span class="w"> </span>signed<span class="w"> </span>by<span class="w"> </span>unknown<span class="w"> </span>authority
</code></pre></div>
<p>é€™å•é¡Œæ˜¯å› ç‚ºé è¨­æ˜¯è‡ªç°½æ†‘è­‰ (Self-Signed)ï¼Œç³»çµ±æ²’æœ‰å®‰è£é€™å¼µè‡ªç°½çš„ CA ï¼Œæ‰€ä»¥è¦ç‰¹åˆ¥æ‹‰å‡ºä¾†å®‰è£åœ¨ç³»çµ±æˆ–è€…æ˜¯åœ¨ä½ çš„ç­†é›»ä¸Š</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>$<span class="w"> </span>oc<span class="w"> </span>project<span class="w"> </span>openshift-authentication
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="c1"># Same content</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>$<span class="w"> </span>oc<span class="w"> </span>get<span class="w"> </span>pods
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a>NAME<span class="w">                               </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>oauth-openshift-74fbdf999f-6kpnn<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>10m
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a>oauth-openshift-74fbdf999f-787cm<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>10m
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="c1"># Pick one and copy the cert to outside</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>$<span class="w"> </span>oc<span class="w"> </span>rsh<span class="w"> </span>oauth-openshift-74fbdf999f-6kpnn<span class="w"> </span>cat<span class="w"> </span>/run/secrets/kubernetes.io/serviceaccount/ca.crt<span class="w"> </span>&gt;<span class="w"> </span>ocp4-ingress-ca.crt
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="c1"># It work on RHEL 7.7</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a>$<span class="w"> </span>cp<span class="w"> </span>ocp4-ingress-ca.crt<span class="w"> </span>/etc/pki/ca-trust/source/anchors/
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a>$<span class="w"> </span>update-ca-trust<span class="w"> </span>extract
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="c1"># Verify Cert is working</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>$<span class="w"> </span>openssl<span class="w"> </span>verify<span class="w"> </span>ocp4-ingress-ca.crt
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>ocp4-ingress-ca.crt:<span class="w"> </span>OK
</code></pre></div>
<h4 id="systemadmin"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#systemadmin">åˆ‡æ›å› <code>system:admin</code></a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>$<span class="w"> </span>oc<span class="w"> </span>whoami
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>ocproot
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>$<span class="w"> </span>oc<span class="w"> </span>config<span class="w"> </span>use-context<span class="w"> </span>admin
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>Switched<span class="w"> </span>to<span class="w"> </span>context<span class="w"> </span><span class="s2">&quot;admin&quot;</span>.
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>$<span class="w"> </span>oc<span class="w"> </span>whoami
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>system:admin
</code></pre></div>
<h3 id="references"><a class="toclink" href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/#references">References</a></h3>
<ul>
<li><a href="https://access.redhat.com/solutions/1519813">KB1519813: How to install a CA certificate on Red Hat Enterprise Linux 6 and later</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/authentication/remove-kubeadmin.html">Removing the kubeadmin user - OpenShift 4.3</a></li>
<li><a href="https://blog.csdn.net/weixin_43902588/article/details/103412127">OpenShift 4ä¹‹è®¾ç½®ç”¨æˆ·/ç»„å¯¹é¡¹ç›®çš„è®¿é—®æƒé™</a></li>
<li><a href="https://blog.csdn.net/weixin_43902588/article/details/103391438">OpenShift 4 ä¹‹å¢åŠ ç®¡ç†å‘˜ç”¨æˆ·</a></li>
<li><a href="https://docs.openshift.com/container-platform/4.3/authentication/configuring-internal-oauth.html">Configuring the internal OAuth server - OpenShift 4.3</a></li>
</ul>
    <nav class="md-post__action">
      <a href="../../../../2020/04/27/%E7%95%B6%E5%AE%89%E8%A3%9D%E5%AE%8C-red-hat-openshift-%E4%B9%8B%E5%BE%8C/">
        Continue reading
      </a>
    </nav>
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <a class="md-pagination__link" href="../2/">2</a> <span class="md-pagination__current">3</span> <a class="md-pagination__link" href="../4/">4</a> <a class="md-pagination__link" href="../5/">5</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/pichuang" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/phil-huang-09b09895" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/@pichuang-tw" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="http://speakerdeck.com/pichuang" target="_blank" rel="noopener" title="speakerdeck.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M213.86 296H100a100 100 0 0 1 0-200h132.84a40 40 0 0 1 0 80H98c-26.47 0-26.45 40 0 40h113.82a100 100 0 0 1 0 200H40a40 40 0 0 1 0-80h173.86c26.48 0 26.46-40 0-40zM298 416a120.21 120.21 0 0 0 51.11-80h64.55a19.83 19.83 0 0 0 19.66-20V196a19.83 19.83 0 0 0-19.66-20H296.42a60.77 60.77 0 0 0 0-80h136.93c43.44 0 78.65 35.82 78.65 80v160c0 44.18-35.21 80-78.65 80z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["announce.dismiss", "content.code.copy", "content.code.annotate", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.path", "navigation.sections", "navigation.indexes", "navigation.expand", "navigation.prune", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "header.autohide"], "search": "../../../../assets/javascripts/workers/search.1e90e0fb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.8e8db93a.min.js"></script>
      
    
  </body>
</html>